import{r as h,_ as F,D as L,R as w,B as V,a6 as O,P as u,a7 as $,H,a8 as Q,a9 as J,j as e,e as k,c as q,F as K,aa as W,f as T,i as R}from"./index-CKcFKU7h.js";import{C as X}from"./CRow-6GBEGtvd.js";import{C as z}from"./CCol-Bfnlt4mm.js";import{C as B}from"./CCardHeader-BJVPw31J.js";import{C as S,a as j}from"./CListGroupItem-CUarwIc_.js";import{C as G}from"./DefaultLayout-Xwng9yPx.js";import{C as Y,a as f}from"./CPaginationItem-22HnPUyI.js";import"./index.esm-DAwbp2WG.js";import"./ex-CELXs5B0.js";var E=h.forwardRef(function(a,N){var n,v=a.children,A=a.className,y=a.color,i=a.shape,m=a.size,o=a.src,d=a.status,g=a.textColor,C=F(a,["children","className","color","shape","size","src","status","textColor"]),b=d&&L("avatar-status","bg-".concat(d));return w.createElement("div",V({className:L("avatar",(n={},n["bg-".concat(y)]=y,n["avatar-".concat(m)]=m,n["text-".concat(g)]=g,n),i,A)},C,{ref:N}),o?w.createElement("img",{src:o,className:"avatar-img"}):v,d&&w.createElement("span",{className:b}))});E.propTypes={children:u.node,className:u.string,color:H,shape:$,size:u.string,src:u.string,status:u.string,textColor:O};E.displayName="CAvatar";const le=()=>{const[a,N]=h.useState({name:"",username:"",email:"",role:"",department:"",permissions:[]}),[n,v]=h.useState(!1),[A,y]=h.useState(!0),[i,m]=h.useState(1),o=5,d=sessionStorage.getItem("userId"),{data:g=[],isLoading:C,error:b,refetch:Z}=Q(void 0,{skip:!n,credentials:"include"}),{data:P,isLoading:D}=J(d,{skip:!d,credentials:"include"});h.useEffect(()=>{const s=sessionStorage.getItem("permissions"),c={name:sessionStorage.getItem("name")||"Unknown Name",username:sessionStorage.getItem("username")||"Unknown Username",email:sessionStorage.getItem("email")||"Unknown Email",role:sessionStorage.getItem("role")||"Unknown Role",department:sessionStorage.getItem("department")||"Unknown Department",permissions:s?JSON.parse(s):[]};N(c)},[]);const I=[...new Set([...a.permissions||[],...(P==null?void 0:P.permissions)||[]])],M=s=>{var c,l,t,r,p,U;return(c=s.action)!=null&&c.includes("/logs/activity")||(l=s.action)!=null&&l.includes("/user-activity")||(t=s.description)!=null&&t.includes("performed POST on")||(r=s.description)!=null&&r.includes("performed GET on")?null:{...s,action:(p=s.action)==null?void 0:p.replace(/^(POST|GET|PUT|DELETE)\s/,"").replace(/^\/api\//,""),description:(U=s.description)==null?void 0:U.replace(/User performed \w+ on /,"")}},x=(g||[]).map(M).filter(s=>s!==null);return e.jsx("div",{className:"profile-container",children:e.jsxs(X,{className:"profile-row",children:[e.jsx(z,{lg:n?6:12,md:12,className:"mb-4",children:e.jsxs(k,{className:"profile-card h-100",children:[e.jsxs(B,{className:"profile-header",children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(q,{color:"primary",variant:"ghost",className:"activity-toggle-btn",onClick:()=>v(!n),children:e.jsx(K,{icon:W})})}),e.jsxs("div",{className:"text-center profile-avatar-section",children:[e.jsx(E,{color:"primary",textColor:"white",size:"xl",className:"profile-avatar mb-3",children:a.name?a.name[0].toUpperCase():"U"}),e.jsx("h2",{className:"mb-1",children:a.name}),e.jsxs("p",{className:"text-medium-emphasis",children:["@",a.username]})]})]}),e.jsxs(T,{children:[e.jsxs(S,{flush:!0,className:"user-details",children:[e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Email:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.email})]}),e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Role:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.role})]}),e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Department:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.department})]})]}),e.jsxs("div",{className:"permissions-section mt-4",children:[e.jsx("h4",{className:"mb-3",children:"Permissions"}),D?e.jsx(R,{color:"primary",size:"sm"}):I.length>0?e.jsx(S,{children:I.map((s,c)=>e.jsx(j,{className:"permission-item",children:e.jsx(G,{color:"light",className:"permission-badge",children:s})},`permission-${c}`))}):e.jsx("p",{className:"text-medium-emphasis",children:"No permissions assigned"})]})]})]})}),n&&e.jsx(z,{lg:6,md:12,className:"mb-4",children:e.jsxs(k,{className:"activity-card h-100",children:[e.jsx(B,{children:e.jsx("h4",{className:"mb-0",children:"Activity Logs"})}),e.jsx(T,{className:"activity-body",children:e.jsx("div",{className:"activity-scroll-container",children:C?e.jsx("div",{className:"text-center p-4",children:e.jsx(R,{color:"primary"})}):b?e.jsx("div",{className:"error-message",children:"Failed to load activity. Please try again."}):x.length>0?e.jsxs(e.Fragment,{children:[e.jsx(S,{children:x.slice((i-1)*o,i*o).map((s,c)=>e.jsxs(j,{className:"activity-item mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx(G,{color:"primary",className:"activity-badge",children:s.action}),e.jsx("small",{className:"text-medium-emphasis",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"mb-0 activity-description",children:s.description})]},`activity-${c}`))}),Math.ceil(x.length/o)>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Y,{"aria-label":"Activity log pagination",children:[e.jsx(f,{"aria-label":"Previous",onClick:()=>m(i-1),disabled:i===1,children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),(()=>{const s=Math.ceil(x.length/o),c=5;let l=[];if(s<=c)l=Array.from({length:s},(t,r)=>r+1);else{l.push(1);let t=Math.max(i-1,2),r=Math.min(i+1,s-1);t===2&&(r=4),r===s-1&&(t=s-3),t>2&&l.push("...");for(let p=t;p<=r;p++)l.push(p);r<s-1&&l.push("..."),l.push(s)}return l.map((t,r)=>t==="..."?e.jsx(f,{disabled:!0,children:"..."},`ellipsis-${r}`):e.jsx(f,{active:i===t,onClick:()=>m(t),children:t},t))})(),e.jsx(f,{"aria-label":"Next",onClick:()=>m(i+1),disabled:i===Math.ceil(x.length/o),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]}):e.jsx("p",{className:"text-center text-medium-emphasis",children:"No activity logs found"})})})]})})]})})};export{le as default};
