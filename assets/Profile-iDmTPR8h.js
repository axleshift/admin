import{r as h,_ as D,d as L,R as S,c as F,S as O,P as u,T as $,p as Q,U as H,V as J,j as e,C as T}from"./index-BizKBI6a.js";import{F as q,B as K,s as k}from"./DefaultLayout-CnpPbvhY.js";import{a as W,b as R}from"./index.esm-LX8wyrY9.js";import{C as z,a as B}from"./CCardBody-cs6hLwSm.js";import{C as G}from"./CCardHeader-CPTDb0Yp.js";import{a as X}from"./CFormInput-BYAzJEzi.js";import{C as w,a as j}from"./CListGroupItem-KEqkBqgX.js";import{C as Y,a as f}from"./CPaginationItem-B-2D8iv_.js";import"./chatbox-V5kNCwUM.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./CCloseButton-CGgGdGd-.js";import"./index-D8rVyQy1.js";var E=h.forwardRef(function(a,N){var n,v=a.children,U=a.className,y=a.color,i=a.shape,m=a.size,o=a.src,d=a.status,g=a.textColor,C=D(a,["children","className","color","shape","size","src","status","textColor"]),b=d&&L("avatar-status","bg-".concat(d));return S.createElement("div",F({className:L("avatar",(n={},n["bg-".concat(y)]=y,n["avatar-".concat(m)]=m,n["text-".concat(g)]=g,n),i,U)},C,{ref:N}),o?S.createElement("img",{src:o,className:"avatar-img"}):v,d&&S.createElement("span",{className:b}))});E.propTypes={children:u.node,className:u.string,color:Q,shape:$,size:u.string,src:u.string,status:u.string,textColor:O};E.displayName="CAvatar";const de=()=>{const[a,N]=h.useState({name:"",username:"",email:"",role:"",department:"",permissions:[]}),[n,v]=h.useState(!1),[U,y]=h.useState(!0),[i,m]=h.useState(1),o=5,d=sessionStorage.getItem("userId"),{data:g=[],isLoading:C,error:b,refetch:Z}=H(void 0,{skip:!n,credentials:"include"}),{data:P,isLoading:M}=J(d,{skip:!d,credentials:"include"});h.useEffect(()=>{const s=sessionStorage.getItem("permissions"),c={name:sessionStorage.getItem("name")||"Unknown Name",username:sessionStorage.getItem("username")||"Unknown Username",email:sessionStorage.getItem("email")||"Unknown Email",role:sessionStorage.getItem("role")||"Unknown Role",department:sessionStorage.getItem("department")||"Unknown Department",permissions:s?JSON.parse(s):[]};N(c)},[]);const A=[...new Set([...a.permissions||[],...(P==null?void 0:P.permissions)||[]])],V=s=>{var c,l,t,r,p,I;return(c=s.action)!=null&&c.includes("/logs/activity")||(l=s.action)!=null&&l.includes("/user-activity")||(t=s.description)!=null&&t.includes("performed POST on")||(r=s.description)!=null&&r.includes("performed GET on")?null:{...s,action:(p=s.action)==null?void 0:p.replace(/^(POST|GET|PUT|DELETE)\s/,"").replace(/^\/api\//,""),description:(I=s.description)==null?void 0:I.replace(/User performed \w+ on /,"")}},x=(g||[]).map(V).filter(s=>s!==null);return e.jsx("div",{className:"profile-container",children:e.jsxs(W,{className:"profile-row",children:[e.jsx(R,{lg:n?6:12,md:12,className:"mb-4",children:e.jsxs(z,{className:"profile-card h-100",children:[e.jsxs(G,{className:"profile-header",children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(X,{color:"primary",variant:"ghost",className:"activity-toggle-btn",onClick:()=>v(!n),children:e.jsx(q,{icon:K})})}),e.jsxs("div",{className:"text-center profile-avatar-section",children:[e.jsx(E,{color:"primary",textColor:"white",size:"xl",className:"profile-avatar mb-3",children:a.name?a.name[0].toUpperCase():"U"}),e.jsx("h2",{className:"mb-1",children:a.name}),e.jsxs("p",{className:"text-medium-emphasis",children:["@",a.username]})]})]}),e.jsxs(B,{children:[e.jsxs(w,{flush:!0,className:"user-details",children:[e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Email:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.email})]}),e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Role:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.role})]}),e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Department:"}),e.jsx("span",{className:"text-medium-emphasis",children:a.department})]})]}),e.jsxs("div",{className:"permissions-section mt-4",children:[e.jsx("h4",{className:"mb-3",children:"Permissions"}),M?e.jsx(T,{color:"primary",size:"sm"}):A.length>0?e.jsx(w,{children:A.map((s,c)=>e.jsx(j,{className:"permission-item",children:e.jsx(k,{color:"light",className:"permission-badge",children:s})},`permission-${c}`))}):e.jsx("p",{className:"text-medium-emphasis",children:"No permissions assigned"})]})]})]})}),n&&e.jsx(R,{lg:6,md:12,className:"mb-4",children:e.jsxs(z,{className:"activity-card h-100",children:[e.jsx(G,{children:e.jsx("h4",{className:"mb-0",children:"Activity Logs"})}),e.jsx(B,{className:"activity-body",children:e.jsx("div",{className:"activity-scroll-container",children:C?e.jsx("div",{className:"text-center p-4",children:e.jsx(T,{color:"primary"})}):b?e.jsx("div",{className:"error-message",children:"Failed to load activity. Please try again."}):x.length>0?e.jsxs(e.Fragment,{children:[e.jsx(w,{children:x.slice((i-1)*o,i*o).map((s,c)=>e.jsxs(j,{className:"activity-item mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx(k,{color:"primary",className:"activity-badge",children:s.action}),e.jsx("small",{className:"text-medium-emphasis",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"mb-0 activity-description",children:s.description})]},`activity-${c}`))}),Math.ceil(x.length/o)>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Y,{"aria-label":"Activity log pagination",children:[e.jsx(f,{"aria-label":"Previous",onClick:()=>m(i-1),disabled:i===1,children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),(()=>{const s=Math.ceil(x.length/o),c=5;let l=[];if(s<=c)l=Array.from({length:s},(t,r)=>r+1);else{l.push(1);let t=Math.max(i-1,2),r=Math.min(i+1,s-1);t===2&&(r=4),r===s-1&&(t=s-3),t>2&&l.push("...");for(let p=t;p<=r;p++)l.push(p);r<s-1&&l.push("..."),l.push(s)}return l.map((t,r)=>t==="..."?e.jsx(f,{disabled:!0,children:"..."},`ellipsis-${r}`):e.jsx(f,{active:i===t,onClick:()=>m(t),children:t},t))})(),e.jsx(f,{"aria-label":"Next",onClick:()=>m(i+1),disabled:i===Math.ceil(x.length/o),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]}):e.jsx("p",{className:"text-center text-medium-emphasis",children:"No activity logs found"})})})]})})]})})};export{de as default};
