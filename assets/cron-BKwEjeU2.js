import{j as s}from"./index-BfJhDpaZ.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{a as h}from"./axiosInstance-Dv2jt_v_.js";import{F as y,S as E,T as P}from"./index-CL47NU8L.js";import{S as T,k as I,X as $,l as H,R as L,a5 as z,W as g,j as C,C as k}from"./vendor-coreui-BN8uYOBb.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const q=()=>{const[m,x]=o.useState("02"),[p,f]=o.useState("00"),[i,j]=o.useState("AM"),[l,S]=o.useState({message:"",type:""}),[n,c]=o.useState(!1);o.useEffect(()=>{if(l.message){const e=setTimeout(()=>{S({message:"",type:""})},5e3);return()=>clearTimeout(e)}},[l]),o.useEffect(()=>{(async()=>{try{c(!0);const t=(await h.get("/backupauto/config")).data;if(t.cronSchedule){const u=t.cronSchedule.split(" "),B=u[0],F=u[1];let r=parseInt(F,10),b="AM";r>=12&&(b="PM",r=r===12?12:r-12),r=r===0?12:r,x(r.toString().padStart(2,"0")),f(B.padStart(2,"0")),j(b)}}catch(a){console.error("Error fetching backup configuration:",a)}finally{c(!1)}})()},[]);const v=Array.from({length:12},(e,a)=>{const t=a+1;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),N=Array.from({length:60},(e,a)=>{const t=a;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),d=(e,a)=>{S({message:e,type:a})},M=()=>{let e=parseInt(m,10);return i==="PM"&&e<12?e+=12:i==="AM"&&e===12&&(e=0),{hours:e.toString().padStart(2,"0"),minutes:p}},w=async()=>{var e;c(!0);try{const a=M(),t=`${a.minutes} ${a.hours} * * *`,u=await h.post("/backupauto/update-schedule",{cronSchedule:t});d(u.data,"success")}catch(a){d(`Error updating schedule: ${((e=a.response)==null?void 0:e.data)||a.message}`,"danger")}finally{c(!1)}},A=async()=>{var e;c(!0);try{const a=await h.post("/backupauto/backup");d(a.data,"success")}catch(a){d(`Error triggering backup: ${((e=a.response)==null?void 0:e.data)||a.message}`,"danger")}finally{c(!1)}};return s.jsxs("div",{className:"p-5",children:[s.jsx("h2",{className:"text-2xl mb-4",children:"Backup Manager"}),l.message&&s.jsx(T,{color:l.type,className:"mb-4",children:l.message}),s.jsxs(I,{className:"mb-4",children:[s.jsx($,{children:s.jsx("div",{children:"Backup Configuration"})}),s.jsxs(H,{children:[s.jsx("p",{className:"mb-4",children:"Backups are automatically saved to the Downloads/my-backups folder in your home directory."}),s.jsxs(L,{className:"mb-4",children:[s.jsx(z,{children:"Backup Time"}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsxs("div",{className:"d-flex",style:{width:"220px"},children:[s.jsx(g,{value:m,onChange:e=>x(e.target.value),disabled:n,className:"me-1",style:{width:"70px"},children:v.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx("span",{className:"mx-1 mt-2",children:":"}),s.jsx(g,{value:p,onChange:e=>f(e.target.value),disabled:n,className:"me-1",style:{width:"70px"},children:N.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsxs(g,{value:i,onChange:e=>j(e.target.value),disabled:n,style:{width:"70px"},children:[s.jsx("option",{value:"AM",children:"AM"}),s.jsx("option",{value:"PM",children:"PM"})]})]}),s.jsxs(C,{color:"success",onClick:w,className:"ms-3",disabled:n,children:[n?s.jsx(k,{size:"sm"}):s.jsx(y,{icon:E})," Set Schedule"]})]}),s.jsxs("small",{className:"text-muted mt-2 d-block",children:["Current schedule: Daily at ",m,":",p," ",i]})]}),s.jsxs(C,{color:"danger",onClick:A,disabled:n,className:"mt-3",children:[n?s.jsx(k,{size:"sm"}):s.jsx(y,{icon:P})," Trigger Backup Now"]})]})]})]})};export{q as default};
