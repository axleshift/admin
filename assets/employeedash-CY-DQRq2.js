import{j as e,w as ne,x as le}from"./index-CuADKcYS.js";import{u as ce,r as s}from"./vendor-react-BHxUanFt.js";import{C as ie}from"./customhead-CU34ta_s.js";import{F as h,n as T,o as de,s as me}from"./index-fF0KaNX5.js";import{S as g}from"./statbox-CI7AxDLC.js";import"./overviewChart-3rb6cUJM.js";import he from"./monthchart-CftspSXb.js";import"./papaparse.min-CHum4QXG.js";import{a as u}from"./axiosInstance-Bq-uIJjs.js";import{l as ge}from"./activityLogger-D6Lc4RsL.js";import{C as ue,a as d,b as r,d as U}from"./vendor-coreui-DaIzHuu_.js";import"./vendor-redux-CSji-Y9p.js";import"./generateCategoricalChart-Cg1fAJrq.js";import"./DefaultLayout-cD_SvmnY.js";import"./yearly-C4XICPYG.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-BggtT3I0.js";import"./index-xsH4HHeE.js";import"./LineChart-BYvjNwQt.js";const fe=()=>e.jsxs("div",{className:"loader",children:[e.jsx("div",{className:"outer"}),e.jsx("div",{className:"middle"}),e.jsx("div",{className:"inner"})]}),Ge=()=>{var b;const j=ce(),[pe,k]=s.useState(window.innerWidth>768),[xe,R]=s.useState(""),[z,f]=s.useState(!0),[B,W]=s.useState([]),[w,N]=s.useState(null),[a,L]=s.useState(null),[c,G]=s.useState(null),[Q,p]=s.useState(!0),{data:ye,isLoading:H}=ne(),{data:Se,isLoading:P}=le(),v=localStorage.getItem("name"),q=localStorage.getItem("role"),J=localStorage.getItem("department");localStorage.getItem("username");const[K,M]=s.useState([]),[O,x]=s.useState(!1),[C,V]=s.useState(null),[D,X]=s.useState(null),[Z,y]=s.useState(!0);ge({name:v,role:q,department:J,route:"Admin Dashboard",action:"Navigate",description:`${v} Navigate to Admin Dashboard`}).catch(console.warn),s.useEffect(()=>{const n=()=>k(window.innerWidth>768);return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),s.useEffect(()=>{const n=localStorage.getItem("accessToken");n?R(n):j("/login")},[j]),s.useEffect(()=>{const n=async()=>{try{p(!0);const t=await u.get("/finance/monthlysalesrevenue");if(t.data&&Array.isArray(t.data)&&t.data.length>0){const o=new Date,S=o.toLocaleString("en-US",{month:"long"}),se=o.getFullYear(),F=t.data.find(l=>l.month===S&&l.year===se),m=new Date(o);m.setMonth(m.getMonth()-1);const ae=m.toLocaleString("en-US",{month:"long"}),oe=m.getFullYear(),Y=t.data.find(l=>l.month===ae&&l.year===oe);if(F)L(F);else{const l=[...t.data].sort((I,$)=>{const re=new Date(`${I.month} 1, ${I.year}`);return new Date(`${$.month} 1, ${$.year}`)-re});L(l[0]),console.log("Current month data not found, using most recent:",l[0])}Y&&G(Y)}p(!1)}catch(t){console.error("Failed to fetch monthly sales data:",t),N(o=>o||"An error occurred while fetching sales data"),p(!1)}},i=async()=>{try{y(!0);const t=await u.get("/finance/yearlysalesrevenue");t.data&&X(t.data),y(!1)}catch(t){console.error("Failed to fetch yearly data:",t),y(!1)}},A=async()=>{var t;try{f(!0);const S=((t=(await u.get("/core/fetch-core")).data)==null?void 0:t.data)||[];W(S),f(!1)}catch(o){N(o.message||"Failed to fetch shipment data"),f(!1)}};(async()=>{try{x(!0);const o=(await u.get("/hr/worker")).data||[];M(o),x(!1)}catch(t){V(t.message||"Failed to fetch user data"),x(!1),console.error("Error fetching users:",t)}})(),A(),i(),n()},[]);const _=B.length,ee=new Date().getFullYear(),te=K.length,E=(n,i)=>!i||i===0?"0":((n-i)/i*100).toFixed(1);return H||P?e.jsx(fe,{}):e.jsxs(ue,{fluid:!0,className:"p-3",children:[e.jsxs(d,{className:"mb-4",children:[e.jsx(r,{xs:12,md:8,children:e.jsx(ie,{title:"Dashboard",subtitle:"Welcome to Dashboard"})}),e.jsx(r,{xs:12,md:4,className:"d-flex justify-content-md-end align-items-center mb-3 mb-md-0"})]}),e.jsxs(d,{className:"my-3 g-3",children:[e.jsx(r,{xs:12,md:6,lg:3,children:e.jsx(g,{title:"Total Employees",value:te,icon:e.jsx(h,{icon:T}),color:"primary",loading:O,description:"Total registered employees"})}),e.jsx(r,{xs:12,md:6,lg:3,children:e.jsx(g,{title:"Total Shipments",value:_,icon:e.jsx(h,{icon:T}),color:"primary",loading:z,description:"Total shipments tracked"})}),e.jsx(r,{xs:12,md:6,lg:3,children:e.jsx(g,{title:`Current Sales (${(a==null?void 0:a.month)||"Loading..."})`,value:((b=a==null?void 0:a.totalSales)==null?void 0:b.toLocaleString())||0,increase:c?`${E((a==null?void 0:a.totalSales)||0,(c==null?void 0:c.totalSales)||0)>0?"+":""}${E((a==null?void 0:a.totalSales)||0,(c==null?void 0:c.totalSales)||0)}%`:"0",icon:e.jsx(h,{icon:de,style:{fontSize:"20px",color:"#0d6efd"}}),loading:Q})}),e.jsxs(r,{xs:12,md:6,lg:3,children:[" ",e.jsx(g,{title:`Yearly Sales (${ee})`,value:D?D.totalSales.toLocaleString():"Loading...",description:"Annual performance",icon:e.jsx(h,{icon:me,style:{fontSize:"20px",color:"#dc3545"}}),loading:Z})]})]}),e.jsx(d,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx(U,{className:"mb-4",children:e.jsx("div",{className:"p-3",children:e.jsx(he,{})})})})}),e.jsx(d,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx(U,{className:"mb-4"})})}),w&&e.jsx(d,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:w})})}),C&&e.jsx(d,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:C})})})]})};export{Ge as default};
