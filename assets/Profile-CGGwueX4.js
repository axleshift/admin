import{H as G,I as B,j as e}from"./index-B-osFWpa.js";import{r as d}from"./vendor-react-B6URQkMn.js";import{F as D,ah as M}from"./index-D-k-o6LC.js";import{S as R,T as v,o as b,$ as C,n as F,al as V,p as S,ab as g,ac as h,d as w,D as P,ag as $,ah as x}from"./vendor-coreui-BDhfDOiu.js";import"./vendor-redux-DipIbRRz.js";const W=()=>{const[c,I]=d.useState({name:"",username:"",email:"",role:"",department:"",permissions:[]}),[p,U]=d.useState(!1),[O,z]=d.useState(!0),[r,u]=d.useState(1),o=5,f=sessionStorage.getItem("userId"),{data:A=[],isLoading:L,error:k,refetch:H}=G(void 0,{skip:!p,credentials:"include"}),{data:j,isLoading:E}=B(f,{skip:!f,credentials:"include"});d.useEffect(()=>{const s=sessionStorage.getItem("permissions"),t={name:sessionStorage.getItem("name")||"Unknown Name",username:sessionStorage.getItem("username")||"Unknown Username",email:sessionStorage.getItem("email")||"Unknown Email",role:sessionStorage.getItem("role")||"Unknown Role",department:sessionStorage.getItem("department")||"Unknown Department",permissions:s?JSON.parse(s):[]};I(t)},[]);const y=[...new Set([...c.permissions||[],...(j==null?void 0:j.permissions)||[]])],T=s=>{var t,n,i,a,l,N;return(t=s.action)!=null&&t.includes("/logs/activity")||(n=s.action)!=null&&n.includes("/user-activity")||(i=s.description)!=null&&i.includes("performed POST on")||(a=s.description)!=null&&a.includes("performed GET on")?null:{...s,action:(l=s.action)==null?void 0:l.replace(/^(POST|GET|PUT|DELETE)\s/,"").replace(/^\/api\//,""),description:(N=s.description)==null?void 0:N.replace(/User performed \w+ on /,"")}},m=(A||[]).map(T).filter(s=>s!==null);return e.jsx("div",{className:"profile-container",children:e.jsxs(R,{className:"profile-row",children:[e.jsx(v,{lg:p?6:12,md:12,className:"mb-4",children:e.jsxs(b,{className:"profile-card h-100",children:[e.jsxs(C,{className:"profile-header",children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(F,{color:"primary",variant:"ghost",className:"activity-toggle-btn",onClick:()=>U(!p),children:e.jsx(D,{icon:M})})}),e.jsxs("div",{className:"text-center profile-avatar-section",children:[e.jsx(V,{color:"primary",textColor:"white",size:"xl",className:"profile-avatar mb-3",children:c.name?c.name[0].toUpperCase():"U"}),e.jsx("h2",{className:"mb-1",children:c.name}),e.jsxs("p",{className:"text-medium-emphasis",children:["@",c.username]})]})]}),e.jsxs(S,{children:[e.jsxs(g,{flush:!0,className:"user-details",children:[e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Email:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.email})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Role:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.role})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Department:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.department})]})]}),e.jsxs("div",{className:"permissions-section mt-4",children:[e.jsx("h4",{className:"mb-3",children:"Permissions"}),E?e.jsx(w,{color:"primary",size:"sm"}):y.length>0?e.jsx(g,{children:y.map((s,t)=>e.jsx(h,{className:"permission-item",children:e.jsx(P,{color:"light",className:"permission-badge",children:s})},`permission-${t}`))}):e.jsx("p",{className:"text-medium-emphasis",children:"No permissions assigned"})]})]})]})}),p&&e.jsx(v,{lg:6,md:12,className:"mb-4",children:e.jsxs(b,{className:"activity-card h-100",children:[e.jsx(C,{children:e.jsx("h4",{className:"mb-0",children:"Activity Logs"})}),e.jsx(S,{className:"activity-body",children:e.jsx("div",{className:"activity-scroll-container",children:L?e.jsx("div",{className:"text-center p-4",children:e.jsx(w,{color:"primary"})}):k?e.jsx("div",{className:"error-message",children:"Failed to load activity. Please try again."}):m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:m.slice((r-1)*o,r*o).map((s,t)=>e.jsxs(h,{className:"activity-item mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx(P,{color:"primary",className:"activity-badge",children:s.action}),e.jsx("small",{className:"text-medium-emphasis",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"mb-0 activity-description",children:s.description})]},`activity-${t}`))}),Math.ceil(m.length/o)>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs($,{"aria-label":"Activity log pagination",children:[e.jsx(x,{"aria-label":"Previous",onClick:()=>u(r-1),disabled:r===1,children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),(()=>{const s=Math.ceil(m.length/o),t=5;let n=[];if(s<=t)n=Array.from({length:s},(i,a)=>a+1);else{n.push(1);let i=Math.max(r-1,2),a=Math.min(r+1,s-1);i===2&&(a=4),a===s-1&&(i=s-3),i>2&&n.push("...");for(let l=i;l<=a;l++)n.push(l);a<s-1&&n.push("..."),n.push(s)}return n.map((i,a)=>i==="..."?e.jsx(x,{disabled:!0,children:"..."},`ellipsis-${a}`):e.jsx(x,{active:r===i,onClick:()=>u(i),children:i},i))})(),e.jsx(x,{"aria-label":"Next",onClick:()=>u(r+1),disabled:r===Math.ceil(m.length/o),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]}):e.jsx("p",{className:"text-center text-medium-emphasis",children:"No activity logs found"})})})]})})]})})};export{W as default};
