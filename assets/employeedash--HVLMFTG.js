import{j as e,x as ie,y as de}from"./index-BA9i51uk.js";import{u as me,r as a}from"./vendor-react-BHxUanFt.js";import{C as ue}from"./customhead-CZNfy1vk.js";import{F as u,L as he,n as I,o as ge,s as fe}from"./index-BbcC8ntF.js";import{S as f}from"./statbox-DkcPDEyD.js";import"./overviewChart-BOT1ReZB.js";import xe from"./monthchart-8fGlIRvh.js";import{P as pe}from"./papaparse.min-BRjzmhib.js";import{a as x}from"./axiosInstance-Bq-uIJjs.js";import{l as ye}from"./activityLogger-D6Lc4RsL.js";import{C as Se,a as m,b as l,d as T}from"./vendor-coreui-blXmWd_E.js";import"./vendor-redux-CSji-Y9p.js";import"./generateCategoricalChart-BDkE1YhN.js";import"./DefaultLayout-CDF3_7TE.js";import"./yearly-Bs7T2UE_.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-BggtT3I0.js";import"./index-xsH4HHeE.js";import"./LineChart-Dj4rqlVi.js";const je=()=>e.jsxs("div",{className:"loader",children:[e.jsx("div",{className:"outer"}),e.jsx("div",{className:"middle"}),e.jsx("div",{className:"inner"})]}),Qe=()=>{var F;const w=me(),[we,z]=a.useState(window.innerWidth>768),[De,B]=a.useState(""),[O,p]=a.useState(!0),[P,W]=a.useState([]),[D,L]=a.useState(null),[o,v]=a.useState(null),[d,G]=a.useState(null),[Q,y]=a.useState(!0),{data:Le,isLoading:V}=ie(),{data:N,isLoading:H}=de(),C=localStorage.getItem("name"),_=localStorage.getItem("role"),q=localStorage.getItem("department");localStorage.getItem("username");const[J,K]=a.useState([]),[M,S]=a.useState(!1),[b,X]=a.useState(null),[E,Z]=a.useState(null),[ee,j]=a.useState(!0);ye({name:C,role:_,department:q,route:"Admin Dashboard",action:"Navigate",description:`${C} Navigate to Admin Dashboard`}).catch(console.warn),a.useEffect(()=>{const n=()=>z(window.innerWidth>768);return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),a.useEffect(()=>{const n=localStorage.getItem("accessToken");n?B(n):w("/login")},[w]),a.useEffect(()=>{const n=async()=>{try{y(!0);const t=await x.get("/finance/monthlysalesrevenue");if(t.data&&Array.isArray(t.data)&&t.data.length>0){const s=new Date,r=s.toLocaleString("en-US",{month:"long"}),ne=s.getFullYear(),R=t.data.find(i=>i.month===r&&i.year===ne),g=new Date(s);g.setMonth(g.getMonth()-1);const re=g.toLocaleString("en-US",{month:"long"}),le=g.getFullYear(),U=t.data.find(i=>i.month===re&&i.year===le);if(R)v(R);else{const i=[...t.data].sort((Y,$)=>{const ce=new Date(`${Y.month} 1, ${Y.year}`);return new Date(`${$.month} 1, ${$.year}`)-ce});v(i[0]),console.log("Current month data not found, using most recent:",i[0])}U&&G(U)}y(!1)}catch(t){console.error("Failed to fetch monthly sales data:",t),L(s=>s||"An error occurred while fetching sales data"),y(!1)}},c=async()=>{try{j(!0);const t=await x.get("/finance/yearlysalesrevenue");t.data&&Z(t.data),j(!1)}catch(t){console.error("Failed to fetch yearly data:",t),j(!1)}},h=async()=>{var t;try{p(!0);const r=((t=(await x.get("/core/fetch-core")).data)==null?void 0:t.data)||[];W(r),p(!1)}catch(s){L(s.message||"Failed to fetch shipment data"),p(!1)}};(async()=>{try{S(!0);const s=(await x.get("/hr/worker")).data||[];K(s),S(!1)}catch(t){X(t.message||"Failed to fetch user data"),S(!1),console.error("Error fetching users:",t)}})(),h(),c(),n()},[]);const te=P.length,ae=new Date().getFullYear(),se=J.length,A=(n,c)=>!c||c===0?"0":((n-c)/c*100).toFixed(1),oe=()=>{if(!N)return;const n=["Customer Name","Order Volume (kg)","Shipping Type","Order Date","Status","Delivery Date"],c=N.map(r=>[r.customerName,`${r.orderVolume} kg`,r.shippingType,new Date(r.orderDate).toLocaleDateString(),r.status,r.deliveryDate?new Date(r.deliveryDate).toLocaleString():"N/A"]),h=pe.unparse([n,...c]),k=new Blob([h],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(k),s=document.createElement("a");s.href=t,s.download="shipping_transactions.csv",s.click(),URL.revokeObjectURL(t)};return V||H?e.jsx(je,{}):e.jsxs(Se,{fluid:!0,className:"p-3",children:[e.jsxs(m,{className:"mb-4",children:[e.jsx(l,{xs:12,md:8,children:e.jsx(ue,{title:"Dashboard",subtitle:"Welcome to Dashboard"})}),e.jsx(l,{xs:12,md:4,className:"d-flex justify-content-md-end align-items-center mb-3 mb-md-0"})]}),e.jsx(m,{children:e.jsxs("button",{className:"download-btn",onClick:oe,children:[e.jsx(u,{icon:he}),"Â  Download Reports"]})}),e.jsxs(m,{className:"my-3 g-3",children:[e.jsx(l,{xs:12,md:6,lg:3,children:e.jsx(f,{title:"Total Employees",value:se,icon:e.jsx(u,{icon:I}),color:"primary",loading:M,description:"Total registered employees"})}),e.jsx(l,{xs:12,md:6,lg:3,children:e.jsx(f,{title:"Total Shipments",value:te,icon:e.jsx(u,{icon:I}),color:"primary",loading:O,description:"Total shipments tracked"})}),e.jsx(l,{xs:12,md:6,lg:3,children:e.jsx(f,{title:`Current Sales (${(o==null?void 0:o.month)||"Loading..."})`,value:((F=o==null?void 0:o.totalSales)==null?void 0:F.toLocaleString())||0,increase:d?`${A((o==null?void 0:o.totalSales)||0,(d==null?void 0:d.totalSales)||0)>0?"+":""}${A((o==null?void 0:o.totalSales)||0,(d==null?void 0:d.totalSales)||0)}%`:"0",icon:e.jsx(u,{icon:ge,style:{fontSize:"20px",color:"#0d6efd"}}),loading:Q})}),e.jsxs(l,{xs:12,md:6,lg:3,children:[" ",e.jsx(f,{title:`Yearly Sales (${ae})`,value:E?E.totalSales.toLocaleString():"Loading...",description:"Annual performance",icon:e.jsx(u,{icon:fe,style:{fontSize:"20px",color:"#dc3545"}}),loading:ee})]})]}),e.jsx(m,{className:"my-3",children:e.jsx(l,{xs:12,children:e.jsx(T,{className:"mb-4",children:e.jsx("div",{className:"p-3",children:e.jsx(xe,{})})})})}),e.jsx(m,{className:"my-3",children:e.jsx(l,{xs:12,children:e.jsx(T,{className:"mb-4"})})}),D&&e.jsx(m,{className:"my-3",children:e.jsx(l,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:D})})}),b&&e.jsx(m,{className:"my-3",children:e.jsx(l,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:b})})})]})};export{Qe as default};
