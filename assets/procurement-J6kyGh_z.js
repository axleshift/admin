import{j as e}from"./index-DM1yPWM8.js";import{r as l,R as k}from"./vendor-react-B6URQkMn.js";import{a as F}from"./axiosInstance-Dv2jt_v_.js";import{F as c,az as H,I as L,a1 as z,a6 as f,W as q,a3 as V,D as p,aA as $,aB as K,H as d,K as M,aC as N}from"./index-qDEKtGai.js";import{N as O,O as Q,k as D,X as y,j as S,l as b,S as P,C as W,Z as w,_ as I,$ as t,a0 as n,a1 as v,a2 as a,as as X,y as Z}from"./vendor-coreui-B7GHRQOS.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const ne=()=>{const[x,T]=l.useState([]),[i,m]=l.useState(!0),[j,h]=l.useState(null),[g,B]=l.useState({}),E=localStorage.getItem("role"),A=localStorage.getItem("department");localStorage.getItem("userId");const R=localStorage.getItem("name"),U=s=>{B(r=>({...r,[s]:!r[s]}))},u=async()=>{m(!0);try{const s=await F.get("/logistics/procurement");T(s.data.data),h(null)}catch(s){h("Error fetching procurement data"),console.error("Procurement data fetch error:",s)}finally{m(!1)}};l.useEffect(()=>{u()},[]);const _=s=>{const r={Pending:{color:"warning",icon:d},Approved:{color:"success",icon:N},"In Progress":{color:"info",icon:d},Completed:{color:"success",icon:N},Cancelled:{color:"danger",icon:M},default:{color:"secondary",icon:d}},C=r[s]||r.default;return logActivity({name:R,role:E,department:A,route:"/procurement",action:"Add Vehicle Initiated",description:"User initiated adding a new vehicle"}).catch(console.warn),e.jsxs(Z,{color:C.color,className:"px-2 py-1",children:[e.jsx(c,{icon:C.icon,className:"me-1"})," ",s]})},o=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return e.jsx(O,{children:e.jsx(Q,{xs:12,children:e.jsxs(D,{className:"mb-4",children:[e.jsxs(y,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(c,{icon:H,className:"me-2"}),e.jsx("strong",{children:"Procurement Management"})]}),e.jsxs(S,{color:"outline-primary",size:"sm",onClick:u,disabled:i,children:[e.jsx(c,{icon:L,className:i?"fa-spin me-1":"me-1"}),"Refresh"]})]}),e.jsxs(b,{children:[j&&e.jsxs(P,{color:"danger",children:[e.jsx(c,{icon:z,className:"me-2"}),j]}),i?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(W,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading procurement data..."})]}):e.jsx(e.Fragment,{children:x.length===0?e.jsx(P,{color:"info",children:"No procurement records found"}):e.jsxs(w,{hover:!0,responsive:!0,striped:!0,className:"border",children:[e.jsx(I,{color:"light",children:e.jsxs(t,{children:[e.jsx(n,{scope:"col",children:"Title"}),e.jsx(n,{scope:"col",children:"Description"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:f,className:"me-1"})," Procurement Date"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:q,className:"me-1"})," Department"]}),e.jsx(n,{scope:"col",children:"Status"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:V,className:"me-1"})," Est. Cost"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:f,className:"me-1"})," Delivery Date"]}),e.jsx(n,{scope:"col",children:"Products"})]})}),e.jsx(v,{children:x.map(s=>e.jsxs(k.Fragment,{children:[e.jsxs(t,{children:[e.jsx(a,{children:s.title}),e.jsx(a,{children:s.description.length>50?`${s.description.substring(0,50)}...`:s.description}),e.jsx(a,{children:new Date(s.procurementDate).toLocaleDateString()}),e.jsx(a,{children:s.department}),e.jsx(a,{children:_(s.status)}),e.jsx(a,{children:o(s.estimatedCost)}),e.jsx(a,{children:new Date(s.deliveryDate).toLocaleDateString()}),e.jsx(a,{children:e.jsxs(S,{color:"link",size:"sm",onClick:()=>U(s._id),children:[e.jsx(c,{icon:p,className:"me-1"}),s.products.length," Items",e.jsx(c,{icon:g[s._id]?$:K,className:"ms-1"})]})})]}),e.jsx(t,{children:e.jsx(a,{colSpan:"8",className:"p-0",children:e.jsx(X,{visible:g[s._id],children:e.jsxs(D,{className:"m-3 border-0",children:[e.jsxs(y,{children:[e.jsx(c,{icon:p,className:"me-2"}),"Product Details"]}),e.jsx(b,{children:e.jsxs(w,{small:!0,borderless:!0,children:[e.jsx(I,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Unit"}),e.jsx(n,{children:"Unit Price"}),e.jsx(n,{children:"Total"})]})}),e.jsx(v,{children:s.products.map(r=>e.jsxs(t,{children:[e.jsx(a,{children:r.name}),e.jsx(a,{children:r.quantity}),e.jsx(a,{children:r.unit}),e.jsx(a,{children:o(r.unitPrice)}),e.jsx(a,{children:o(r.quantity*r.unitPrice)})]},r._id))})]})})]})})})})]},s._id))})]})})]})]})})})};export{ne as default};
