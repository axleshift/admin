import{j as e}from"./index-fGDiSkDy.js";import{r as i}from"./vendor-react-BHxUanFt.js";import{F as n,au as S,g as p,n as R,T as q,av as u,aw as V,ax as T,a as Q,d as W,j as X,i as G}from"./index-BNowUf5p.js";import{a as N}from"./axiosInstance-Bq-uIJjs.js";import{C as J,a as K,b as O,o as _,g as D,l as d,m as Y,d as Z,n as ee,p as w,e as se,Q as ne,R as ae,S as oe,T as te,w as re,x as ie,y as E,z as x,A as le,B as j,u as ce,X as de}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const ge=()=>{const[f,b]=i.useState([]),[m,v]=i.useState(!1),[A,l]=i.useState(null),[F,C]=i.useState(!1),[c,k]=i.useState(null),[r,h]=i.useState(new Set);i.useEffect(()=>{I()},[]);const I=async()=>{try{v(!0),l(null);const s=await N.get("/complains/get-complains");b(s.data.complaints||[])}catch(s){console.error("Error fetching complaints:",s),l("Failed to load complaints. Please try again.")}finally{v(!1)}},P=async s=>{try{l(null),h(t=>new Set(t).add(s._id));const o=await N.post("/complains/ai-resolve",{complaintText:s.complaintText,complaintId:s._id});b(t=>t.map(a=>a._id===s._id?o.data:a))}catch(o){console.error("Error resolving with AI:",o),l("Failed to resolve complaint. Please try again.")}finally{h(o=>{const t=new Set(o);return t.delete(s._id),t})}},$=s=>{(s.status==="Needs AI Review"||s.status==="Pending")&&!r.has(s._id)&&P(s)},M=s=>{window.open(`/api/complains/resolution-document/${s}`,"_blank")},B=s=>{k(s),C(!0)},H=async s=>{var o,t;try{l(null),h(y=>new Set(y).add(`notify-${s}`));const a=f.find(y=>y._id===s);if(!a)throw new Error("Complaint not found");console.log(`Sending notification to: ${a.employeeEmail}`);const g=await N.post("/complains/send-notification",{complaintId:s});alert("Notification sent successfully to "+a.employeeEmail)}catch(a){console.error("Error sending notification:",a),l(`Failed to send notification. Please try again. ${((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message}`)}finally{h(a=>{const g=new Set(a);return g.delete(`notify-${s}`),g})}},U=s=>{switch(s){case"Resolved":return"success";case"Under Review":return"warning";case"Dismissed":return"danger";case"Needs AI Review":return"info";case"Pending":default:return"secondary"}},z=s=>{switch(s){case"Resolved":return G;case"Under Review":return u;case"Dismissed":return X;case"Needs AI Review":return S;case"Pending":default:return R}},L=()=>c?e.jsxs(ne,{visible:F,onClose:()=>C(!1),size:"lg",children:[e.jsx(ae,{closeButton:!0,children:e.jsxs(oe,{children:[e.jsx(n,{icon:T,className:"me-2"}),"Action Items for Complaint"]})}),e.jsxs(te,{children:[c.actionItems&&c.actionItems.length>0?e.jsxs(re,{bordered:!0,striped:!0,responsive:!0,children:[e.jsx(ie,{children:e.jsxs(E,{children:[e.jsx(x,{children:"Action"}),e.jsx(x,{children:"Assigned To"}),e.jsx(x,{children:"Due Date"}),e.jsx(x,{children:"Status"})]})}),e.jsx(le,{children:c.actionItems.map((s,o)=>e.jsxs(E,{children:[e.jsx(j,{children:s.action}),e.jsx(j,{children:s.assignedTo}),e.jsx(j,{children:s.dueDate||"ASAP"}),e.jsx(j,{children:e.jsx(ce,{id:`action-${o}`,label:"Completed",checked:s.completed,disabled:!0})})]},o))})]}):e.jsx("p",{children:"No action items defined for this complaint."}),c.followUpDate&&e.jsxs("div",{className:"mt-3",children:[e.jsx("strong",{children:"Follow-up Date:"})," ",new Date(c.followUpDate).toLocaleDateString()]})]}),e.jsx(de,{children:e.jsx(d,{color:"secondary",onClick:()=>C(!1),children:"Close"})})]}):null;return e.jsxs(J,{className:"py-4",children:[e.jsx(K,{children:e.jsxs(O,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h1",{children:[e.jsx(n,{icon:S,className:"me-2"}),"AI Complaints Resolution System"]}),e.jsx(_,{content:"This system only shows complaints that require advanced AI resolution due to their complexity or sensitivity.",placement:"bottom",children:e.jsx(n,{icon:p,className:"ms-2 text-info",style:{cursor:"pointer"}})})]}),A&&e.jsxs(D,{color:"danger",className:"mb-4",children:[e.jsx(n,{icon:R,className:"me-2"}),A]}),e.jsxs(d,{color:"primary",onClick:I,disabled:m,className:"mb-4",children:[e.jsx(n,{icon:q,className:"me-2",spin:m}),m?"Loading...":"Refresh Complaints"]}),m?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(Y,{}),e.jsx("p",{className:"mt-3",children:"Loading complex complaints..."})]}):e.jsx(e.Fragment,{children:f.length===0?e.jsxs(D,{color:"info",children:[e.jsx(n,{icon:p,className:"me-2"}),"No complex complaints found that require AI resolution."]}):f.map(s=>e.jsxs(Z,{className:"mb-4",children:[e.jsxs(ee,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.source==="Employee Complaint"?s.isAnonymous?"Anonymous":s.employeeName:s.userId}),s.source==="Employee Complaint"&&e.jsxs("span",{className:"ms-3 text-muted",children:["Username: ",s.isAnonymous?"Hidden":s.employeeUsername]})]}),e.jsxs("div",{children:[s.hrNotes&&e.jsx(_,{content:`HR Notes: ${s.hrNotes}`,placement:"top",children:e.jsxs("span",{className:"me-3 text-primary",children:[e.jsx(n,{icon:p})," HR Forwarded"]})}),r.has(s._id)?e.jsxs(w,{color:"warning",children:[e.jsx(n,{icon:u,spin:!0,className:"me-1"}),"Processing"]}):e.jsxs(w,{color:U(s.status),children:[e.jsx(n,{icon:z(s.status),className:"me-1"}),s.status]})]})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("small",{className:"text-muted d-block mb-2",children:["Source: ",s.source,s.source==="Employee Complaint"&&e.jsxs(e.Fragment,{children:[" • ","Department: ",s.department," • ","Type: ",s.complaintType," • ","Urgency: ",e.jsx(w,{color:s.urgency==="Critical"?"danger":s.urgency==="High"?"warning":s.urgency==="Medium"?"info":"secondary",shape:"rounded-pill",children:s.urgency})]})]}),e.jsx("p",{className:"mb-0",children:s.complaintText})]}),s.resolutionText&&e.jsxs("div",{className:"mt-3 p-3 bg-light rounded",children:[e.jsx("h6",{children:"AI Resolution:"}),e.jsx("p",{className:"mb-0",children:s.resolutionText}),e.jsxs("div",{className:"mt-3",children:[e.jsxs(d,{color:"primary",size:"sm",className:"me-2",onClick:()=>M(s._id),children:[e.jsx(n,{icon:V,className:"me-1"}),"Download Document"]}),s.actionItems&&s.actionItems.length>0&&e.jsxs(d,{color:"info",size:"sm",className:"me-2",onClick:()=>B(s),children:[e.jsx(n,{icon:T,className:"me-1"}),"View Action Items"]}),s.source==="Employee Complaint"&&!s.isAnonymous&&e.jsxs(d,{color:"success",size:"sm",onClick:()=>H(s._id),disabled:r.has(`notify-${s._id}`),children:[e.jsx(n,{icon:r.has(`notify-${s._id}`)?u:Q,spin:r.has(`notify-${s._id}`),className:"me-1"}),r.has(`notify-${s._id}`)?"Sending...":"Send Notification"]})]})]}),(s.status==="Needs AI Review"||s.status==="Pending")&&e.jsx(d,{color:"success",size:"sm",onClick:()=>$(s),className:"mt-3",disabled:r.has(s._id),children:r.has(s._id)?e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:u,spin:!0,className:"me-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(n,{icon:W,className:"me-2"}),"Resolve with Advanced AI"]})})]})]},s._id))})]})}),L()]})};export{ge as default};
