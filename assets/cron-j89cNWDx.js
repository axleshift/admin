import{j as s}from"./index-Bb-Hm6Ev.js";import{r as n}from"./vendor-react-BHxUanFt.js";import{a as m}from"./axiosInstance-Bq-uIJjs.js";import{F as g,J as L,K as O,L as z}from"./index-a-IrBYvB.js";import{g as H,d as R,n as D,e as U,f as Y,s as N,t as h,l as f,m as j}from"./vendor-coreui-T9QyU9K3.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const Z=()=>{const[p,b]=n.useState("02"),[x,v]=n.useState("00"),[d,y]=n.useState("AM"),[S,k]=n.useState("6"),[_,J]=n.useState("5"),[i,C]=n.useState({message:"",type:""}),[r,l]=n.useState(!1);n.useEffect(()=>{if(i.message){const e=setTimeout(()=>{C({message:"",type:""})},5e3);return()=>clearTimeout(e)}},[i]),n.useEffect(()=>{(async()=>{try{l(!0);const t=(await m.get("/backupauto/config")).data;if(t.cronSchedule){const u=t.cronSchedule.split(" "),I=u[0],$=u[1];let o=parseInt($,10),M="AM";o>=12&&(M="PM",o=o===12?12:o-12),o=o===0?12:o,b(o.toString().padStart(2,"0")),v(I.padStart(2,"0")),y(M)}t.retentionPeriodMonths&&k(t.retentionPeriodMonths.toString())}catch(a){console.error("Error fetching backup configuration:",a)}finally{l(!1)}})()},[]);const w=Array.from({length:12},(e,a)=>{const t=a+1;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),P=Array.from({length:60},(e,a)=>{const t=a;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),B=[{value:"1",label:"1 Month"},{value:"3",label:"3 Months"},{value:"6",label:"6 Months"},{value:"12",label:"1 Year"},{value:"24",label:"2 Years"}],c=(e,a)=>{C({message:e,type:a})},A=()=>{let e=parseInt(p,10);return d==="PM"&&e<12?e+=12:d==="AM"&&e===12&&(e=0),{hours:e.toString().padStart(2,"0"),minutes:x}},F=async()=>{var e;l(!0);try{const a=A(),t=`${a.minutes} ${a.hours} * * *`,u=await m.post("/backupauto/update-schedule",{cronSchedule:t,retentionPeriodMonths:parseInt(S,10)});c(u.data,"success")}catch(a){c(`Error updating schedule: ${((e=a.response)==null?void 0:e.data)||a.message}`,"danger")}finally{l(!1)}},E=async()=>{var e;l(!0);try{const a=await m.post("/backupauto/backup");c(a.data,"success")}catch(a){c(`Error triggering backup: ${((e=a.response)==null?void 0:e.data)||a.message}`,"danger")}finally{l(!1)}},T=async()=>{var e;l(!0);try{const a=await m.post("/backupauto/cleanup");c(a.data,"success")}catch(a){c(`Error during cleanup: ${((e=a.response)==null?void 0:e.data)||a.message}`,"danger")}finally{l(!1)}};return s.jsxs("div",{className:"p-5",children:[s.jsx("h2",{className:"text-2xl mb-4",children:"Backup Manager"}),i.message&&s.jsx(H,{color:i.type,className:"mb-4",children:i.message}),s.jsxs(R,{className:"mb-4",children:[s.jsx(D,{children:s.jsx("div",{children:"Backup Configuration"})}),s.jsxs(U,{children:[s.jsx("p",{className:"mb-4",children:"Backups are automatically saved to the Downloads/my-backups folder in your home directory."}),s.jsxs(Y,{className:"mb-4",children:[s.jsx(N,{children:"Backup Time"}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsxs("div",{className:"d-flex",style:{width:"220px"},children:[s.jsx(h,{value:p,onChange:e=>b(e.target.value),disabled:r,className:"me-1",style:{width:"70px"},children:w.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx("span",{className:"mx-1 mt-2",children:":"}),s.jsx(h,{value:x,onChange:e=>v(e.target.value),disabled:r,className:"me-1",style:{width:"70px"},children:P.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsxs(h,{value:d,onChange:e=>y(e.target.value),disabled:r,style:{width:"70px"},children:[s.jsx("option",{value:"AM",children:"AM"}),s.jsx("option",{value:"PM",children:"PM"})]})]}),s.jsxs(f,{color:"success",onClick:F,className:"ms-3",disabled:r,children:[r?s.jsx(j,{size:"sm"}):s.jsx(g,{icon:L})," Set Schedule"]})]}),s.jsxs("small",{className:"text-muted mt-2 d-block",children:["Current schedule: Daily at ",p,":",x," ",d]})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx(N,{children:"Backup Retention Period"}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(h,{value:S,onChange:e=>k(e.target.value),disabled:r,style:{width:"150px"},children:B.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx("small",{className:"text-muted ms-3",children:"Backups older than this will be automatically deleted"})]})]}),s.jsxs("div",{className:"d-flex mt-4",children:[s.jsxs(f,{color:"danger",onClick:E,disabled:r,className:"me-3",children:[r?s.jsx(j,{size:"sm"}):s.jsx(g,{icon:O})," Trigger Backup Now"]}),s.jsxs(f,{color:"warning",onClick:T,disabled:r,children:[r?s.jsx(j,{size:"sm"}):s.jsx(g,{icon:z})," Clean Up Old Backups"]})]})]})]})]})};export{Z as default};
