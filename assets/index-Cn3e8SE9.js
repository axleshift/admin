import{j as e}from"./index-SoqsusEQ.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{a as D}from"./axiosInstance-Dv2jt_v_.js";import{u as X}from"./vendor-redux-DipIbRRz.js";import{F as r,ai as Q,I as F,aj as Y,ak as Z,f as ee,al as se,am as ae,an as te,ao as re,B as U,W as le,A as B,ap as ne,D as ie,O as ce,aq as oe}from"./index-awhlclXR.js";import{u as de,c as H,k as x,X as h,l as j,j as g,ah as me,y as u,C as xe,$ as he,a0 as je,a1 as S,a2 as c,a3 as ge,a4 as i,al as O,af as ue,N as T,O as d,s as pe,t as Ne,_ as fe,v as ye,am as we,an as be,ao as Ce,ap as Ae,w as ke}from"./vendor-coreui-DHT2NCDT.js";import"./index-t--hEgTQ.js";const Ie=()=>{const[N,E]=o.useState([]),[M,f]=o.useState(null),[z,y]=o.useState(!0),[w,b]=o.useState(!1),[t,K]=o.useState(null),[W,C]=o.useState(!1),G=X(s=>s.changeState.theme),{colorMode:P}=de("coreui-free-react-admin-template-theme"),a=G==="dark"||P==="dark",$=()=>{y(!0),f(null),D.get("/general/log").then(s=>{E(s.data),y(!1)}).catch(s=>{f(s.message),y(!1)})},V=()=>{b(!0),D.get("/general/log").then(s=>{E(s.data),b(!1)}).catch(s=>{f(s.message),b(!1)})};o.useEffect(()=>{$()},[]);const _=s=>{K(s),C(!0)},p=s=>{if(typeof s=="object"&&s!==null&&s.category&&s.patterns&&s.riskLevel)return{category:s.category,patterns:s.patterns,risk:s.riskLevel==="UNKNOWN"?"MEDIUM":s.riskLevel};const l=typeof s=="string"?s:JSON.stringify(s);if(!l)return{category:"Not available",patterns:"Not available",risk:"MEDIUM"};let m="MEDIUM";const n=l.match(/risk(?:\s*level|\s*assessment)?:?\s*(low|medium|high)/i);n&&(m=n[1].toUpperCase());let k="";const I=l.match(/categor(?:y|ization):?\s*([^.]+)/i);I?k=I[1].trim():k="General activity";let v="";const L=l.match(/patterns:?\s*([^.]+)/i)||l.match(/unusual patterns:?\s*([^.]+)/i);return L?v=L[1].trim():v="No unusual patterns detected",{category:k,patterns:v,risk:m}},A=s=>!s||s.toLowerCase()==="unknown"?"warning":s.toLowerCase()==="high"?"danger":s.toLowerCase()==="medium"?"warning":s.toLowerCase()==="low"?"success":a?"light":"secondary",q=a?{color:"#FFFFFF"}:{},R=s=>{const l={CREATE:"success",UPDATE:"primary",DELETE:"danger",RESTORE:"warning",SELECT:"info",FETCH:a?"light":"secondary",NAVIGATE:a?"light":"secondary",AUTO:a?"light":"dark",SET:"info"};for(const[m,n]of Object.entries(l))if(s&&s.includes(m))return n;return a?"light":"secondary"},J=s=>{const l=new Date,m=new Date(s),n=Math.floor((l-m)/1e3);return n<60?`${n} seconds ago`:n<3600?`${Math.floor(n/60)} minutes ago`:n<86400?`${Math.floor(n/3600)} hours ago`:`${Math.floor(n/86400)} days ago`};return M?e.jsx(H,{className:"mt-4",children:e.jsxs(x,{className:`text-center border-danger ${a?"bg-dark text-white":""}`,children:[e.jsxs(h,{className:"bg-danger text-white",children:[e.jsx(r,{icon:Q,className:"me-2"})," Error"]}),e.jsxs(j,{children:[e.jsx("p",{className:"mb-0",children:M}),e.jsxs(g,{color:"primary",className:"mt-3",onClick:$,children:[e.jsx(r,{icon:F,className:"me-2"})," Try Again"]})]})]})}):e.jsxs(H,{fluid:!0,className:"p-4",children:[e.jsxs(x,{className:`shadow-sm ${a?"bg-dark text-white":""}`,children:[e.jsxs(h,{className:`d-flex justify-content-between align-items-center ${a?"bg-dark text-white border-secondary":"bg-light"}`,children:[e.jsxs("div",{children:[e.jsx(r,{icon:Y,className:"me-2 text-primary"}),e.jsxs(me,{className:"d-inline mb-0",style:q,children:["Activity Tracker ",e.jsx(u,{color:"info",shape:"rounded-pill",className:"ms-2",children:"AI Enhanced"})]})]}),e.jsxs("div",{children:[e.jsxs(g,{color:"light",size:"sm",className:`me-2 ${a?"text-dark":""}`,onClick:V,disabled:w,children:[e.jsx(r,{icon:F,spin:w,className:"me-1"}),w?"Refreshing...":"Refresh"]}),e.jsxs(g,{color:a?"light":"secondary",size:"sm",className:a?"text-dark":"",children:[e.jsx(r,{icon:Z,className:"me-1"}),"Export"]})]})]}),e.jsx(j,{children:z?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(xe,{color:"primary"}),e.jsx("p",{className:`mt-2 ${a?"text-light":"text-muted"}`,children:"Loading activity data..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs(he,{hover:!0,striped:!0,responsive:!0,className:`border ${a?"table-dark":""}`,children:[e.jsx(je,{className:a?"bg-dark text-white border-secondary":"bg-light",children:e.jsxs(S,{children:[e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:ee,className:`me-2 ${a?"text-white":"text-muted"}`}),"User"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:se,className:`me-2 ${a?"text-white":"text-muted"}`}),"Role"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:ae,className:`me-2 ${a?"text-white":"text-muted"}`}),"Department"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:te,className:`me-2 ${a?"text-white":"text-muted"}`}),"Route"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:re,className:`me-2 ${a?"text-white":"text-muted"}`}),"Action"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:U,className:`me-2 ${a?"text-white":"text-muted"}`}),"Description"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:le,className:`me-2 ${a?"text-white":"text-muted"}`}),"Time"]}),e.jsxs(c,{className:"text-nowrap",children:[e.jsx(r,{icon:B,className:`me-2 ${a?"text-white":"text-muted"}`}),"AI Analysis"]})]})}),e.jsx(ge,{children:N.length===0?e.jsx(S,{children:e.jsx(i,{colSpan:8,className:`text-center p-5 ${a?"text-white":"text-muted"}`,children:"No activity records found"})}):N.map(s=>{const{risk:l}=p(s.aiAnalysis);return e.jsxs(S,{className:"align-middle",children:[e.jsx(i,{className:"font-weight-bold",children:s.name||"Unknown"}),e.jsx(i,{children:e.jsx(u,{color:a?"light":"dark",shape:"rounded-pill",className:`px-2 py-1 ${a?"text-dark":""}`,children:s.role||"Unknown"})}),e.jsx(i,{children:s.department||"Unknown"}),e.jsx(i,{className:a?"text-info":"text-primary",children:s.route}),e.jsx(i,{children:e.jsx(u,{color:R(s.action),shape:"rounded-pill",className:R(s.action)==="light"?"text-dark":"",children:s.action})}),e.jsx(i,{children:e.jsx(O,{content:s.description,placement:"bottom",children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},children:s.description})})}),e.jsx(i,{className:"text-nowrap",children:e.jsx(O,{content:new Date(s.timestamp).toLocaleString(),children:e.jsx("span",{children:J(s.timestamp)})})}),e.jsx(i,{children:s.aiAnalysis?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(u,{color:A(l),shape:"rounded-pill",className:"me-2",children:l}),e.jsxs(g,{color:"light",size:"sm",onClick:()=>_(s),children:[e.jsx(r,{icon:ne,className:"me-1"}),"View"]})]}):e.jsx("span",{className:"text-muted",children:"Not available"})})]},s._id)})})]})})}),e.jsx(ue,{className:`${a?"bg-dark text-white border-secondary":"bg-light text-muted"}`,children:e.jsxs(T,{children:[e.jsx(d,{children:e.jsxs("small",{children:["Showing ",N.length," activities"]})}),e.jsx(d,{className:"text-end",children:e.jsxs("small",{children:["Last updated: ",new Date().toLocaleString()]})})]})})]}),e.jsxs(pe,{visible:W,onClose:()=>C(!1),size:"lg",backdrop:"static",className:a?"modal-dark":"",children:[e.jsx(Ne,{className:a?"bg-dark text-white":"",children:e.jsxs(fe,{children:[e.jsx(r,{icon:B,className:"me-2 text-primary"}),"AI Activity Analysis"]})}),e.jsx(ye,{className:a?"bg-dark text-white":"",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Activity Details"}),e.jsxs(T,{className:"mb-3",children:[e.jsxs(d,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"User:"})," ",t.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Role:"})," ",t.role]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Department:"})," ",t.department]})]}),e.jsxs(d,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Route:"})," ",t.route]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Action:"})," ",t.action]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Time:"})," ",new Date(t.timestamp).toLocaleString()]})]})]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Description:"})," ",t.description]})]}),t&&e.jsxs("div",{className:"mb-3 mt-4",children:[e.jsxs("h5",{children:[e.jsx(r,{icon:ie,className:"me-2 text-info"}),"AI Analysis Results"]}),t.aiAnalysis?e.jsxs(e.Fragment,{children:[e.jsx(we,{activeItemKey:1,className:"mt-3",children:e.jsxs(be,{itemKey:1,children:[e.jsx(Ce,{children:"Full Analysis"}),e.jsx(Ae,{children:e.jsx("div",{className:`p-3 ${a?"bg-secondary bg-opacity-10":"bg-light"}`,style:{whiteSpace:"pre-line",borderRadius:"0.25rem"},children:typeof t.aiAnalysis=="object"&&t.aiAnalysis.fullAnalysis?t.aiAnalysis.fullAnalysis:t.aiAnalysis})})]})}),e.jsxs(T,{className:"mt-4",children:[e.jsx(d,{md:"4",children:e.jsxs(x,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(h,{className:"bg-info text-white",children:[e.jsx(r,{icon:U,className:"me-2"}),"Category"]}),e.jsx(j,{children:t.aiStructuredAnalysis?t.aiStructuredAnalysis.category:p(t.aiAnalysis).category})]})}),e.jsx(d,{md:"4",children:e.jsxs(x,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(h,{className:"bg-primary text-white",children:[e.jsx(r,{icon:ce,className:"me-2"}),"Patterns"]}),e.jsx(j,{children:t.aiStructuredAnalysis?t.aiStructuredAnalysis.patterns:p(t.aiAnalysis).patterns})]})}),e.jsx(d,{md:"4",children:e.jsx(x,{className:a?"bg-dark text-white border-secondary":"",children:(()=>{const s=t.aiStructuredAnalysis?t.aiStructuredAnalysis.riskLevel:p(t.aiAnalysis).risk;return e.jsxs(e.Fragment,{children:[e.jsxs(h,{className:`bg-${A(s)} text-white`,children:[e.jsx(r,{icon:oe,className:"me-2"}),"Risk Level"]}),e.jsx(j,{className:"d-flex justify-content-center align-items-center",children:e.jsx(u,{color:A(s),size:"lg",shape:"rounded-pill",className:"px-4 py-2",children:s})})]})})()})})]})]}):e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-muted",children:"AI analysis not available for this activity."})})]})]})}),e.jsx(ke,{className:a?"bg-dark text-white":"",children:e.jsx(g,{color:"secondary",onClick:()=>C(!1),children:"Close"})})]})]})};export{Ie as default};
