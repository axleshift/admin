import{j as e}from"./index-Bf0IcOp-.js";import{r,i as ee,k as se}from"./vendor-react-B6URQkMn.js";import{a as D}from"./axiosInstance-Dv2jt_v_.js";import{a as ae}from"./geminiPasswordAnalyzer-D2a4flXO.js";import{F as i,r as M,t as Z,u as _,v as te,w as re,x as H,y as O,z as ne}from"./index-CL47NU8L.js";import{c as oe,N as le,O as ie,k as ce,X as de,l as me,R as ue,S as A,V as Y,Y as K,C as v,y as fe,Z as he,j as pe}from"./vendor-coreui-BN8uYOBb.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const k=a=>{let t=0,c="Very Weak";const d=[];a.length<8?d.push("Password should be at least 8 characters long"):t+=20,/[A-Z]/.test(a)?t+=15:d.push("Add uppercase letters for stronger security"),/[a-z]/.test(a)?t+=15:d.push("Add lowercase letters for better security"),/[0-9]/.test(a)?t+=15:d.push("Include numbers to strengthen your password"),/[^A-Za-z0-9]/.test(a)?t+=15:d.push("Add special characters (like !@#$%) for maximum security");const h=new Set(a).size;return h>8?t+=10:h>5?t+=5:d.push("Use a greater variety of characters"),["12345","123456","qwerty","password","admin","welcome","abcdef","abc123","111111","000000"].some(w=>a.toLowerCase().includes(w))&&(t=Math.max(t-20,0),d.push("Avoid common password patterns and sequences")),t<30?c="Very Weak":t<50?c="Weak":t<70?c="Moderate":t<85?c="Strong":c="Very Strong",{score:t,strength:c,feedback:d,explanation:"Analysis performed using basic password rules."}};function Pe(){const[a,t]=r.useState(""),[c,d]=r.useState(""),[h,l]=r.useState(""),[w,z]=r.useState(""),[n,I]=r.useState(null),[g,b]=r.useState(!1),[x,y]=r.useState(null),[E,R]=r.useState(!1),[j,T]=r.useState(!0),[F,C]=r.useState(0),[p,N]=r.useState(!1),X=ee(),{id:P,token:S}=se(),G=(s,o)=>{let m;return(...f)=>{clearTimeout(m),m=setTimeout(()=>{s(...f)},o)}},U=r.useCallback(async s=>{if(!s||s.length<4)return null;if(b(!0),y(null),j)try{const o=await Promise.race([ae(s),new Promise((m,f)=>setTimeout(()=>f(new Error("Analysis timeout")),3e3))]);return C(0),o}catch(o){console.error("Password analysis error:",o);const m=F+1;return C(m),m>=3?(T(!1),y("AI analysis temporarily disabled due to repeated failures"),setTimeout(()=>{T(!0),C(0),y(null)},3e4)):y(`Could not analyze password strength (Attempt ${m}/3)`),k(s)}else return k(s)},[j,F]),$=r.useCallback(G(async s=>{try{const o=await U(s);I(o)}finally{b(!1)}},500),[U]);r.useEffect(()=>{N(!1),a?$(a):(I(null),b(!1))},[a,$]),r.useEffect(()=>{(async()=>{try{await D.get(`/general/validate-reset-token/${P}/${S}`)}catch{l("This password reset link has expired or is invalid")}})()},[P,S]);const J=async s=>{var m,f,L,V,W,B;if(s.preventDefault(),l(""),z(""),N(!1),a!==c){l("Passwords do not match");return}if(a.length<8){l("Password must be at least 8 characters long");return}const o=n||k(a);if(o.score<30){l("Please choose a stronger password");return}R(!0);try{const u=await D.post(`/general/reset-password/${P}/${S}`,{password:a,passwordAnalysis:{score:o.score,strength:o.strength,aiPowered:j&&!x}});u.data.Status==="Success"?(z("Password reset successful! Redirecting to login..."),setTimeout(()=>X("/login"),2e3)):l(u.data.Message||"Password reset failed")}catch(u){console.error("Error:",u),((m=u.response)==null?void 0:m.status)===400?((L=(f=u.response)==null?void 0:f.data)==null?void 0:L.Code)==="PASSWORD_RECENTLY_USED"?(N(!0),l("This password was recently used. Please choose a password you haven't used within the last 6 months.")):l(((W=(V=u.response)==null?void 0:V.data)==null?void 0:W.Message)||"Invalid password or expired token"):((B=u.response)==null?void 0:B.status)===404?l("User not found"):l("An error occurred during password reset. Please try again.")}finally{R(!1)}},q=s=>!s||s<30?"danger":s<50?"warning":s<70?"info":s<85?"primary":"success",Q=s=>!s||s<50?O:s<70?H:ne;return e.jsx(oe,{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:e.jsx(le,{className:"w-100 justify-content-center",children:e.jsx(ie,{md:6,lg:4,children:e.jsxs(ce,{className:"shadow-lg border-0",children:[e.jsxs(de,{className:"bg-primary text-white text-center py-3",children:[e.jsx(i,{icon:M,size:"2x",className:"me-2"}),e.jsx("h4",{className:"d-inline align-middle",children:"Reset Password"})]}),e.jsx(me,{className:"p-4",children:e.jsxs(ue,{onSubmit:J,children:[h&&e.jsxs(A,{color:p?"warning":"danger",className:"mb-3",children:[p&&e.jsx(i,{icon:Z,className:"me-2"}),h]}),w&&e.jsx(A,{color:"success",className:"mb-3",children:w}),e.jsxs("div",{className:"mb-3",children:[e.jsx(Y,{type:"password",placeholder:"New Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:_,className:"me-2"}),"New Password"]}),value:a,onChange:s=>t(s.target.value),required:!0,className:`mb-2 ${p?"border-warning":""}`,autoComplete:"new-password"}),a.length>0&&e.jsxs("div",{className:"mb-3 password-analyzer",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[j&&!x?e.jsx(K,{content:"AI-powered password analysis",children:e.jsx(i,{icon:te,className:"me-2 text-primary"})}):e.jsx(K,{content:"Basic password analysis",children:e.jsx(i,{icon:re,className:"me-2 text-secondary"})}),"Password Strength:"]}),g?e.jsx(v,{size:"sm",color:"primary"}):n&&e.jsxs(fe,{color:q(n.score),shape:"rounded-pill",children:[e.jsx(i,{icon:Q(n.score),className:"me-1"}),n.strength]})]}),n&&!g&&e.jsxs(e.Fragment,{children:[e.jsx(he,{value:n.score,color:q(n.score),className:"mb-2",animated:!0}),e.jsxs("div",{className:"password-feedback mt-2",children:[p&&e.jsxs("div",{className:"small text-warning mb-1 fw-bold",children:[e.jsx(i,{icon:Z,className:"me-1"}),"This password was used within the last 6 months"]}),n.feedback&&n.feedback.map((s,o)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(i,{icon:H,className:"me-1"}),s]},o)),n.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:n.explanation})]})]}),x&&e.jsxs(A,{color:"warning",className:"py-1 mt-2 mb-0 small",children:[e.jsx(i,{icon:O,className:"me-1"}),x]})]}),e.jsx(Y,{type:"password",placeholder:"Confirm Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:_,className:"me-2"}),"Confirm Password"]}),value:c,onChange:s=>d(s.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(pe,{type:"submit",color:"primary",className:"w-100",disabled:E||g||a.length<8||a!==c||n&&n.score<30||p,children:E?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",component:"span",className:"me-2"}),"Updating..."]}):g?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",component:"span",className:"me-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:M,className:"me-2"}),"Update Password"]})})]})})]})})})})}export{Pe as default};
