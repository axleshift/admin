import{j as e,l as fe,m as ye}from"./index-BRG0Ob5i.js";import{r as d}from"./vendor-react-B6URQkMn.js";import{F as c,l as z,m as Y,n as te,o as we,p as Ce,q as J,r as ve,s as Se,t as Ne,u as be,v as ne,h as ke}from"./DefaultLayout-BMb2_2VI.js";import{l as W}from"./activityLogger-B0YFQMHx.js";import{a as ie}from"./axiosInstance-BPOGMmNr.js";import{k as L,a2 as I,l as P,S as k,C as me,j as g,y as B,a5 as Ae,a6 as Re,a7 as le,a8 as ce,s as he,t as ue,a4 as pe,v as ge,T as Ue,V as xe,U as Le,P as j,N as Pe,O as Ee,Y as $e,Z as Ie,_ as oe,$ as C,a0 as Me,a1 as v,W as de,w as Te}from"./vendor-coreui-vXCAeGSv.js";import"./vendor-redux-DipIbRRz.js";import"./Page500-_hBnhY0G.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-DLItbach.js";import"./index-t--hEgTQ.js";const je=({userData:h,onSecurityUpdate:M})=>{const[E,T]=d.useState(null),[O,u]=d.useState(!1),[F,D]=d.useState(null),[i,f]=d.useState(!1),[S,V]=d.useState(""),[A,$]=d.useState(!1);d.useEffect(()=>{G(h)&&y(h)},[h]);const G=a=>a&&a.firstName&&a.lastName&&a.email&&a.password&&a.role&&a.department,y=async a=>{var s,r,l,o;if(!(!a.password||a.password.length<3)){u(!0),D(null);try{const t=await ie.post("/security/analyze-security",{firstName:a.firstName,lastName:a.lastName,email:a.email,password:a.password,role:a.role,department:a.department});if((r=(s=t.data.securityAnalysis)==null?void 0:s.aiRecommendations)!=null&&r.analysis&&(t.data.securityAnalysis.aiRecommendations.analysis=w(t.data.securityAnalysis.aiRecommendations.analysis)),T(t.data.securityAnalysis),M){const n={isSecure:H(t.data.securityAnalysis),analysis:t.data.securityAnalysis};M(n),await ie.post("/security/log-security-event",{userId:a.userId||a.email,eventType:n.isSecure?"SECURITY_CHECK_PASSED":"SECURITY_CHECK_FAILED",details:{riskLevel:t.data.securityAnalysis.aiRecommendations.riskLevel,timestamp:new Date().toISOString(),passwordStrength:t.data.securityAnalysis.basicChecks.passwordStrength.strength,rolePrivilegeLevel:t.data.securityAnalysis.basicChecks.rolePrivilegeLevel.privilegeLevel}})}}catch(t){console.error("Security analysis error:",t),D(((o=(l=t.response)==null?void 0:l.data)==null?void 0:o.message)||"Error analyzing security")}finally{u(!1)}}},w=a=>{if(!a)return"";let s=a;const r=/##\s+.+/.test(a),l=/\*\*\d+\.\s.+?\*\*:/.test(a);return r?(s=s.replace(/##\s+(.+?):/g,"<h5>$1</h5>"),s=s.replace(/##\s+(.+?)$/gm,"<h5>$1</h5>"),s=s.replace(/(\d+)\.\s+\*\*(.+?)\*\*/g,"<p><strong>$1. $2</strong></p>"),s=s.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),s=s.replace(/\*\s+(.+?)$/gm,"<li>$1</li>"),s=s.replace(/(<li>.+?<\/li>\n)+/gs,"<ul>$&</ul>"),s=s.replace(/<\/h5>/g,'</h5><div class="mb-3">'),s=s.replace(/<h5>/g,"</div><h5>"),s=s.replace("</div>",""),s+="</div>"):l&&(s=s.replace(/\*\*(\d+)\.\s+Overall Risk Assessment:\*\*\s+(\w+)/i,'<h5>1. Overall Risk Assessment</h5><p class="mb-3"><span class="badge bg-$2-color me-2">$2</span></p>'),s=s.replace(/\*\*(\d+)\.\s+Specific Security Concerns:\*\*/i,"<h5>2. Specific Security Concerns</h5>"),s=s.replace(/\*\*(\d+)\.\s+Recommendations to Improve Security:\*\*/i,"<h5>3. Recommendations to Improve Security</h5>"),s=s.replace(/\*\*\*([^*]+)\*\*/g,"<strong>• $1</strong>"),s=s.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),s=s.replace(/\*([^*]+)\*/g,"<em>$1</em>"),s=s.replace(/\*\s/g,"• ")),s.includes("**")&&!s.includes("<strong>")&&(s=s.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")),["low","medium","high","critical"].forEach(t=>{const n=new RegExp(`\\b${t}\\b`,"gi");s=s.replace(n,`<span class="badge bg-${t.toLowerCase()}-color me-1">${t.toUpperCase()}</span>`)}),s=s.replace(/\n\n/g,"</p><p>"),s.includes("<p>")||(s=`<p>${s}</p>`),s},K=()=>{const s="ABCDEFGHJKLMNPQRSTUVWXYZ",r="abcdefghijkmnopqrstuvwxyz",l="23456789",o="!@#$%^&*()-_=+[]{}|;:,.<>?",t=s+r+l+o;let n="";n+=s.charAt(Math.floor(Math.random()*s.length)),n+=r.charAt(Math.floor(Math.random()*r.length)),n+=l.charAt(Math.floor(Math.random()*l.length)),n+=o.charAt(Math.floor(Math.random()*o.length));for(let b=4;b<16;b++)n+=t.charAt(Math.floor(Math.random()*t.length));n=n.split("").sort(()=>.5-Math.random()).join(""),V(n),$(!1),f(!0)},q=()=>{navigator.clipboard.writeText(S),$(!0),setTimeout(()=>{$(!1)},2e3)},H=a=>{if(!a)return!1;const{basicChecks:s,aiRecommendations:r}=a;return s.passwordStrength.strength==="weak"?!1:s.rolePrivilegeLevel.privilegeLevel==="critical"?r.riskLevel!=="high":s.emailRisk.riskLevel!=="high"},R=a=>{switch(a==null?void 0:a.toLowerCase()){case"high":return"danger";case"medium":return"warning";case"low":return"success";case"critical":return"danger";case"elevated":return"warning";case"standard":return"success";default:return"info"}},_=a=>{switch(a){case"strong":return"success";case"good":return"info";case"moderate":return"warning";case"weak":return"danger";default:return"secondary"}};if(!G(h))return e.jsxs(L,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex align-items-center",children:[e.jsx(c,{icon:z,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsx(P,{children:e.jsx(k,{color:"info",children:"Enter user details to receive AI-powered security recommendations."})})]});if(O)return e.jsxs(L,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex align-items-center",children:[e.jsx(c,{icon:z,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsxs(P,{className:"text-center p-4",children:[e.jsx(me,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Analyzing security with Gemini AI..."})]})]});if(F)return e.jsxs(L,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex align-items-center",children:[e.jsx(c,{icon:z,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsxs(P,{children:[e.jsxs(k,{color:"danger",children:[e.jsx(c,{icon:Y,className:"me-2"}),F]}),e.jsx(g,{color:"primary",size:"sm",onClick:()=>y(h),children:"Try Again"})]})]});if(!E)return null;const{basicChecks:p,aiRecommendations:U}=E,x=p.passwordStrength,N=H(E);return e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex align-items-center",children:[e.jsx(c,{icon:z,className:"me-2"}),e.jsx("strong",{children:"Gemini AI Security Assistant"})]}),e.jsxs(P,{children:[e.jsx(k,{color:N?"success":"warning",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(c,{icon:N?te:Y,className:"me-2",size:"lg"}),e.jsxs("div",{children:[e.jsx("strong",{children:N?"Security Check Passed":"Security Recommendations"}),e.jsx("p",{className:"mb-0",children:N?"This user registration meets the security requirements.":"Please review the security recommendations below."})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Password Strength:"}),e.jsxs("div",{children:[e.jsx(B,{color:_(x.strength),className:"me-2",children:x.strength.toUpperCase()}),e.jsxs(g,{color:"primary",size:"sm",onClick:K,title:"Generate a secure password",children:[e.jsx(c,{icon:we,className:"me-1"}),"Generate Secure Password"]})]})]}),e.jsx(Ae,{className:"mb-2",children:e.jsx(Re,{value:x.score,color:_(x.strength)})}),x.feedback.length>0&&e.jsx(le,{small:!0,flush:!0,className:"border rounded mb-3",children:x.feedback.map((a,s)=>e.jsxs(ce,{children:[e.jsx(c,{icon:Ce,className:"me-2 text-primary"}),a]},s))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Privilege Level:"}),e.jsx(B,{color:R(p.rolePrivilegeLevel.privilegeLevel),children:p.rolePrivilegeLevel.privilegeLevel.toUpperCase()})]}),p.rolePrivilegeLevel.requiresAdditionalVerification&&e.jsxs(k,{color:"info",className:"small",children:[e.jsx(c,{icon:J,className:"me-2"}),"This role requires additional verification due to elevated privileges."]})]}),p.emailRisk.riskFactors.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Email Risk Level:"}),e.jsx(B,{color:R(p.emailRisk.riskLevel),children:p.emailRisk.riskLevel.toUpperCase()})]}),e.jsx(le,{small:!0,flush:!0,className:"border rounded mb-3",children:p.emailRisk.riskFactors.map((a,s)=>e.jsxs(ce,{children:[e.jsx(c,{icon:Y,className:"me-2 text-warning"}),a]},s))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Gemini AI Security Analysis:"}),e.jsxs(B,{color:R(U.riskLevel),children:[U.riskLevel.toUpperCase()," RISK"]})]}),e.jsx(L,{className:"bg-light",children:e.jsx(P,{children:e.jsx("div",{className:"analysis-content",dangerouslySetInnerHTML:{__html:U.analysis.replace(/\$2-color/g,R(U.riskLevel))}})})})]})]})]}),e.jsxs(he,{visible:i,onClose:()=>f(!1),alignment:"center",children:[e.jsx(ue,{children:e.jsxs(pe,{children:[e.jsx(c,{icon:J,className:"me-2"}),"Secure Password Generator"]})}),e.jsxs(ge,{children:[e.jsx("p",{children:"This password has been generated securely with a mix of uppercase, lowercase, numbers, and special characters:"}),e.jsxs(Ue,{className:"mb-3",children:[e.jsx(xe,{type:"text",value:S,readOnly:!0,className:"border-end-0"}),e.jsx(Le,{className:"bg-primary text-white cursor-pointer",onClick:q,children:e.jsx(c,{icon:ve})})]}),A&&e.jsxs(k,{color:"success",className:"mt-3 mb-0 py-2",children:[e.jsx(c,{icon:te,className:"me-2"}),"Password copied to clipboard!"]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[e.jsx(g,{color:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(g,{color:"success",onClick:()=>{q(),f(!1)},children:"Use This Password"})]})]})]})]})};je.propTypes={userData:j.shape({userId:j.string,firstName:j.string.isRequired,lastName:j.string.isRequired,email:j.string.isRequired,password:j.string.isRequired,role:j.string.isRequired,department:j.string.isRequired}),onSecurityUpdate:j.func.isRequired};const Ye=()=>{var a;const{data:h,isLoading:M,isError:E,refetch:T}=fe(),[O]=ye(),[u,F]=d.useState(null),D=["Administrative","Finance","HR","Core","Logistics"],[i,f]=d.useState({}),[S,V]=d.useState({}),[A,$]=d.useState({}),[G,y]=d.useState(!1),[w,K]=d.useState(null);d.useEffect(()=>{try{const s=localStorage.getItem("currentUser");if(s){const r=JSON.parse(s);F(r),W({name:r.name||"Unknown User",role:r.role||"Unknown Role",department:r.department||"Unknown Department",route:"hr/users",action:"VIEW",description:"Accessed new users registration page"})}}catch(s){console.error("Failed to get current user:",s)}},[]);const q=s=>{if(!s)return[];const r=s.toLowerCase();return r==="finance"?["user","admin","staff","superadmin","technician"]:r==="administrative"||r==="admin"?["admin","manager","superadmin"]:r==="logistics"?["Admin","Manager","Employee","Contractor"]:r==="core"?["Admin","Manager","Employee","Contractor"]:r==="hr"?["Admin","Manager","Employee","Contractor"]:[]},H=(s,r)=>{f({...i,[s]:{...i[s],password:r}})},R=s=>{V({...S,[s]:!S[s]})},_=(s,r)=>{f({...i,[s]:{...i[s],department:r,role:""}})},p=(s,r)=>{f({...i,[s]:{...i[s],role:r}})},U=(s,r)=>{$({...A,[s]:r})},x=s=>{var o,t,n;const r=s.id||s._id||s.email,l={userId:r,firstName:s.firstName,lastName:s.lastName,email:s.email,password:((o=i[r])==null?void 0:o.password)||"",role:((t=i[r])==null?void 0:t.role)||"",department:((n=i[r])==null?void 0:n.department)||""};K(l),y(!0)},N=async s=>{const r=s.id||s._id||s.email,l=i[r]||{},o=A[r];if(!o||!o.isSecure){x(s);return}const t={firstName:s.firstName,lastName:s.lastName,email:s.email,password:l.password||"",role:l.role||"",department:l.department||""};try{const n=await O(t).unwrap();if(console.log("User saved successfully:",n),u){const b=`Registered new user: ${s.firstName} ${s.lastName} (${s.email}) with role: ${l.role} in department: ${l.department}`;W({name:u.name||"Unknown User",role:u.role||"Unknown Role",department:u.department||"Unknown Department",route:"hr/users",action:"CREATE",description:b})}T()}catch(n){console.error("Error saving user:",n),u&&W({name:u.name||"Unknown User",role:u.role||"Unknown Role",department:u.department||"Unknown Department",route:"hr/users",action:"ERROR",description:`Failed to register user: ${s.firstName} ${s.lastName} (${s.email}). Error: ${n.message||"Unknown error"}`}),n.data&&n.data.error&&console.error("Validation error:",n.data.error)}};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsx(Ee,{md:12,children:e.jsxs(L,{children:[e.jsx(I,{children:e.jsxs("h4",{children:[e.jsx(c,{icon:Se,className:"me-2"}),"New Users"]})}),e.jsxs(P,{children:[e.jsxs($e,{hover:!0,responsive:!0,className:"align-middle",children:[e.jsx(Ie,{color:"light",children:e.jsxs(oe,{children:[e.jsx(C,{children:"First Name"}),e.jsx(C,{children:"Last Name"}),e.jsx(C,{children:"Email"}),e.jsx(C,{children:"Password"}),e.jsx(C,{children:"Department"}),e.jsx(C,{children:"Role"}),e.jsx(C,{children:"Security"}),e.jsx(C,{children:"Actions"})]})}),e.jsx(Me,{children:h&&h.map(s=>{var b,Q,Z,X,ee,se,re,ae;const r=s.id||s._id||s.email,l=((b=i[r])==null?void 0:b.department)||"",o=q(l),t=A[r]||{},n=t!=null&&t.isSecure?"success":t?"warning":"secondary";return e.jsxs(oe,{children:[e.jsx(v,{children:s.firstName}),e.jsx(v,{children:s.lastName}),e.jsx(v,{children:s.email}),e.jsx(v,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(xe,{type:S[r]?"text":"password",placeholder:"Set password",value:((Q=i[r])==null?void 0:Q.password)||"",onChange:m=>H(r,m.target.value)}),e.jsx(g,{color:"link",onClick:()=>R(r),className:"ms-2",children:e.jsx(c,{icon:S[r]?Ne:be})})]})}),e.jsx(v,{children:e.jsxs(de,{value:((Z=i[r])==null?void 0:Z.department)||"",onChange:m=>_(r,m.target.value),children:[e.jsx("option",{value:"",children:"Select department"}),D.map(m=>e.jsx("option",{value:m,children:m},m))]})}),e.jsx(v,{children:e.jsxs(de,{value:((X=i[r])==null?void 0:X.role)||"",onChange:m=>p(r,m.target.value),disabled:!((ee=i[r])!=null&&ee.department),children:[e.jsx("option",{value:"",children:"Select role"}),o.map(m=>e.jsx("option",{value:m,children:m},m))]})}),e.jsx(v,{children:e.jsxs(g,{color:n,size:"sm",onClick:()=>x(s),children:[e.jsx(c,{icon:J,className:"me-1"}),t!=null&&t.isSecure?"Secure":"Check"]})}),e.jsx(v,{children:e.jsxs(g,{color:"primary",onClick:()=>N(s),disabled:!((se=i[r])!=null&&se.department)||!((re=i[r])!=null&&re.role)||!((ae=i[r])!=null&&ae.password),children:[e.jsx(c,{icon:ne,className:"me-1"}),"Save"]})})]},r)})})]}),M&&e.jsx("div",{className:"text-center my-3",children:e.jsx(me,{color:"primary"})}),E&&e.jsx(k,{color:"danger",className:"mt-3",children:"Error loading new users. Please try again."}),h&&h.length===0&&e.jsx(k,{color:"info",className:"mt-3",children:"No new user registrations pending."}),e.jsx("div",{className:"d-flex justify-content-end mt-3",children:e.jsxs(g,{color:"secondary",onClick:T,children:[e.jsx(c,{icon:ke,className:"me-1"}),"Refresh"]})})]})]})})}),e.jsxs(he,{visible:G,onClose:()=>y(!1),size:"lg",children:[e.jsx(ue,{onClose:()=>y(!1),children:e.jsx(pe,{children:"Security Analysis"})}),e.jsx(ge,{children:w&&e.jsx(je,{userData:w,onSecurityUpdate:s=>{U(w.userId,s)}})}),e.jsxs(Te,{children:[e.jsx(g,{color:"secondary",onClick:()=>y(!1),children:"Close"}),w&&((a=A[w.userId])==null?void 0:a.isSecure)&&e.jsxs(g,{color:"success",onClick:()=>{y(!1);const s=h.find(r=>(r.id||r._id||r.email)===w.userId);s&&N(s)},children:[e.jsx(c,{icon:ne,className:"me-1"}),"Save User"]})]})]})]})};export{Ye as default};
