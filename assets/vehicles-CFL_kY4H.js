import{j as e}from"./index-ala_1vvM.js";import{r as l}from"./vendor-react-BHxUanFt.js";import{a as E}from"./axiosInstance-Bq-uIJjs.js";import{l as w}from"./activityLogger-D6Lc4RsL.js";import{F as t,t as x,c as I,w as ee,a3 as se,a4 as ae,j as te,s as A,a5 as F,a6 as le,g as P,a7 as re,a8 as ne,a1 as ie,a9 as oe,aa as ce,ab as de,h as me,i as he,x as xe}from"./index-CO_Wo9dq.js";import{m as T,g as v,d as R,n as z,Q as ue,R as pe,S as je,T as u,a as ge,b as fe,l as p,e as be,a7 as we,x as Ne,H as ye,I as Ce,J as ve,K as ke,O as Ve,p as De}from"./vendor-coreui-C1kAWlgm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const Te=()=>{const[n,$]=l.useState([]),[N,k]=l.useState(!0),[j,V]=l.useState(null),[g,D]=l.useState(null),[S,_]=l.useState(!1),[U,B]=l.useState(""),[L,H]=l.useState(""),[Z,y]=l.useState(!1),[f,b]=l.useState(null),[O,o]=l.useState(!1),i=localStorage.getItem("role"),c=localStorage.getItem("department"),r=localStorage.getItem("name"),M=localStorage.getItem("username");localStorage.getItem("userId"),l.useEffect(()=>{(async()=>{try{k(!0);const a=await E.get("/logistics/vehicle");a.data.success&&a.data.data.success?($(a.data.data.data),b({color:"success",title:"Success",content:"Vehicle data has been successfully loaded!"}),o(!0),w({name:r,role:i,department:c,route:"/vehicles",action:"View Vehicles",description:`${r} viewed vehicle fleet data`}).catch(console.warn)):V("Failed to fetch vehicle data")}catch(a){V(a.message||"An error occurred while fetching vehicle data"),console.error("Error fetching vehicles:",a),b({color:"danger",title:"Error",content:"Failed to load vehicle data"}),o(!0)}finally{k(!1)}})()},[r,i,c]);const d=async s=>{try{_(!0);let a="";switch(s){case"all":a="All_Vehicles";break;case"available":a="Available_Vehicles";break;case"in_use":a="InUse_Vehicles";break;case"maintenance":a="Maintenance_Vehicles";break;case"forRegistration":a="ForRegistration_Vehicles";break;default:a="Vehicles"}const m=await E.post("/management/downloadVehicleZip",{name:r,role:i,username:M,downloadType:s},{responseType:"blob"}),W=r.substring(0,2)+i.charAt(0)+M.slice(-6);B(W),H(`${a}_Protected.zip`),y(!0);const X=window.URL.createObjectURL(new Blob([m.data])),h=document.createElement("a");h.href=X,h.setAttribute("download",`${a}_Protected.zip`),document.body.appendChild(h),h.click(),document.body.removeChild(h),w({name:r,role:i,department:c,route:"/vehicles",action:"Download Protected Data",description:`Downloaded ${a} as password-protected zip`}).catch(console.warn),b({color:"success",title:"Success",content:`File ${a}_Protected.zip downloaded successfully!`}),o(!0)}catch(a){console.error("Error creating protected zip:",a),b({color:"danger",title:"Error",content:"Failed to create protected download. Please try again."}),o(!0)}finally{_(!1)}},C=(s,a)=>{const m={view:`Viewed details for vehicle ${a.regisNumber||a._id}`,edit:`Initiated editing vehicle ${a.regisNumber||a._id}`,delete:`Initiated deletion of vehicle ${a.regisNumber||a._id}`};w({name:r,role:i,department:c,route:"/vehicles",action:`Vehicle ${s.charAt(0).toUpperCase()+s.slice(1)}`,description:m[s]}).catch(console.warn)},Y=s=>{if(g===s)D(null);else{D(s);const a=n.find(m=>m._id===s);a&&w({name:r,role:i,department:c,route:"/vehicles",action:"View Vehicle Details",description:`${r} Expanded details for vehicle ${a.regisNumber||s}`}).catch(console.warn)}},q=s=>s?new Date(s).toLocaleDateString():"N/A",G=s=>({available:"success",in_use:"primary",forRegistration:"warning",maintenance:"danger"})[s]||"secondary",J=s=>({available:he,in_use:P,forRegistration:me,maintenance:de})[s]||xe,K=s=>e.jsxs(De,{color:G(s),children:[e.jsx(t,{icon:J(s),className:"me-1"}),s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())]}),Q=[{key:"idNum",label:"ID",icon:le},{key:"brand",label:"Brand",icon:F},{key:"model",label:"Model",icon:x},{key:"year",label:"Year",icon:A},{key:"type",label:"Type",icon:x},{key:"capacity",label:"Capacity (kg)",icon:P},{key:"fuelType",label:"Fuel Type",icon:re},{key:"currentMileage",label:"Mileage (km)",icon:ne}];return e.jsxs("div",{className:"container-fluid p-4",children:[O&&f&&e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:1050},children:e.jsx("div",{className:`toast show align-items-center text-white bg-${f.color} border-0`,role:"alert","aria-live":"assertive","aria-atomic":"true",children:e.jsxs("div",{className:"d-flex",children:[e.jsxs("div",{className:"toast-body",children:[e.jsx("strong",{children:f.title}),": ",f.content]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>o(!1)})]})})}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("h1",{children:[e.jsx(t,{icon:x,className:"me-3 text-primary"}),"Vehicle Fleet Management"]})}),N&&e.jsx("div",{className:"d-flex justify-content-center py-5",children:e.jsx(T,{color:"primary"})}),j&&e.jsxs(v,{color:"danger",className:"mb-4",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:j})]}),!N&&!j&&n&&n.length===0&&e.jsx(v,{color:"warning",className:"mb-4",children:e.jsx("p",{children:"No vehicle data available."})}),!N&&!j&&n&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"shadow mb-4",children:e.jsx(z,{className:"bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"fw-bold",children:[e.jsx(t,{icon:x,className:"me-2 text-primary"}),"Total Vehicles: ",n.filter(s=>!s.deleted).length]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(ue,{children:[e.jsxs(pe,{disabled:S,children:[e.jsx(t,{icon:I,className:"me-2",color:"success"}),"Secure Download",S&&e.jsx(T,{size:"sm",className:"ms-2"})]}),e.jsxs(je,{children:[e.jsx(u,{onClick:()=>d("all"),children:"All Vehicles"}),e.jsx(u,{onClick:()=>d("available"),children:"Available Vehicles"}),e.jsx(u,{onClick:()=>d("in_use"),children:"In-Use Vehicles"}),e.jsx(u,{onClick:()=>d("maintenance"),children:"Maintenance Vehicles"}),e.jsx(u,{onClick:()=>d("forRegistration"),children:"For Registration Vehicles"})]})]})})]})})}),e.jsx(ge,{children:n.filter(s=>!s.deleted).map(s=>e.jsx(fe,{sm:12,className:"mb-4",children:e.jsx(R,{className:"shadow-sm border-top-0 border-left-0 border-right-0 border-bottom border-primary",style:{cursor:"pointer",borderWidth:"3px"},children:e.jsxs("div",{className:"d-flex flex-row",children:[e.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"120px",minHeight:"100%"},children:e.jsx(t,{icon:x,size:"3x",className:"text-primary"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs(z,{className:"d-flex justify-content-between align-items-center bg-white border-0",children:[e.jsx("div",{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:ee,className:"me-2 text-primary"}),s.regisNumber||"No Registration"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[K(s.status||"unknown"),e.jsx(p,{color:"link",className:"p-0 ms-3",onClick:()=>Y(s._id),children:e.jsx(t,{icon:g===s._id?se:ae,size:"lg"})})]})]}),e.jsxs(be,{className:"py-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Driver"}),e.jsxs("div",{children:[e.jsx(t,{icon:te,className:"me-2 text-info"}),e.jsx("strong",{children:s.driver||"Not Assigned"})]})]}),e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Registration Expiry"}),e.jsxs("div",{children:[e.jsx(t,{icon:A,className:"me-2 text-warning"}),e.jsx("strong",{children:q(s.regisExprationDate)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small mb-1",children:"Brand & Model"}),e.jsxs("div",{children:[e.jsx(t,{icon:F,className:"me-2 text-secondary"}),e.jsx("strong",{children:(s.brand||"")+" "+(s.model||"")})]})]})]}),e.jsxs(we,{visible:g===s._id,children:[e.jsx("hr",{className:"my-3"}),e.jsx("div",{className:"row",children:Q.filter(a=>!["regisNumber","driver","regisExprationDate","status","brand","model"].includes(a.key)).map(a=>e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:a.label}),e.jsxs("div",{children:[a.icon&&e.jsx(t,{icon:a.icon,className:"me-2 text-primary"}),e.jsx("strong",{children:s[a.key]||"N/A"})]})]},a.key))})]})]}),g===s._id&&e.jsxs(Ne,{className:"bg-white d-flex justify-content-end gap-2 py-2",children:[e.jsxs(p,{color:"info",size:"sm",onClick:()=>C("view",s),children:[e.jsx(t,{icon:ie,className:"me-1"})," View"]}),e.jsxs(p,{color:"success",size:"sm",onClick:()=>C("edit",s),children:[e.jsx(t,{icon:oe,className:"me-1"})," Edit"]}),e.jsxs(p,{color:"danger",size:"sm",onClick:()=>C("delete",s),children:[e.jsx(t,{icon:ce,className:"me-1"})," Delete"]})]})]})]})})},s._id))})]}),e.jsxs(ye,{visible:Z,onClose:()=>y(!1),children:[e.jsx(Ce,{closeButton:!0,children:e.jsx(ve,{children:"Password Protected File"})}),e.jsxs(ke,{children:[e.jsxs("p",{children:["Your file ",e.jsx("strong",{children:L})," has been downloaded successfully."]}),e.jsx("p",{children:"Use the following password to unlock the ZIP file:"}),e.jsxs(v,{color:"info",className:"d-flex align-items-center",children:[e.jsx(t,{icon:I,className:"me-3 fs-4"}),e.jsx("div",{className:"font-monospace fw-bold",children:U})]}),e.jsx("p",{className:"text-muted small",children:"This password is unique to your account. Please keep it secure."})]}),e.jsx(Ve,{children:e.jsx(p,{color:"secondary",onClick:()=>y(!1),children:"Close"})})]})]})};export{Te as default};
