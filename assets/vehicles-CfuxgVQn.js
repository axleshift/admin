import{j as e}from"./index-CzlX11AB.js";import{r as l}from"./vendor-react-P0hRR2W0.js";import{a as E}from"./axiosInstance-Bq-uIJjs.js";import{l as N}from"./activityLogger-D6Lc4RsL.js";import{F as t,D as x,c as I,ag as ee,I as se,J as ae,p as te,C as A,S as F,ah as le,g as P,ai as re,aj as oe,af as ne,ak as ie,al as ce,am as de,h as me,i as he,n as xe}from"./index-D0KVb9r2.js";import{m as T,g as k,d as R,n as z,L as ge,M as ue,N as fe,O as g,a as je,b as pe,l as u,e as be,G as Ne,r as we,Q as ye,R as Ce,S as ke,T as ve,X as De,p as Ve}from"./vendor-coreui-pds89uUO.js";import"./vendor-redux-BKcj_6VU.js";import"./index-xsH4HHeE.js";const Te=()=>{const[o,$]=l.useState([]),[w,v]=l.useState(!0),[f,D]=l.useState(null),[j,V]=l.useState(null),[S,M]=l.useState(!1),[U,B]=l.useState(""),[L,H]=l.useState(""),[Z,y]=l.useState(!1),[p,b]=l.useState(null),[G,i]=l.useState(!1),n=localStorage.getItem("role"),c=localStorage.getItem("department"),r=localStorage.getItem("name"),_=localStorage.getItem("username");localStorage.getItem("userId"),l.useEffect(()=>{(async()=>{try{v(!0);const a=await E.get("/logistics/vehicle");a.data.success&&a.data.data.success?($(a.data.data.data),b({color:"success",title:"Success",content:"Vehicle data has been successfully loaded!"}),i(!0),N({name:r,role:n,department:c,route:"/vehicles",action:"View Vehicles",description:`${r} viewed vehicle fleet data`}).catch(console.warn)):D("Failed to fetch vehicle data")}catch(a){D(a.message||"An error occurred while fetching vehicle data"),console.error("Error fetching vehicles:",a),b({color:"danger",title:"Error",content:"Failed to load vehicle data"}),i(!0)}finally{v(!1)}})()},[r,n,c]);const d=async s=>{try{M(!0);let a="";switch(s){case"all":a="All_Vehicles";break;case"available":a="Available_Vehicles";break;case"in_use":a="InUse_Vehicles";break;case"maintenance":a="Maintenance_Vehicles";break;case"forRegistration":a="ForRegistration_Vehicles";break;default:a="Vehicles"}const m=await E.post("/management/downloadVehicleZip",{name:r,role:n,username:_,downloadType:s},{responseType:"blob"}),X=r.substring(0,2)+n.charAt(0)+_.slice(-6);B(X),H(`${a}_Protected.zip`),y(!0);const K=window.URL.createObjectURL(new Blob([m.data])),h=document.createElement("a");h.href=K,h.setAttribute("download",`${a}_Protected.zip`),document.body.appendChild(h),h.click(),document.body.removeChild(h),N({name:r,role:n,department:c,route:"/vehicles",action:"Download Protected Data",description:`Downloaded ${a} as password-protected zip`}).catch(console.warn),b({color:"success",title:"Success",content:`File ${a}_Protected.zip downloaded successfully!`}),i(!0)}catch(a){console.error("Error creating protected zip:",a),b({color:"danger",title:"Error",content:"Failed to create protected download. Please try again."}),i(!0)}finally{M(!1)}},C=(s,a)=>{const m={view:`Viewed details for vehicle ${a.regisNumber||a._id}`,edit:`Initiated editing vehicle ${a.regisNumber||a._id}`,delete:`Initiated deletion of vehicle ${a.regisNumber||a._id}`};N({name:r,role:n,department:c,route:"/vehicles",action:`Vehicle ${s.charAt(0).toUpperCase()+s.slice(1)}`,description:m[s]}).catch(console.warn)},O=s=>{if(j===s)V(null);else{V(s);const a=o.find(m=>m._id===s);a&&N({name:r,role:n,department:c,route:"/vehicles",action:"View Vehicle Details",description:`${r} Expanded details for vehicle ${a.regisNumber||s}`}).catch(console.warn)}},Y=s=>s?new Date(s).toLocaleDateString():"N/A",q=s=>({available:"success",in_use:"primary",forRegistration:"warning",maintenance:"danger"})[s]||"secondary",J=s=>({available:he,in_use:P,forRegistration:me,maintenance:de})[s]||xe,Q=s=>e.jsxs(Ve,{color:q(s),children:[e.jsx(t,{icon:J(s),className:"me-1"}),s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())]}),W=[{key:"idNum",label:"ID",icon:le},{key:"brand",label:"Brand",icon:F},{key:"model",label:"Model",icon:x},{key:"year",label:"Year",icon:A},{key:"type",label:"Type",icon:x},{key:"capacity",label:"Capacity (kg)",icon:P},{key:"fuelType",label:"Fuel Type",icon:re},{key:"currentMileage",label:"Mileage (km)",icon:oe}];return e.jsxs("div",{className:"container-fluid p-4",children:[G&&p&&e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:1050},children:e.jsx("div",{className:`toast show align-items-center text-white bg-${p.color} border-0`,role:"alert","aria-live":"assertive","aria-atomic":"true",children:e.jsxs("div",{className:"d-flex",children:[e.jsxs("div",{className:"toast-body",children:[e.jsx("strong",{children:p.title}),": ",p.content]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>i(!1)})]})})}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("h1",{className:"text-light",children:[e.jsx(t,{icon:x,className:"me-3 text-info"}),"Vehicle Fleet Management"]})}),w&&e.jsx("div",{className:"d-flex justify-content-center py-5",children:e.jsx(T,{color:"info"})}),f&&e.jsxs(k,{color:"danger",className:"mb-4",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:f})]}),!w&&!f&&o&&o.length===0&&e.jsx(k,{color:"warning",className:"mb-4",children:e.jsx("p",{children:"No vehicle data available."})}),!w&&!f&&o&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"shadow mb-4 bg-dark text-light border-dark",children:e.jsx(z,{className:"bg-dark border-secondary",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"fw-bold",children:[e.jsx(t,{icon:x,className:"me-2 text-info"}),"Total Vehicles: ",o.filter(s=>!s.deleted).length]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(ge,{children:[e.jsxs(ue,{color:"dark",disabled:S,children:[e.jsx(t,{icon:I,className:"me-2",color:"success"}),"Secure Download",S&&e.jsx(T,{size:"sm",className:"ms-2"})]}),e.jsxs(fe,{className:"bg-dark",children:[e.jsx(g,{className:"text-light",onClick:()=>d("all"),children:"All Vehicles"}),e.jsx(g,{className:"text-light",onClick:()=>d("available"),children:"Available Vehicles"}),e.jsx(g,{className:"text-light",onClick:()=>d("in_use"),children:"In-Use Vehicles"}),e.jsx(g,{className:"text-light",onClick:()=>d("maintenance"),children:"Maintenance Vehicles"}),e.jsx(g,{className:"text-light",onClick:()=>d("forRegistration"),children:"For Registration Vehicles"})]})]})})]})})}),e.jsx(je,{children:o.filter(s=>!s.deleted).map(s=>e.jsx(pe,{sm:12,className:"mb-4",children:e.jsx(R,{className:"shadow-sm border-dark bg-dark text-light border-top-0 border-left-0 border-right-0 border-bottom border-info",style:{cursor:"pointer",borderWidth:"3px"},children:e.jsxs("div",{className:"d-flex flex-row",children:[e.jsx("div",{className:"bg-secondary d-flex align-items-center justify-content-center",style:{width:"120px",minHeight:"100%"},children:e.jsx(t,{icon:x,size:"3x",className:"text-info"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs(z,{className:"d-flex justify-content-between align-items-center bg-dark border-0",children:[e.jsx("div",{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:ee,className:"me-2 text-info"}),s.regisNumber||"No Registration"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[Q(s.status||"unknown"),e.jsx(u,{color:"link",className:"p-0 ms-3 text-info",onClick:()=>O(s._id),children:e.jsx(t,{icon:j===s._id?se:ae,size:"lg"})})]})]}),e.jsxs(be,{className:"py-2 bg-dark text-light",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-info small mb-1",children:"Driver"}),e.jsxs("div",{children:[e.jsx(t,{icon:te,className:"me-2 text-info"}),e.jsx("strong",{children:s.driver||"Not Assigned"})]})]}),e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-info small mb-1",children:"Registration Expiry"}),e.jsxs("div",{children:[e.jsx(t,{icon:A,className:"me-2 text-warning"}),e.jsx("strong",{children:Y(s.regisExprationDate)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-info small mb-1",children:"Brand & Model"}),e.jsxs("div",{children:[e.jsx(t,{icon:F,className:"me-2 text-light"}),e.jsx("strong",{children:(s.brand||"")+" "+(s.model||"")})]})]})]}),e.jsxs(Ne,{visible:j===s._id,children:[e.jsx("hr",{className:"my-3 border-secondary"}),e.jsx("div",{className:"row",children:W.filter(a=>!["regisNumber","driver","regisExprationDate","status","brand","model"].includes(a.key)).map(a=>e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("div",{className:"text-info small mb-1",children:a.label}),e.jsxs("div",{children:[a.icon&&e.jsx(t,{icon:a.icon,className:"me-2 text-info"}),e.jsx("strong",{children:s[a.key]||"N/A"})]})]},a.key))})]})]}),j===s._id&&e.jsxs(we,{className:"bg-dark border-secondary d-flex justify-content-end gap-2 py-2",children:[e.jsxs(u,{color:"info",size:"sm",onClick:()=>C("view",s),children:[e.jsx(t,{icon:ne,className:"me-1"})," View"]}),e.jsxs(u,{color:"success",size:"sm",onClick:()=>C("edit",s),children:[e.jsx(t,{icon:ie,className:"me-1"})," Edit"]}),e.jsxs(u,{color:"danger",size:"sm",onClick:()=>C("delete",s),children:[e.jsx(t,{icon:ce,className:"me-1"})," Delete"]})]})]})]})})},s._id))})]}),e.jsxs(ye,{visible:Z,onClose:()=>y(!1),dark:!0,children:[e.jsx(Ce,{closeButton:!0,className:"bg-dark text-light border-secondary",children:e.jsx(ke,{children:"Password Protected File"})}),e.jsxs(ve,{className:"bg-dark text-light",children:[e.jsxs("p",{children:["Your file ",e.jsx("strong",{children:L})," has been downloaded successfully."]}),e.jsx("p",{children:"Use the following password to unlock the ZIP file:"}),e.jsxs(k,{color:"info",className:"d-flex align-items-center bg-secondary",children:[e.jsx(t,{icon:I,className:"me-3 fs-4"}),e.jsx("div",{className:"font-monospace fw-bold",children:U})]}),e.jsx("p",{className:"text-muted small",children:"This password is unique to your account. Please keep it secure."})]}),e.jsx(De,{className:"bg-dark border-secondary",children:e.jsx(u,{color:"secondary",onClick:()=>y(!1),children:"Close"})})]})]})};export{Te as default};
