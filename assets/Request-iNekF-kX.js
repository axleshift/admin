import{n as F,j as s}from"./index-DP5FNfKy.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{u as E}from"./vendor-redux-DipIbRRz.js";import{F as y,V as T,f as D,J as B,G as L,W as V,e as H,X as O,Y as J}from"./index-D-k-o6LC.js";import{l as d}from"./activityLogger-CP8e6OX7.js";import{u as W,g as G,S as b,T as h,o as X,$ as Y,p as Z,V as _,Z as z,a9 as K,n as Q}from"./vendor-coreui-BDhfDOiu.js";import"./axiosInstance-4uoCCw6P.js";const ee=a=>a?a.length<=2?"*".repeat(a.length):`${a[0]}${"*".repeat(a.length-2)}${a[a.length-1]}`:"",se=[{category:"HR",icon:D,permissions:[{key:"/worker",label:"Employees"},{key:"/jobposting",label:"Job Postings"},{key:"/payroll",label:"Payroll Management"}]},{category:"Finance",icon:B,permissions:[{key:"/freight/transaction",label:"Transactions"},{key:"/invoice",label:"Invoicing"},{key:"/financialanalytics",label:"Financial Analytics"},{key:"/oversales",label:"Oversales"},{key:"/freightaudit",label:"Freight Audit"}]},{category:"Logistics",icon:L,permissions:[{key:"/freight/transaction",label:"Freight Transactions"},{key:"/logistic1/index",label:"Logistics Index"}]},{category:"Core",icon:V,permissions:[{key:"/customer",label:"Customer"},{key:"/monthly",label:"Monthly"},{key:"/daily",label:"Daily"},{key:"/breakdown",label:"Breakdown"},{key:"/shipment",label:"Shipment Management"}]},{category:"Administrative",icon:H,permissions:[{key:"/useractivity/index",label:"User Activity"},{key:"/announce",label:"Announcements"},{key:"/recovery",label:"Recovery"},{key:"/registernew",label:"New User Registration"},{key:"/PendingRequest",label:"Pending Requests"},{key:"/AccessReview",label:"Access Review"},{key:"/monitoring",label:"User Monitoring"},{key:"/restore",label:"System Restore"}]}],ie=()=>{const[a,f]=o.useState([]),[g,k]=o.useState(""),[l,x]=o.useState(""),[c,S]=o.useState(""),[C,j]=o.useState(""),[m,u]=o.useState(null),[i,q]=o.useState({}),[v,{isLoading:p}]=F(),{colorMode:N}=W(),n=N==="dark";E(e=>{var t;return(t=e.changeState)==null?void 0:t.theme}),o.useEffect(()=>{const e=sessionStorage.getItem("userId"),t=sessionStorage.getItem("name"),r=sessionStorage.getItem("department"),$=sessionStorage.getItem("role");e&&(k(e),j(ee(e))),t&&x(t),r&&S(r),d({name:t,role:$,department:r,route:"/access-request",action:"Page Visit",description:"User visited the access request page"})},[]);const U=e=>{const t=a.includes(e)?a.filter(r=>r!==e):[...a,e];f(t),d({name:l,role:sessionStorage.getItem("role"),department:c,route:"/access-request",action:"Toggle Permission",description:`User ${a.includes(e)?"removed":"added"} permission: ${e}`})},R=e=>{const t={...i,[e]:!i[e]};q(t),d({name:l,role:sessionStorage.getItem("role"),department:c,route:"/access-request",action:"Toggle Category",description:`User ${i[e]?"collapsed":"expanded"} category: ${e}`})},w=async()=>{var e,t;if(u(null),!g||!l||!c||a.length===0){u({success:!1,message:"Ensure all fields are filled and at least one permission is selected."});return}try{const r=await v({requestType:"AccessRequest",pageName:a[0]||"",name:l,department:c,username:g,requestDetails:{permissions:a}}).unwrap();d({name:l,role:sessionStorage.getItem("role"),department:c,route:"/access-request",action:"Submit Request",description:`User submitted access request for permissions: ${a.join(", ")}`}),u({success:!0,message:"Access request sent successfully!"}),f([])}catch(r){d({name:l,role:sessionStorage.getItem("role"),department:c,route:"/access-request",action:"Submit Request Failed",description:`User failed to submit access request: ${((e=r.data)==null?void 0:e.error)||"Unknown error"}`}),u({success:!1,message:((t=r.data)==null?void 0:t.error)||"Failed to send request"})}},A=n?{backgroundColor:"#2c2c34",color:"#fff"}:{},I=n?{backgroundColor:"#3c4b64",color:"#fff"}:{backgroundColor:"#321fdb",color:"#fff"},M=n?{backgroundColor:"#3a3a3a",color:"#fff"}:{backgroundColor:"#f8f9fa",color:"#000"},P=n?{backgroundColor:"#3a3a3a",color:"#fff",borderColor:"#666"}:{backgroundColor:"#f8f9fa",color:"#000"};return s.jsx(G,{className:`vh-100 d-flex align-items-center justify-content-center ${n?"bg-dark":"bg-light"}`,children:s.jsx(b,{className:"w-100 justify-content-center",children:s.jsx(h,{md:10,lg:12,children:s.jsxs(X,{className:"shadow-lg",style:A,children:[s.jsxs(Y,{className:"d-flex align-items-center",style:I,children:[s.jsx(y,{icon:T,className:"me-2"}),s.jsx("strong",{children:"Access Request"})]}),s.jsx(Z,{children:s.jsxs(_,{children:[s.jsx(z,{type:"text",label:"User ID",value:C,readOnly:!0,style:P}),s.jsx("label",{className:`form-label mt-3 ${n?"text-light":""}`,children:"Select Permissions"}),se.map(e=>s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center p-2 rounded cursor-pointer",style:M,onClick:()=>R(e.category),children:[s.jsxs("div",{children:[s.jsx(y,{icon:e.icon,className:"me-2 text-primary"}),s.jsx("strong",{children:e.category})]}),s.jsx("span",{children:i[e.category]?"▼":"►"})]}),i[e.category]&&s.jsx(b,{className:"mt-2",children:e.permissions.map(t=>s.jsx(h,{xs:6,md:4,className:"mb-2",children:s.jsx(K,{id:t.key,label:t.label,checked:a.includes(t.key),onChange:()=>U(t.key),className:n?"text-light":""})},t.key))})]},e.category)),m&&s.jsxs("div",{className:`alert ${m.success?"alert-success":"alert-danger"} d-flex align-items-center`,children:[s.jsx(y,{icon:m.success?O:J,className:"me-2"}),m.message]}),s.jsx(Q,{color:"primary",className:"w-100 mt-3",onClick:w,disabled:p||!g,children:p?"Sending Request...":"Submit Access Request"})]})})]})})})})};export{ie as default};
