import{c as ae,j as s,_ as ce}from"./index-CoOWKF1B.js";import{r as C,g as de,i as ue,R as le,L as pe}from"./vendor-react-B6URQkMn.js";import{P as j,c as fe,N as M,O as U,Q as he,k as me,l as ge,R as ye,S as G,T as ee,U as te,o as re,V as ne,j as W,C as ve}from"./vendor-coreui-DbIDZSkS.js";import{c as xe}from"./cil-user-Ddrdy7PS.js";import{c as be}from"./cil-lock-locked-DmxpJbVL.js";import"./vendor-redux-DipIbRRz.js";var Se=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function J(){return J=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},J.apply(this,arguments)}function we(t,o){if(t==null)return{};var i={},r=Object.keys(t),n,l;for(l=0;l<r.length;l++)n=r[l],!(o.indexOf(n)>=0)&&(i[n]=t[n]);return i}function q(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _e(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,K(t,o)}function K(t,o){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},K(t,o)}var z=function(t){_e(o,t);function o(){var r;return r=t.call(this)||this,r.handleExpired=r.handleExpired.bind(q(r)),r.handleErrored=r.handleErrored.bind(q(r)),r.handleChange=r.handleChange.bind(q(r)),r.handleRecaptchaRef=r.handleRecaptchaRef.bind(q(r)),r}var i=o.prototype;return i.getCaptchaFunction=function(n){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[n]:this.props.grecaptcha[n]:null},i.getValue=function(){var n=this.getCaptchaFunction("getResponse");return n&&this._widgetId!==void 0?n(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var n=this.getCaptchaFunction("execute");if(n&&this._widgetId!==void 0)return n(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var n=this;return new Promise(function(l,b){n.executionResolve=l,n.executionReject=b,n.execute()})},i.reset=function(){var n=this.getCaptchaFunction("reset");n&&this._widgetId!==void 0&&n(this._widgetId)},i.forceReset=function(){var n=this.getCaptchaFunction("reset");n&&n()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(n){this.props.onChange&&this.props.onChange(n),this.executionResolve&&(this.executionResolve(n),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var n=this.getCaptchaFunction("render");if(n&&this._widgetId===void 0){var l=document.createElement("div");this._widgetId=n(l,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(l)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(n){this.captcha=n},i.render=function(){var n=this.props;n.sitekey,n.onChange,n.theme,n.type,n.tabindex,n.onExpired,n.onErrored,n.size,n.stoken,n.grecaptcha,n.badge,n.hl,n.isolated;var l=we(n,Se);return C.createElement("div",J({},l,{ref:this.handleRecaptchaRef}))},o}(C.Component);z.displayName="ReCAPTCHA";z.propTypes={sitekey:j.string.isRequired,onChange:j.func,grecaptcha:j.object,theme:j.oneOf(["dark","light"]),type:j.oneOf(["image","audio"]),tabindex:j.number,onExpired:j.func,onErrored:j.func,size:j.oneOf(["compact","normal","invisible"]),stoken:j.string,hl:j.string,badge:j.oneOf(["bottomright","bottomleft","inline"]),isolated:j.bool};z.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};var V={exports:{}},u={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function Re(){if(oe)return u;oe=1;var t=typeof Symbol=="function"&&Symbol.for,o=t?Symbol.for("react.element"):60103,i=t?Symbol.for("react.portal"):60106,r=t?Symbol.for("react.fragment"):60107,n=t?Symbol.for("react.strict_mode"):60108,l=t?Symbol.for("react.profiler"):60114,b=t?Symbol.for("react.provider"):60109,w=t?Symbol.for("react.context"):60110,S=t?Symbol.for("react.async_mode"):60111,v=t?Symbol.for("react.concurrent_mode"):60111,x=t?Symbol.for("react.forward_ref"):60112,c=t?Symbol.for("react.suspense"):60113,a=t?Symbol.for("react.suspense_list"):60120,f=t?Symbol.for("react.memo"):60115,d=t?Symbol.for("react.lazy"):60116,L=t?Symbol.for("react.block"):60121,_=t?Symbol.for("react.fundamental"):60117,T=t?Symbol.for("react.responder"):60118,R=t?Symbol.for("react.scope"):60119;function h(e){if(typeof e=="object"&&e!==null){var g=e.$$typeof;switch(g){case o:switch(e=e.type,e){case S:case v:case r:case l:case n:case c:return e;default:switch(e=e&&e.$$typeof,e){case w:case x:case d:case f:case b:return e;default:return g}}case i:return g}}}function m(e){return h(e)===v}return u.AsyncMode=S,u.ConcurrentMode=v,u.ContextConsumer=w,u.ContextProvider=b,u.Element=o,u.ForwardRef=x,u.Fragment=r,u.Lazy=d,u.Memo=f,u.Portal=i,u.Profiler=l,u.StrictMode=n,u.Suspense=c,u.isAsyncMode=function(e){return m(e)||h(e)===S},u.isConcurrentMode=m,u.isContextConsumer=function(e){return h(e)===w},u.isContextProvider=function(e){return h(e)===b},u.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===o},u.isForwardRef=function(e){return h(e)===x},u.isFragment=function(e){return h(e)===r},u.isLazy=function(e){return h(e)===d},u.isMemo=function(e){return h(e)===f},u.isPortal=function(e){return h(e)===i},u.isProfiler=function(e){return h(e)===l},u.isStrictMode=function(e){return h(e)===n},u.isSuspense=function(e){return h(e)===c},u.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===r||e===v||e===l||e===n||e===c||e===a||typeof e=="object"&&e!==null&&(e.$$typeof===d||e.$$typeof===f||e.$$typeof===b||e.$$typeof===w||e.$$typeof===x||e.$$typeof===_||e.$$typeof===T||e.$$typeof===R||e.$$typeof===L)},u.typeOf=h,u}var ie;function je(){return ie||(ie=1,V.exports=Re()),V.exports}var B,se;function Le(){if(se)return B;se=1;var t=je(),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},n={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},l={};l[t.ForwardRef]=r,l[t.Memo]=n;function b(d){return t.isMemo(d)?n:l[d.$$typeof]||o}var w=Object.defineProperty,S=Object.getOwnPropertyNames,v=Object.getOwnPropertySymbols,x=Object.getOwnPropertyDescriptor,c=Object.getPrototypeOf,a=Object.prototype;function f(d,L,_){if(typeof L!="string"){if(a){var T=c(L);T&&T!==a&&f(d,T,_)}var R=S(L);v&&(R=R.concat(v(L)));for(var h=b(d),m=b(L),e=0;e<R.length;++e){var g=R[e];if(!i[g]&&!(_&&_[g])&&!(m&&m[g])&&!(h&&h[g])){var y=x(L,g);try{w(d,g,y)}catch{}}}}return d}return B=f,B}var Oe=Le();const Ce=de(Oe);function Y(){return Y=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var i=arguments[o];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},Y.apply(this,arguments)}function Ie(t,o){if(t==null)return{};var i={},r=Object.keys(t),n,l;for(l=0;l<r.length;l++)n=r[l],!(o.indexOf(n)>=0)&&(i[n]=t[n]);return i}function Te(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o}var I={},Ee=0;function Pe(t,o){return o=o||{},function(r){var n=r.displayName||r.name||"Component",l=function(w){Te(S,w);function S(x,c){var a;return a=w.call(this,x,c)||this,a.state={},a.__scriptURL="",a}var v=S.prototype;return v.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+Ee++),this.__scriptLoaderID},v.setupScriptURL=function(){return this.__scriptURL=typeof t=="function"?t():t,this.__scriptURL},v.asyncScriptLoaderHandleLoad=function(c){var a=this;this.setState(c,function(){return a.props.asyncScriptOnLoad&&a.props.asyncScriptOnLoad(a.state)})},v.asyncScriptLoaderTriggerOnScriptLoaded=function(){var c=I[this.__scriptURL];if(!c||!c.loaded)throw new Error("Script is not loaded.");for(var a in c.observers)c.observers[a](c);delete window[o.callbackName]},v.componentDidMount=function(){var c=this,a=this.setupScriptURL(),f=this.asyncScriptLoaderGetScriptLoaderID(),d=o,L=d.globalName,_=d.callbackName,T=d.scriptId;if(L&&typeof window[L]<"u"&&(I[a]={loaded:!0,observers:{}}),I[a]){var R=I[a];if(R&&(R.loaded||R.errored)){this.asyncScriptLoaderHandleLoad(R);return}R.observers[f]=function(y){return c.asyncScriptLoaderHandleLoad(y)};return}var h={};h[f]=function(y){return c.asyncScriptLoaderHandleLoad(y)},I[a]={loaded:!1,observers:h};var m=document.createElement("script");m.src=a,m.async=!0;for(var e in o.attributes)m.setAttribute(e,o.attributes[e]);T&&(m.id=T);var g=function(E){if(I[a]){var D=I[a],A=D.observers;for(var p in A)E(A[p])&&delete A[p]}};_&&typeof window<"u"&&(window[_]=function(){return c.asyncScriptLoaderTriggerOnScriptLoaded()}),m.onload=function(){var y=I[a];y&&(y.loaded=!0,g(function(E){return _?!1:(E(y),!0)}))},m.onerror=function(){var y=I[a];y&&(y.errored=!0,g(function(E){return E(y),!0}))},document.body.appendChild(m)},v.componentWillUnmount=function(){var c=this.__scriptURL;if(o.removeOnUnmount===!0)for(var a=document.getElementsByTagName("script"),f=0;f<a.length;f+=1)a[f].src.indexOf(c)>-1&&a[f].parentNode&&a[f].parentNode.removeChild(a[f]);var d=I[c];d&&(delete d.observers[this.asyncScriptLoaderGetScriptLoaderID()],o.removeOnUnmount===!0&&delete I[c])},v.render=function(){var c=o.globalName,a=this.props;a.asyncScriptOnLoad;var f=a.forwardedRef,d=Ie(a,["asyncScriptOnLoad","forwardedRef"]);return c&&typeof window<"u"&&(d[c]=typeof window[c]<"u"?window[c]:void 0),d.ref=f,C.createElement(r,d)},S}(C.Component),b=C.forwardRef(function(w,S){return C.createElement(l,Y({},w,{forwardedRef:S}))});return b.displayName="AsyncScriptLoader("+n+")",b.propTypes={asyncScriptOnLoad:j.func},Ce(b,r)}}var Q="onloadcallback",Ne="grecaptcha";function X(){return typeof window<"u"&&window.recaptchaOptions||{}}function ke(){var t=X(),o=t.useRecaptchaNet?"recaptcha.net":"www.google.com";return t.enterprise?"https://"+o+"/recaptcha/enterprise.js?onload="+Q+"&render=explicit":"https://"+o+"/recaptcha/api.js?onload="+Q+"&render=explicit"}const Ae=Pe(ke,{callbackName:Q,globalName:Ne,attributes:X().nonce?{nonce:X().nonce}:{}})(z),ze=()=>{const[t,o]=C.useState({identifier:"",password:""}),[i,r]=C.useState(null),[n,l]=C.useState(null),[b,w]=C.useState(!1),[S,v]=C.useState(0),[x,c]=C.useState(null),[a,f]=C.useState(null),d=ue(),[L,{isLoading:_}]=ae();le.useEffect(()=>{let e=null;return b&&S>0&&(e=setInterval(()=>{v(g=>{const y=g-1;return y<=0?(clearInterval(e),w(!1),0):y})},1e3)),()=>{e&&clearInterval(e)}},[b,S]);const T=async e=>{var g,y,E,D,A;if(e.preventDefault(),r(null),f(null),!t.identifier||!t.password){r("Both username/email and password are required.");return}try{const p=await L(t).unwrap();console.log("Login Success:",p),localStorage.setItem("accessToken",p.accessToken),localStorage.setItem("refreshToken",p.refreshToken);const{id:O,name:H,username:$,role:F,email:Z,department:k}=p.user;let P=[];if(p.user.permissions)if(Array.isArray(p.user.permissions))P=p.user.permissions,console.log("✅ User permissions array:",P);else{console.warn("⚠️ Server returned permissions in unexpected format:",p.user.permissions);try{const N=typeof p.user.permissions=="string"?JSON.parse(p.user.permissions):p.user.permissions;Array.isArray(N)&&(P=N,console.log("✅ Converted permissions to array:",P))}catch(N){console.error("❌ Failed to parse permissions:",N)}}else console.warn("⚠️ No permissions found in user data");if(P.length===0&&F&&k)try{const N=await ce(()=>import("./permissionConfig-DLItbach.js"),[],import.meta.url);(g=N.accessPermissions[F])!=null&&g[k]&&(P=N.accessPermissions[F][k],console.log("✅ Using default role-based permissions:",P))}catch(N){console.error("❌ Failed to import permissions config:",N)}switch(sessionStorage.setItem("userId",O),sessionStorage.setItem("username",$||""),sessionStorage.setItem("name",H||""),sessionStorage.setItem("email",Z||""),sessionStorage.setItem("role",F||""),sessionStorage.setItem("department",k||""),sessionStorage.setItem("permissions",JSON.stringify(P)),console.log("📦 Session Storage after login:",{userId:O,username:$||"",name:H||"",email:Z||"",role:F||"",department:k||"",permissions:P}),p.securityAlert&&f(p.securityAlert.message||"Unusual activity detected on your account."),k==null?void 0:k.toLowerCase()){case"administrative":d("/employeedash");break;case"hr":d("/hrdash");break;case"core":d("/coredash");break;case"finance":d("/financedash");break;case"logistics":d("/logisticdash");break;default:d("/dashboard")}}catch(p){if(console.error("Login Failed:",p),p.status===429){if(w(!0),(y=p.data)!=null&&y.lockedUntil){const O=new Date(p.data.lockedUntil),$=Math.ceil((O-new Date)/1e3);v($>0?$:900),c(O)}else{v(900);const O=new Date;O.setMinutes(O.getMinutes()+15),c(O)}r(((E=p.data)==null?void 0:E.message)||"Too many failed login attempts. This account is temporarily locked."),setShowOtpOption(!0)}else{const O=(D=p.data)==null?void 0:D.remainingAttempts;r(O!==void 0?`Invalid credentials. You have ${O} ${O===1?"attempt":"attempts"} remaining.`:((A=p.data)==null?void 0:A.message)||"Login failed. Please check your credentials and try again.")}}},R=e=>{console.log("CAPTCHA Token:",e),l(e)},h=()=>{const e=Math.floor(S/60),g=S%60;return`${e.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`},m=b&&t.identifier!=="";return s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(fe,{children:s.jsx(M,{className:"justify-content-center",children:s.jsx(U,{md:8,children:s.jsx(he,{children:s.jsx(me,{className:"p-4",children:s.jsx(ge,{children:s.jsxs(ye,{onSubmit:T,children:[s.jsx("h1",{children:"Login"}),s.jsx("p",{className:"text-body-secondary",children:"Sign In to your account"}),a&&s.jsxs(G,{color:"warning",children:[s.jsx("strong",{children:"Security Notice:"})," ",a]}),m&&s.jsxs(G,{color:"danger",children:[s.jsx("strong",{children:"Account Temporarily Locked"}),s.jsxs("p",{children:["This account (",t.identifier,") has been temporarily locked due to too many failed login attempts. Please try again in ",h(),"."]}),x&&s.jsxs("small",{children:["Lockout expires at: ",x.toLocaleTimeString()]})]}),!m&&i&&s.jsx(G,{color:"danger",children:i}),s.jsxs(ee,{className:"mb-3",children:[s.jsx(te,{children:s.jsx(re,{icon:xe})}),s.jsx(ne,{type:"text",placeholder:"Email or Username",autoComplete:"email",value:t.identifier,onChange:e=>{e.target.value!==t.identifier&&(w(!1),r(null)),o({...t,identifier:e.target.value})},disabled:_,required:!0})]}),s.jsxs(ee,{className:"mb-4",children:[s.jsx(te,{children:s.jsx(re,{icon:be})}),s.jsx(ne,{type:"password",placeholder:"Password",autoComplete:"current-password",value:t.password,onChange:e=>o({...t,password:e.target.value}),disabled:_||m,required:!0})]}),s.jsx(M,{children:s.jsx(U,{xs:6,children:s.jsx(Ae,{sitekey:void 0,onChange:R})})}),s.jsxs(M,{children:[s.jsx(U,{xs:6,children:s.jsx(W,{type:"submit",color:"primary",className:"px-4",disabled:_||m,children:_?s.jsxs(s.Fragment,{children:[s.jsx(ve,{size:"sm",className:"me-2"})," Logging in..."]}):m?"Account Locked":"Login"})}),s.jsx(U,{xs:6,className:"text-end",children:s.jsx(pe,{to:"/forgotpass",children:s.jsx(W,{color:"link",className:"px-0",children:"Forgot password?"})})})]}),m&&s.jsx(M,{className:"mt-3",children:s.jsx(U,{xs:12,children:s.jsx(W,{type:"button",color:"secondary",className:"w-100",onClick:()=>window.location.href="/OTP",children:"Use OTP to Unlock Account"})})})]})})})})})})})})};export{ze as default};
