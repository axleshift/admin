import{j as e}from"./index-nln47cCr.js";import{r}from"./vendor-react-B6URQkMn.js";import{a as w}from"./axiosInstance-Dv2jt_v_.js";import{l as v}from"./activityLogger-CswLieGG.js";import"./vendor-redux-DipIbRRz.js";import"./vendor-coreui-vXCAeGSv.js";import"./index-t--hEgTQ.js";const T=()=>{const[u,P]=r.useState([]),[i,m]=r.useState(1),[x,E]=r.useState(0),[o,c]=r.useState(!1),[p,l]=r.useState(null),d=sessionStorage.getItem("role"),h=sessionStorage.getItem("department"),g=sessionStorage.getItem("name");r.useEffect(()=>{v({name:g,role:d,department:h,route:"/freights",action:"Page Visit",description:"User viewed the freights list page"})},[g,d,h]);const j=async()=>{var t,a;c(!0),l(null);try{const n=await w.post("/core/syncFreightData");console.log("Sync response:",n.data),await f()}catch(n){l(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while syncing freights"),console.error("Error syncing freights:",n)}finally{c(!1)}},f=async()=>{var t,a,n,b;c(!0),l(null);try{const s=await w.get("/core/freight",{params:{page:i}});if(!s.data||!Array.isArray(s.data.freights))throw new Error("Invalid response format");P(s.data.freights),E(s.data.totalPages||1)}catch(s){const S=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message||"An unexpected error occurred";l(S),console.error("Detailed Fetch Error:",{status:(n=s.response)==null?void 0:n.status,data:(b=s.response)==null?void 0:b.data,message:S})}finally{c(!1)}};r.useEffect(()=>{j()},[]),r.useEffect(()=>{f()},[i]);const y=t=>{v({name:g,role:d,department:h,route:`/freights/${t}`,action:"View Freight",description:`User viewed details for freight ID: ${t}`})},F=()=>m(t=>Math.max(t-1,1)),N=()=>m(t=>t+1);return o?e.jsx("p",{children:"Loading freights..."}):p?e.jsxs("p",{children:["Error: ",p]}):e.jsxs("div",{className:"freight-list-container",children:[e.jsx("h2",{children:"Freight List"}),e.jsx("div",{className:"sync-section",children:e.jsx("button",{onClick:j,disabled:o,children:o?"Syncing...":"Sync Freight Data"})}),e.jsxs("table",{className:"freight-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tracking Number"}),e.jsx("th",{children:"Country"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total Weight"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:u.length>0?u.map(t=>e.jsxs("tr",{onClick:()=>y(t._id),className:"freight-row",children:[e.jsx("td",{children:t.tracking_number}),e.jsx("td",{children:t.country}),e.jsx("td",{children:t.status}),e.jsxs("td",{children:[t.total_weight," kg"]}),e.jsxs("td",{children:[t.amount.currency," ",t.amount.value]}),e.jsx("td",{children:e.jsx("button",{onClick:a=>{a.stopPropagation(),y(t._id)},children:"View Details"})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"No freights available"})})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:F,disabled:i===1||o,children:"Previous"}),e.jsxs("span",{children:["Page ",i," of ",x]}),e.jsx("button",{onClick:N,disabled:i===x||o,children:"Next"})]})]})};export{T as default};
