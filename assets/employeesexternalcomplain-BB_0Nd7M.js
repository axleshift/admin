import{j as e}from"./index-CqTYrJit.js";import{r as p}from"./vendor-react-BHxUanFt.js";import{F as m,m as k,i as U,n as w,o as N,p as A,a as L,q as D,h as P,r as q,s as R,t as B}from"./index-BNowUf5p.js";import{a as H}from"./axiosInstance-Bq-uIJjs.js";import{C as M,a as y,b as i,d as O,n as W,e as z,g as G,f as J,s as r,k as h,t as j,u as K,v as Q,l as V,m as X}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";function le(){const[l,u]=p.useState({employeeId:"",employeeName:"",department:"",employeeEmail:"",employeeUsername:"",complaintType:"",complaintText:"",urgency:"Medium",isAnonymous:!1});p.useEffect(()=>{const a=new URLSearchParams(window.location.search),o={employeeId:a.get("employeeId")||"",employeeName:a.get("employeeName")||"",employeeEmail:a.get("employeeEmail")||"",department:a.get("department")||"",employeeUsername:a.get("employeeUsername")||""};Object.values(o).some(n=>n!=="")?(console.log("Loading data from URL parameters:",o),u(n=>({...n,...o}))):(console.log("Loading from localStorage:"),console.log("userId:",localStorage.getItem("userId")),console.log("name:",localStorage.getItem("name")),console.log("department:",localStorage.getItem("department")),console.log("email:",localStorage.getItem("email")),console.log("username:",localStorage.getItem("username")),u(n=>({...n,employeeId:localStorage.getItem("userId")||"",employeeName:localStorage.getItem("name")||"",department:localStorage.getItem("department")||"",employeeEmail:localStorage.getItem("email")||"",employeeUsername:localStorage.getItem("username")||""})))},[]);const[s,f]=p.useState({}),[C,v]=p.useState(!1),[x,g]=p.useState(null),b=["HR","Finance","Core","Logistics","Administrative"],E=["Workplace Harassment","Pay Issues","Working Conditions","Management Issues","Other"],I=["Low","Medium","High","Critical"],t=a=>{const{name:o,value:d,type:n,checked:c}=a.target;u({...l,[o]:n==="checkbox"?c:d}),s[o]&&f({...s,[o]:null})},S=()=>{const a={};return l.employeeName.trim()||(a.employeeName="Employee name is required"),l.department||(a.department="Department is required"),l.employeeEmail.trim()||(a.employeeEmail="Employee email is required"),l.complaintType||(a.complaintType="Complaint type is required"),l.complaintText.trim()||(a.complaintText="Complaint details are required"),a},T=async a=>{var d,n;a.preventDefault();const o=S();if(Object.keys(o).length>0){f(o);return}console.log("Submitting form data:",l),v(!0),g(null);try{const c=await H.post("/complains/employeecomplainexternal",l);console.log("Server response:",c.data),g({success:!0,message:c.data.message||"Complaint submitted successfully"}),u(F=>({...F,complaintType:"",complaintText:"",urgency:"Medium",isAnonymous:!1}))}catch(c){console.error("Error submitting complaint:",c),g({success:!1,message:((n=(d=c.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to submit complaint. Please try again."})}finally{v(!1)}};return e.jsx(M,{className:"py-4",children:e.jsx(y,{className:"justify-content-center",children:e.jsx(i,{md:10,children:e.jsxs(O,{children:[e.jsxs(W,{className:"text-center bg-light",children:[e.jsxs("h4",{children:[e.jsx(m,{icon:k,className:"me-2"}),"Employee Complaint Form"]}),e.jsx("small",{className:"text-muted",children:"Please provide the details of your complaint below"})]}),e.jsxs(z,{children:[x&&e.jsxs(G,{color:x.success?"success":"danger",children:[e.jsx(m,{icon:x.success?U:w,className:"me-2"}),x.message]}),e.jsxs(J,{onSubmit:T,children:[e.jsxs(y,{className:"mb-3",children:[e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"employeeUsername",children:[e.jsx(m,{icon:N,className:"me-1"})," Employee Username"]}),e.jsx(h,{id:"employeeUsername",name:"employeeUsername",value:l.employeeUsername,onChange:t,invalid:!!s.employeeUsername}),s.employeeUsername&&e.jsx("div",{className:"invalid-feedback d-block",children:s.employeeUsername})]}),e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"employeeName",children:[e.jsx(m,{icon:A,className:"me-1"})," Employee Name *"]}),e.jsx(h,{id:"employeeName",name:"employeeName",value:l.employeeName,onChange:t,invalid:!!s.employeeName}),s.employeeName&&e.jsx("div",{className:"invalid-feedback d-block",children:s.employeeName})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"employeeEmail",children:[e.jsx(m,{icon:L,className:"me-1"})," Employee Email *"]}),e.jsx(h,{id:"employeeEmail",name:"employeeEmail",type:"email",value:l.employeeEmail,onChange:t,invalid:!!s.employeeEmail}),s.employeeEmail&&e.jsx("div",{className:"invalid-feedback d-block",children:s.employeeEmail})]}),e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"employeeId",children:[e.jsx(m,{icon:N,className:"me-1"})," Employee ID"]}),e.jsx(h,{id:"employeeId",name:"employeeId",value:l.employeeId,onChange:t,invalid:!!s.employeeId}),s.employeeId&&e.jsx("div",{className:"invalid-feedback d-block",children:s.employeeId})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"department",children:[e.jsx(m,{icon:D,className:"me-1"})," Department *"]}),e.jsxs(j,{id:"department",name:"department",value:l.department,onChange:t,invalid:!!s.department,children:[e.jsx("option",{value:"",children:"Select Department"}),b.map(a=>e.jsx("option",{value:a,children:a},a))]}),s.department&&e.jsx("div",{className:"invalid-feedback d-block",children:s.department})]}),e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"complaintType",children:[e.jsx(m,{icon:P,className:"me-1"})," Complaint Type *"]}),e.jsxs(j,{id:"complaintType",name:"complaintType",value:l.complaintType,onChange:t,invalid:!!s.complaintType,children:[e.jsx("option",{value:"",children:"Select Complaint Type"}),E.map(a=>e.jsx("option",{value:a,children:a},a))]}),s.complaintType&&e.jsx("div",{className:"invalid-feedback d-block",children:s.complaintType})]})]}),e.jsxs(y,{className:"mb-3",children:[e.jsxs(i,{md:6,children:[e.jsxs(r,{htmlFor:"urgency",children:[e.jsx(m,{icon:q,className:"me-1"})," Urgency Level"]}),e.jsx(j,{id:"urgency",name:"urgency",value:l.urgency,onChange:t,children:I.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(i,{md:6,className:"d-flex align-items-end",children:e.jsx(K,{id:"isAnonymous",name:"isAnonymous",label:e.jsxs(e.Fragment,{children:["Submit Anonymously ",e.jsx(m,{icon:R,className:"ms-1 text-muted"})]}),checked:l.isAnonymous,onChange:t})})]}),e.jsxs(r,{htmlFor:"complaintText",children:[e.jsx(m,{icon:B,className:"me-1"})," Complaint Details *"]}),e.jsx(Q,{id:"complaintText",name:"complaintText",rows:5,value:l.complaintText,onChange:t,invalid:!!s.complaintText,placeholder:"Please provide detailed information about your complaint..."}),s.complaintText&&e.jsx("div",{className:"invalid-feedback d-block",children:s.complaintText}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs(V,{type:"submit",color:"primary",disabled:C,children:[C?e.jsx(X,{size:"sm",className:"me-2"}):null,"Submit Complaint"]})})]})]})]})})})})}export{le as default};
