import{r as n,j as a}from"./index-BizKBI6a.js";import{a as p}from"./axiosInstance-CnxFScdD.js";import{F as f,m as T,n as $,o as H}from"./DefaultLayout-CnpPbvhY.js";import{C as L}from"./CAlert-CUEFZV7O.js";import{C as O,a as U}from"./CCardBody-cs6hLwSm.js";import{C as _}from"./CCardHeader-CPTDb0Yp.js";import{C as N}from"./CForm-tPETyldd.js";import{b as M,C as R,a as x}from"./CFormInput-BYAzJEzi.js";import{C as b}from"./CFormSelect-BBQbi0Yz.js";import"./index-D8rVyQy1.js";import"./chatbox-V5kNCwUM.js";import"./index.esm-LX8wyrY9.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./CCloseButton-CGgGdGd-.js";const te=()=>{const[d,y]=n.useState(""),[h,j]=n.useState("02"),[g,C]=n.useState("00"),[u,k]=n.useState("AM"),[l,S]=n.useState({message:"",type:""}),[i,o]=n.useState(!1);n.useEffect(()=>{if(l.message){const e=setTimeout(()=>{S({message:"",type:""})},5e3);return()=>clearTimeout(e)}},[l]),n.useEffect(()=>{(async()=>{try{o(!0);const t=(await p.get("/backupauto/config")).data;if(t.backupDir&&y(t.backupDir),t.cronSchedule){const m=t.cronSchedule.split(" "),D=m[0],I=m[1];let c=parseInt(I,10),v="AM";c>=12&&(v="PM",c=c===12?12:c-12),c=c===0?12:c,j(c.toString().padStart(2,"0")),C(D.padStart(2,"0")),k(v)}}catch(s){console.error("Error fetching backup configuration:",s),r("Failed to load saved configuration","danger")}finally{o(!1)}})()},[]);const w=Array.from({length:12},(e,s)=>{const t=s+1;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),F=Array.from({length:60},(e,s)=>{const t=s;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),r=(e,s)=>{S({message:e,type:s})},A=()=>{let e=parseInt(h,10);return u==="PM"&&e<12?e+=12:u==="AM"&&e===12&&(e=0),{hours:e.toString().padStart(2,"0"),minutes:g}},B=async()=>{var e;if(!d.trim()){r("Please enter a valid backup directory path","danger");return}o(!0);try{const s=await p.post("/backupauto/update-directory",{backupDir:d});r(s.data,"success")}catch(s){r(`Error updating directory: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{o(!1)}},E=async()=>{var e;o(!0);try{const s=A(),t=`${s.minutes} ${s.hours} * * *`,m=await p.post("/backupauto/update-schedule",{cronSchedule:t});r(m.data,"success")}catch(s){r(`Error updating schedule: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{o(!1)}},P=async()=>{var e;if(!d.trim()){r("Please configure a backup directory first","warning");return}o(!0);try{const s=await p.post("/backupauto/backup");r(s.data,"success")}catch(s){r(`Error triggering backup: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{o(!1)}};return a.jsxs("div",{className:"p-5",children:[a.jsx("h2",{className:"text-2xl mb-4",children:"Backup Manager"}),l.message&&a.jsx(L,{color:l.type,className:"mb-4",children:l.message}),a.jsxs(O,{className:"mb-4",children:[a.jsx(_,{children:a.jsx("div",{children:"Backup Configuration"})}),a.jsxs(U,{children:[a.jsxs(N,{className:"mb-4",children:[a.jsx(M,{children:"Backup Directory"}),a.jsxs("div",{className:"d-flex",children:[a.jsx(R,{type:"text",value:d,onChange:e=>y(e.target.value),placeholder:"Enter backup directory path",disabled:i}),a.jsxs(x,{color:"primary",onClick:B,className:"ms-2",disabled:i,children:[a.jsx(f,{icon:T})," Set Directory"]})]})]}),a.jsxs(N,{className:"mb-4",children:[a.jsx(M,{children:"Backup Time"}),a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsxs("div",{className:"d-flex",style:{width:"220px"},children:[a.jsx(b,{value:h,onChange:e=>j(e.target.value),disabled:i,className:"me-1",style:{width:"70px"},children:w.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("span",{className:"mx-1 mt-2",children:":"}),a.jsx(b,{value:g,onChange:e=>C(e.target.value),disabled:i,className:"me-1",style:{width:"70px"},children:F.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsxs(b,{value:u,onChange:e=>k(e.target.value),disabled:i,style:{width:"70px"},children:[a.jsx("option",{value:"AM",children:"AM"}),a.jsx("option",{value:"PM",children:"PM"})]})]}),a.jsxs(x,{color:"success",onClick:E,className:"ms-3",disabled:i,children:[a.jsx(f,{icon:$})," Set Schedule"]})]}),a.jsxs("small",{className:"text-muted mt-2 d-block",children:["Current schedule: Daily at ",h,":",g," ",u]})]}),a.jsxs(x,{color:"danger",onClick:P,disabled:i,className:"mt-3",children:[a.jsx(f,{icon:H})," Trigger Backup Now"]})]})]})]})};export{te as default};
