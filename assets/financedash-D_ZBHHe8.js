import{j as e}from"./index-BA9i51uk.js";import{u as G,r as n}from"./vendor-react-BHxUanFt.js";import{S as g}from"./statbox-DkcPDEyD.js";import{C as J}from"./customhead-CZNfy1vk.js";import K from"./monthchart-8fGlIRvh.js";import{F as f,m as O,o as Q,r as V,s as X}from"./index-BbcC8ntF.js";import{a as S}from"./axiosInstance-Bq-uIJjs.js";import{l as Z}from"./activityLogger-D6Lc4RsL.js";import{C as _,a as u,b as r,d as M}from"./vendor-coreui-blXmWd_E.js";import"./vendor-redux-CSji-Y9p.js";import"./generateCategoricalChart-BDkE1YhN.js";import"./DefaultLayout-CDF3_7TE.js";import"./yearly-Bs7T2UE_.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-BggtT3I0.js";import"./index-xsH4HHeE.js";import"./LineChart-Dj4rqlVi.js";const je=()=>{var v,L;G();const[ee,E]=n.useState(window.innerWidth>768),[t,j]=n.useState(null),[s,I]=n.useState(null),[w,b]=n.useState(null),[te,h]=n.useState(!0),[z,x]=n.useState(!0),[C,p]=n.useState(null),[U,B]=n.useState([]),F=localStorage.getItem("name"),W=localStorage.getItem("role"),k=localStorage.getItem("department");localStorage.getItem("username"),Z({name:F,role:W,department:k,route:"Finance Dashboard",action:"Navigate",description:`${F} Navigate to Finance Dashboard`}).catch(console.warn),n.useEffect(()=>{const l=()=>E(window.innerWidth>768);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),n.useEffect(()=>{const l=async()=>{try{h(!0);const a=await S.get("/finance/monthlysalesrevenue");if(a.data&&Array.isArray(a.data)&&a.data.length>0){const i=new Date,y=i.toLocaleString("en-US",{month:"long"}),H=i.getFullYear(),N=a.data.find(o=>o.month===y&&o.year===H),m=new Date(i);m.setMonth(m.getMonth()-1);const P=m.toLocaleString("en-US",{month:"long"}),T=m.getFullYear(),R=a.data.find(o=>o.month===P&&o.year===T);if(N)j(N);else{const o=[...a.data].sort((Y,A)=>{const q=new Date(`${Y.month} 1, ${Y.year}`);return new Date(`${A.month} 1, ${A.year}`)-q});j(o[0]),console.log("Current month data not found, using most recent:",o[0])}R&&I(R)}h(!1)}catch(a){console.error("Failed to fetch dashboard data:",a),p(a.message||"An error occurred while fetching data"),h(!1)}},c=async()=>{try{x(!0);const a=await S.get("/finance/yearlysalesrevenue");a.data&&b(a.data),x(!1)}catch(a){console.error("Failed to fetch yearly data:",a),p(a.message||"An error occurred while fetching yearly data"),x(!1)}},$=async()=>{try{const i=(await S.get("/hr/worker")).data.filter(y=>y.department==="Finance");B(i)}catch(a){p(a.message||"Failed to fetch Finance department users"),console.error("Error fetching Finance users:",a)}};l(),c(),$()},[]);const d=(l,c)=>!c||c===0?"0":((l-c)/c*100).toFixed(1),D=new Date().getFullYear();return e.jsxs(_,{fluid:!0,className:"p-3",children:[e.jsx(u,{children:e.jsx(r,{children:e.jsx(J,{title:"Finance Dashboard",subtitle:"Welcome to the Finance Dashboard"})})}),e.jsxs(u,{children:[e.jsx(r,{xs:12,md:6,lg:3,children:e.jsx(g,{title:"Finance Department Employees",value:U.length,icon:e.jsx(f,{icon:O,style:{fontSize:"20px",color:"#0d6efd"}}),description:"Total Finance personnel"})}),e.jsx(r,{xs:12,md:6,lg:4,children:e.jsx(g,{title:`Current Sales (${(t==null?void 0:t.month)||"Loading..."})`,value:((v=t==null?void 0:t.totalSales)==null?void 0:v.toLocaleString())||0,increase:s?`${d((t==null?void 0:t.totalSales)||0,(s==null?void 0:s.totalSales)||0)>0?"+":""}${d((t==null?void 0:t.totalSales)||0,(s==null?void 0:s.totalSales)||0)}%`:"0",icon:e.jsx(f,{icon:Q,style:{fontSize:"20px",color:"#0d6efd"}})})}),e.jsx(r,{xs:12,md:6,lg:4,children:e.jsx(g,{title:`Current Revenue (${(t==null?void 0:t.month)||"Loading..."})`,value:`$${((L=t==null?void 0:t.totalRevenue)==null?void 0:L.toLocaleString())||0}`,increase:s?`${d((t==null?void 0:t.totalRevenue)||0,(s==null?void 0:s.totalRevenue)||0)>0?"+":""}${d((t==null?void 0:t.totalRevenue)||0,(s==null?void 0:s.totalRevenue)||0)}%`:"0",icon:e.jsx(f,{icon:V,style:{fontSize:"20px",color:"#198754"}})})}),e.jsx(r,{xs:12,md:6,lg:4,children:e.jsx(g,{title:`Yearly Sales (${D})`,value:w?w.totalSales.toLocaleString():"Loading...",description:"Annual performance",icon:e.jsx(f,{icon:X,style:{fontSize:"20px",color:"#dc3545"}}),loading:z})})]}),e.jsx(u,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx(M,{className:"mb-4",children:e.jsx("div",{className:"p-3",children:e.jsx(K,{})})})})}),C&&e.jsx(u,{className:"my-3",children:e.jsx(r,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:C})})})]})};export{je as default};
