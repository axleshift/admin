import{g as M,h as R,j as e}from"./index-C1kKK9j-.js";import{r as d,u as D}from"./vendor-react-BHxUanFt.js";import{F as V,ab as O}from"./index-ByAwoHiW.js";import{a as $,b as v,d as C,n as b,l as S,a3 as z,e as w,E as g,F as h,m as P,p as A,Y as Q,Z as x}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";const X=()=>{const[l,I]=d.useState({name:"",username:"",email:"",role:"",department:"",permissions:[]}),[p,U]=d.useState(!1),[H,J]=d.useState(!0),[n,u]=d.useState(1),o=5,k=D(),f=localStorage.getItem("userId"),{data:E=[],isLoading:L,error:G,refetch:Y}=M(void 0,{skip:!p,credentials:"include"}),{data:j,isLoading:T}=R(f,{skip:!f,credentials:"include"});d.useEffect(()=>{const s=localStorage.getItem("permissions"),t={name:localStorage.getItem("name")||"Unknown Name",username:localStorage.getItem("username")||"Unknown Username",email:localStorage.getItem("email")||"Unknown Email",role:localStorage.getItem("role")||"Unknown Role",department:localStorage.getItem("department")||"Unknown Department",permissions:s?JSON.parse(s):[]};I(t)},[]);const y=[...new Set([...l.permissions||[],...(j==null?void 0:j.permissions)||[]])],B=s=>{var t,r,i,a,c,N;return(t=s.action)!=null&&t.includes("/logs/activity")||(r=s.action)!=null&&r.includes("/user-activity")||(i=s.description)!=null&&i.includes("performed POST on")||(a=s.description)!=null&&a.includes("performed GET on")?null:{...s,action:(c=s.action)==null?void 0:c.replace(/^(POST|GET|PUT|DELETE)\s/,"").replace(/^\/api\//,""),description:(N=s.description)==null?void 0:N.replace(/User performed \w+ on /,"")}},m=(E||[]).map(B).filter(s=>s!==null),F=()=>{k("/employeescomplains")};return e.jsx("div",{className:"profile-container",children:e.jsxs($,{className:"profile-row",children:[e.jsx(v,{lg:p?6:12,md:12,className:"mb-4",children:e.jsxs(C,{className:"profile-card h-100",children:[e.jsxs(b,{className:"profile-header",children:[e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(S,{color:"primary",variant:"ghost",className:"activity-toggle-btn",onClick:()=>U(!p),children:e.jsx(V,{icon:O})}),e.jsx(S,{color:"success",onClick:F,children:"Create A Complaint"})]}),e.jsxs("div",{className:"text-center profile-avatar-section",children:[e.jsx(z,{color:"primary",textColor:"white",size:"xl",className:"profile-avatar mb-3",children:l.name?l.name[0].toUpperCase():"U"}),e.jsx("h2",{className:"mb-1",children:l.name}),e.jsxs("p",{className:"text-medium-emphasis",children:["@",l.username]})]})]}),e.jsxs(w,{children:[e.jsxs(g,{flush:!0,className:"user-details",children:[e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Email:"}),e.jsx("span",{className:"text-medium-emphasis",children:l.email})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Role:"}),e.jsx("span",{className:"text-medium-emphasis",children:l.role})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Department:"}),e.jsx("span",{className:"text-medium-emphasis",children:l.department})]})]}),e.jsxs("div",{className:"permissions-section mt-4",children:[e.jsx("h4",{className:"mb-3",children:"Permissions"}),T?e.jsx(P,{color:"primary",size:"sm"}):y.length>0?e.jsx(g,{children:y.map((s,t)=>e.jsx(h,{className:"permission-item",children:e.jsx(A,{color:"light",className:"permission-badge",children:s})},`permission-${t}`))}):e.jsx("p",{className:"text-medium-emphasis",children:"No permissions assigned"})]})]})]})}),p&&e.jsx(v,{lg:6,md:12,className:"mb-4",children:e.jsxs(C,{className:"activity-card h-100",children:[e.jsx(b,{children:e.jsx("h4",{className:"mb-0",children:"Activity Logs"})}),e.jsx(w,{className:"activity-body",children:e.jsx("div",{className:"activity-scroll-container",children:L?e.jsx("div",{className:"text-center p-4",children:e.jsx(P,{color:"primary"})}):G?e.jsx("div",{className:"error-message",children:"Failed to load activity. Please try again."}):m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:m.slice((n-1)*o,n*o).map((s,t)=>e.jsxs(h,{className:"activity-item mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx(A,{color:"primary",className:"activity-badge",children:s.action}),e.jsx("small",{className:"text-medium-emphasis",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"mb-0 activity-description",children:s.description})]},`activity-${t}`))}),Math.ceil(m.length/o)>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Q,{"aria-label":"Activity log pagination",children:[e.jsx(x,{"aria-label":"Previous",onClick:()=>u(n-1),disabled:n===1,children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),(()=>{const s=Math.ceil(m.length/o),t=5;let r=[];if(s<=t)r=Array.from({length:s},(i,a)=>a+1);else{r.push(1);let i=Math.max(n-1,2),a=Math.min(n+1,s-1);i===2&&(a=4),a===s-1&&(i=s-3),i>2&&r.push("...");for(let c=i;c<=a;c++)r.push(c);a<s-1&&r.push("..."),r.push(s)}return r.map((i,a)=>i==="..."?e.jsx(x,{disabled:!0,children:"..."},`ellipsis-${a}`):e.jsx(x,{active:n===i,onClick:()=>u(i),children:i},i))})(),e.jsx(x,{"aria-label":"Next",onClick:()=>u(n+1),disabled:n===Math.ceil(m.length/o),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]}):e.jsx("p",{className:"text-center text-medium-emphasis",children:"No activity logs found"})})})]})})]})})};export{X as default};
