import{r as a,a as l,j as e,e as j,f as C,g as O,K as Q,b as T,c as E,k as u}from"./index-Cskk6QuV.js";import{C as U}from"./index.esm-CbuOHHQi.js";import{C as V}from"./CAlert-C4tVWNT_.js";import{C as P}from"./CRow-BtsQEa9i.js";import{C as g}from"./CCol-BpNSW51C.js";import{C as S}from"./CCardHeader-BxjHQWZq.js";import{C as D,a as B}from"./CListGroupItem-C47ieOko.js";const te=()=>{const[m,v]=a.useState(""),[F,N]=a.useState([]),[c,L]=a.useState(null),[$,f]=a.useState([]),[n,z]=a.useState(null),[A,p]=a.useState([]),[x,G]=a.useState(null),[i,r]=a.useState(!1),[w,R]=a.useState(!1),[I,t]=a.useState(""),[b,k]=a.useState(!1);a.useEffect(()=>{const s=localStorage.getItem("backupDirectory");s&&(v(s),r(!0),l.post("http://localhost:5053/admin/set-directory",{directory:s}).then(()=>{k(!0),y()}).catch(()=>t("Could not restore saved directory. Please set it manually.")).finally(()=>r(!1)))},[]),a.useEffect(()=>{b&&y()},[b]),a.useEffect(()=>{c?H(c):f([])},[c]),a.useEffect(()=>{n?K(c,n):p([])},[n]);const y=async()=>{r(!0),t("");try{const s=await l.get("http://localhost:5053/admin/list-backups");N(s.data.backups||[])}catch{t("Error fetching backups"),N([])}finally{r(!1)}},H=async s=>{var d,h;if(s){r(!0),t("");try{const o=await l.get(`http://localhost:5053/admin/list-collections/${s.name}`);o.data.databases?f(o.data.databases):(f([]),t("No databases found in this backup."))}catch(o){console.error("Error fetching databases:",o),t(((h=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.message)||"Error fetching databases"),f([])}finally{r(!1)}}},K=async(s,d)=>{if(!s||!d){p([]);return}r(!0),t("");try{const h=await l.get(`http://localhost:5053/admin/list-collections/${s.name}?databaseName=${d}`);p(h.data.collections||[])}catch{t("Error fetching collections"),p([])}finally{r(!1)}},q=async()=>{if(!m){t("Please enter a directory.");return}r(!0),t("");try{await l.post("http://localhost:5053/admin/set-directory",{directory:m}),localStorage.setItem("backupDirectory",m),k(!0),y()}catch{t("Error setting directory"),k(!1)}finally{r(!1)}},J=async()=>{R(!0),t("");try{await l.post("http://localhost:5053/admin/backup"),y()}catch{t("Error during backup")}finally{R(!1)}},M=async()=>{if(!c||!n||!x){t("Please select a backup, database, and collection.");return}r(!0),t("");try{await l.post("http://localhost:5053/admin/restore",{timestamp:c.name,filename:x,databaseName:n}),alert("Restore successful!")}catch{t("Restore failed.")}finally{r(!1)}};return e.jsxs(U,{children:[I&&e.jsx(V,{color:"danger",className:"mt-3",children:I}),e.jsx(P,{className:"mb-4 mt-3",children:e.jsx(g,{children:e.jsxs(j,{children:[e.jsx(S,{children:"Backup Configuration"}),e.jsxs(C,{children:[e.jsxs(O,{children:[e.jsx(Q,{children:"Set Backup Directory"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(T,{type:"text",placeholder:"Enter directory path",value:m,onChange:s=>v(s.target.value)}),e.jsx(E,{className:"ms-2",onClick:q,disabled:i,children:i?e.jsx(u,{size:"sm"}):"Set Directory"})]})]}),e.jsx(E,{color:"primary",className:"mt-3",onClick:J,disabled:!b||w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:"sm"})," Creating Backup..."]}):"Create New Backup"})]})]})})}),e.jsxs(P,{children:[e.jsx(g,{md:"4",children:e.jsxs(j,{children:[e.jsx(S,{children:"Available Backups"}),e.jsx(C,{children:i?e.jsx(u,{}):e.jsx(D,{children:F.map(s=>e.jsx(B,{active:(c==null?void 0:c.name)===s.name,onClick:()=>L(s),style:{cursor:"pointer"},children:s.name},s.name))})})]})}),e.jsx(g,{md:"4",children:e.jsxs(j,{children:[e.jsx(S,{children:"Select Database"}),e.jsx(C,{children:i?e.jsx(u,{}):e.jsx(D,{children:$.map(s=>e.jsx(B,{active:n===s,onClick:()=>z(s),style:{cursor:"pointer"},children:s},s))})})]})}),e.jsxs(g,{md:"4",children:[e.jsxs(j,{children:[e.jsx(S,{children:"Select Collection"}),e.jsx(C,{children:i?e.jsx(u,{}):e.jsx(D,{children:A.map(s=>e.jsx(B,{active:x===s,onClick:()=>G(s),style:{cursor:"pointer"},children:s},s))})})]}),e.jsx(E,{color:"warning",className:"mt-3",onClick:M,disabled:!x,children:"Restore"})]})]})]})};export{te as default};
