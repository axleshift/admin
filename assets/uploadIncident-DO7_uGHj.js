import{j as e}from"./index-BGtljK0H.js";import{d as R,u as U,r as a}from"./vendor-react-BHxUanFt.js";import{a as k}from"./axiosInstance-Bq-uIJjs.js";import"./vendor-redux-CSji-Y9p.js";import"./vendor-coreui-CLDxaGvm.js";import"./index-xsH4HHeE.js";function $(){const{userId:r,token:n}=R();U();const[i,h]=a.useState(null),[l,g]=a.useState({title:"Absence Explanation Report",description:"",location:"",severity:"Medium"}),[x,y]=a.useState(!1),[c,f]=a.useState(null),[b,d]=a.useState(""),[m,I]=a.useState(null),[F,j]=a.useState(!0);a.useEffect(()=>{(async()=>{if(!r||!n){j(!1),d("Invalid URL. Please use the link provided in your email.");return}try{const t=await k.get(`/users/${r}/validate-token/${n}`);I(t.data.user)}catch(t){console.error("Token validation error:",t),j(!1),d("Your link has expired or is invalid. Please contact HR for assistance.")}})()},[r,n]);const E=o=>{h(o.target.files[0])},u=o=>{const{name:t,value:p}=o.target;g({...l,[t]:p})},S=async o=>{var p,v,N,w;if(o.preventDefault(),!i){d("Please select a file to upload");return}y(!0),d(""),f(null);const t=new FormData;t.append("file",i),Object.keys(l).forEach(s=>{t.append(s,l[s])});try{const s=r&&n?`/incidentreport/upload/${r}/${n}`:"/incidentreport/upload",C=await k.post(s,t,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0});f({success:!0,message:"Report uploaded successfully! You may now close this window.",data:C.data}),h(null),g({title:"Absence Explanation Report",description:"",location:"",severity:"Medium"}),document.getElementById("file-upload").value="",setTimeout(()=>{},5e3)}catch(s){console.error("Error uploading file:",s),f({success:!1,message:((v=(p=s.response)==null?void 0:p.data)==null?void 0:v.message)||"Failed to upload file"}),d(((w=(N=s.response)==null?void 0:N.data)==null?void 0:w.message)||"Failed to upload the incident report. Please try again.")}finally{y(!1)}};return F?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-8 max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Incident Report Upload"}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-800",children:"User Information"}),e.jsxs("p",{className:"mt-2 text-gray-700",children:["Name: ",m.name]}),e.jsxs("p",{className:"text-gray-700",children:["Email: ",m.email]}),e.jsxs("p",{className:"text-gray-700",children:["Department: ",m.department]})]}),e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-yellow-800",children:"Attendance Notice"}),e.jsx("p",{className:"mt-2 text-gray-700",children:"Our records indicate you have exceeded the maximum allowed absences for this month. Please submit an explanation with any supporting documentation."})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:b}),(c==null?void 0:c.success)&&e.jsx("div",{className:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded",children:c.message}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Report Title"}),e.jsx("input",{type:"text",id:"title",name:"title",value:l.title,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter report title",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Explanation of Absences"}),e.jsx("textarea",{id:"description",name:"description",value:l.description,onChange:u,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Please explain the reason for your absences this month",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"location",className:"block text-sm font-medium text-gray-700 mb-1",children:"Work Location"}),e.jsx("input",{type:"text",id:"location",name:"location",value:l.location,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your work location or department"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"severity",className:"block text-sm font-medium text-gray-700 mb-1",children:"Impact Level"}),e.jsxs("select",{id:"severity",name:"severity",value:l.severity,onChange:u,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"Low",children:"Low Impact"}),e.jsx("option",{value:"Medium",children:"Medium Impact"}),e.jsx("option",{value:"High",children:"High Impact"}),e.jsx("option",{value:"Critical",children:"Critical Impact"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 mb-1",children:"Upload Supporting Document"}),e.jsx("input",{id:"file-upload",type:"file",onChange:E,className:`block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4
                       file:rounded-full file:border-0
                       file:text-sm file:font-semibold
                       file:bg-blue-50 file:text-blue-700
                       hover:file:bg-blue-100`,required:!0}),i&&e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:["Selected File: ",e.jsx("span",{className:"font-medium",children:i.name})," (",Math.round(i.size/1024)," KB)"]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Accepted file formats: PDF, Word, Excel, images, and text documents (Max: 10MB)"})]}),e.jsx("button",{type:"submit",disabled:x,className:`w-full py-2 px-4 rounded-md font-medium text-white 
              ${x?"bg-blue-400":"bg-blue-600 hover:bg-blue-700"} 
              focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150`,children:x?"Uploading...":"Submit Report"})]})]})}):e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-8 max-w-md w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center text-red-600",children:"Invalid Link"}),e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:b}),e.jsx("p",{className:"text-center mt-4",children:"Please contact your HR department for assistance."})]})})}export{$ as default};
