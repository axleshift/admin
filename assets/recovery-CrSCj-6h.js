import{j as e}from"./index-DV-wgTl8.js";import{r as a,i as _}from"./vendor-react-B6URQkMn.js";import{a as d}from"./axiosInstance-Bq-uIJjs.js";import{l as m}from"./activityLogger-D6Lc4RsL.js";import{c as $,S as F,N as C,O as u,k as h,X as x,j as g,l as p,C as j,a7 as w,a8 as B}from"./vendor-coreui-DDUzhqJ9.js";import"./vendor-redux-C7peqcPR.js";import"./index-xsH4HHeE.js";const X=()=>{const[k,y]=a.useState([]),[t,R]=a.useState(null),[N,f]=a.useState([]),[c,I]=a.useState(null),[o,n]=a.useState(!1),[S,v]=a.useState(!1),[b,r]=a.useState(""),A=_(),L=localStorage.getItem("name"),l=()=>({name:L||"Unknown User"});a.useEffect(()=>{E()},[]),a.useEffect(()=>{if(t){P(t);const s=l();m({...s,route:"/recovery",action:"SELECT_BACKUP",description:`Selected backup: ${t.name}`})}else f([])},[t]);const E=async()=>{n(!0),r("");try{const s=await d.get("/admin/list-backups");y(s.data.backups||[])}catch{r("Error fetching backups"),y([])}finally{n(!1)}},P=async s=>{if(s){n(!0),r("");try{const i=await d.get(`/admin/list-collections/${s.name}`);f(i.data.collections||[])}catch{r("Error fetching collections"),f([])}finally{n(!1)}}},T=async()=>{v(!0),r("");try{await d.post("/admin/backup"),E();const s=l();m({...s,route:"/recovery",action:"CREATE_BACKUP",description:"Created new backup"})}catch{r("Error during backup")}finally{v(!1)}},O=async()=>{if(!t||!c){r("Please select a backup and collection.");return}if(window.confirm(`Are you sure you want to restore collection "${c}"? This will replace the current data.`)){n(!0),r("");try{await d.post("/admin/restore",{timestamp:t.name,filename:c,databaseName:"adminis"});const i=l();m({...i,route:"/recovery",action:"RESTORE_COLLECTION",description:`Restored collection: ${c} from backup: ${t.name}`}),alert("Restore successful!")}catch{r("Restore failed.")}finally{n(!1)}}},U=async()=>{const s=l();m({...s,route:"/recovery",action:"NAVIGATE_TO_SCHEDULER",description:"Navigated to backup scheduler page"}),A("/cron")};return e.jsxs($,{children:[b&&e.jsx(F,{color:"danger",className:"mt-3",children:b}),e.jsx(C,{className:"mb-4 mt-3",children:e.jsx(u,{children:e.jsxs(h,{children:[e.jsxs(x,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:"Backup Configuration"}),e.jsx(g,{className:"ms-auto",color:"primary",onClick:U,children:"Schedule Backup"})]}),e.jsx(p,{children:e.jsx(g,{color:"primary",className:"mt-3",onClick:T,disabled:S,children:S?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm"})," Creating Backup..."]}):"Create New Backup"})})]})})}),e.jsxs(C,{children:[e.jsx(u,{md:"6",children:e.jsxs(h,{children:[e.jsx(x,{children:"Available Backups"}),e.jsx(p,{children:o?e.jsx(j,{}):e.jsx(e.Fragment,{children:k.length===0?e.jsx("div",{className:"text-center p-3",children:"No backups available"}):e.jsx(w,{children:k.map(s=>e.jsxs(B,{active:(t==null?void 0:t.name)===s.name,onClick:()=>R(s),style:{cursor:"pointer"},children:[s.name,e.jsxs("small",{className:"d-block text-muted",children:[new Date(s.created).toLocaleString()," - ",Math.round(s.size/1024/1024),"MB"]})]},s.name))})})})]})}),e.jsx(u,{md:"6",children:e.jsxs(h,{children:[e.jsx(x,{children:"Select Collection"}),e.jsx(p,{children:o?e.jsx(j,{}):e.jsx(e.Fragment,{children:t?N.length===0?e.jsx("div",{className:"text-center p-3",children:"No collections found in this backup"}):e.jsx(w,{children:N.map(s=>e.jsx(B,{onClick:()=>I(s),active:c===s,style:{cursor:"pointer"},children:s},s))}):e.jsx("div",{className:"text-center p-3",children:"Select a backup first"})})})]})})]}),e.jsx(C,{className:"mt-4",children:e.jsx(u,{children:e.jsxs(h,{children:[e.jsx(x,{children:"Restore Options"}),e.jsxs(p,{children:[e.jsxs("div",{className:"mb-3",children:[t&&e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Backup:"})," ",t.name]}),c&&e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Collection:"})," ",c]})]}),t&&c?e.jsx(g,{color:"warning",onClick:O,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(j,{size:"sm"})," Restoring..."]}):"Restore Collection"}):e.jsx("div",{className:"text-muted",children:"Please select a backup and collection to restore"})]})]})})})]})};export{X as default};
