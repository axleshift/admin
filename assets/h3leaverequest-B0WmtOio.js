import{j as e}from"./index-ala_1vvM.js";import{r as a}from"./vendor-react-BHxUanFt.js";import{a as V}from"./axiosInstance-Bq-uIJjs.js";import{l as le}from"./activityLogger-D6Lc4RsL.js";import{C as Te,G as Ee,d as C,n as Ie,j as t,Q as Ze,R as ze,m as S,S as qe,T as D,l as d,e as P,a as Ue,b as T,r as _e,s as $e,t as oe,u as o,v as Be,w as n,U as Oe,V as E,H as I,I as Z,J as z,K as q,y as We,O as U,k as Ye,D as Ke,E as Ge,F as Je,p as m,g as ne}from"./vendor-coreui-C1kAWlgm.js";import{F as Qe,L as Xe}from"./index-CO_Wo9dq.js";import{c as es,a as ss,b as rs}from"./cil-people-DOcwnkEl.js";import{c as ie}from"./cil-user-Ddrdy7PS.js";import{c as de}from"./cil-lock-locked-DmxpJbVL.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";var as=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='408 432 376 432 376 464 112 464 112 136 144 136 144 104 80 104 80 496 408 496 408 432' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M176,16V400H496V153.373L358.627,16ZM464,368H208V48H312V200H464Zm0-200H344V48h1.372L464,166.627Z' class='ci-primary'/>"],L=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z' class='ci-primary'/>"],ts=["512 512","<rect width='34.924' height='34.924' x='256' y='95.998' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M16,496H496V16H16ZM48,48H464V464H48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M285.313,359.032a18.123,18.123,0,0,1-15.6,8.966,18.061,18.061,0,0,1-17.327-23.157l35.67-121.277A49.577,49.577,0,0,0,194.7,190.572l-11.718,28.234,29.557,12.266,11.718-28.235a17.577,17.577,0,0,1,33.1,11.7l-35.67,121.277A50.061,50.061,0,0,0,269.709,400a50.227,50.227,0,0,0,43.25-24.853l15.1-25.913-27.646-16.115Z' class='ci-primary'/>"],cs=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M344,16H168V168H16V344H168V496H344V344H496V168H344ZM464,200V312H312V464H200V312H48V200H200V48H312V200Z' class='ci-primary'/>"],ls=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M432,64H16V384H432ZM400,352H48V96H400Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='464 144 464 416 96 416 96 448 496 448 496 144 464 144' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M224,302.46c39.7,0,72-35.137,72-78.326s-32.3-78.326-72-78.326-72,35.136-72,78.326S184.3,302.46,224,302.46Zm0-124.652c22.056,0,40,20.782,40,46.326s-17.944,46.326-40,46.326-40-20.782-40-46.326S201.944,177.808,224,177.808Z' class='ci-primary'/><rect width='32' height='176' x='80' y='136' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='176' x='336' y='136' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],os=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M29.663,482.25l.087.087a24.847,24.847,0,0,0,17.612,7.342,25.178,25.178,0,0,0,8.1-1.345l142.006-48.172,272.5-272.5A88.832,88.832,0,0,0,344.334,42.039l-272.5,272.5L23.666,456.541A24.844,24.844,0,0,0,29.663,482.25Zm337.3-417.584a56.832,56.832,0,0,1,80.371,80.373L411.5,180.873,331.127,100.5ZM99.744,331.884,308.5,123.127,388.873,203.5,180.116,412.256,58.482,453.518Z' class='ci-primary'/>"],ns=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='427.314 107.313 404.686 84.687 256 233.373 107.314 84.687 84.686 107.313 233.373 256 84.686 404.687 107.314 427.313 256 278.627 404.686 427.313 427.314 404.687 278.627 256 427.314 107.313' class='ci-primary'/>"];const ws=()=>{const[p,_]=a.useState([]),[$,B]=a.useState(!0),[u,me]=a.useState(1),[j,b]=a.useState(!1),[i,O]=a.useState(null),[h,W]=a.useState(""),[he,Y]=a.useState(!1),[K,R]=a.useState(""),[xe,pe]=a.useState(null),[ue,je]=a.useState(!1),[c,ge]=a.useState(null),[ve,is]=a.useState(!1),[G,be]=a.useState(null),H=5,[ds,ms]=a.useState(!1),[J,ye]=a.useState(""),[fe,Ne]=a.useState(""),[we,Q]=a.useState(!1),[Ce,M]=a.useState(!1),y=localStorage.getItem("role"),X=localStorage.getItem("department"),g=localStorage.getItem("name"),ee=localStorage.getItem("username"),Se=a.useRef();le({name:g,role:y,department:X,route:"Leave Request",action:"Page Visit",description:`${g} visit the Leave Request page`}).catch(console.warn),a.useEffect(()=>{se()},[]);const x=(s,r,l)=>{pe(e.jsxs(Ke,{autohide:!0,delay:5e3,children:[e.jsx(Ge,{closeButton:!0,color:s,children:e.jsx("strong",{className:"me-auto",children:r})}),e.jsx(Je,{children:l})]}))},se=async()=>{var s,r;try{B(!0);const w=(await V.get("/hr/leaveRequest")).data.data||[];_(w),x("success","Data Fetched Successfully",`Retrieved ${w.length} leave request(s)`)}catch(l){console.error("Error fetching leave requests:",l),x("danger","Fetch Error",`Failed to load leave requests: ${((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.error)||l.message}`)}finally{B(!1)}},re=u*H,De=re-H,Pe=p.slice(De,re),A=Math.ceil(p.length/H),Le=s=>{if(!s)return e.jsx(m,{color:"secondary",children:"Unknown"});switch(s.toLowerCase()){case"approved":return e.jsx(m,{color:"success",children:s});case"pending":return e.jsx(m,{color:"warning",children:s});case"rejected":return e.jsx(m,{color:"danger",children:s});default:return e.jsx(m,{color:"info",children:s})}},Re=s=>s?s.toLowerCase()==="paid"?e.jsx(m,{color:"success",children:s}):e.jsx(m,{color:"secondary",children:s}):e.jsx(m,{color:"secondary",children:"Unknown"}),ae=s=>{if(!s)return"N/A";try{const r=new Date(s);return isNaN(r.getTime())?"Invalid Date":r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(r){return console.error("Date formatting error:",r),"Error"}},te=(s,r)=>{O(s),W(r),R(""),Y(!0)},f=()=>{Y(!1),O(null),W(""),R("")},ce=()=>{Q(!1),M(!1)},k=()=>{je(!1),ge(null),be(null)},He=()=>{navigator.clipboard.writeText(J).then(()=>{M(!0),setTimeout(()=>M(!1),3e3)}).catch(s=>{console.error("Failed to copy password:",s),x("danger","Error","Failed to copy password to clipboard")})},Me=async()=>{if(!(!i||!h))try{b(!0);const s=h==="approve"?"Approved":"Rejected";await V.put(`/hr/leaveRequest/${i.id}`,{status:s,comments:K}),_(r=>r.map(l=>l.id===i.id?{...l,status:s}:l)),f(),x("success","Success",`Leave request has been ${s.toLowerCase()} successfully`)}catch(s){console.error(`Error ${h}ing leave request:`,s),x("danger","Error",`Failed to ${h} leave request. Please try again.`)}finally{b(!1)}},Ae=s=>{if(s==null)return"N/A";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}catch(r){return console.error("Currency formatting error:",r),"Error"}},F=s=>{me(s)},ke=()=>{if(ve)return e.jsxs("div",{className:"text-center p-5",children:[e.jsx(S,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Loading document..."})]});if(G)return e.jsxs(ne,{color:"danger",className:"mb-0",children:[e.jsx("h4",{children:"Error Loading Document"}),e.jsx("p",{children:G}),e.jsx("p",{children:"Please try again or contact support if the issue persists."})]});if(!c)return e.jsxs(ne,{color:"warning",className:"mb-0",children:[e.jsx("h4",{children:"No Document Selected"}),e.jsx("p",{children:"There was an error selecting the document. Please try again."})]});const s=c.path;switch(c.type){case"pdf":return e.jsx("div",{className:"document-viewer-container",style:{height:"600px",width:"100%"},children:e.jsx("iframe",{src:s,title:c.name,width:"100%",height:"100%",style:{border:"none"},children:"Your browser does not support iframes."})});case"image":return e.jsx("div",{className:"text-center p-3",children:e.jsx("img",{src:s,alt:c.name,className:"img-fluid",style:{maxHeight:"600px",maxWidth:"100%"}})});case"word":return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(t,{icon:L,size:"3xl",className:"text-primary mb-3"}),e.jsx("h5",{children:"Microsoft Word Document"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for Word documents"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",c.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",c.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," Microsoft Word Document"]})]})]})});case"excel":return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(t,{icon:L,size:"3xl",className:"text-success mb-3"}),e.jsx("h5",{children:"Microsoft Excel Document"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for Excel documents"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",c.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",c.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," Microsoft Excel Document"]})]})]})});default:return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(t,{icon:L,size:"3xl",className:"text-secondary mb-3"}),e.jsx("h5",{children:"Document Preview"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for this file type"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",c.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",c.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," ",c.type.toUpperCase()]})]})]})})}},N=async s=>{try{b(!0);let r="";switch(s){case"all":r="All_LeaveRequests";break;case"pending":r="Pending_LeaveRequests";break;case"approved":r="Approved_LeaveRequests";break;case"rejected":r="Rejected_LeaveRequests";break;default:r="LeaveRequests"}const l=await V.post("/management/downloadLeaveRequest",{name:g,role:y,username:ee,downloadType:s},{responseType:"blob"}),w=g.substring(0,2)+y.charAt(0)+ee.slice(-6);ye(w),Ne(`${r}_Protected.zip`),Q(!0);const Fe=window.URL.createObjectURL(new Blob([l.data])),v=document.createElement("a");v.href=Fe,v.setAttribute("download",`${r}_Protected.zip`),document.body.appendChild(v),v.click(),document.body.removeChild(v),x("success","Success",`File ${r}_Protected.zip downloaded successfully!`),await le({name:g,role:y,department:X,route:"/leave-requests",action:"Download",description:`${g} downloaded ${s} leave requests as ${r}_Protected.zip`}).catch(Ve=>{console.warn("Error logging download activity:",Ve)})}catch(r){console.error("Error creating protected zip:",r),x("danger","Error","Failed to create protected download. Please try again.")}finally{b(!1)}};return e.jsxs(Te,{fluid:!0,className:"mt-4",children:[e.jsx(Ee,{ref:Se,push:xe,placement:"top-end"}),e.jsxs(C,{className:"shadow",children:[e.jsxs(Ie,{className:"bg-primary text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h4",{className:"mb-0",children:[e.jsx(t,{icon:es,className:"me-2"}),"Leave Requests"]}),e.jsxs(Ze,{children:[e.jsxs(ze,{color:"primary",disabled:j,children:[e.jsx(Qe,{icon:Xe,className:"me-2"}),"Secure PDF Download",j&&e.jsx(S,{size:"sm",className:"ms-2"})]}),e.jsxs(qe,{children:[e.jsx(D,{onClick:()=>N("all"),children:"All Leave Requests"}),e.jsx(D,{onClick:()=>N("pending"),children:"Pending Requests"}),e.jsx(D,{onClick:()=>N("approved"),children:"Approved Requests"}),e.jsx(D,{onClick:()=>N("rejected"),children:"Rejected Requests"})]})]}),e.jsxs(d,{color:"light",size:"sm",onClick:se,disabled:$,children:[e.jsx(t,{icon:os,className:"me-1"}),"Refresh"]})]}),e.jsx(P,{children:$?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(S,{color:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading leave requests..."})]}):p.length===0?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(t,{icon:ts,size:"xl",className:"mb-3 text-muted"}),e.jsx("p",{children:"No leave requests found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Ue,{className:"mb-3",children:[e.jsx(T,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(C,{className:"text-white bg-info",children:e.jsxs(P,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Total Requests"}),e.jsx("h3",{className:"mb-0",children:p.length})]}),e.jsx(t,{icon:ss,size:"3xl"})]})})}),e.jsx(T,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(C,{className:"text-white bg-warning",children:e.jsxs(P,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Pending"}),e.jsx("h3",{className:"mb-0",children:p.filter(s=>s.status&&s.status.toLowerCase()==="pending").length})]}),e.jsx(t,{icon:cs,size:"3xl"})]})})}),e.jsx(T,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(C,{className:"text-white bg-success",children:e.jsxs(P,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Approved"}),e.jsx("h3",{className:"mb-0",children:p.filter(s=>s.status&&s.status.toLowerCase()==="approved").length})]}),e.jsx(t,{icon:rs,size:"3xl"})]})})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs(_e,{striped:!0,hover:!0,responsive:!0,className:"border",children:[e.jsx($e,{className:"bg-light",children:e.jsxs(oe,{children:[e.jsx(o,{children:"ID"}),e.jsxs(o,{children:[e.jsx(t,{icon:ie,className:"me-1"}),"Employee"]}),e.jsx(o,{children:"Department"}),e.jsx(o,{children:"Leave Type"}),e.jsx(o,{children:"Start Date"}),e.jsx(o,{children:"Days"}),e.jsxs(o,{children:[e.jsx(t,{icon:ls,className:"me-1"}),"Amount"]}),e.jsx(o,{children:"Paid Status"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Be,{children:Pe.map(s=>e.jsxs(oe,{children:[e.jsx(n,{children:s.id}),e.jsx(n,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-light rounded-circle p-2 me-2 text-primary",children:e.jsx(t,{icon:ie})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:s.name||"Unknown"}),e.jsx("small",{className:"text-muted",children:s.reason||"No reason"})]})]})}),e.jsx(n,{children:s.department||"N/A"}),e.jsx(n,{children:s.leave_type||"N/A"}),e.jsx(n,{children:ae(s.start_date)}),e.jsx(n,{children:s.days||"N/A"}),e.jsx(n,{children:Ae(s.amount)}),e.jsx(n,{children:Re(s.isPaid)}),e.jsx(n,{children:Le(s.status)}),e.jsxs(n,{children:[s.status&&s.status.toLowerCase()==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{color:"success",size:"sm",onClick:()=>te(s,"approve"),disabled:j,children:"Approve"}),e.jsx(d,{color:"danger",size:"sm",className:"ms-2",onClick:()=>te(s,"reject"),disabled:j,children:"Reject"})]}),(!s.status||s.status.toLowerCase()!=="pending")&&e.jsx("span",{className:"text-muted",children:"No actions available"})]})]},s.id))})]})}),A>1&&e.jsxs(Oe,{className:"mt-3 justify-content-center","aria-label":"Page navigation",children:[e.jsx(E,{disabled:u===1,onClick:()=>F(u-1),children:"Previous"}),[...Array(A)].map((s,r)=>e.jsx(E,{active:u===r+1,onClick:()=>F(r+1),children:r+1},r+1)),e.jsx(E,{disabled:u===A,onClick:()=>F(u+1),children:"Next"})]})]})})]}),e.jsxs(I,{visible:he,onClose:f,children:[e.jsx(Z,{onClose:f,children:e.jsxs(z,{children:[h==="approve"?"Approve":"Reject"," Leave Request"]})}),e.jsx(q,{children:i&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",i.name||"Unknown",e.jsx("br",{}),e.jsx("strong",{children:"Leave Type:"})," ",i.leave_type||"N/A",e.jsx("br",{}),e.jsx("strong",{children:"Start Date:"})," ",ae(i.start_date),e.jsx("br",{}),e.jsx("strong",{children:"Duration:"})," ",i.days||"N/A"," days"]}),e.jsx("label",{htmlFor:"comments",className:"form-label",children:"Comments:"}),e.jsx(We,{id:"comments",rows:3,value:K,onChange:s=>R(s.target.value),placeholder:"Add any comments here (optional)"})]})}),e.jsxs(U,{children:[e.jsx(d,{color:"secondary",onClick:f,children:"Cancel"}),e.jsx(d,{color:h==="approve"?"success":"danger",onClick:Me,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",className:"me-2"}),"Processing..."]}):h==="approve"?"Approve":"Reject"})]})]}),e.jsxs(I,{visible:ue,onClose:k,size:"lg",backdrop:"static",children:[e.jsx(Z,{onClose:k,children:e.jsx(z,{children:c&&e.jsxs(e.Fragment,{children:[e.jsx(t,{icon:L,className:"me-2"}),"Document Preview: ",c.employeeName]})})}),e.jsx(q,{className:"p-0",children:e.jsx("div",{className:"document-viewer",children:ke()})}),e.jsx(U,{children:e.jsxs(d,{color:"secondary",onClick:k,children:[e.jsx(t,{icon:ns,className:"me-1"}),"Close"]})})]}),e.jsxs(I,{visible:we,onClose:ce,backdrop:"static",alignment:"center",children:[e.jsx(Z,{className:"bg-info text-white",children:e.jsxs(z,{children:[e.jsx(t,{icon:de,className:"me-2"}),"Secure File Password"]})}),e.jsxs(q,{className:"p-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"display-6 mb-3 text-info",children:e.jsx(t,{icon:de,size:"xl"})}),e.jsx("h5",{children:"Your download has started"}),e.jsx("p",{className:"text-muted",children:"Use the password below to extract the ZIP file contents:"})]}),e.jsxs("div",{className:"password-container p-3 bg-light rounded border position-relative mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(Ye,{type:"text",value:J,readOnly:!0,className:"bg-white border-info text-center fw-bold"}),e.jsx(d,{color:"secondary",className:"ms-2",onClick:He,title:"Copy to clipboard",children:e.jsx(t,{icon:as})})]}),Ce&&e.jsxs("div",{className:"text-success mt-2 small",children:[e.jsx("i",{className:"fas fa-check-circle"})," Password copied to clipboard!"]})]}),e.jsxs("div",{className:"file-info mb-4 p-3 bg-light rounded border",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",fe]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Format:"})," Protected ZIP Archive"]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Contents:"})," HR Leave Request Reports (PDF)"]})]}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Important:"})," Keep this password secure. You'll need it to access the contents of the downloaded file."]})]}),e.jsx(U,{children:e.jsx(d,{color:"info",className:"px-4",onClick:ce,children:"I've Saved My Password"})})]})]})};export{ws as default};
