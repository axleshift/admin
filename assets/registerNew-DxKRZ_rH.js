import{j as e}from"./index-CqTYrJit.js";import{r as i}from"./vendor-react-BHxUanFt.js";import{a as C}from"./axiosInstance-Bq-uIJjs.js";import{F as r,G as A,i as L,H as k,p as z,a as B,I as J,J as _}from"./index-BNowUf5p.js";import{m as y,d as R,e as H,n as M,p as x,l as S,g as O,E as V,F as q,G as K,a as Q,b as E}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";function ae(){var f,p;const[l,j]=i.useState([]),[g,P]=i.useState(null),[N,I]=i.useState({}),[U,n]=i.useState(!0),[h,m]=i.useState(!1),[d,o]=i.useState(null),u=()=>{n(!0),C.get("/hr/newhires").then(s=>{j(s.data),n(!1)}).catch(s=>{P(s.message),n(!1)})};i.useEffect(()=>{u()},[]);const D=()=>{m(!0),o(null),C.post("/client/process-registrations").then(s=>{console.log("Registration response:",s.data),o({success:s.data.success,message:s.data.message,registeredUsers:s.data.registeredUsers||[],alreadyRegistered:s.data.alreadyRegistered||[]});const a=new Set([...(s.data.registeredUsers||[]).map(t=>t.email),...(s.data.alreadyRegistered||[]).map(t=>t.email)]);a.size>0?j(t=>t.map(c=>{var b;if(a.has(c.email)){const w=(b=s.data.registeredUsers)==null?void 0:b.find(G=>G.email===c.email);return{...c,registered:!0,...w?{generatedPassword:w.generatedPassword||""}:{}}}return c})):u(),m(!1)}).catch(s=>{var a,t;console.error("Registration error:",s),o({success:!1,message:((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message}),m(!1)})},F=s=>{I(a=>({...a,[s]:!a[s]}))};if(U)return e.jsx("div",{className:"d-flex justify-content-center p-4",children:e.jsx(y,{color:"primary"})});if(g)return e.jsx(R,{color:"danger",className:"text-white",children:e.jsxs(H,{children:["Error: ",g]})});const v=l.filter(s=>s.registered).length,$=l.length-v;return e.jsxs(R,{children:[e.jsxs(M,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0",children:"New Hires"}),e.jsxs("div",{className:"mt-1",children:[e.jsxs(x,{color:"success",className:"me-2",children:[v," Registered"]}),e.jsxs(x,{color:"info",children:[$," Pending Registration"]})]})]}),e.jsx(S,{color:"primary",onClick:D,disabled:h||l.every(s=>s.registered),children:h?e.jsxs(e.Fragment,{children:[e.jsx(y,{size:"sm",className:"me-2"}),"Registering..."]}):l.every(s=>s.registered)?"All Hires Registered":e.jsxs(e.Fragment,{children:[e.jsx(r,{icon:A,className:"me-2"}),"Register New Hires"]})})]}),e.jsxs(H,{children:[d&&e.jsxs(O,{color:d.success?"success":"danger",className:"mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[d.success&&e.jsx(r,{icon:L,className:"me-2"}),d.message]}),d.success&&((f=d.registeredUsers)==null?void 0:f.length)>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"fw-bold",children:"Newly registered users:"}),e.jsx("ul",{className:"mt-1",children:d.registeredUsers.map((s,a)=>e.jsxs("li",{children:[s.firstName," ",s.lastName," (",s.email,") - Password: ",e.jsx("code",{className:"bg-light px-2 py-1 rounded",children:s.generatedPassword})]},`new-${a}`))})]}),d.success&&((p=d.alreadyRegistered)==null?void 0:p.length)>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"fw-bold",children:"Already registered users:"}),e.jsx("ul",{className:"mt-1",children:d.alreadyRegistered.map((s,a)=>e.jsxs("li",{children:[s.firstName," ",s.lastName," (",s.email,")"]},`existing-${a}`))})]})]}),l.length===0?e.jsx("p",{className:"text-muted",children:"No new hires found."}):e.jsx(V,{children:l.map((s,a)=>e.jsxs(q,{className:`mb-2 ${s.registered?"border-success":""}`,children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`me-3 p-2 rounded-circle 
                      ${s.registered?"bg-success text-white":"bg-light"}`,children:e.jsx(r,{icon:s.registered?k:z,size:"lg"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:s.firstName?`${s.firstName} ${s.lastName}`:s.name||`New Hire #${a+1}`}),e.jsxs("div",{className:"text-muted small",children:[e.jsx(r,{icon:B,className:"me-1"}),s.email]})]})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(x,{color:s.registered?"success":"info",className:"me-3 px-3 py-2",children:s.registered?"Registered":"Pending Registration"}),e.jsx(S,{color:s.registered?"success":"primary",variant:"outline",size:"sm",onClick:()=>F(a),className:"d-flex align-items-center",children:N[a]?e.jsxs(e.Fragment,{children:["Hide Details",e.jsx(r,{icon:J,className:"ms-1"})]}):e.jsxs(e.Fragment,{children:["View Details",e.jsx(r,{icon:_,className:"ms-1"})]})})]})]}),e.jsx(K,{visible:N[a],children:e.jsx("div",{className:"mt-3 p-3 bg-light rounded",children:e.jsxs(Q,{children:[e.jsxs(E,{md:6,children:[s.governmentIds&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Government IDs:"}),e.jsx("div",{children:JSON.stringify(s.governmentIds)})]}),s._id&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"ID:"}),e.jsx("div",{children:s._id})]}),s.employeeId&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Employee ID:"}),e.jsx("div",{children:s.employeeId})]}),s.firstName&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"First Name:"}),e.jsx("div",{children:s.firstName})]}),s.lastName&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Last Name:"}),e.jsx("div",{children:s.lastName})]}),s.middleName&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Middle Name:"}),e.jsx("div",{children:s.middleName})]}),s.position&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Position (Role):"}),e.jsx("div",{children:s.position})]})]}),e.jsxs(E,{md:6,children:[s.department&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Department:"}),e.jsx("div",{children:s.department})]}),s.employmentStatus&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Employment Status:"}),e.jsx("div",{children:s.employmentStatus})]}),s.dateHired&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Date Hired:"}),e.jsx("div",{children:s.dateHired})]}),s.email&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Email:"}),e.jsx("div",{children:s.email})]}),s.phoneNumber&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Phone Number:"}),e.jsx("div",{children:s.phoneNumber})]}),s.address&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Address:"}),e.jsx("div",{children:s.address})]}),s.registered&&e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Registration Status:"}),e.jsx("div",{className:"text-success fw-bold",children:"Registered"}),s.generatedPassword&&e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"fw-bold text-muted",children:"Generated Password:"}),e.jsx("div",{className:"bg-white p-2 rounded border",children:e.jsx("code",{children:s.generatedPassword})})]})]})]})]})})})]},a))})]})]})}export{ae as default};
