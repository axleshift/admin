import{r as a,u as T,j as e,C as u}from"./index-BizKBI6a.js";import{a as l}from"./axiosInstance-CnxFScdD.js";import{C as U,a as F,b as C}from"./index.esm-LX8wyrY9.js";import{C as V}from"./CAlert-CUEFZV7O.js";import{C as g,a as b}from"./CCardBody-cs6hLwSm.js";import{C as S}from"./CCardHeader-CPTDb0Yp.js";import{a as h,b as W,C as X}from"./CFormInput-BYAzJEzi.js";import{C as Y}from"./CForm-tPETyldd.js";import{C as v,a as E}from"./CListGroupItem-KEqkBqgX.js";import"./index-D8rVyQy1.js";import"./CCloseButton-CGgGdGd-.js";const ie=()=>{const[f,D]=a.useState(""),[L,B]=a.useState([]),[c,$]=a.useState(null),[z,x]=a.useState([]),[o,A]=a.useState(null),[G,p]=a.useState([]),[j,w]=a.useState(null),[i,r]=a.useState(!1),[I,R]=a.useState(!1),[P,t]=a.useState(""),[k,N]=a.useState(!1),H=T();a.useEffect(()=>{const s=localStorage.getItem("backupDirectory");s&&(D(s),r(!0),l.post("/admin/set-directory",{directory:s}).then(()=>{N(!0),y()}).catch(()=>t("Could not restore saved directory. Please set it manually.")).finally(()=>r(!1)))},[]),a.useEffect(()=>{k&&y()},[k]),a.useEffect(()=>{c?q(c):x([])},[c]),a.useEffect(()=>{o?J(c,o):p([])},[o,c]);const y=async()=>{r(!0),t("");try{const s=await l.get("/admin/list-backups");B(s.data.backups||[])}catch{t("Error fetching backups"),B([])}finally{r(!1)}},q=async s=>{var d,m;if(s){r(!0),t("");try{const n=await l.get(`/admin/list-collections/${s.name}`);n.data.databases?x(n.data.databases):(x([]),t("No databases found in this backup."))}catch(n){console.error("Error fetching databases:",n),t(((m=(d=n==null?void 0:n.response)==null?void 0:d.data)==null?void 0:m.message)||"Error fetching databases"),x([])}finally{r(!1)}}},J=async(s,d)=>{if(!s||!d){p([]);return}r(!0),t("");try{const m=await l.get(`/admin/list-collections/${s.name}?databaseName=${d}`);p(m.data.collections||[])}catch{t("Error fetching collections"),p([])}finally{r(!1)}},K=async()=>{if(!f){t("Please enter a directory.");return}r(!0),t("");try{await l.post("/admin/set-directory",{directory:f}),localStorage.setItem("backupDirectory",f),N(!0),y()}catch{t("Error setting directory"),N(!1)}finally{r(!1)}},M=async()=>{R(!0),t("");try{await l.post("/admin/backup"),y()}catch{t("Error during backup")}finally{R(!1)}},O=async()=>{if(!c||!o||!j){t("Please select a backup, database, and collection.");return}r(!0),t("");try{await l.post("/admin/restore",{timestamp:c.name,filename:j,databaseName:o}),alert("Restore successful!")}catch{t("Restore failed.")}finally{r(!1)}},Q=async()=>{H("/cron")};return e.jsxs(U,{children:[P&&e.jsx(V,{color:"danger",className:"mt-3",children:P}),e.jsx(F,{className:"mb-4 mt-3",children:e.jsx(C,{children:e.jsxs(g,{children:[e.jsxs(S,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:"Backup Configuration"}),e.jsx(h,{className:"ms-auto",color:"primary",onClick:Q,children:"Schedule Backup"})]}),e.jsxs(b,{children:[e.jsxs(Y,{children:[e.jsx(W,{children:"Set Backup Directory"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(X,{type:"text",placeholder:"Enter directory path",value:f,onChange:s=>D(s.target.value)}),e.jsx(h,{className:"ms-2",onClick:K,disabled:i,children:i?e.jsx(u,{size:"sm"}):"Set Directory"})]})]}),e.jsx(h,{color:"primary",className:"mt-3",onClick:M,disabled:!k||I,children:I?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:"sm"})," Creating Backup..."]}):"Create New Backup"})]})]})})}),e.jsxs(F,{children:[e.jsx(C,{md:"4",children:e.jsxs(g,{children:[e.jsx(S,{children:"Available Backups"}),e.jsx(b,{children:i?e.jsx(u,{}):e.jsx(v,{children:L.map(s=>e.jsx(E,{active:(c==null?void 0:c.name)===s.name,onClick:()=>$(s),style:{cursor:"pointer"},children:s.name},s.name))})})]})}),e.jsx(C,{md:"4",children:e.jsxs(g,{children:[e.jsx(S,{children:"Select Database"}),e.jsx(b,{children:i?e.jsx(u,{}):e.jsx(v,{children:z.map(s=>e.jsx(E,{active:o===s,onClick:()=>A(s),style:{cursor:"pointer"},children:s},s))})})]})}),e.jsx(C,{md:"4",children:e.jsxs(g,{children:[e.jsx(S,{children:"Select Collection"}),e.jsx(b,{children:i?e.jsx(u,{}):e.jsx(e.Fragment,{children:j?e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{children:"Selected Collection:"}),e.jsx("div",{className:"p-3 bg-light border rounded",children:j}),e.jsxs("div",{className:"d-flex mt-3",children:[e.jsx(h,{color:"warning",className:"me-2",onClick:O,children:"Restore"}),e.jsx(h,{color:"secondary",onClick:()=>w(null),children:"Change Collection"})]})]}):e.jsx(v,{children:G.map(s=>e.jsx(E,{onClick:()=>w(s),style:{cursor:"pointer"},children:s},s))})})})]})})]})]})};export{ie as default};
