import{j as e}from"./index-Bb-Hm6Ev.js";import{r as o,R as z}from"./vendor-react-BHxUanFt.js";import{a as R}from"./axiosInstance-Bq-uIJjs.js";import{F as n,an as V,H as $,h as G,C as D,q as M,Z as Q,A,ao as W,ap as Z,G as f,n as J,aq as b}from"./index-a-IrBYvB.js";import{a as K,b as O,d as S,n as I,l as w,e as T,g as k,m as X,w as B,x as E,y as m,z as t,A as F,B as r,a8 as Y,V as ee,W as p,p as se}from"./vendor-coreui-T9QyU9K3.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const ae=async x=>{try{await R.post("/activity/log",x)}catch(l){console.warn("Failed to log activity:",l)}},de=()=>{const[x,l]=o.useState([]),[j,C]=o.useState(!0),[y,h]=o.useState(null),[N,U]=o.useState({}),[i,q]=o.useState({currentPage:1,totalPages:1,totalItems:0,hasNext:!1,hasPrev:!1}),P=localStorage.getItem("role"),v=localStorage.getItem("department");localStorage.getItem("userId");const g=localStorage.getItem("name"),_=s=>{U(a=>({...a,[s]:!a[s]}))},d=async(s=1)=>{C(!0);try{const a=await R.get(`/logistics/procurement?page=${s}&limit=10`);if(a.data&&a.data.success&&a.data.data){const{procurements:c,pagination:L}=a.data.data;Array.isArray(c)?(l(c),q(L||{currentPage:1,totalPages:1,totalItems:c.length,hasNext:!1,hasPrev:!1}),h(null)):(l([]),h("Invalid data format: Procurements is not an array"),console.error("Invalid procurements data:",a.data))}else l([]),h("Invalid response format from server"),console.error("Invalid response format:",a.data)}catch(a){h("Error fetching procurement data"),console.error("Procurement data fetch error:",a)}finally{C(!1)}};o.useEffect(()=>{d(),g&&ae({name:g,role:P,department:v,route:"/procurement",action:"View Procurement Page",description:"User viewed the procurement management page"}).catch(console.warn)},[g,P,v]);const H=s=>{const a={Pending:{color:"warning",icon:f},Approved:{color:"success",icon:b},"In Progress":{color:"info",icon:f},Completed:{color:"success",icon:b},Cancelled:{color:"danger",icon:J},default:{color:"secondary",icon:f}},c=a[s]||a.default;return e.jsxs(se,{color:c.color,className:"px-2 py-1",children:[e.jsx(n,{icon:c.icon,className:"me-1"})," ",s]})},u=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return e.jsx(K,{children:e.jsx(O,{xs:12,children:e.jsxs(S,{className:"mb-4",children:[e.jsxs(I,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(n,{icon:V,className:"me-2"}),e.jsx("strong",{children:"Procurement Management"})]}),e.jsxs(w,{color:"outline-primary",size:"sm",onClick:()=>d(i.currentPage),disabled:j,children:[e.jsx(n,{icon:$,className:j?"fa-spin me-1":"me-1"}),"Refresh"]})]}),e.jsxs(T,{children:[y&&e.jsxs(k,{color:"danger",children:[e.jsx(n,{icon:G,className:"me-2"}),y]}),j?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(X,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading procurement data..."})]}):e.jsx(e.Fragment,{children:x.length===0?e.jsx(k,{color:"info",children:"No procurement records found"}):e.jsxs(e.Fragment,{children:[e.jsxs(B,{hover:!0,responsive:!0,striped:!0,className:"border",children:[e.jsx(E,{color:"light",children:e.jsxs(m,{children:[e.jsx(t,{scope:"col",children:"Title"}),e.jsx(t,{scope:"col",children:"Description"}),e.jsxs(t,{scope:"col",children:[e.jsx(n,{icon:D,className:"me-1"})," Procurement Date"]}),e.jsxs(t,{scope:"col",children:[e.jsx(n,{icon:M,className:"me-1"})," Department"]}),e.jsx(t,{scope:"col",children:"Status"}),e.jsxs(t,{scope:"col",children:[e.jsx(n,{icon:Q,className:"me-1"})," Est. Cost"]}),e.jsxs(t,{scope:"col",children:[e.jsx(n,{icon:D,className:"me-1"})," Delivery Date"]}),e.jsx(t,{scope:"col",children:"Products"})]})}),e.jsx(F,{children:x.map(s=>e.jsxs(z.Fragment,{children:[e.jsxs(m,{children:[e.jsx(r,{children:s.title}),e.jsx(r,{children:s.description&&s.description.length>50?`${s.description.substring(0,50)}...`:s.description||"No description"}),e.jsx(r,{children:s.procurementDate?new Date(s.procurementDate).toLocaleDateString():"N/A"}),e.jsx(r,{children:s.department||"N/A"}),e.jsx(r,{children:H(s.status)}),e.jsx(r,{children:s.estimatedCost!==void 0?u(s.estimatedCost):"N/A"}),e.jsx(r,{children:s.deliveryDate?new Date(s.deliveryDate).toLocaleDateString():"N/A"}),e.jsx(r,{children:s.products&&Array.isArray(s.products)?e.jsxs(w,{color:"link",size:"sm",onClick:()=>_(s._id),children:[e.jsx(n,{icon:A,className:"me-1"}),s.products.length," Items",e.jsx(n,{icon:N[s._id]?W:Z,className:"ms-1"})]}):"No products"})]}),s.products&&Array.isArray(s.products)&&e.jsx(m,{children:e.jsx(r,{colSpan:"8",className:"p-0",children:e.jsx(Y,{visible:N[s._id],children:e.jsxs(S,{className:"m-3 border-0",children:[e.jsxs(I,{children:[e.jsx(n,{icon:A,className:"me-2"}),"Product Details"]}),e.jsx(T,{children:e.jsxs(B,{small:!0,borderless:!0,children:[e.jsx(E,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Quantity"}),e.jsx(t,{children:"Unit"}),e.jsx(t,{children:"Unit Price"}),e.jsx(t,{children:"Total"})]})}),e.jsx(F,{children:s.products.map(a=>e.jsxs(m,{children:[e.jsx(r,{children:a.name||"N/A"}),e.jsx(r,{children:a.quantity||0}),e.jsx(r,{children:a.unit||"N/A"}),e.jsx(r,{children:a.unitPrice!==void 0?u(a.unitPrice):"N/A"}),e.jsx(r,{children:a.quantity&&a.unitPrice!==void 0?u(a.quantity*a.unitPrice):"N/A"})]},a._id))})]})})]})})})})]},s._id))})]}),i.totalPages>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(ee,{children:[e.jsx(p,{disabled:!i.hasPrev,onClick:()=>d(i.currentPage-1),children:"Previous"}),[...Array(i.totalPages).keys()].map(s=>e.jsx(p,{active:s+1===i.currentPage,onClick:()=>d(s+1),children:s+1},s+1)),e.jsx(p,{disabled:!i.hasNext,onClick:()=>d(i.currentPage+1),children:"Next"})]})})]})})]})]})})})};export{de as default};
