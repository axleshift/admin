import{j as e}from"./index-C_p2WIB1.js";import{u as V,r as n}from"./vendor-react-P0hRR2W0.js";import{S as d}from"./statbox-CEb_unYd.js";import{C as X}from"./customhead-DYRIXJjq.js";import Z from"./monthchart-CAOGwhpk.js";import{F as m,w as _,y as M,B as ee,u as te,C as se}from"./index-D0KVb9r2.js";import{a as u}from"./axiosInstance-Bq-uIJjs.js";import{l as ae}from"./activityLogger-D6Lc4RsL.js";import ne from"./invoicelist-AC8fHn8S.js";import{C as oe,a as f,b as o,d as Y}from"./vendor-coreui-pds89uUO.js";import"./vendor-redux-BXoDUiID.js";import"./generateCategoricalChart-Cfl7J4DB.js";import"./LineChart-CPohoAyb.js";import"./index-xsH4HHeE.js";/* empty css                */const Le=()=>{var N,I;V();const[re,A]=n.useState(window.innerWidth>768),[s,j]=n.useState(null),[a,z]=n.useState(null),[v,U]=n.useState(null),[ce,p]=n.useState(!0),[B,y]=n.useState(!0),[w,h]=n.useState(null),[le,ie]=n.useState(!1),[W,F]=n.useState(!0),[D,T]=n.useState([]),[k,H]=n.useState([]),C=localStorage.getItem("name"),P=localStorage.getItem("role"),q=localStorage.getItem("department");localStorage.getItem("username"),ae({name:C,role:P,department:q,route:"Finance Dashboard",action:"Navigate",description:`${C} Navigate to Finance Dashboard`}).catch(console.warn),n.useEffect(()=>{const c=()=>A(window.innerWidth>768);return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),n.useEffect(()=>{const c=async()=>{try{p(!0);const t=await u.get("/finance/monthlysalesrevenue");if(t.data&&Array.isArray(t.data)&&t.data.length>0){const i=new Date,S=i.toLocaleString("en-US",{month:"long"}),J=i.getFullYear(),b=t.data.find(r=>r.month===S&&r.year===J),x=new Date(i);x.setMonth(x.getMonth()-1);const K=x.toLocaleString("en-US",{month:"long"}),O=x.getFullYear(),$=t.data.find(r=>r.month===K&&r.year===O);if(b)j(b);else{const r=[...t.data].sort((R,E)=>{const Q=new Date(`${R.month} 1, ${R.year}`);return new Date(`${E.month} 1, ${E.year}`)-Q});j(r[0]),console.log("Current month data not found, using most recent:",r[0])}$&&z($)}p(!1)}catch(t){console.error("Failed to fetch dashboard data:",t),h(t.message||"An error occurred while fetching data"),p(!1)}},l=async()=>{try{y(!0);const t=await u.get("/finance/yearlysalesrevenue");t.data&&U(t.data),y(!1)}catch(t){console.error("Failed to fetch yearly data:",t),h(t.message||"An error occurred while fetching yearly data"),y(!1)}},L=async()=>{try{const i=(await u.get("/hr/worker")).data.filter(S=>S.department==="Finance");H(i)}catch(t){h(t.message||"Failed to fetch Finance department users"),console.error("Error fetching Finance users:",t)}};(async()=>{try{const t=await u.get("/finance/invoice");t.data&&T(t.data),F(!1)}catch(t){console.error("Failed to fetch invoice data:",t),h(t.message||"An error occurred while fetching invoice data"),F(!1)}})(),c(),l(),L()},[]);const g=(c,l)=>!l||l===0?"0":((c-l)/l*100).toFixed(1),G=new Date().getFullYear();return e.jsxs(oe,{fluid:!0,className:"p-3",children:[e.jsx(f,{children:e.jsx(o,{children:e.jsx(X,{title:"Finance Dashboard",subtitle:"Welcome to the Finance Dashboard"})})}),e.jsxs(f,{className:"mb-4",children:[e.jsx(o,{xs:12,md:6,children:e.jsxs(f,{className:"h-100",children:[e.jsx(o,{xs:12,md:6,className:"mb-3",children:e.jsx(d,{title:"Finance Department Employees",value:k.length,icon:e.jsx(m,{icon:_,style:{fontSize:"20px",color:"#0d6efd"}}),description:"Total Finance personnel"})}),e.jsx(o,{xs:12,md:6,className:"mb-3",children:e.jsx(d,{title:`Current Sales (${(s==null?void 0:s.month)||"Loading..."})`,value:((N=s==null?void 0:s.totalSales)==null?void 0:N.toLocaleString())||0,increase:a?`${g((s==null?void 0:s.totalSales)||0,(a==null?void 0:a.totalSales)||0)>0?"+":""}${g((s==null?void 0:s.totalSales)||0,(a==null?void 0:a.totalSales)||0)}%`:"0",icon:e.jsx(m,{icon:M,style:{fontSize:"20px",color:"#0d6efd"}})})}),e.jsx(o,{xs:12,md:6,className:"mb-3",children:e.jsx(d,{title:`Current Revenue (${(s==null?void 0:s.month)||"Loading..."})`,value:`$${((I=s==null?void 0:s.totalRevenue)==null?void 0:I.toLocaleString())||0}`,increase:a?`${g((s==null?void 0:s.totalRevenue)||0,(a==null?void 0:a.totalRevenue)||0)>0?"+":""}${g((s==null?void 0:s.totalRevenue)||0,(a==null?void 0:a.totalRevenue)||0)}%`:"0",icon:e.jsx(m,{icon:ee,style:{fontSize:"20px",color:"#198754"}})})}),e.jsx(o,{xs:12,md:6,className:"mb-3",children:e.jsx(d,{title:"Total Invoices",value:D.length,description:"Total invoices generated",icon:e.jsx(m,{icon:te,style:{fontSize:"20px",color:"#dc3545"}}),loading:W})}),e.jsx(o,{xs:12,className:"mb-3",children:e.jsx(d,{title:`Yearly Sales (${G})`,value:v?v.totalSales.toLocaleString():"Loading...",description:"Annual performance",icon:e.jsx(m,{icon:se,style:{fontSize:"20px",color:"#dc3545"}}),loading:B})})]})}),e.jsx(o,{xs:12,md:6,children:e.jsx(Y,{className:"h-100",children:e.jsx("div",{className:"p-3 h-100",children:e.jsx(ne,{})})})})]}),e.jsx(f,{children:e.jsx(o,{xs:12,children:e.jsx(Y,{className:"mb-4",children:e.jsx("div",{className:"p-3",children:e.jsx(Z,{})})})})}),w&&e.jsx(f,{className:"my-3",children:e.jsx(o,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:w})})})]})};export{Le as default};
