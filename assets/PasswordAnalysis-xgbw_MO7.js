import{j as s}from"./index-Creopves.js";import{r as h,i as ys,R as Cs}from"./vendor-react-B6URQkMn.js";import{a as As}from"./axiosInstance-z6yTqPqm.js";import{F as r,w as cs,$ as Ss,E as vs,U as Ps,a0 as ns,A as ds,f as Rs,a1 as Fs,a2 as E,a3 as Ds,a4 as ks,a5 as Es,a6 as Ts}from"./index-BSUr8F9F.js";import{g as Ms,S as F,T as u,o as w,$ as os,p as y,Z as T,_ as ts,n as g,W as Hs,d as zs,a1 as M,a2 as H,a3 as b,a4 as d,a5 as z,a6 as n,D as _,a0 as D,ab as _s,ac as Us,ad as C,x as Is,y as Ls,a8 as Bs,z as Vs,A as $s}from"./vendor-coreui-C9cgcUrA.js";import"./vendor-redux-DipIbRRz.js";function Gs(){var W,Z,q,K,Y,G,J,Q,X,ss,as;const[U,I]=h.useState([]),[hs,L]=h.useState(!0),[B,V]=h.useState(""),[o,x]=h.useState(1),[j,ms]=h.useState(1),[A,xs]=h.useState(10),[N,$]=h.useState({dateFrom:"",dateTo:"",strengthLevel:"",searchTerm:""}),[e,js]=h.useState(null),[ps,S]=h.useState(!1),[k,O]=h.useState({});ys(),h.useEffect(()=>{us()},[o,A,N]);const us=async()=>{var a,l;L(!0),V("");try{const i=new URLSearchParams({page:o,limit:A,...Object.fromEntries(Object.entries(N).filter(([t,R])=>R!==""))}),m=await As.get(`/security/password-reset-analysis?${i}`);I(m.data.data||[]),ms(m.data.totalPages||1);const p={};m.data.data.forEach(t=>{t._id&&(p[t._id]=!1)}),O(t=>({...t,...p}))}catch(i){console.error("Error fetching password reset events:",i),V(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.Message)||"Failed to load password reset analysis data"),I([])}finally{L(!1)}},v=a=>a?new Date(a).toLocaleString():"N/A",f=a=>a<40?"danger":a<60?"warning":a<80?"info":"success",Ns=a=>{js(a),S(!0)},P=(a,l)=>{$({...N,[a]:l}),x(1)},gs=a=>{a.preventDefault()},bs=()=>{$({dateFrom:"",dateTo:"",strengthLevel:"",searchTerm:""}),x(1)},fs=a=>{O(l=>({...l,[a]:!l[a]}))};return s.jsxs(Ms,{fluid:!0,className:"px-4",children:[s.jsx(F,{className:"mb-3",children:s.jsxs(u,{children:[s.jsxs("h2",{className:"mb-3 mt-4",children:[s.jsx(r,{icon:cs,className:"me-2 text-primary"}),"Password Reset Analysis Dashboard"]}),s.jsx("p",{className:"text-muted",children:"Monitor and analyze password reset events and security levels across the system"})]})}),s.jsxs(w,{className:"mb-4 shadow-sm",children:[s.jsxs(os,{children:[s.jsx(r,{icon:Ss,className:"me-2"}),"Filters & Search"]}),s.jsx(y,{children:s.jsxs("form",{onSubmit:gs,children:[s.jsxs(F,{className:"g-3",children:[s.jsx(u,{md:3,children:s.jsx(T,{type:"date",label:"From Date",value:N.dateFrom,onChange:a=>P("dateFrom",a.target.value)})}),s.jsx(u,{md:3,children:s.jsx(T,{type:"date",label:"To Date",value:N.dateTo,onChange:a=>P("dateTo",a.target.value)})}),s.jsx(u,{md:3,children:s.jsxs(ts,{label:"Password Strength",value:N.strengthLevel,onChange:a=>P("strengthLevel",a.target.value),children:[s.jsx("option",{value:"",children:"All Strength Levels"}),s.jsx("option",{value:"Weak",children:"Weak"}),s.jsx("option",{value:"Moderate",children:"Moderate"}),s.jsx("option",{value:"Strong",children:"Strong"}),s.jsx("option",{value:"Very Strong",children:"Very Strong"})]})}),s.jsx(u,{md:3,children:s.jsx(T,{type:"text",label:"Search User",placeholder:"Name or Email",value:N.searchTerm,onChange:a=>P("searchTerm",a.target.value)})})]}),s.jsx(F,{className:"mt-3",children:s.jsxs(u,{className:"d-flex justify-content-end",children:[s.jsx(g,{color:"secondary",variant:"outline",className:"me-2",onClick:bs,children:"Reset Filters"}),s.jsxs(g,{type:"submit",color:"primary",children:[s.jsx(r,{icon:vs,className:"me-2"}),"Search"]})]})})]})})]}),B&&s.jsxs(Hs,{color:"danger",className:"mb-4",children:[s.jsx(r,{icon:Ps,className:"me-2"}),B]}),s.jsxs(w,{className:"mb-4 shadow-sm",children:[s.jsxs(os,{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("div",{children:[s.jsx(r,{icon:ns,className:"me-2"}),"Password Reset Events"]}),s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("span",{className:"me-2",children:"Show:"}),s.jsxs(ts,{size:"sm",className:"me-3",style:{width:"80px"},value:A,onChange:a=>{xs(Number(a.target.value)),x(1)},children:[s.jsx("option",{value:"5",children:"5"}),s.jsx("option",{value:"10",children:"10"}),s.jsx("option",{value:"25",children:"25"}),s.jsx("option",{value:"50",children:"50"})]})]})]}),s.jsx(y,{children:hs?s.jsxs("div",{className:"text-center py-5",children:[s.jsx(zs,{color:"primary"}),s.jsx("p",{className:"mt-3 text-muted",children:"Loading password reset data..."})]}):U.length===0?s.jsxs("div",{className:"text-center py-5",children:[s.jsx(r,{icon:ds,size:"2x",className:"text-muted mb-3"}),s.jsx("p",{className:"text-muted",children:"No password reset events found"})]}):s.jsxs(s.Fragment,{children:[s.jsxs(M,{responsive:!0,hover:!0,align:"middle",className:"mb-0",children:[s.jsx(H,{children:s.jsxs(b,{className:"bg-light",children:[s.jsx(d,{style:{width:"5%"},children:"#"}),s.jsxs(d,{style:{width:"20%"},children:[s.jsx(r,{icon:Rs,className:"me-2"}),"User"]}),s.jsxs(d,{style:{width:"15%"},children:[s.jsx(r,{icon:Fs,className:"me-2"}),"Reset Date"]}),s.jsxs(d,{style:{width:"30%"},children:[s.jsx(r,{icon:ns,className:"me-2"}),"Password Strength"]}),s.jsx(d,{style:{width:"15%"},children:"Status"}),s.jsx(d,{style:{width:"15%"},children:"Actions"})]})}),s.jsx(z,{children:U.map((a,l)=>{var i,m,p,t,R,es;return s.jsxs(Cs.Fragment,{children:[s.jsxs(b,{children:[s.jsx(n,{children:(o-1)*A+l+1}),s.jsx(n,{children:s.jsxs("div",{className:"d-flex flex-column",children:[s.jsx("span",{className:"fw-bold",children:((i=a==null?void 0:a.user)==null?void 0:i.name)||"Unknown"}),s.jsx("span",{className:"small text-muted",children:((m=a==null?void 0:a.user)==null?void 0:m.email)||"No email"}),(a==null?void 0:a.previousResets)&&a.previousResets.length>0&&s.jsx("div",{className:"mt-1",children:s.jsxs(g,{color:"link",size:"sm",className:"p-0",onClick:()=>fs(a._id),children:[s.jsx(r,{icon:E,className:"me-1"}),k[a._id]?"Hide":"Show"," History",s.jsx(r,{icon:k[a._id]?Ds:ks,className:"ms-1",size:"xs"}),s.jsx(_,{color:"light",shape:"rounded-pill",className:"ms-2",children:a.previousResets.length})]})})]})}),s.jsx(n,{children:v(a==null?void 0:a.timestamp)}),s.jsx(n,{children:s.jsxs("div",{className:"d-flex flex-column",children:[s.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[s.jsx("span",{children:((p=a==null?void 0:a.passwordAnalysis)==null?void 0:p.strength)||"N/A"}),s.jsxs("span",{className:"fw-bold",children:[((t=a==null?void 0:a.passwordAnalysis)==null?void 0:t.score)||0,"/100"]})]}),s.jsx(D,{thin:!0,value:((R=a==null?void 0:a.passwordAnalysis)==null?void 0:R.score)||0,color:f(((es=a==null?void 0:a.passwordAnalysis)==null?void 0:es.score)||0)})]})}),s.jsx(n,{children:a!=null&&a.validationPassed?s.jsx(g,{color:"success",variant:"outline",size:"sm",className:"px-3",disabled:!0,children:"Success"}):s.jsx(g,{color:"danger",variant:"outline",size:"sm",className:"px-3",disabled:!0,children:"Failed"})}),s.jsx(n,{children:s.jsxs(g,{color:"primary",variant:"ghost",size:"sm",onClick:()=>Ns(a),children:[s.jsx(r,{icon:Es,className:"me-1"}),"Details"]})})]}),(a==null?void 0:a.previousResets)&&a.previousResets.length>0&&s.jsx(b,{children:s.jsx(n,{colSpan:"6",className:"p-0 border-0",children:s.jsx(_s,{visible:k[a._id],children:s.jsxs("div",{className:"bg-light p-3",children:[s.jsxs("h6",{className:"mb-3",children:[s.jsx(r,{icon:E,className:"me-2 text-primary"}),"Password Reset History"]}),s.jsxs(M,{small:!0,hover:!0,responsive:!0,className:"mb-0",children:[s.jsx(H,{children:s.jsxs(b,{className:"bg-white",children:[s.jsx(d,{children:"Date"}),s.jsx(d,{children:"Strength"}),s.jsx(d,{children:"Status"}),s.jsx(d,{children:"IP Address"})]})}),s.jsx(z,{children:a.previousResets.map((c,ws)=>{var ls,is,rs;return s.jsxs(b,{children:[s.jsx(n,{children:v(c.timestamp)}),s.jsx(n,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{style:{width:"80px"},children:s.jsx(D,{thin:!0,value:((ls=c==null?void 0:c.passwordAnalysis)==null?void 0:ls.score)||0,color:f(((is=c==null?void 0:c.passwordAnalysis)==null?void 0:is.score)||0)})}),s.jsxs("span",{className:"ms-2 small",children:[((rs=c==null?void 0:c.passwordAnalysis)==null?void 0:rs.score)||0,"/100"]})]})}),s.jsx(n,{children:c!=null&&c.validationPassed?s.jsx(_,{color:"success",shape:"rounded-pill",children:"Success"}):s.jsx(_,{color:"danger",shape:"rounded-pill",children:"Failed"})}),s.jsxs(n,{children:[s.jsx(r,{icon:Ts,className:"me-1 text-muted"}),(c==null?void 0:c.ipAddress)||"N/A"]})]},ws)})})]})]})})})})]},(a==null?void 0:a._id)||l)})})]}),s.jsxs(Us,{align:"center",className:"mt-4",children:[s.jsx(C,{disabled:o===1,onClick:()=>x(1),children:"First"}),s.jsx(C,{disabled:o===1,onClick:()=>x(a=>Math.max(a-1,1)),children:"Previous"}),[...Array(Math.min(5,j))].map((a,l)=>{let i;return j<=5||o<=3?i=l+1:o>=j-2?i=j-4+l:i=o-2+l,s.jsx(C,{active:i===o,onClick:()=>x(i),children:i},i)}),s.jsx(C,{disabled:o===j,onClick:()=>x(a=>Math.min(a+1,j)),children:"Next"}),s.jsx(C,{disabled:o===j,onClick:()=>x(j),children:"Last"})]})]})})]}),s.jsxs(Is,{visible:ps,onClose:()=>S(!1),size:"lg",children:[s.jsx(Ls,{onClose:()=>S(!1),children:s.jsxs(Bs,{children:[s.jsx(r,{icon:cs,className:"me-2 text-primary"}),"Password Reset Details"]})}),s.jsx(Vs,{children:e&&s.jsxs(s.Fragment,{children:[s.jsxs(F,{className:"mb-4",children:[s.jsxs(u,{md:6,children:[s.jsx("h5",{children:"User Information"}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Name:"})," ",((W=e.user)==null?void 0:W.name)||"Unknown"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Email:"})," ",((Z=e.user)==null?void 0:Z.email)||"No email"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Department:"})," ",((q=e.user)==null?void 0:q.department)||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Role:"})," ",((K=e.user)==null?void 0:K.role)||"User"]})]}),s.jsxs(u,{md:6,children:[s.jsx("h5",{children:"Event Information"}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Event ID:"})," ",e._id||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Timestamp:"})," ",v(e.timestamp)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"IP Address:"})," ",e.ipAddress||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Status:"})," ",e.validationPassed?"Success":"Failed"]})]})]}),s.jsx("h5",{className:"mb-3",children:"Password Analysis"}),s.jsx(w,{className:"mb-4 border",children:s.jsxs(y,{children:[s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[s.jsx("span",{className:"fw-bold",children:"Strength Rating:"}),s.jsx("span",{className:`text-${f(((Y=e.passwordAnalysis)==null?void 0:Y.score)||0)}`,children:((G=e.passwordAnalysis)==null?void 0:G.strength)||"N/A"})]}),s.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[s.jsx("span",{className:"fw-bold",children:"Score:"}),s.jsxs("span",{children:[((J=e.passwordAnalysis)==null?void 0:J.score)||0,"/100"]})]}),s.jsx(D,{className:"mb-3",value:((Q=e.passwordAnalysis)==null?void 0:Q.score)||0,color:f(((X=e.passwordAnalysis)==null?void 0:X.score)||0)})]}),((ss=e.passwordAnalysis)==null?void 0:ss.feedback)&&e.passwordAnalysis.feedback.length>0&&s.jsxs("div",{className:"mb-3",children:[s.jsx("h6",{children:"Feedback & Recommendations"}),s.jsx("ul",{className:"list-group list-group-flush",children:e.passwordAnalysis.feedback.map((a,l)=>s.jsxs("li",{className:"list-group-item px-0",children:[s.jsx(r,{icon:ds,className:"me-2 text-primary"}),a]},l))})]}),((as=e.passwordAnalysis)==null?void 0:as.explanation)&&s.jsxs("div",{className:"p-3 bg-light rounded",children:[s.jsx("h6",{children:"Analysis Explanation"}),s.jsx("p",{className:"mb-0",children:e.passwordAnalysis.explanation})]})]})}),e.validationDetails&&s.jsxs("div",{className:"mb-3",children:[s.jsx("h5",{className:"mb-3",children:"Validation Details"}),s.jsx(w,{className:"border",children:s.jsxs(y,{children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Validation Passed:"})," ",e.validationDetails.passed?"Yes":"No"]}),e.validationDetails.message&&s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Message:"})," ",e.validationDetails.message]}),e.validationDetails.checks&&s.jsxs("div",{className:"mt-3",children:[s.jsx("h6",{children:"Validation Checks"}),s.jsx("ul",{className:"list-group list-group-flush",children:Object.entries(e.validationDetails.checks).map(([a,l])=>s.jsxs("li",{className:"list-group-item px-0 d-flex justify-content-between",children:[s.jsx("span",{children:a.replace(/([A-Z])/g," $1").replace(/^./,i=>i.toUpperCase())}),s.jsx("span",{children:l?s.jsx("span",{className:"text-success",children:"Passed"}):s.jsx("span",{className:"text-danger",children:"Failed"})})]},a))})]})]})})]}),e.previousResets&&e.previousResets.length>0&&s.jsxs("div",{className:"mb-3",children:[s.jsxs("h5",{className:"mb-3",children:[s.jsx(r,{icon:E,className:"me-2"}),"Password Reset History"]}),s.jsx(w,{className:"border",children:s.jsx(y,{children:s.jsxs(M,{responsive:!0,small:!0,hover:!0,className:"mb-0",children:[s.jsx(H,{children:s.jsxs(b,{className:"bg-light",children:[s.jsx(d,{children:"Date"}),s.jsx(d,{children:"Password Strength"}),s.jsx(d,{children:"Status"}),s.jsx(d,{children:"IP Address"})]})}),s.jsx(z,{children:e.previousResets.map((a,l)=>{var i,m,p,t;return s.jsxs(b,{children:[s.jsx(n,{children:v(a.timestamp)}),s.jsx(n,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{style:{width:"100px"},children:s.jsx(D,{thin:!0,value:((i=a==null?void 0:a.passwordAnalysis)==null?void 0:i.score)||0,color:f(((m=a==null?void 0:a.passwordAnalysis)==null?void 0:m.score)||0)})}),s.jsxs("span",{className:"ms-2",children:[((p=a==null?void 0:a.passwordAnalysis)==null?void 0:p.strength)||"N/A","(",((t=a==null?void 0:a.passwordAnalysis)==null?void 0:t.score)||0,"/100)"]})]})}),s.jsx(n,{children:a!=null&&a.validationPassed?s.jsx("span",{className:"text-success",children:"Success"}):s.jsx("span",{className:"text-danger",children:"Failed"})}),s.jsx(n,{children:(a==null?void 0:a.ipAddress)||"N/A"})]},a._id||l)})})]})})})]})]})}),s.jsx($s,{children:s.jsx(g,{color:"secondary",onClick:()=>S(!1),children:"Close"})})]})]})}export{Gs as default};
