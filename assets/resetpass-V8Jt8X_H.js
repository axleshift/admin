import{j as e}from"./index-SoqsusEQ.js";import{r as d,i as I,k}from"./vendor-react-B6URQkMn.js";import{a as E}from"./axiosInstance-Dv2jt_v_.js";import{a as R}from"./index-t--hEgTQ.js";import{F as u,x as $,z as j,A as F,B as L}from"./index-awhlclXR.js";import{c as _,N as q,O as M,k as Z,X as B,l as G,R as O,S as C,V as N,C as A,Y as T,j as U}from"./vendor-coreui-DHT2NCDT.js";import"./vendor-redux-DipIbRRz.js";const W="AIzaSyBlGfiToGE4_D_86kpLw_7QSzvaAySDASA",D="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",K=async s=>{try{const t={length:s.length,hasLowercase:/[a-z]/.test(s),hasUppercase:/[A-Z]/.test(s),hasNumbers:/\d/.test(s),hasSymbols:/[^A-Za-z0-9]/.test(s),patterns:{hasRepeatedChars:/(.)\1{2,}/.test(s),hasSequentialNumbers:/(?:012|123|234|345|456|567|678|789)/.test(s),hasKeyboardPatterns:/(?:qwer|asdf|zxcv|wasd)/i.test(s)}},n=`
      As a password security AI, analyze this password's strength based on these features:
      - Length: ${t.length} characters
      - Contains lowercase letters: ${t.hasLowercase}
      - Contains uppercase letters: ${t.hasUppercase}
      - Contains numbers: ${t.hasNumbers}
      - Contains symbols: ${t.hasSymbols}
      - Contains repeated characters: ${t.patterns.hasRepeatedChars}
      - Contains sequential numbers: ${t.patterns.hasSequentialNumbers}
      - Contains keyboard patterns: ${t.patterns.hasKeyboardPatterns}
      
      Provide a JSON response with:
      1. A numerical score from 0-100
      2. A strength classification (Weak, Moderate, Strong, Very Strong)
      3. An array of specific improvement suggestions
      4. A brief explanation of the scoring
      
      Return ONLY valid JSON without any other text.
    `,h=(await R.post(D,{contents:[{parts:[{text:n}]}]},{headers:{"Content-Type":"application/json","x-goog-api-key":W}})).data.candidates[0].content.parts[0].text,o=h.match(/```json\s*([\s\S]*?)\s*```/)||h.match(/\{[\s\S]*\}/),a=o?JSON.parse(o[0].startsWith("{")?o[0]:o[1]):null;if(!a)throw new Error("Failed to parse AI response");return a}catch(t){return console.error("AI Password Analysis Error:",t),J(s)}},J=s=>{let t=0;const n=[];s.length>=8&&(t+=20),s.length>=12&&(t+=10),/[a-z]/.test(s)&&(t+=10),/[A-Z]/.test(s)&&(t+=15),/\d/.test(s)&&(t+=15),/[^A-Za-z0-9]/.test(s)&&(t+=20),/(.)\1{2,}/.test(s)&&(t-=10),s.length<8&&n.push("Use at least 8 characters"),/[a-z]/.test(s)||n.push("Add lowercase letters"),/[A-Z]/.test(s)||n.push("Add uppercase letters"),/\d/.test(s)||n.push("Add numbers"),/[^A-Za-z0-9]/.test(s)||n.push("Add special characters"),/(.)\1{2,}/.test(s)&&n.push("Avoid repeated characters");let c="Weak";return t>=30&&(c="Moderate"),t>=60&&(c="Strong"),t>=80&&(c="Very Strong"),{score:t,strength:c,feedback:n.length>0?n:["Good password!"],explanation:"Basic password analysis (AI fallback)"}};function te(){const[s,t]=d.useState(""),[n,c]=d.useState(""),[h,o]=d.useState(""),[a,f]=d.useState(null),[p,g]=d.useState(!1),[x,y]=d.useState(null),w=I(),{id:S,token:P}=k(),v=(r,i)=>{let l;return(...m)=>{clearTimeout(l),l=setTimeout(()=>{r(...m)},i)}};d.useEffect(()=>{const r=v(async i=>{if(i.length>=4){g(!0),y(null);try{const l=await K(i);f(l)}catch(l){console.error("Password analysis error:",l),y("Could not analyze password strength")}finally{g(!1)}}else f(null)},500);s?r(s):f(null)},[s]);const z=async r=>{var i,l;if(r.preventDefault(),o(""),s!==n){o("Passwords do not match");return}if(a&&a.score<40){o("Please choose a stronger password");return}try{const m=await E.post(`/general/reset-password/${S}/${P}`,{password:s,passwordAnalysis:{score:a==null?void 0:a.score,strength:a==null?void 0:a.strength}});m.data.Status==="Success"?w("/login"):o(m.data.Message||"Password reset failed")}catch(m){console.error("Error:",m),o(((l=(i=m.response)==null?void 0:i.data)==null?void 0:l.message)||"An error occurred")}},b=r=>r<40?"danger":r<60?"warning":r<80?"info":"success";return e.jsx(_,{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:e.jsx(q,{className:"w-100 justify-content-center",children:e.jsx(M,{md:6,lg:4,children:e.jsxs(Z,{className:"shadow-lg border-0",children:[e.jsxs(B,{className:"bg-primary text-white text-center py-3",children:[e.jsx(u,{icon:$,size:"2x",className:"me-2"}),e.jsx("h4",{className:"d-inline align-middle",children:"Reset Password"})]}),e.jsx(G,{className:"p-4",children:e.jsxs(O,{onSubmit:z,children:[h&&e.jsx(C,{color:"danger",className:"mb-3",children:h}),e.jsxs("div",{className:"mb-3",children:[e.jsx(N,{type:"password",placeholder:"New Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(u,{icon:j,className:"me-2"}),"New Password"]}),value:s,onChange:r=>t(r.target.value),required:!0,className:"mb-2",autoComplete:"new-password"}),s.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[e.jsx(u,{icon:F,className:"me-2 text-primary"}),"AI Password Analysis:"]}),p?e.jsx(A,{size:"sm",color:"primary"}):a&&e.jsx("span",{className:`text-${b(a.score)}`,children:a.strength})]}),a&&!p&&e.jsxs(e.Fragment,{children:[e.jsx(T,{value:a.score,color:b(a.score),className:"mb-2"}),e.jsxs("div",{className:"password-feedback mt-2",children:[a.feedback.map((r,i)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(u,{icon:L,className:"me-1"}),r]},i)),a.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:a.explanation})]})]}),x&&e.jsx(C,{color:"warning",className:"py-1 mt-2 mb-0 small",children:x})]}),e.jsx(N,{type:"password",placeholder:"Confirm Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(u,{icon:j,className:"me-2"}),"Confirm Password"]}),value:n,onChange:r=>c(r.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(U,{type:"submit",color:"primary",className:"w-100",disabled:p||a&&a.score<40,children:p?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"sm",component:"span",className:"me-2"}),"Analyzing..."]}):"Update Password"})]})})]})})})})}export{te as default};
