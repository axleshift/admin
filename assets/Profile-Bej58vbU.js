import{J as M,K as T,j as e}from"./index-HAz-9vrD.js";import{r as d}from"./vendor-react-B6URQkMn.js";import{F as B,t as R}from"./DefaultLayout-gKL30h8Z.js";import{M as D,N as v,k as b,a1 as C,j as F,a9 as V,l as S,a5 as g,a6 as h,C as w,y as P,aa as O,ab as x}from"./vendor-coreui-BGyit7oL.js";import"./vendor-redux-DipIbRRz.js";import"./Page500-DCa2HrMo.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-KkVvSLbE.js";import"./index-D8rVyQy1.js";const ee=()=>{const[c,I]=d.useState({name:"",username:"",email:"",role:"",department:"",permissions:[]}),[p,U]=d.useState(!1),[$,z]=d.useState(!0),[n,u]=d.useState(1),o=5,f=sessionStorage.getItem("userId"),{data:k=[],isLoading:A,error:L,refetch:J}=M(void 0,{skip:!p,credentials:"include"}),{data:j,isLoading:E}=T(f,{skip:!f,credentials:"include"});d.useEffect(()=>{const s=sessionStorage.getItem("permissions"),a={name:sessionStorage.getItem("name")||"Unknown Name",username:sessionStorage.getItem("username")||"Unknown Username",email:sessionStorage.getItem("email")||"Unknown Email",role:sessionStorage.getItem("role")||"Unknown Role",department:sessionStorage.getItem("department")||"Unknown Department",permissions:s?JSON.parse(s):[]};I(a)},[]);const y=[...new Set([...c.permissions||[],...(j==null?void 0:j.permissions)||[]])],G=s=>{var a,r,i,t,l,N;return(a=s.action)!=null&&a.includes("/logs/activity")||(r=s.action)!=null&&r.includes("/user-activity")||(i=s.description)!=null&&i.includes("performed POST on")||(t=s.description)!=null&&t.includes("performed GET on")?null:{...s,action:(l=s.action)==null?void 0:l.replace(/^(POST|GET|PUT|DELETE)\s/,"").replace(/^\/api\//,""),description:(N=s.description)==null?void 0:N.replace(/User performed \w+ on /,"")}},m=(k||[]).map(G).filter(s=>s!==null);return e.jsx("div",{className:"profile-container",children:e.jsxs(D,{className:"profile-row",children:[e.jsx(v,{lg:p?6:12,md:12,className:"mb-4",children:e.jsxs(b,{className:"profile-card h-100",children:[e.jsxs(C,{className:"profile-header",children:[e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx(F,{color:"primary",variant:"ghost",className:"activity-toggle-btn",onClick:()=>U(!p),children:e.jsx(B,{icon:R})})}),e.jsxs("div",{className:"text-center profile-avatar-section",children:[e.jsx(V,{color:"primary",textColor:"white",size:"xl",className:"profile-avatar mb-3",children:c.name?c.name[0].toUpperCase():"U"}),e.jsx("h2",{className:"mb-1",children:c.name}),e.jsxs("p",{className:"text-medium-emphasis",children:["@",c.username]})]})]}),e.jsxs(S,{children:[e.jsxs(g,{flush:!0,className:"user-details",children:[e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Email:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.email})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Role:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.role})]}),e.jsxs(h,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:"Department:"}),e.jsx("span",{className:"text-medium-emphasis",children:c.department})]})]}),e.jsxs("div",{className:"permissions-section mt-4",children:[e.jsx("h4",{className:"mb-3",children:"Permissions"}),E?e.jsx(w,{color:"primary",size:"sm"}):y.length>0?e.jsx(g,{children:y.map((s,a)=>e.jsx(h,{className:"permission-item",children:e.jsx(P,{color:"light",className:"permission-badge",children:s})},`permission-${a}`))}):e.jsx("p",{className:"text-medium-emphasis",children:"No permissions assigned"})]})]})]})}),p&&e.jsx(v,{lg:6,md:12,className:"mb-4",children:e.jsxs(b,{className:"activity-card h-100",children:[e.jsx(C,{children:e.jsx("h4",{className:"mb-0",children:"Activity Logs"})}),e.jsx(S,{className:"activity-body",children:e.jsx("div",{className:"activity-scroll-container",children:A?e.jsx("div",{className:"text-center p-4",children:e.jsx(w,{color:"primary"})}):L?e.jsx("div",{className:"error-message",children:"Failed to load activity. Please try again."}):m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(g,{children:m.slice((n-1)*o,n*o).map((s,a)=>e.jsxs(h,{className:"activity-item mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsx(P,{color:"primary",className:"activity-badge",children:s.action}),e.jsx("small",{className:"text-medium-emphasis",children:new Date(s.timestamp).toLocaleString()})]}),e.jsx("p",{className:"mb-0 activity-description",children:s.description})]},`activity-${a}`))}),Math.ceil(m.length/o)>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(O,{"aria-label":"Activity log pagination",children:[e.jsx(x,{"aria-label":"Previous",onClick:()=>u(n-1),disabled:n===1,children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),(()=>{const s=Math.ceil(m.length/o),a=5;let r=[];if(s<=a)r=Array.from({length:s},(i,t)=>t+1);else{r.push(1);let i=Math.max(n-1,2),t=Math.min(n+1,s-1);i===2&&(t=4),t===s-1&&(i=s-3),i>2&&r.push("...");for(let l=i;l<=t;l++)r.push(l);t<s-1&&r.push("..."),r.push(s)}return r.map((i,t)=>i==="..."?e.jsx(x,{disabled:!0,children:"..."},`ellipsis-${t}`):e.jsx(x,{active:n===i,onClick:()=>u(i),children:i},i))})(),e.jsx(x,{"aria-label":"Next",onClick:()=>u(n+1),disabled:n===Math.ceil(m.length/o),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]}):e.jsx("p",{className:"text-center text-medium-emphasis",children:"No activity logs found"})})})]})})]})})};export{ee as default};
