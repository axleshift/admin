import{l as A,m as H,j as s}from"./index-oNzC6x8M.js";import{r as h}from"./vendor-react-B6URQkMn.js";import{F as x,d as B,e as L,g as V,h as M}from"./DefaultLayout-B4epelsf.js";import{l as j}from"./activityLogger-DIotgneL.js";import{M as O,N as _,k as z,a1 as G,l as I,X as J,Y as Q,Z as U,_ as l,$ as W,a0 as i,U as X,j as v,V as N}from"./vendor-coreui-BGyit7oL.js";import"./vendor-redux-DipIbRRz.js";import"./Page500-O2atWjTG.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-pp7a5Fm6.js";import"./index-D8rVyQy1.js";import"./axiosInstance-CnxFScdD.js";const ce=()=>{const{data:u,isLoading:Y,isError:Z,refetch:R}=A(),[S]=H(),[o,k]=h.useState(null),y=["Administrative","Finance","HR","Core","Logistics"],[n,p]=h.useState({}),[d,E]=h.useState({});h.useEffect(()=>{try{const e=localStorage.getItem("currentUser");if(e){const r=JSON.parse(e);k(r),j({name:r.name||"Unknown User",role:r.role||"Unknown Role",department:r.department||"Unknown Department",route:"hr/users",action:"VIEW",description:"Accessed new users registration page"})}}catch(e){console.error("Failed to get current user:",e)}},[]);const D=e=>e==="Finance"?["user","admin","staff","superadmin","technician"]:["admin","manager","superadmin"],F=(e,r)=>{p({...n,[e]:{...n[e],password:r}})},$=e=>{E({...d,[e]:!d[e]})},b=(e,r)=>{p({...n,[e]:{...n[e],department:r,role:""}})},P=(e,r)=>{p({...n,[e]:{...n[e],role:r}})},T=async e=>{const r=n[e.id]||{},c={id:e.id,firstName:e.firstName,lastName:e.lastName,email:e.email,password:r.password||"",role:r.role||"",department:r.department||""};try{const t=await S(c).unwrap();if(console.log("User saved successfully:",t),o){const m=`Registered new user: ${e.firstName} ${e.lastName} (${e.email}) with role: ${r.role} in department: ${r.department}`;j({name:o.name||"Unknown User",role:o.role||"Unknown Role",department:o.department||"Unknown Department",route:"hr/users",action:"CREATE",description:m})}R()}catch(t){console.error("Error saving user:",t),o&&j({name:o.name||"Unknown User",role:o.role||"Unknown Role",department:o.department||"Unknown Department",route:"hr/users",action:"ERROR",description:`Failed to register user: ${e.firstName} ${e.lastName} (${e.email}). Error: ${t.message||"Unknown error"}`}),t.data&&t.data.error&&console.error("Validation error:",t.data.error)}};return s.jsx(O,{children:s.jsx(_,{md:12,children:s.jsxs(z,{children:[s.jsx(G,{children:s.jsxs("h4",{children:[s.jsx(x,{icon:B,className:"me-2"}),"New Users"]})}),s.jsx(I,{children:s.jsxs(J,{hover:!0,responsive:!0,className:"align-middle",children:[s.jsx(Q,{color:"light",children:s.jsxs(U,{children:[s.jsx(l,{children:"First Name"}),s.jsx(l,{children:"Last Name"}),s.jsx(l,{children:"Email"}),s.jsx(l,{children:"Password"}),s.jsx(l,{children:"Department"}),s.jsx(l,{children:"Role"}),s.jsx(l,{children:"Actions"})]})}),s.jsx(W,{children:u&&u.map(e=>{var m,w,g,C,f;const r=e.id||e._id||e.email,c=((m=n[r])==null?void 0:m.department)||"",t=D(c);return s.jsxs(U,{children:[s.jsx(i,{children:e.firstName}),s.jsx(i,{children:e.lastName}),s.jsx(i,{children:e.email}),s.jsx(i,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(X,{type:d[r]?"text":"password",placeholder:"Set password",value:((w=n[r])==null?void 0:w.password)||"",onChange:a=>F(r,a.target.value)}),s.jsx(v,{variant:"ghost",onClick:()=>$(r),className:"ms-2",children:s.jsx(x,{icon:d[r]?L:V})})]})}),s.jsx(i,{children:s.jsxs(N,{value:c,onChange:a=>b(r,a.target.value),children:[s.jsx("option",{value:"",children:"Select Department"}),y.map(a=>s.jsx("option",{value:a,children:a},a))]})}),s.jsx(i,{children:s.jsxs(N,{value:((g=n[r])==null?void 0:g.role)||"",onChange:a=>P(r,a.target.value),disabled:!c,children:[s.jsx("option",{value:"",children:"Select Role"}),t.map(a=>s.jsx("option",{value:a,children:a},a))]})}),s.jsx(i,{children:s.jsxs(v,{color:"primary",size:"sm",onClick:()=>T(e),disabled:!c||!((C=n[r])!=null&&C.role)||!((f=n[r])!=null&&f.password),children:[s.jsx(x,{icon:M,className:"me-2"}),"Save"]})})]},r)})})]})})]})})})};export{ce as default};
