import{j as e}from"./index-BRiklXPP.js";import{r}from"./vendor-react-B6URQkMn.js";import{a as F}from"./axiosInstance-BZJzjIBE.js";import{a as q,b as ee,c as se,g as ae,C as re,o as g,$ as te,s as l,n as h,p as C,d as Z,S as ce,T as b,a1 as le,a2 as ne,a3 as z,a4 as t,a5 as oe,a6 as c,ac as ie,ad as w,x as de,y as me,a8 as he,z as xe,a7 as je,A as ue,D as o}from"./vendor-coreui-C9cgcUrA.js";import{c as pe,a as ge,b as Ce}from"./cil-people-DOcwnkEl.js";import{c as B}from"./cil-user-Ddrdy7PS.js";import{c as fe}from"./cil-money-Dk3vHnQB.js";import"./vendor-redux-DipIbRRz.js";var ve=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z' class='ci-primary'/>"],ye=["512 512","<rect width='34.924' height='34.924' x='256' y='95.998' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M16,496H496V16H16ZM48,48H464V464H48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M285.313,359.032a18.123,18.123,0,0,1-15.6,8.966,18.061,18.061,0,0,1-17.327-23.157l35.67-121.277A49.577,49.577,0,0,0,194.7,190.572l-11.718,28.234,29.557,12.266,11.718-28.235a17.577,17.577,0,0,1,33.1,11.7l-35.67,121.277A50.061,50.061,0,0,0,269.709,400a50.227,50.227,0,0,0,43.25-24.853l15.1-25.913-27.646-16.115Z' class='ci-primary'/>"],Ne=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M344,16H168V168H16V344H168V496H344V344H496V168H344ZM464,200V312H312V464H200V312H48V200H200V48H312V200Z' class='ci-primary'/>"],be=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M29.663,482.25l.087.087a24.847,24.847,0,0,0,17.612,7.342,25.178,25.178,0,0,0,8.1-1.345l142.006-48.172,272.5-272.5A88.832,88.832,0,0,0,344.334,42.039l-272.5,272.5L23.666,456.541A24.844,24.844,0,0,0,29.663,482.25Zm337.3-417.584a56.832,56.832,0,0,1,80.371,80.373L411.5,180.873,331.127,100.5ZM99.744,331.884,308.5,123.127,388.873,203.5,180.116,412.256,58.482,453.518Z' class='ci-primary'/>"];const Re=()=>{const[d,H]=r.useState([]),[A,S]=r.useState(!0),[m,I]=r.useState(1),[j,L]=r.useState(!1),[n,M]=r.useState(null),[i,T]=r.useState(""),[U,V]=r.useState(!1),[R,f]=r.useState(""),[_,$]=r.useState(null),v=5,O=r.useRef();r.useEffect(()=>{D()},[]);const D=async()=>{try{S(!0);const s=await F.get("/hr/leaveRequest");H(s.data.data||[])}catch(s){console.error("Error fetching leave requests:",s),p("danger","Error","Failed to load leave requests")}finally{S(!1)}},P=m*v,G=P-v,J=d.slice(G,P),y=Math.ceil(d.length/v),K=s=>{if(!s)return e.jsx(o,{color:"secondary",children:"Unknown"});switch(s.toLowerCase()){case"approved":return e.jsx(o,{color:"success",children:s});case"pending":return e.jsx(o,{color:"warning",children:s});case"rejected":return e.jsx(o,{color:"danger",children:s});default:return e.jsx(o,{color:"info",children:s})}},Q=s=>s?s.toLowerCase()==="paid"?e.jsx(o,{color:"success",children:s}):e.jsx(o,{color:"secondary",children:s}):e.jsx(o,{color:"secondary",children:"Unknown"}),k=s=>{if(!s)return"N/A";try{const a=new Date(s);return isNaN(a.getTime())?"Invalid Date":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(a){return console.error("Date formatting error:",a),"Error"}},E=(s,a)=>{M(s),T(a),f(""),V(!0)},u=()=>{V(!1),M(null),T(""),f("")},p=(s,a,x)=>{$(e.jsxs(q,{autohide:!0,delay:5e3,children:[e.jsx(ee,{closeButton:!0,color:s,children:e.jsx("strong",{className:"me-auto",children:a})}),e.jsx(se,{children:x})]}))},W=async()=>{if(!(!n||!i))try{L(!0);const s=i==="approve"?"Approved":"Rejected";await F.put(`/hr/leaveRequest/${n.id}`,{status:s,comments:R}),H(a=>a.map(x=>x.id===n.id?{...x,status:s}:x)),u(),p("success","Success",`Leave request has been ${s.toLowerCase()} successfully`)}catch(s){console.error(`Error ${i}ing leave request:`,s),p("danger","Error",`Failed to ${i} leave request. Please try again.`)}finally{L(!1)}},X=s=>{if(s==null)return"N/A";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}catch(a){return console.error("Currency formatting error:",a),"Error"}},N=s=>{I(s)},Y=s=>{s||p("warning","info","No document available")};return e.jsxs(ae,{fluid:!0,className:"mt-4",children:[e.jsx(re,{ref:O,push:_,placement:"top-end"}),e.jsxs(g,{className:"shadow",children:[e.jsxs(te,{className:"bg-primary text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h4",{className:"mb-0",children:[e.jsx(l,{icon:pe,className:"me-2"}),"Leave Requests"]}),e.jsxs(h,{color:"light",size:"sm",onClick:D,disabled:A,children:[e.jsx(l,{icon:be,className:"me-1"}),"Refresh"]})]}),e.jsx(C,{children:A?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(Z,{color:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading leave requests..."})]}):d.length===0?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(l,{icon:ye,size:"xl",className:"mb-3 text-muted"}),e.jsx("p",{children:"No leave requests found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ce,{className:"mb-3",children:[e.jsx(b,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(g,{className:"text-white bg-info",children:e.jsxs(C,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Total Requests"}),e.jsx("h3",{className:"mb-0",children:d.length})]}),e.jsx(l,{icon:ge,size:"3xl"})]})})}),e.jsx(b,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(g,{className:"text-white bg-warning",children:e.jsxs(C,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Pending"}),e.jsx("h3",{className:"mb-0",children:d.filter(s=>s.status&&s.status.toLowerCase()==="pending").length})]}),e.jsx(l,{icon:Ne,size:"3xl"})]})})}),e.jsx(b,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(g,{className:"text-white bg-success",children:e.jsxs(C,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Approved"}),e.jsx("h3",{className:"mb-0",children:d.filter(s=>s.status&&s.status.toLowerCase()==="approved").length})]}),e.jsx(l,{icon:Ce,size:"3xl"})]})})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs(le,{striped:!0,hover:!0,responsive:!0,className:"border",children:[e.jsx(ne,{className:"bg-light",children:e.jsxs(z,{children:[e.jsx(t,{children:"ID"}),e.jsxs(t,{children:[e.jsx(l,{icon:B,className:"me-1"}),"Employee"]}),e.jsx(t,{children:"Department"}),e.jsx(t,{children:"Leave Type"}),e.jsx(t,{children:"Start Date"}),e.jsx(t,{children:"Days"}),e.jsxs(t,{children:[e.jsx(l,{icon:fe,className:"me-1"}),"Amount"]}),e.jsx(t,{children:"Paid Status"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Document"}),e.jsx(t,{children:"Actions"})]})}),e.jsx(oe,{children:J.map(s=>e.jsxs(z,{children:[e.jsx(c,{children:s.id}),e.jsx(c,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-light rounded-circle p-2 me-2 text-primary",children:e.jsx(l,{icon:B})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:s.name||"Unknown"}),e.jsx("small",{className:"text-muted",children:s.reason||"No reason"})]})]})}),e.jsx(c,{children:s.department||"N/A"}),e.jsx(c,{children:s.leave_type||"N/A"}),e.jsx(c,{children:k(s.start_date)}),e.jsx(c,{children:s.days||"N/A"}),e.jsx(c,{children:X(s.amount)}),e.jsx(c,{children:Q(s.isPaid)}),e.jsx(c,{children:K(s.status)}),e.jsx(c,{children:s.document_path?e.jsx(h,{color:"info",size:"sm",onClick:()=>Y(s.document_path),children:e.jsx(l,{icon:ve})}):e.jsx("span",{className:"text-muted",children:"No doc"})}),e.jsxs(c,{children:[s.status&&s.status.toLowerCase()==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"success",size:"sm",onClick:()=>E(s,"approve"),disabled:j,children:"Approve"}),e.jsx(h,{color:"danger",size:"sm",className:"ms-2",onClick:()=>E(s,"reject"),disabled:j,children:"Reject"})]}),(!s.status||s.status.toLowerCase()!=="pending")&&e.jsx("span",{className:"text-muted",children:"No actions available"})]})]},s.id))})]})}),y>1&&e.jsxs(ie,{className:"mt-3 justify-content-center","aria-label":"Page navigation",children:[e.jsx(w,{disabled:m===1,onClick:()=>N(m-1),children:"Previous"}),[...Array(y)].map((s,a)=>e.jsx(w,{active:m===a+1,onClick:()=>N(a+1),children:a+1},a+1)),e.jsx(w,{disabled:m===y,onClick:()=>N(m+1),children:"Next"})]})]})})]}),e.jsxs(de,{visible:U,onClose:u,children:[e.jsx(me,{onClose:u,children:e.jsxs(he,{children:[i==="approve"?"Approve":"Reject"," Leave Request"]})}),e.jsx(xe,{children:n&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",n.name||"Unknown",e.jsx("br",{}),e.jsx("strong",{children:"Leave Type:"})," ",n.leave_type||"N/A",e.jsx("br",{}),e.jsx("strong",{children:"Start Date:"})," ",k(n.start_date),e.jsx("br",{}),e.jsx("strong",{children:"Duration:"})," ",n.days||"N/A"," days"]}),e.jsx("label",{htmlFor:"comments",className:"form-label",children:"Comments:"}),e.jsx(je,{id:"comments",rows:3,value:R,onChange:s=>f(s.target.value),placeholder:"Add any comments here (optional)"})]})}),e.jsxs(ue,{children:[e.jsx(h,{color:"secondary",onClick:u,children:"Cancel"}),e.jsx(h,{color:i==="approve"?"success":"danger",onClick:W,disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:"sm",className:"me-2"}),"Processing..."]}):i==="approve"?"Approve":"Reject"})]})]})]})};export{Re as default};
