import{j as a}from"./index-DehEVgH0.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{a as p}from"./axiosInstance-Dv2jt_v_.js";import{F as f,V as T,W as $,X as H}from"./index-awhlclXR.js";import{S as L,k as O,X as R,l as U,R as N,a6 as M,V,j as x,W as b}from"./vendor-coreui-DHT2NCDT.js";import"./vendor-redux-DipIbRRz.js";import"./index-t--hEgTQ.js";const K=()=>{const[d,y]=o.useState(""),[h,j]=o.useState("02"),[g,k]=o.useState("00"),[u,S]=o.useState("AM"),[i,v]=o.useState({message:"",type:""}),[l,c]=o.useState(!1);o.useEffect(()=>{if(i.message){const e=setTimeout(()=>{v({message:"",type:""})},5e3);return()=>clearTimeout(e)}},[i]),o.useEffect(()=>{(async()=>{try{c(!0);const t=(await p.get("/backupauto/config")).data;if(t.backupDir&&y(t.backupDir),t.cronSchedule){const m=t.cronSchedule.split(" "),D=m[0],I=m[1];let n=parseInt(I,10),C="AM";n>=12&&(C="PM",n=n===12?12:n-12),n=n===0?12:n,j(n.toString().padStart(2,"0")),k(D.padStart(2,"0")),S(C)}}catch(s){console.error("Error fetching backup configuration:",s),r("Failed to load saved configuration","danger")}finally{c(!1)}})()},[]);const w=Array.from({length:12},(e,s)=>{const t=s+1;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),F=Array.from({length:60},(e,s)=>{const t=s;return{value:t.toString().padStart(2,"0"),label:t.toString().padStart(2,"0")}}),r=(e,s)=>{v({message:e,type:s})},A=()=>{let e=parseInt(h,10);return u==="PM"&&e<12?e+=12:u==="AM"&&e===12&&(e=0),{hours:e.toString().padStart(2,"0"),minutes:g}},B=async()=>{var e;if(!d.trim()){r("Please enter a valid backup directory path","danger");return}c(!0);try{const s=await p.post("/backupauto/update-directory",{backupDir:d});r(s.data,"success")}catch(s){r(`Error updating directory: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{c(!1)}},E=async()=>{var e;c(!0);try{const s=A(),t=`${s.minutes} ${s.hours} * * *`,m=await p.post("/backupauto/update-schedule",{cronSchedule:t});r(m.data,"success")}catch(s){r(`Error updating schedule: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{c(!1)}},P=async()=>{var e;if(!d.trim()){r("Please configure a backup directory first","warning");return}c(!0);try{const s=await p.post("/backupauto/backup");r(s.data,"success")}catch(s){r(`Error triggering backup: ${((e=s.response)==null?void 0:e.data)||s.message}`,"danger")}finally{c(!1)}};return a.jsxs("div",{className:"p-5",children:[a.jsx("h2",{className:"text-2xl mb-4",children:"Backup Manager"}),i.message&&a.jsx(L,{color:i.type,className:"mb-4",children:i.message}),a.jsxs(O,{className:"mb-4",children:[a.jsx(R,{children:a.jsx("div",{children:"Backup Configuration"})}),a.jsxs(U,{children:[a.jsxs(N,{className:"mb-4",children:[a.jsx(M,{children:"Backup Directory"}),a.jsxs("div",{className:"d-flex",children:[a.jsx(V,{type:"text",value:d,onChange:e=>y(e.target.value),placeholder:"Enter backup directory path",disabled:l}),a.jsxs(x,{color:"primary",onClick:B,className:"ms-2",disabled:l,children:[a.jsx(f,{icon:T})," Set Directory"]})]})]}),a.jsxs(N,{className:"mb-4",children:[a.jsx(M,{children:"Backup Time"}),a.jsxs("div",{className:"d-flex align-items-center",children:[a.jsxs("div",{className:"d-flex",style:{width:"220px"},children:[a.jsx(b,{value:h,onChange:e=>j(e.target.value),disabled:l,className:"me-1",style:{width:"70px"},children:w.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("span",{className:"mx-1 mt-2",children:":"}),a.jsx(b,{value:g,onChange:e=>k(e.target.value),disabled:l,className:"me-1",style:{width:"70px"},children:F.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsxs(b,{value:u,onChange:e=>S(e.target.value),disabled:l,style:{width:"70px"},children:[a.jsx("option",{value:"AM",children:"AM"}),a.jsx("option",{value:"PM",children:"PM"})]})]}),a.jsxs(x,{color:"success",onClick:E,className:"ms-3",disabled:l,children:[a.jsx(f,{icon:$})," Set Schedule"]})]}),a.jsxs("small",{className:"text-muted mt-2 d-block",children:["Current schedule: Daily at ",h,":",g," ",u]})]}),a.jsxs(x,{color:"danger",onClick:P,disabled:l,className:"mt-3",children:[a.jsx(f,{icon:H})," Trigger Backup Now"]})]})]})]})};export{K as default};
