import{r as l,j as e,e as d,f as h,J as k,b as g,c as B,i as m,a as p}from"./index-CKcFKU7h.js";import{C as I}from"./index.esm-DAwbp2WG.js";import{C as O}from"./CAlert-D4xm2muB.js";import{C as v}from"./CRow-6GBEGtvd.js";import{C as u}from"./CCol-Bfnlt4mm.js";import{C as x}from"./CCardHeader-BJVPw31J.js";import{C as f}from"./CCardTitle-DlzJVczk.js";import{C as j}from"./CCardText-BWRHRdk1.js";import{C as R}from"./CForm-2IzFcotE.js";import{C as J,a as P}from"./CListGroupItem-CUarwIc_.js";const ee=()=>{const[N,E]=l.useState(""),[W,q]=l.useState(""),[b,z]=l.useState(""),[C,L]=l.useState(""),[w,T]=l.useState([]),[o,c]=l.useState({directory:!1,backup:!1,restore:!1,fetchBackups:!1}),[y,F]=l.useState({message:"",type:"",visible:!1}),r=(a,t)=>{F({message:a,type:t,visible:!0}),setTimeout(()=>F(s=>({...s,visible:!1})),5e3)},A=async a=>{var S,D;const t=a.target.files;if(!t.length){r("Please select a directory.","danger");return}const s=t[0].webkitRelativePath.split("/")[0];E(s),c(i=>({...i,directory:!0}));try{const i=await p.post("http://localhost:5053/admin/set-directory",{directory:s});r(i.data.message,"success"),n()}catch(i){r(((D=(S=i==null?void 0:i.response)==null?void 0:S.data)==null?void 0:D.message)||"Error setting directory","danger")}finally{c(i=>({...i,directory:!1}))}},n=async()=>{c(a=>({...a,fetchBackups:!0}));try{const a=await p.get("http://localhost:5053/admin/get-backup-files");T(a.data.files)}catch{r("Failed to retrieve backup files","danger")}finally{c(a=>({...a,fetchBackups:!1}))}},G=async()=>{var a,t;c(s=>({...s,backup:!0}));try{const s=await p.post("http://localhost:5053/admin/backup");r(s.data.message,"success"),n()}catch(s){r(((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Error during backup","danger")}finally{c(s=>({...s,backup:!1}))}},H=async()=>{var a,t;if(!C||!b){r("Please fill in Database Name and BSON Filename.","danger");return}c(s=>({...s,restore:!0}));try{const s=await p.post("http://localhost:5053/admin/restore",{filename:C,databaseName:b});r(s.data.message,"success")}catch(s){r(((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Restore failed.","danger")}finally{c(s=>({...s,restore:!1}))}};return l.useEffect(()=>{N&&n()},[N]),e.jsxs(I,{className:"py-4",children:[y.visible&&e.jsx(O,{color:y.type,dismissible:!0,children:y.message}),e.jsx(v,{className:"mb-4",children:e.jsx(u,{children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(f,{children:"Backup Directory Configuration"})}),e.jsxs(h,{children:[e.jsx(j,{children:"Set the directory where database backups will be stored"}),e.jsxs(R,{children:[e.jsx(k,{htmlFor:"directory",children:"Backup Directory Path"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(g,{id:"directory",type:"file",webkitdirectory:"true",onChange:A}),e.jsx(B,{color:"primary",onClick:n,disabled:o.fetchBackups,style:{minWidth:"120px"},children:o.fetchBackups?e.jsx(m,{size:"sm"}):"Browse Folder"})]})]})]})]})})}),e.jsxs(v,{className:"g-4",children:[e.jsx(u,{md:6,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(f,{children:"Backup Database"})}),e.jsxs(h,{children:[e.jsx(j,{children:"Create a new backup of the current database state"}),e.jsx(B,{color:"primary",onClick:G,disabled:o.backup,className:"w-100",children:o.backup?e.jsx(m,{size:"sm"}):"Create Backup"})]})]})}),e.jsx(u,{md:6,children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(f,{children:"Restore Database"})}),e.jsxs(h,{children:[e.jsx(j,{children:"Restore a specific database from a backup"}),e.jsxs(R,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(k,{htmlFor:"database",children:"Database Name"}),e.jsx(g,{id:"database",type:"text",placeholder:"adminis",value:b,onChange:a=>z(a.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(k,{htmlFor:"filename",children:"BSON Filename"}),e.jsx(g,{id:"filename",type:"text",placeholder:"users.bson",value:C,onChange:a=>L(a.target.value)})]}),e.jsx(B,{color:"warning",onClick:H,disabled:o.restore,className:"w-100",children:o.restore?e.jsx(m,{size:"sm"}):"Restore Database"})]})]})]})})]}),e.jsx(v,{className:"mb-4",children:e.jsx(u,{children:e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(f,{children:"Available Backup Files"})}),e.jsxs(h,{children:[e.jsx(j,{children:"Here are the backup files available for restoration:"}),e.jsx(J,{children:o.fetchBackups?e.jsx(m,{size:"sm"}):w.length>0?w.map((a,t)=>e.jsx(P,{children:a},t)):e.jsx(P,{children:"No backup files available."})})]})]})})})]})};export{ee as default};
