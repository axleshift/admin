import{j as e}from"./index-DxMhGMaw.js";import{r as l,R as Q}from"./vendor-react-B6URQkMn.js";import{a as Y}from"./axiosInstance-Dv2jt_v_.js";import{F as u,M as Z,E as ee,a1 as se,a2 as re,a3 as ae}from"./index-CL47NU8L.js";import{a8 as w,a9 as I,aa as k,ab as te,N as O,O as v,k as ne,X as oe,j as H,l as le,T as ce,U as ie,V as de,C as me,S as ue,_ as he,$ as xe,a0 as T,a1 as c,a2 as pe,a3 as t,y as ge,ag as ye,ah as D}from"./vendor-coreui-BN8uYOBb.js";import{l as J}from"./activityLogger-dj-FpP-1.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const ve=()=>{const[h,j]=l.useState([]),[f,F]=l.useState(!0),[x,_]=l.useState(null),[A,$]=l.useState(""),[r,G]=l.useState({key:"id",direction:"ascending"}),[m,C]=l.useState(1),[V,N]=l.useState(null),[je,q]=l.useState(null),S=10,p=localStorage.getItem("role"),g=localStorage.getItem("department");localStorage.getItem("username");const E=localStorage.getItem("userId");JSON.parse(localStorage.getItem("permissions")||"[]");const y=localStorage.getItem("name");l.useEffect(()=>{R(),W()},[]);const W=async()=>{try{E&&y&&p&&g&&await J({name:y,role:p,department:g,route:"payroll",action:"Page View",description:"User viewed the Payroll page"})}catch(s){console.warn("Error logging page view:",s)}},R=async()=>{try{F(!0);const s=await Y.get("/hr/payroll");s.data&&Array.isArray(s.data)?(j(s.data),N(e.jsxs(w,{autohide:!0,delay:5e3,children:[e.jsx(I,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Success"})}),e.jsxs(k,{children:["Successfully loaded ",s.data.length," payroll records!"]})]}))):(console.warn("Unexpected API response format:",s.data),j([]),N(e.jsxs(w,{autohide:!0,delay:5e3,color:"warning",children:[e.jsx(I,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Warning"})}),e.jsx(k,{children:"Received unexpected data format. Please contact support if this persists."})]}))),_(null)}catch(s){_("Failed to fetch payroll data. Please try again later."),console.error("Error fetching payroll data:",s),j([]),N(e.jsxs(w,{autohide:!0,delay:5e3,color:"danger",children:[e.jsx(I,{closeButton:!0,children:e.jsx("strong",{className:"me-auto",children:"Error"})}),e.jsx(k,{children:"Failed to fetch payroll data. Please try again later."})]}))}finally{F(!1)}},B=async()=>{await R();try{E&&y&&p&&g&&await J({name:y,role:p,department:g,route:"/hr/payroll",action:"Refresh Data",description:"User refreshed the Payroll data"})}catch(s){console.warn("Error logging refresh action:",s)}},n=s=>{let a="ascending";r.key===s&&r.direction==="ascending"&&(a="descending"),G({key:s,direction:a})},o=s=>r.key!==s?e.jsx(u,{icon:se,className:"ms-1 text-gray-400"}):r.direction==="ascending"?e.jsx(u,{icon:re,className:"ms-1"}):e.jsx(u,{icon:ae,className:"ms-1"}),P=Q.useMemo(()=>r.key?[...h].sort((s,a)=>{const i=s[r.key],d=a[r.key];return!isNaN(parseFloat(i))&&!isNaN(parseFloat(d))?r.direction==="ascending"?parseFloat(i)-parseFloat(d):parseFloat(d)-parseFloat(i):typeof i=="string"&&typeof d=="string"?r.direction==="ascending"?i.localeCompare(d):d.localeCompare(i):i<d?r.direction==="ascending"?-1:1:i>d?r.direction==="ascending"?1:-1:0}):h,[h,r]).filter(s=>Object.values(s).some(a=>a&&a.toString().toLowerCase().includes(A.toLowerCase()))),M=m*S,X=M-S,U=P.slice(X,M),b=Math.ceil(P.length/S),L=s=>s==null?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),z=s=>["January","February","March","April","May","June","July","August","September","October","November","December"][s-1]||`Month ${s}`,K=s=>{switch(s==null?void 0:s.toLowerCase()){case"approved":return"success";case"paid":return"success";case"pending":return"warning";case"rejected":return"danger";case"failed":return"danger";default:return"secondary"}};return e.jsxs("div",{className:"mb-4",children:[e.jsx(te,{ref:q,push:V,placement:"top-end"}),e.jsx(O,{children:e.jsx(v,{children:e.jsxs(ne,{className:"mb-4",children:[e.jsxs(oe,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Payroll Management"}),e.jsx("div",{children:e.jsxs(H,{color:"light",className:"me-2",onClick:B,children:[e.jsx(u,{icon:Z,className:"me-1"})," Refresh"]})})]}),e.jsxs(le,{children:[e.jsxs(O,{className:"mb-3",children:[e.jsx(v,{md:6,children:e.jsxs(ce,{children:[e.jsx(ie,{children:e.jsx(u,{icon:ee})}),e.jsx(de,{placeholder:"Search payroll...",value:A,onChange:s=>$(s.target.value)})]})}),e.jsx(v,{md:6,className:"d-flex justify-content-end align-items-center",children:!f&&!x&&e.jsxs("small",{className:"text-medium-emphasis",children:["Showing ",P.length," of ",h.length," records"]})})]}),f&&e.jsxs("div",{className:"text-center p-5",children:[e.jsx(me,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading payroll data..."})]}),x&&e.jsxs(ue,{color:"danger",children:[x,e.jsx(H,{color:"link",className:"p-0 ms-2",onClick:B,children:"Try again"})]}),!f&&!x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(he,{hover:!0,bordered:!0,children:[e.jsx(xe,{color:"light",children:e.jsxs(T,{children:[e.jsxs(c,{onClick:()=>n("id"),style:{cursor:"pointer"},children:["ID ",o("id")]}),e.jsxs(c,{onClick:()=>n("employee_id"),style:{cursor:"pointer"},children:["Employee ID ",o("employee_id")]}),e.jsxs(c,{onClick:()=>n("name"),style:{cursor:"pointer"},children:["Employee ",o("name")]}),e.jsxs(c,{onClick:()=>n("department"),style:{cursor:"pointer"},children:["Department ",o("department")]}),e.jsxs(c,{onClick:()=>n("job_position"),style:{cursor:"pointer"},children:["Position ",o("job_position")]}),e.jsxs(c,{onClick:()=>n("gross_salary"),style:{cursor:"pointer"},className:"text-end",children:["Gross Pay ",o("gross_salary")]}),e.jsxs(c,{onClick:()=>n("net_salary"),style:{cursor:"pointer"},className:"text-end",children:["Net Pay ",o("net_salary")]}),e.jsxs(c,{onClick:()=>n("year"),style:{cursor:"pointer"},className:"text-center",children:["Period ",o("year")]}),e.jsxs(c,{onClick:()=>n("status"),style:{cursor:"pointer"},className:"text-center",children:["Status ",o("status")]})]})}),e.jsx(pe,{children:U.length>0?U.map((s,a)=>e.jsxs(T,{children:[e.jsx(t,{children:s.id||"—"}),e.jsx(t,{children:s.employee_id||"—"}),e.jsx(t,{children:s.name||"—"}),e.jsx(t,{children:s.department||"—"}),e.jsx(t,{children:s.job_position||"—"}),e.jsx(t,{className:"text-end",children:L(s.gross_salary)}),e.jsx(t,{className:"text-end",children:L(s.net_salary)}),e.jsx(t,{className:"text-center",children:`${z(s.month)}, ${s.year}`}),e.jsx(t,{className:"text-center",children:e.jsx(ge,{color:K(s.status),children:s.status||"Pending"})})]},s.id||a)):e.jsx(T,{children:e.jsx(t,{colSpan:"10",className:"text-center p-4 text-medium-emphasis",children:"No payroll records found."})})})]})}),b>1&&e.jsxs(ye,{className:"mt-3 justify-content-center","aria-label":"Page navigation",children:[e.jsx(D,{disabled:m===1,onClick:()=>C(m-1),children:"Previous"}),Array.from({length:b},(s,a)=>a+1).map(s=>e.jsx(D,{active:s===m,onClick:()=>C(s),children:s},s)),e.jsx(D,{disabled:m===b,onClick:()=>C(m+1),children:"Next"})]})]})]})]})})})]})};export{ve as default};
