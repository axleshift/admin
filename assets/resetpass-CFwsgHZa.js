import{j as e}from"./index-CqTYrJit.js";import{r as n,u as ee,d as se}from"./vendor-react-BHxUanFt.js";import{a as M}from"./axiosInstance-Bq-uIJjs.js";import{a as ae,c as te}from"./geminiPasswordAnalyzer-CjYXo4ux.js";import{F as i,f as V,b as _,c as H,d as re,e as ne,g as Z,h as K,i as oe}from"./index-BNowUf5p.js";import{C as le,a as ie,b as ce,d as de,n as me,e as ue,f as fe,g as P,k as O,o as Y,m as S,p as he,q as pe,l as ge}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const A=t=>{let r=0,c="Very Weak";const d=[];t.length<8?d.push("Password should be at least 8 characters long"):r+=20,/[A-Z]/.test(t)?r+=15:d.push("Add uppercase letters for stronger security"),/[a-z]/.test(t)?r+=15:d.push("Add lowercase letters for better security"),/[0-9]/.test(t)?r+=15:d.push("Include numbers to strengthen your password"),/[^A-Za-z0-9]/.test(t)?r+=15:d.push("Add special characters (like !@#$%) for maximum security");const h=new Set(t).size;return h>8?r+=10:h>5?r+=5:d.push("Use a greater variety of characters"),["12345","123456","qwerty","password","admin","welcome","abcdef","abc123","111111","000000"].some(g=>t.toLowerCase().includes(g))&&(r=Math.max(r-20,0),d.push("Avoid common password patterns and sequences")),r<30?c="Very Weak":r<50?c="Weak":r<70?c="Moderate":r<85?c="Strong":c="Very Strong",{score:r,strength:c,feedback:d,explanation:"Analysis performed using basic password rules."}};function Se(){const[t,r]=n.useState(""),[c,d]=n.useState(""),[h,l]=n.useState(""),[g,k]=n.useState(""),[o,v]=n.useState(null),[w,z]=n.useState(!1),[x,y]=n.useState(null),[I,E]=n.useState(!1),[j,T]=n.useState(!0),[R,b]=n.useState(0),[p,F]=n.useState(!1),G=ee(),{id:C,token:N}=se(),J=(s,a)=>{let m;return(...f)=>{clearTimeout(m),m=setTimeout(()=>{s(...f)},a)}},U=n.useCallback(async s=>{if(!s||s.length<4)return null;if(z(!0),y(null),j)try{const a=await Promise.race([ae(s),new Promise((m,f)=>setTimeout(()=>f(new Error("Analysis timeout")),3e3))]);return b(0),a}catch(a){console.error("Password analysis error:",a);const m=R+1;return b(m),m>=3?(T(!1),y("AI analysis temporarily disabled due to repeated failures"),setTimeout(()=>{T(!0),b(0),y(null)},3e4)):y(`Could not analyze password strength (Attempt ${m}/3)`),A(s)}else return A(s)},[j,R]),$=n.useCallback(J(async s=>{try{const a=await U(s);v(a)}finally{z(!1)}},500),[U]);n.useEffect(()=>{t&&($(t),te(t)<28&&v(a=>({...a,feedback:[...(a==null?void 0:a.feedback)||[],"Increase password complexity for better security."]})))},[t,$]),n.useEffect(()=>{(async()=>{try{(await M.get(`/general/validate-reset-token/${C}/${N}`)).data.Status==="Success"&&l("")}catch(a){console.error("Token validation error:",a),l("This password reset link has expired or is invalid")}})()},[C,N]);const Q=async s=>{var m,f,L,W,B,D;if(s.preventDefault(),l(""),k(""),F(!1),t!==c){l("Passwords do not match");return}if(t.length<8){l("Password must be at least 8 characters long");return}const a=o||A(t);if(a.score<30){l("Please choose a stronger password");return}E(!0);try{const u=await M.post(`/general/reset-password/${C}/${N}`,{password:t,passwordAnalysis:{score:a.score,strength:a.strength,aiPowered:j&&!x}});u.data.Status==="Success"?(k("Password reset successful! Redirecting to login..."),setTimeout(()=>G("/login"),2e3)):l(u.data.Message||"Password reset failed")}catch(u){console.error("Error:",u),((m=u.response)==null?void 0:m.status)===400?((L=(f=u.response)==null?void 0:f.data)==null?void 0:L.Code)==="PASSWORD_RECENTLY_USED"?(F(!0),l("This password was recently used. Please choose a password you haven't used within the last 6 months.")):l(((B=(W=u.response)==null?void 0:W.data)==null?void 0:B.Message)||"Invalid password or expired token"):((D=u.response)==null?void 0:D.status)===404?l("User not found"):l("An error occurred during password reset. Please try again.")}finally{E(!1)}},q=s=>!s||s<30?"danger":s<50?"warning":s<70?"info":s<85?"primary":"success",X=s=>!s||s<50?K:s<70?Z:oe;return e.jsx(le,{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:e.jsx(ie,{className:"w-100 justify-content-center",children:e.jsx(ce,{md:6,lg:4,children:e.jsxs(de,{className:"shadow-lg border-0",children:[e.jsxs(me,{className:"bg-primary text-white text-center py-3",children:[e.jsx(i,{icon:V,size:"2x",className:"me-2"}),e.jsx("h4",{className:"d-inline align-middle",children:"Reset Password"})]}),e.jsx(ue,{className:"p-4",children:e.jsxs(fe,{onSubmit:Q,children:[h&&e.jsxs(P,{color:p?"warning":"danger",className:"mb-3",children:[p&&e.jsx(i,{icon:_,className:"me-2"}),h]}),g&&e.jsx(P,{color:"success",className:"mb-3",children:g}),e.jsxs("div",{className:"mb-3",children:[e.jsx(O,{type:"password",placeholder:"New Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:H,className:"me-2"}),"New Password"]}),value:t,onChange:s=>r(s.target.value),required:!0,className:`mb-2 ${p?"border-warning":""}`,autoComplete:"new-password"}),t.length>0&&e.jsxs("div",{className:"mb-3 password-analyzer",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[j&&!x?e.jsx(Y,{content:"AI-powered password analysis",children:e.jsx(i,{icon:re,className:"me-2 text-primary"})}):e.jsx(Y,{content:"Basic password analysis",children:e.jsx(i,{icon:ne,className:"me-2 text-secondary"})}),"Password Strength:"]}),w?e.jsx(S,{size:"sm",color:"primary"}):o&&e.jsxs(he,{color:q(o.score),shape:"rounded-pill",children:[e.jsx(i,{icon:X(o.score),className:"me-1"}),o.strength]})]}),o&&!w&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{value:o.score,color:q(o.score),className:"mb-2",animated:!0}),e.jsxs("div",{className:"password-feedback mt-2",children:[p&&e.jsxs("div",{className:"small text-warning mb-1 fw-bold",children:[e.jsx(i,{icon:_,className:"me-1"}),"This password was used within the last 6 months"]}),o.feedback&&o.feedback.map((s,a)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(i,{icon:Z,className:"me-1"}),s]},a)),o.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:o.explanation})]})]}),x&&e.jsxs(P,{color:"warning",className:"py-1 mt-2 mb-0 small",children:[e.jsx(i,{icon:K,className:"me-1"}),x]})]}),e.jsx(O,{type:"password",placeholder:"Confirm Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:H,className:"me-2"}),"Confirm Password"]}),value:c,onChange:s=>d(s.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(ge,{type:"submit",color:"primary",className:"w-100",disabled:I||w||t.length<8||t!==c||o&&o.score<30||p,children:I?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",component:"span",className:"me-2"}),"Updating..."]}):w?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"sm",component:"span",className:"me-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{icon:V,className:"me-2"}),"Update Password"]})})]})})]})})})})}export{Se as default};
