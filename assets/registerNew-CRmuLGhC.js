import{k as M,l as L,j as e}from"./index-BCB2LN3G.js";import{r as h}from"./vendor-react-B6URQkMn.js";import{F as j,K as k,L as B,M as P}from"./index-C9F8SBHO.js";import{N as q,O,k as V,X as z,l as G,_ as K,$ as Q,a0 as v,a1 as o,a2 as W,a3 as c,W as S,j as X,C as f,S as N}from"./vendor-coreui-DbIDZSkS.js";import"./vendor-redux-DipIbRRz.js";const I=()=>{const{data:i,isLoading:u,isError:y,refetch:R}=M(),[U,{isLoading:p}]=L(),[d,g]=h.useState({}),[A,m]=h.useState({}),[E,x]=h.useState({}),b=["Administrative","Finance","HR","Core","Logistics"],w={Finance:["User","Admin","Staff","Superadmin","Technician"],Administrative:["Admin","Manager","Superadmin"],HR:["Admin","Manager","Employee","Contractor"],Core:["Admin","Manager","Employee","Contractor"],Logistics:["Admin","Manager","Employee","Contractor"]},F=s=>{const a=d[s]||{},r={};return a.department||(r.department="Department is required"),a.role||(r.role="Role is required"),m(l=>({...l,[s]:r})),Object.keys(r).length===0},T=(s,a)=>{g(r=>({...r,[s]:{...r[s],department:a,role:""}})),m(r=>({...r,[s]:{}}))},D=(s,a)=>{g(r=>({...r,[s]:{...r[s],role:a}})),m(r=>({...r,[s]:{}}))},H=async s=>{const a=s.id;if(!F(a))return;const l={id:a,firstName:s.firstName,lastName:s.lastName,email:s.email,department:d[a].department,role:d[a].role};try{x(n=>({...n,[a]:{loading:!0,error:null}}));const t=await U(l).unwrap();x(n=>({...n,[a]:{loading:!1,error:null,success:!0}})),R()}catch(t){x(n=>{var C;return{...n,[a]:{loading:!1,error:((C=t.data)==null?void 0:C.message)||"An unexpected error occurred",success:!1}}}),console.error("Save user error:",t)}};return e.jsx(q,{children:e.jsx(O,{md:12,children:e.jsxs(V,{children:[e.jsx(z,{children:e.jsxs("h4",{children:[e.jsx(j,{icon:k,className:"me-2"}),"New Users Registration"]})}),e.jsxs(G,{children:[e.jsxs(K,{hover:!0,responsive:!0,children:[e.jsx(Q,{children:e.jsxs(v,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Department"}),e.jsx(o,{children:"Role"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(W,{children:i==null?void 0:i.map(s=>{const a=s.id,r=d[a]||{},l=A[a]||{},t=E[a]||{};return e.jsxs(v,{children:[e.jsxs(c,{children:[s.firstName," ",s.lastName]}),e.jsx(c,{children:s.email}),e.jsxs(c,{children:[e.jsxs(S,{value:r.department||"",onChange:n=>T(a,n.target.value),invalid:!!l.department,children:[e.jsx("option",{value:"",children:"Select Department"}),b.map(n=>e.jsx("option",{value:n,children:n},n))]}),l.department&&e.jsx("div",{className:"text-danger small",children:l.department})]}),e.jsxs(c,{children:[e.jsxs(S,{value:r.role||"",onChange:n=>D(a,n.target.value),disabled:!r.department,invalid:!!l.role,children:[e.jsx("option",{value:"",children:"Select Role"}),(w[r.department]||[]).map(n=>e.jsx("option",{value:n,children:n},n))]}),l.role&&e.jsx("div",{className:"text-danger small",children:l.role})]}),e.jsxs(c,{children:[e.jsx(X,{color:t.success?"success":t.error?"danger":"primary",onClick:()=>H(s),disabled:t.loading||p,children:t.loading||p?e.jsx(f,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:B,className:"me-2"}),t.success?"Saved":t.error?"Retry":"Save"]})}),t.error&&e.jsxs("div",{className:"text-danger small mt-1",children:[e.jsx(j,{icon:P,className:"me-1"}),t.error]})]})]},a)})})]}),u&&e.jsx("div",{className:"text-center my-3",children:e.jsx(f,{color:"primary"})}),y&&e.jsx(N,{color:"danger",children:"Failed to load users. Please try again."}),(!i||i.length===0)&&!u&&e.jsx(N,{color:"info",children:"No new users available for registration."})]})]})})})};export{I as default};
