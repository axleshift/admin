import{j as e,l as je,m as ye}from"./index-nln47cCr.js";import{r as m}from"./vendor-react-B6URQkMn.js";import{F as o,l as B,m as W,n as te,o as we,p as Ce,q as J,r as ve,s as Se,t as Ne,u as be,v as ne,h as ke}from"./DefaultLayout-v5SE012R.js";import{l as Z}from"./activityLogger-CswLieGG.js";import{a as ie}from"./axiosInstance-Dv2jt_v_.js";import{k as L,a2 as M,l as E,S as k,C as me,j as x,y as O,a5 as Ae,a6 as Re,a7 as le,a8 as oe,s as he,t as ue,a4 as pe,v as ge,T as Ue,V as xe,U as Pe,P as j,N as Le,O as Ee,Y as $e,Z as Ie,_ as ce,$ as v,a0 as Me,a1 as S,W as de,w as Te}from"./vendor-coreui-vXCAeGSv.js";import"./vendor-redux-DipIbRRz.js";import"./Page500-DLXus9S5.js";import"./cil-magnifying-glass-COgjSVTM.js";import"./permissionConfig-DLItbach.js";import"./index-t--hEgTQ.js";const fe=({userData:u,onSecurityUpdate:T})=>{const[$,F]=m.useState(null),[K,p]=m.useState(!1),[q,D]=m.useState(null),[i,y]=m.useState(!1),[N,V]=m.useState(""),[A,I]=m.useState(!1);m.useEffect(()=>{G(u)&&w(u)},[u]);const G=t=>t&&t.firstName&&t.lastName&&t.email&&t.password&&t.role&&t.department,w=async t=>{var s,r,l,d;if(!(!t.password||t.password.length<3)){p(!0),D(null);try{const a=await ie.post("/security/analyze-security",{firstName:t.firstName,lastName:t.lastName,email:t.email,password:t.password,role:t.role,department:t.department});if((r=(s=a.data.securityAnalysis)==null?void 0:s.aiRecommendations)!=null&&r.analysis&&(a.data.securityAnalysis.aiRecommendations.analysis=C(a.data.securityAnalysis.aiRecommendations.analysis)),F(a.data.securityAnalysis),T){const n={isSecure:H(a.data.securityAnalysis),analysis:a.data.securityAnalysis};T(n),await ie.post("/security/log-security-event",{userId:t.userId||t.email,eventType:n.isSecure?"SECURITY_CHECK_PASSED":"SECURITY_CHECK_FAILED",details:{riskLevel:a.data.securityAnalysis.aiRecommendations.riskLevel,timestamp:new Date().toISOString(),passwordStrength:a.data.securityAnalysis.basicChecks.passwordStrength.strength,rolePrivilegeLevel:a.data.securityAnalysis.basicChecks.rolePrivilegeLevel.privilegeLevel}})}}catch(a){console.error("Security analysis error:",a),D(((d=(l=a.response)==null?void 0:l.data)==null?void 0:d.message)||"Error analyzing security")}finally{p(!1)}}},C=t=>{if(!t)return"";let s=t;const r=/##\s+.+/.test(t),l=/\*\*\d+\.\s.+?\*\*:/.test(t);return r?(s=s.replace(/##\s+(.+?):/g,"<h5>$1</h5>"),s=s.replace(/##\s+(.+?)$/gm,"<h5>$1</h5>"),s=s.replace(/(\d+)\.\s+\*\*(.+?)\*\*/g,"<p><strong>$1. $2</strong></p>"),s=s.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),s=s.replace(/\*\s+(.+?)$/gm,"<li>$1</li>"),s=s.replace(/(<li>.+?<\/li>\n)+/gs,"<ul>$&</ul>"),s=s.replace(/<\/h5>/g,'</h5><div class="mb-3">'),s=s.replace(/<h5>/g,"</div><h5>"),s=s.replace("</div>",""),s+="</div>"):l&&(s=s.replace(/\*\*(\d+)\.\s+Overall Risk Assessment:\*\*\s+(\w+)/i,'<h5>1. Overall Risk Assessment</h5><p class="mb-3"><span class="badge bg-$2-color me-2">$2</span></p>'),s=s.replace(/\*\*(\d+)\.\s+Specific Security Concerns:\*\*/i,"<h5>2. Specific Security Concerns</h5>"),s=s.replace(/\*\*(\d+)\.\s+Recommendations to Improve Security:\*\*/i,"<h5>3. Recommendations to Improve Security</h5>"),s=s.replace(/\*\*\*([^*]+)\*\*/g,"<strong>• $1</strong>"),s=s.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),s=s.replace(/\*([^*]+)\*/g,"<em>$1</em>"),s=s.replace(/\*\s/g,"• ")),s.includes("**")&&!s.includes("<strong>")&&(s=s.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>")),["low","medium","high","critical"].forEach(a=>{const n=new RegExp(`\\b${a}\\b`,"gi");s=s.replace(n,`<span class="badge bg-${a.toLowerCase()}-color me-1">${a.toUpperCase()}</span>`)}),s=s.replace(/\n\n/g,"</p><p>"),s.includes("<p>")||(s=`<p>${s}</p>`),s},Y=()=>{const s="ABCDEFGHJKLMNPQRSTUVWXYZ",r="abcdefghijkmnopqrstuvwxyz",l="23456789",d="!@#$%^&*()-_=+[]{}|;:,.<>?",a=s+r+l+d;let n="";n+=s.charAt(Math.floor(Math.random()*s.length)),n+=r.charAt(Math.floor(Math.random()*r.length)),n+=l.charAt(Math.floor(Math.random()*l.length)),n+=d.charAt(Math.floor(Math.random()*d.length));for(let c=4;c<16;c++)n+=a.charAt(Math.floor(Math.random()*a.length));n=n.split("").sort(()=>.5-Math.random()).join(""),V(n),I(!1),y(!0)},z=()=>{navigator.clipboard.writeText(N),I(!0),setTimeout(()=>{I(!1)},2e3)},H=t=>{if(!t)return!1;const{basicChecks:s,aiRecommendations:r}=t;return s.passwordStrength.strength==="weak"?!1:s.rolePrivilegeLevel.privilegeLevel==="critical"?r.riskLevel!=="high":s.emailRisk.riskLevel!=="high"},R=t=>{switch(t==null?void 0:t.toLowerCase()){case"high":return"danger";case"medium":return"warning";case"low":return"success";case"critical":return"danger";case"elevated":return"warning";case"standard":return"success";default:return"info"}},_=t=>{switch(t){case"strong":return"success";case"good":return"info";case"moderate":return"warning";case"weak":return"danger";default:return"secondary"}};if(!G(u))return e.jsxs(L,{className:"mb-4",children:[e.jsxs(M,{className:"d-flex align-items-center",children:[e.jsx(o,{icon:B,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsx(E,{children:e.jsx(k,{color:"info",children:"Enter user details to receive AI-powered security recommendations."})})]});if(K)return e.jsxs(L,{className:"mb-4",children:[e.jsxs(M,{className:"d-flex align-items-center",children:[e.jsx(o,{icon:B,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsxs(E,{className:"text-center p-4",children:[e.jsx(me,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Analyzing security with Gemini AI..."})]})]});if(q)return e.jsxs(L,{className:"mb-4",children:[e.jsxs(M,{className:"d-flex align-items-center",children:[e.jsx(o,{icon:B,className:"me-2"}),e.jsx("strong",{children:"AI Security Assistant"})]}),e.jsxs(E,{children:[e.jsxs(k,{color:"danger",children:[e.jsx(o,{icon:W,className:"me-2"}),q]}),e.jsx(x,{color:"primary",size:"sm",onClick:()=>w(u),children:"Try Again"})]})]});if(!$)return null;const{basicChecks:g,aiRecommendations:U}=$,f=g.passwordStrength,b=H($);return e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"mb-4",children:[e.jsxs(M,{className:"d-flex align-items-center",children:[e.jsx(o,{icon:B,className:"me-2"}),e.jsx("strong",{children:"Gemini AI Security Assistant"})]}),e.jsxs(E,{children:[e.jsx(k,{color:b?"success":"warning",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(o,{icon:b?te:W,className:"me-2",size:"lg"}),e.jsxs("div",{children:[e.jsx("strong",{children:b?"Security Check Passed":"Security Recommendations"}),e.jsx("p",{className:"mb-0",children:b?"This user registration meets the security requirements.":"Please review the security recommendations below."})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Password Strength:"}),e.jsxs("div",{children:[e.jsx(O,{color:_(f.strength),className:"me-2",children:f.strength.toUpperCase()}),e.jsxs(x,{color:"primary",size:"sm",onClick:Y,title:"Generate a secure password",children:[e.jsx(o,{icon:we,className:"me-1"}),"Generate Secure Password"]})]})]}),e.jsx(Ae,{className:"mb-2",children:e.jsx(Re,{value:f.score,color:_(f.strength)})}),f.feedback.length>0&&e.jsx(le,{small:!0,flush:!0,className:"border rounded mb-3",children:f.feedback.map((t,s)=>e.jsxs(oe,{children:[e.jsx(o,{icon:Ce,className:"me-2 text-primary"}),t]},s))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Privilege Level:"}),e.jsx(O,{color:R(g.rolePrivilegeLevel.privilegeLevel),children:g.rolePrivilegeLevel.privilegeLevel.toUpperCase()})]}),g.rolePrivilegeLevel.requiresAdditionalVerification&&e.jsxs(k,{color:"info",className:"small",children:[e.jsx(o,{icon:J,className:"me-2"}),"This role requires additional verification due to elevated privileges."]})]}),g.emailRisk.riskFactors.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Email Risk Level:"}),e.jsx(O,{color:R(g.emailRisk.riskLevel),children:g.emailRisk.riskLevel.toUpperCase()})]}),e.jsx(le,{small:!0,flush:!0,className:"border rounded mb-3",children:g.emailRisk.riskFactors.map((t,s)=>e.jsxs(oe,{children:[e.jsx(o,{icon:W,className:"me-2 text-warning"}),t]},s))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("strong",{children:"Gemini AI Security Analysis:"}),e.jsxs(O,{color:R(U.riskLevel),children:[U.riskLevel.toUpperCase()," RISK"]})]}),e.jsx(L,{className:"bg-light",children:e.jsx(E,{children:e.jsx("div",{className:"analysis-content",dangerouslySetInnerHTML:{__html:U.analysis.replace(/\$2-color/g,R(U.riskLevel))}})})})]})]})]}),e.jsxs(he,{visible:i,onClose:()=>y(!1),alignment:"center",children:[e.jsx(ue,{children:e.jsxs(pe,{children:[e.jsx(o,{icon:J,className:"me-2"}),"Secure Password Generator"]})}),e.jsxs(ge,{children:[e.jsx("p",{children:"This password has been generated securely with a mix of uppercase, lowercase, numbers, and special characters:"}),e.jsxs(Ue,{className:"mb-3",children:[e.jsx(xe,{type:"text",value:N,readOnly:!0,className:"border-end-0"}),e.jsx(Pe,{className:"bg-primary text-white cursor-pointer",onClick:z,children:e.jsx(o,{icon:ve})})]}),A&&e.jsxs(k,{color:"success",className:"mt-3 mb-0 py-2",children:[e.jsx(o,{icon:te,className:"me-2"}),"Password copied to clipboard!"]}),e.jsxs("div",{className:"d-flex justify-content-between mt-4",children:[e.jsx(x,{color:"secondary",onClick:()=>y(!1),children:"Close"}),e.jsx(x,{color:"success",onClick:()=>{z(),y(!1)},children:"Use This Password"})]})]})]})]})};fe.propTypes={userData:j.shape({userId:j.string,firstName:j.string.isRequired,lastName:j.string.isRequired,email:j.string.isRequired,password:j.string.isRequired,role:j.string.isRequired,department:j.string.isRequired}),onSecurityUpdate:j.func.isRequired};const Ye=()=>{var t;const{data:u,isLoading:T,isError:$,refetch:F}=je(),[K]=ye(),[p,q]=m.useState(null),D=["Administrative","Finance","HR","Core","Logistics"],[i,y]=m.useState({}),[N,V]=m.useState({}),[A,I]=m.useState({}),[G,w]=m.useState(!1),[C,Y]=m.useState(null);m.useEffect(()=>{try{const s=localStorage.getItem("currentUser");if(s){const r=JSON.parse(s);q(r),Z({name:r.name||"Unknown User",role:r.role||"Unknown Role",department:r.department||"Unknown Department",route:"hr/users",action:"VIEW",description:"Accessed new users registration page"})}}catch(s){console.error("Failed to get current user:",s)}},[]);const z=s=>{if(!s)return[];const r=s.toLowerCase();return r==="finance"?["user","admin","staff","superadmin","technician"]:r==="administrative"||r==="admin"?["admin","manager","superadmin"]:r==="logistics"?["Admin","Manager","Employee","Contractor"]:r==="core"?["Admin","Manager","Employee","Contractor"]:r==="hr"?["Admin","Manager","Employee","Contractor"]:[]},H=(s,r)=>{y({...i,[s]:{...i[s],password:r}})},R=s=>{V({...N,[s]:!N[s]})},_=(s,r)=>{y({...i,[s]:{...i[s],department:r,role:""}})},g=(s,r)=>{y({...i,[s]:{...i[s],role:r}})},U=(s,r)=>{I({...A,[s]:r})},f=s=>{var d,a,n;const r=s.id||s._id||s.email,l={userId:r,firstName:s.firstName,lastName:s.lastName,email:s.email,password:((d=i[r])==null?void 0:d.password)||"",role:((a=i[r])==null?void 0:a.role)||"",department:((n=i[r])==null?void 0:n.department)||""};Y(l),w(!0)},b=async s=>{const r=s.id||s._id||s.email,l=i[r]||{},d=A[r];if(!d||!d.isSecure){f(s);return}const a={firstName:s.firstName||"",lastName:s.lastName||"",email:s.email,password:l.password||"",role:l.role||"",department:l.department||""},n=[];if(a.firstName||n.push("First Name is required"),a.lastName||n.push("Last Name is required"),a.email||n.push("Email is required"),a.password||n.push("Password is required"),a.role||n.push("Role is required"),a.department||n.push("Department is required"),a.password&&(a.password.length<8&&n.push("Password must be at least 8 characters long"),/[a-z]/.test(a.password)||n.push("Password must contain at least one lowercase letter"),/[A-Z]/.test(a.password)||n.push("Password must contain at least one uppercase letter"),/[0-9]/.test(a.password)||n.push("Password must contain at least one number"),/[@$!%*?&#]/.test(a.password)||n.push("Password must contain at least one special character")),n.length>0){n.forEach(c=>{console.error(c)});return}try{const c=await K(a).unwrap();if(console.log("User saved successfully:",c),p){const P=`Registered new user: ${s.firstName} ${s.lastName} (${s.email}) with role: ${l.role} in department: ${l.department}`;Z({name:p.name||"Unknown User",role:p.role||"Unknown Role",department:p.department||"Unknown Department",route:"hr/users",action:"CREATE",description:P})}F()}catch(c){console.error("Error saving user:",c),c.data&&c.data.errors?c.data.errors.forEach(P=>{console.error(P)}):c.data&&c.data.message?console.error(c.data.message):console.error("An unexpected error occurred while saving the user"),p&&Z({name:p.name||"Unknown User",role:p.role||"Unknown Role",department:p.department||"Unknown Department",route:"hr/users",action:"ERROR",description:`Failed to register user: ${s.firstName} ${s.lastName} (${s.email}). Error: ${c.message||"Unknown error"}`})}};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{children:e.jsx(Ee,{md:12,children:e.jsxs(L,{children:[e.jsx(M,{children:e.jsxs("h4",{children:[e.jsx(o,{icon:Se,className:"me-2"}),"New Users"]})}),e.jsxs(E,{children:[e.jsxs($e,{hover:!0,responsive:!0,className:"align-middle",children:[e.jsx(Ie,{color:"light",children:e.jsxs(ce,{children:[e.jsx(v,{children:"First Name"}),e.jsx(v,{children:"Last Name"}),e.jsx(v,{children:"Email"}),e.jsx(v,{children:"Password"}),e.jsx(v,{children:"Department"}),e.jsx(v,{children:"Role"}),e.jsx(v,{children:"Security"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(Me,{children:u&&u.map(s=>{var c,P,Q,X,ee,se,re,ae;const r=s.id||s._id||s.email,l=((c=i[r])==null?void 0:c.department)||"",d=z(l),a=A[r]||{},n=a!=null&&a.isSecure?"success":a?"warning":"secondary";return e.jsxs(ce,{children:[e.jsx(S,{children:s.firstName}),e.jsx(S,{children:s.lastName}),e.jsx(S,{children:s.email}),e.jsx(S,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(xe,{type:N[r]?"text":"password",placeholder:"Set password",value:((P=i[r])==null?void 0:P.password)||"",onChange:h=>H(r,h.target.value)}),e.jsx(x,{color:"link",onClick:()=>R(r),className:"ms-2",children:e.jsx(o,{icon:N[r]?Ne:be})})]})}),e.jsx(S,{children:e.jsxs(de,{value:((Q=i[r])==null?void 0:Q.department)||"",onChange:h=>_(r,h.target.value),children:[e.jsx("option",{value:"",children:"Select department"}),D.map(h=>e.jsx("option",{value:h,children:h},h))]})}),e.jsx(S,{children:e.jsxs(de,{value:((X=i[r])==null?void 0:X.role)||"",onChange:h=>g(r,h.target.value),disabled:!((ee=i[r])!=null&&ee.department),children:[e.jsx("option",{value:"",children:"Select role"}),d.map(h=>e.jsx("option",{value:h,children:h},h))]})}),e.jsx(S,{children:e.jsxs(x,{color:n,size:"sm",onClick:()=>f(s),children:[e.jsx(o,{icon:J,className:"me-1"}),a!=null&&a.isSecure?"Secure":"Check"]})}),e.jsx(S,{children:e.jsxs(x,{color:"primary",onClick:()=>b(s),disabled:!((se=i[r])!=null&&se.department)||!((re=i[r])!=null&&re.role)||!((ae=i[r])!=null&&ae.password),children:[e.jsx(o,{icon:ne,className:"me-1"}),"Save"]})})]},r)})})]}),T&&e.jsx("div",{className:"text-center my-3",children:e.jsx(me,{color:"primary"})}),$&&e.jsx(k,{color:"danger",className:"mt-3",children:"Error loading new users. Please try again."}),u&&u.length===0&&e.jsx(k,{color:"info",className:"mt-3",children:"No new user registrations pending."}),e.jsx("div",{className:"d-flex justify-content-end mt-3",children:e.jsxs(x,{color:"secondary",onClick:F,children:[e.jsx(o,{icon:ke,className:"me-1"}),"Refresh"]})})]})]})})}),e.jsxs(he,{visible:G,onClose:()=>w(!1),size:"lg",children:[e.jsx(ue,{onClose:()=>w(!1),children:e.jsx(pe,{children:"Security Analysis"})}),e.jsx(ge,{children:C&&e.jsx(fe,{userData:C,onSecurityUpdate:s=>{U(C.userId,s)}})}),e.jsxs(Te,{children:[e.jsx(x,{color:"secondary",onClick:()=>w(!1),children:"Close"}),C&&((t=A[C.userId])==null?void 0:t.isSecure)&&e.jsxs(x,{color:"success",onClick:()=>{w(!1);const s=u.find(r=>(r.id||r._id||r.email)===C.userId);s&&b(s)},children:[e.jsx(o,{icon:ne,className:"me-1"}),"Save User"]})]})]})]})};export{Ye as default};
