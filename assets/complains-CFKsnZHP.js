import{j as e}from"./index-CzlX11AB.js";import{r}from"./vendor-react-P0hRR2W0.js";import{F as a,au as D,g as y,n as E,i as F,T as G,d as M,av as j,aw as J,ax as P,a as K,j as O}from"./index-D0KVb9r2.js";import{a as N}from"./axiosInstance-Bq-uIJjs.js";import{C as Y,a as Z,b as ee,o as $,g as w,l as c,m as se,d as ne,n as ae,p as v,e as oe,Q as te,R as ie,S as re,T as le,w as ce,x as de,y as B,z as f,A as me,B as g,u as ue,X as he}from"./vendor-coreui-pds89uUO.js";import"./vendor-redux-BKcj_6VU.js";import"./index-xsH4HHeE.js";const Ne=()=>{const[m,b]=r.useState([]),[h,A]=r.useState(!1),[I,l]=r.useState(null),[U,C]=r.useState(!1),[d,H]=r.useState(null),[i,x]=r.useState(new Set),[S,R]=r.useState(null);r.useEffect(()=>{_()},[]);const T=s=>{R(s),setTimeout(()=>{R(null)},5e3)},_=async()=>{try{A(!0),l(null);const s=await N.get("/complains/get-complains");b(s.data.complaints||[])}catch(s){console.error("Error fetching complaints:",s),l("Failed to load complaints. Please try again.")}finally{A(!1)}},z=async s=>{var t,u;try{l(null),x(o=>new Set(o).add(s._id));const n=await N.post("/complains/ai-resolve",{complaintId:s._id,complaintText:s.complaintText});b(o=>o.map(p=>p._id===s._id?{...n.data,source:p.source}:p)),T(`Complaint successfully resolved! Resolution: ${n.data.resolutionReference||"N/A"}`)}catch(n){console.error("Error resolving with AI:",n),l(((u=(t=n.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to resolve complaint. Please try again.")}finally{x(n=>{const o=new Set(n);return o.delete(s._id),o})}},k=s=>{(s.status==="Needs AI Review"||s.status==="Pending")&&!i.has(s._id)&&z(s)},L=s=>{window.open(`/api/complains/resolution-document/${s}`,"_blank")},q=s=>{H(s),C(!0)},Q=async s=>{var t,u;try{l(null),x(o=>new Set(o).add(`notify-${s}`));const n=m.find(o=>o._id===s);if(!n)throw new Error("Complaint not found");await N.post("/complains/send-notification",{complaintId:s}),T(`Notification sent successfully to ${n.employeeEmail}`)}catch(n){console.error("Error sending notification:",n),l(`Failed to send notification. ${((u=(t=n.response)==null?void 0:t.data)==null?void 0:u.message)||n.message}`)}finally{x(n=>{const o=new Set(n);return o.delete(`notify-${s}`),o})}},V=s=>{switch(s){case"Resolved":return"success";case"Under Review":return"warning";case"Dismissed":return"danger";case"Needs AI Review":return"info";case"Pending":default:return"secondary"}},W=s=>{switch(s){case"Resolved":return F;case"Under Review":return j;case"Dismissed":return O;case"Needs AI Review":return D;case"Pending":default:return E}},X=()=>d?e.jsxs(te,{visible:U,onClose:()=>C(!1),size:"lg",children:[e.jsx(ie,{closeButton:!0,children:e.jsxs(re,{children:[e.jsx(a,{icon:P,className:"me-2"}),"Action Items for Complaint"]})}),e.jsxs(le,{children:[d.actionItems&&d.actionItems.length>0?e.jsxs(ce,{bordered:!0,striped:!0,responsive:!0,children:[e.jsx(de,{children:e.jsxs(B,{children:[e.jsx(f,{children:"Action"}),e.jsx(f,{children:"Assigned To"}),e.jsx(f,{children:"Due Date"}),e.jsx(f,{children:"Status"})]})}),e.jsx(me,{children:d.actionItems.map((s,t)=>e.jsxs(B,{children:[e.jsx(g,{children:s.action}),e.jsx(g,{children:s.assignedTo}),e.jsx(g,{children:s.dueDate||"ASAP"}),e.jsx(g,{children:e.jsx(ue,{id:`action-${t}`,label:"Completed",checked:s.completed,disabled:!0})})]},t))})]}):e.jsx("p",{children:"No action items defined for this complaint."}),d.followUpDate&&e.jsxs("div",{className:"mt-3",children:[e.jsx("strong",{children:"Follow-up Date:"})," ",new Date(d.followUpDate).toLocaleDateString()]})]}),e.jsx(he,{children:e.jsx(c,{color:"secondary",onClick:()=>C(!1),children:"Close"})})]}):null;return e.jsxs(Y,{className:"py-4",children:[e.jsx(Z,{children:e.jsxs(ee,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h1",{children:[e.jsx(a,{icon:D,className:"me-2"}),"AI Complaints Resolution System"]}),e.jsx($,{content:"This system shows complaints that require advanced AI resolution due to their complexity or sensitivity.",placement:"bottom",children:e.jsx(a,{icon:y,className:"ms-2 text-info",style:{cursor:"pointer"}})})]}),I&&e.jsxs(w,{color:"danger",className:"mb-4",children:[e.jsx(a,{icon:E,className:"me-2"}),I]}),S&&e.jsxs(w,{color:"success",className:"mb-4",children:[e.jsx(a,{icon:F,className:"me-2"}),S]}),e.jsxs("div",{className:"d-flex mb-4",children:[e.jsxs(c,{color:"primary",onClick:_,disabled:h,className:"me-2",children:[e.jsx(a,{icon:G,className:"me-2",spin:h}),h?"Loading...":"Refresh Complaints"]}),e.jsxs(c,{color:"success",onClick:()=>{const s=m.filter(t=>(t.status==="Needs AI Review"||t.status==="Pending")&&!i.has(t._id));s.length>0?k(s[0]):l("No eligible complaints found to resolve")},disabled:!m.some(s=>(s.status==="Needs AI Review"||s.status==="Pending")&&!i.has(s._id)),children:[e.jsx(a,{icon:M,className:"me-2"}),"Quick Resolve Next Complaint"]})]}),h?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(se,{}),e.jsx("p",{className:"mt-3",children:"Loading complex complaints..."})]}):e.jsx(e.Fragment,{children:m.length===0?e.jsxs(w,{color:"info",children:[e.jsx(a,{icon:y,className:"me-2"}),"No complex complaints found that require AI resolution."]}):m.map(s=>e.jsxs(ne,{className:"mb-4",children:[e.jsxs(ae,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:s.source==="Employee Complaint"?s.isAnonymous?"Anonymous":s.employeeName:s.userId||"Unknown User"}),s.source==="Employee Complaint"&&!s.isAnonymous&&e.jsxs("span",{className:"ms-3 text-muted",children:["Username: ",s.employeeUsername]})]}),e.jsxs("div",{children:[s.hrNotes&&e.jsx($,{content:`HR Notes: ${s.hrNotes}`,placement:"top",children:e.jsxs("span",{className:"me-3 text-primary",children:[e.jsx(a,{icon:y})," HR Forwarded"]})}),i.has(s._id)?e.jsxs(v,{color:"warning",children:[e.jsx(a,{icon:j,spin:!0,className:"me-1"}),"Processing"]}):e.jsxs(v,{color:V(s.status),children:[e.jsx(a,{icon:W(s.status),className:"me-1"}),s.status]})]})]}),e.jsxs(oe,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("small",{className:"text-muted d-block mb-2",children:["Source: ",s.source,s.source==="Employee Complaint"&&e.jsxs(e.Fragment,{children:[" • ","Department: ",s.department," • ","Type: ",s.complaintType," • ","Urgency: ",e.jsx(v,{color:s.urgency==="Critical"?"danger":s.urgency==="High"?"warning":s.urgency==="Medium"?"info":"secondary",shape:"rounded-pill",children:s.urgency})]})]}),e.jsx("p",{className:"mb-0",children:s.complaintText})]}),s.resolutionText&&e.jsxs("div",{className:"mt-3 p-3 bg-light rounded",children:[e.jsx("h6",{children:"AI Resolution:"}),e.jsx("p",{className:"mb-0",children:s.resolutionText}),e.jsxs("div",{className:"mt-3",children:[e.jsxs(c,{color:"primary",size:"sm",className:"me-2",onClick:()=>L(s._id),children:[e.jsx(a,{icon:J,className:"me-1"}),"Download Document"]}),s.actionItems&&s.actionItems.length>0&&e.jsxs(c,{color:"info",size:"sm",className:"me-2",onClick:()=>q(s),children:[e.jsx(a,{icon:P,className:"me-1"}),"View Action Items"]}),s.source==="Employee Complaint"&&!s.isAnonymous&&e.jsxs(c,{color:"success",size:"sm",onClick:()=>Q(s._id),disabled:i.has(`notify-${s._id}`),children:[e.jsx(a,{icon:i.has(`notify-${s._id}`)?j:K,spin:i.has(`notify-${s._id}`),className:"me-1"}),i.has(`notify-${s._id}`)?"Sending...":"Send Notification"]})]})]}),(s.status==="Needs AI Review"||s.status==="Pending")&&e.jsx(c,{color:"success",size:"sm",onClick:()=>k(s),className:"mt-3",disabled:i.has(s._id),children:i.has(s._id)?e.jsxs(e.Fragment,{children:[e.jsx(a,{icon:j,spin:!0,className:"me-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{icon:M,className:"me-2"}),"Resolve with Advanced AI"]})})]})]},s._id))})]})}),X()]})};export{Ne as default};
