import{k as M,j as e}from"./index-BnfaAiZg.js";import{r as l}from"./vendor-react-B6URQkMn.js";import{u as $}from"./vendor-redux-C7peqcPR.js";import{F as g,P as E,f as D,z as F,Q as B}from"./index-1Ig5rmq6.js";import{l as d}from"./activityLogger-dj-FpP-1.js";import{u as L,c as T,N as x,O as b,k as H,X as O,l as V,V as z,a5 as J,j as Q}from"./vendor-coreui-DGBpOIqK.js";import"./axiosInstance-Dv2jt_v_.js";import"./index-t--hEgTQ.js";const X=t=>t?t.length<=2?"*".repeat(t.length):`${t[0]}${"*".repeat(t.length-2)}${t[t.length-1]}`:"",Y=[{category:"HR",icon:D,permissions:[{key:"/worker",label:"Employees"},{key:"/jobposting",label:"Job Postings"},{key:"/payroll",label:"Payroll Management"},{key:"/leave",label:"Leave Management"}]}],ae=()=>{const[t,f]=l.useState([]),[u,h]=l.useState(""),[c,y]=l.useState(""),[n,S]=l.useState(""),[k,C]=l.useState(""),[i,m]=l.useState(null),[j,{isLoading:p}]=M(),{colorMode:N}=L(),o=N==="dark";$(s=>{var a;return(a=s.changeState)==null?void 0:a.theme}),l.useEffect(()=>{const s=localStorage.getItem("userId"),a=localStorage.getItem("name"),r=localStorage.getItem("department"),w=localStorage.getItem("role");s&&(h(s),C(X(s))),a&&y(a),r&&S(r),d({name:a,role:w,department:r,route:"/access-request",action:"Page Visit",description:"User visited the access request page"})},[]);const q=s=>{const a=t.includes(s)?t.filter(r=>r!==s):[...t,s];f(a),d({name:c,role:localStorage.getItem("role"),department:n,route:"/access-request",action:"Toggle Permission",description:`User ${t.includes(s)?"removed":"added"} permission: ${s}`})},U=async()=>{var s,a;if(m(null),!u||!c||!n||t.length===0){m({success:!1,message:"Ensure all fields are filled and at least one permission is selected."});return}try{const r=await j({requestType:"AccessRequest",pageName:t[0]||"",name:c,department:n,username:u,requestDetails:{permissions:t}}).unwrap();d({name:c,role:localStorage.getItem("role"),department:n,route:"/access-request",action:"Submit Request",description:`User submitted access request for permissions: ${t.join(", ")}`}),m({success:!0,message:"Access request sent successfully!"}),f([])}catch(r){d({name:c,role:localStorage.getItem("role"),department:n,route:"/access-request",action:"Submit Request Failed",description:`User failed to submit access request: ${((s=r.data)==null?void 0:s.error)||"Unknown error"}`}),m({success:!1,message:((a=r.data)==null?void 0:a.error)||"Failed to send request"})}},R=o?{backgroundColor:"#2c2c34",color:"#fff"}:{},I=o?{backgroundColor:"#3c4b64",color:"#fff"}:{backgroundColor:"#321fdb",color:"#fff"},v=o?{backgroundColor:"#3a3a3a",color:"#fff",padding:"12px",borderRadius:"6px",marginBottom:"16px"}:{backgroundColor:"#f8f9fa",color:"#000",padding:"12px",borderRadius:"6px",marginBottom:"16px"},P=o?{backgroundColor:"#3a3a3a",color:"#fff",borderColor:"#666"}:{backgroundColor:"#f8f9fa",color:"#000"},A={position:"sticky",top:"20px",maxHeight:"90vh",overflowY:"auto"};return e.jsx(T,{fluid:!0,className:`py-4 ${o?"bg-dark":"bg-light"}`,children:e.jsx(x,{className:"justify-content-center",children:e.jsx(b,{md:8,lg:6,children:e.jsx("div",{style:A,children:e.jsxs(H,{className:"shadow-lg mb-4",style:R,children:[e.jsxs(O,{className:"d-flex align-items-center",style:I,children:[e.jsx(g,{icon:E,className:"me-2"}),e.jsx("strong",{children:"Access Request"})]}),e.jsxs(V,{children:[e.jsx(z,{type:"text",label:"User ID",value:k,readOnly:!0,style:P,className:"mb-4"}),e.jsx("label",{className:`form-label ${o?"text-light":""}`,children:"Available Permissions"}),Y.map(s=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",style:v,children:[e.jsx(g,{icon:s.icon,className:"me-2 text-primary"}),e.jsx("strong",{children:s.category})]}),e.jsx(x,{children:s.permissions.map(a=>e.jsx(b,{xs:12,md:6,className:"mb-3",children:e.jsx(J,{id:a.key,label:a.label,checked:t.includes(a.key),onChange:()=>q(a.key),className:o?"text-light":""})},a.key))})]},s.category)),i&&e.jsxs("div",{className:`alert ${i.success?"alert-success":"alert-danger"} d-flex align-items-center mt-3`,children:[e.jsx(g,{icon:i.success?F:B,className:"me-2"}),i.message]}),e.jsx(Q,{color:"primary",className:"w-100 mt-3",onClick:U,disabled:p||!u,children:p?"Sending Request...":"Submit Access Request"})]})]})})})})})};export{ae as default};
