import{j as e}from"./index-DGlCYBmm.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{a as W}from"./axiosInstance-Dv2jt_v_.js";import{u as le}from"./vendor-redux-C7peqcPR.js";import{F as r,T as ce,R as _,y as oe,ah as de,f as he,ai as me,_ as xe,aj as je,ak as ge,C as G,W as ue,A as V,al as pe,I as Ne,D as fe,B as ye}from"./index-DgWFfLP0.js";import{u as be,c as q,k as p,X as N,l as f,j as y,ae as we,y as b,C as Ce,_ as Ae,$ as ke,a0 as R,a1 as m,a2 as ve,a3 as h,Y as J,ah as Se,ai as j,aj as Te,N as L,O as g,s as Me,t as Ee,ad as $e,v as Ie,an as Re,ao as Le,ap as De,aq as Pe,w as Fe}from"./vendor-coreui-DDUzhqJ9.js";import"./index-t--hEgTQ.js";const _e=()=>{const[w,D]=o.useState([]),[P,k]=o.useState(null),[X,v]=o.useState(!0),[S,T]=o.useState(!1),[t,Y]=o.useState(null),[Q,M]=o.useState(!1),[d,Z]=o.useState(1),[C]=o.useState(20),[x,F]=o.useState(1),ee=le(s=>s.changeState.theme),{colorMode:se}=be("coreui-free-react-admin-template-theme"),a=ee==="dark"||se==="dark",U=()=>{v(!0),k(null),W.get("/general/log").then(s=>{D(s.data),F(Math.ceil(s.data.length/C)),v(!1)}).catch(s=>{k(s.message),v(!1)})},ae=()=>{T(!0),W.get("/general/log").then(s=>{D(s.data),F(Math.ceil(s.data.length/C)),T(!1)}).catch(s=>{k(s.message),T(!1)})};o.useEffect(()=>{U()},[]);const te=s=>{Y(s),M(!0)},E=d*C,B=E-C,O=w.slice(B,E),u=s=>Z(s),re=()=>{const s=[];s.push(e.jsx(j,{active:d===1,onClick:()=>u(1),children:"1"},"first"));let l=Math.max(2,d-Math.floor(5/2)),i=Math.min(x-1,l+5-2);i-l<3&&(l=Math.max(2,i-3)),l>2&&s.push(e.jsx(j,{disabled:!0,children:"..."},"ellipsis1"));for(let c=l;c<=i;c++)s.push(e.jsx(j,{active:d===c,onClick:()=>u(c),children:c},c));return i<x-1&&s.push(e.jsx(j,{disabled:!0,children:"..."},"ellipsis2")),x>1&&s.push(e.jsx(j,{active:d===x,onClick:()=>u(x),children:x},"last")),s},A=s=>{if(typeof s=="object"&&s!==null&&s.category&&s.patterns&&s.riskLevel)return{category:s.category,patterns:s.patterns,risk:s.riskLevel==="UNKNOWN"?"MEDIUM":s.riskLevel};const n=typeof s=="string"?s:JSON.stringify(s);if(!n)return{category:"Not available",patterns:"Not available",risk:"MEDIUM"};let l="MEDIUM";const i=n.match(/risk(?:\s*level|\s*assessment)?:?\s*(low|medium|high)/i);i&&(l=i[1].toUpperCase());let c="";const z=n.match(/categor(?:y|ization):?\s*([^.]+)/i);z?c=z[1].trim():c="General activity";let I="";const K=n.match(/patterns:?\s*([^.]+)/i)||n.match(/unusual patterns:?\s*([^.]+)/i);return K?I=K[1].trim():I="No unusual patterns detected",{category:c,patterns:I,risk:l}},$=s=>!s||s.toLowerCase()==="unknown"?"warning":s.toLowerCase()==="high"?"danger":s.toLowerCase()==="medium"?"warning":s.toLowerCase()==="low"?"success":a?"light":"secondary",ie=a?{color:"#FFFFFF"}:{},H=s=>{const n={CREATE:"success",UPDATE:"primary",DELETE:"danger",RESTORE:"warning",SELECT:"info",FETCH:a?"light":"secondary",NAVIGATE:a?"light":"secondary",AUTO:a?"light":"dark",SET:"info"};for(const[l,i]of Object.entries(n))if(s&&s.includes(l))return i;return a?"light":"secondary"},ne=s=>{const n=new Date,l=new Date(s),i=Math.floor((n-l)/1e3);return i<60?`${i} seconds ago`:i<3600?`${Math.floor(i/60)} minutes ago`:i<86400?`${Math.floor(i/3600)} hours ago`:`${Math.floor(i/86400)} days ago`};return P?e.jsx(q,{className:"mt-4",children:e.jsxs(p,{className:`text-center border-danger ${a?"bg-dark text-white":""}`,children:[e.jsxs(N,{className:"bg-danger text-white",children:[e.jsx(r,{icon:ce,className:"me-2"})," Error"]}),e.jsxs(f,{children:[e.jsx("p",{className:"mb-0",children:P}),e.jsxs(y,{color:"primary",className:"mt-3",onClick:U,children:[e.jsx(r,{icon:_,className:"me-2"})," Try Again"]})]})]})}):e.jsxs(q,{fluid:!0,className:"p-4",children:[e.jsxs(p,{className:`shadow-sm ${a?"bg-dark text-white":""}`,children:[e.jsxs(N,{className:`d-flex justify-content-between align-items-center ${a?"bg-dark text-white border-secondary":"bg-light"}`,children:[e.jsxs("div",{children:[e.jsx(r,{icon:oe,className:"me-2 text-primary"}),e.jsxs(we,{className:"d-inline mb-0",style:ie,children:["Activity Tracker ",e.jsx(b,{color:"info",shape:"rounded-pill",className:"ms-2",children:"AI Enhanced"})]})]}),e.jsxs("div",{children:[e.jsxs(y,{color:"light",size:"sm",className:`me-2 ${a?"text-dark":""}`,onClick:ae,disabled:S,children:[e.jsx(r,{icon:_,spin:S,className:"me-1"}),S?"Refreshing...":"Refresh"]}),e.jsxs(y,{color:a?"light":"secondary",size:"sm",className:a?"text-dark":"",children:[e.jsx(r,{icon:de,className:"me-1"}),"Export"]})]})]}),e.jsx(f,{children:X?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(Ce,{color:"primary"}),e.jsx("p",{className:`mt-2 ${a?"text-light":"text-muted"}`,children:"Loading activity data..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(Ae,{hover:!0,striped:!0,responsive:!0,className:`border ${a?"table-dark":""}`,children:[e.jsx(ke,{className:a?"bg-dark text-white border-secondary":"bg-light",children:e.jsxs(R,{children:[e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:he,className:`me-2 ${a?"text-white":"text-muted"}`}),"User"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:me,className:`me-2 ${a?"text-white":"text-muted"}`}),"Role"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:xe,className:`me-2 ${a?"text-white":"text-muted"}`}),"Department"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:je,className:`me-2 ${a?"text-white":"text-muted"}`}),"Route"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:ge,className:`me-2 ${a?"text-white":"text-muted"}`}),"Action"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:G,className:`me-2 ${a?"text-white":"text-muted"}`}),"Description"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:ue,className:`me-2 ${a?"text-white":"text-muted"}`}),"Time"]}),e.jsxs(m,{className:"text-nowrap",children:[e.jsx(r,{icon:V,className:`me-2 ${a?"text-white":"text-muted"}`}),"AI Analysis"]})]})}),e.jsx(ve,{children:O.length===0?e.jsx(R,{children:e.jsx(h,{colSpan:8,className:`text-center p-5 ${a?"text-white":"text-muted"}`,children:"No activity records found"})}):O.map(s=>{const{risk:n}=A(s.aiAnalysis);return e.jsxs(R,{className:"align-middle",children:[e.jsx(h,{className:"font-weight-bold",children:s.name||"Unknown"}),e.jsx(h,{children:e.jsx(b,{color:a?"light":"dark",shape:"rounded-pill",className:`px-2 py-1 ${a?"text-dark":""}`,children:s.role||"Unknown"})}),e.jsx(h,{children:s.department||"Unknown"}),e.jsx(h,{className:a?"text-info":"text-primary",children:s.route}),e.jsx(h,{children:e.jsx(b,{color:H(s.action),shape:"rounded-pill",className:H(s.action)==="light"?"text-dark":"",children:s.action})}),e.jsx(h,{children:e.jsx(J,{content:s.description,placement:"bottom",children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},children:s.description})})}),e.jsx(h,{className:"text-nowrap",children:e.jsx(J,{content:new Date(s.timestamp).toLocaleString(),children:e.jsx("span",{children:ne(s.timestamp)})})}),e.jsx(h,{children:s.aiAnalysis?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(b,{color:$(n),shape:"rounded-pill",className:"me-2",children:n}),e.jsxs(y,{color:"light",size:"sm",onClick:()=>te(s),children:[e.jsx(r,{icon:pe,className:"me-1"}),"View"]})]}):e.jsx("span",{className:"text-muted",children:"Not available"})})]},s._id)})})]})}),w.length>0&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Se,{"aria-label":"Activity pagination",className:a?"pagination-dark":"",children:[e.jsx(j,{"aria-label":"Previous",disabled:d===1,onClick:()=>u(d-1),children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),re(),e.jsx(j,{"aria-label":"Next",disabled:d===x,onClick:()=>u(d+1),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]})}),e.jsx(Te,{className:`${a?"bg-dark text-white border-secondary":"bg-light text-muted"}`,children:e.jsxs(L,{children:[e.jsx(g,{children:e.jsxs("small",{children:["Showing ",B+1,"-",Math.min(E,w.length)," of ",w.length," activities"]})}),e.jsx(g,{className:"text-end",children:e.jsxs("small",{children:["Last updated: ",new Date().toLocaleString()]})})]})})]}),e.jsxs(Me,{visible:Q,onClose:()=>M(!1),size:"lg",backdrop:"static",className:a?"modal-dark":"",children:[e.jsx(Ee,{className:a?"bg-dark text-white":"",children:e.jsxs($e,{children:[e.jsx(r,{icon:V,className:"me-2 text-primary"}),"AI Activity Analysis"]})}),e.jsx(Ie,{className:a?"bg-dark text-white":"",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Activity Details"}),e.jsxs(L,{className:"mb-3",children:[e.jsxs(g,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"User:"})," ",t.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Role:"})," ",t.role]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Department:"})," ",t.department]})]}),e.jsxs(g,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Route:"})," ",t.route]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Action:"})," ",t.action]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Time:"})," ",new Date(t.timestamp).toLocaleString()]})]})]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Description:"})," ",t.description]})]}),e.jsxs("div",{className:"mb-3 mt-4",children:[e.jsxs("h5",{children:[e.jsx(r,{icon:Ne,className:"me-2 text-info"}),"AI Analysis Results"]}),t.aiAnalysis?e.jsxs(e.Fragment,{children:[e.jsx(Re,{activeItemKey:1,className:"mt-3",children:e.jsxs(Le,{itemKey:1,children:[e.jsx(De,{children:"Full Analysis"}),e.jsx(Pe,{children:e.jsx("div",{className:`p-3 ${a?"bg-secondary bg-opacity-10":"bg-light"}`,style:{whiteSpace:"pre-line",borderRadius:"0.25rem"},children:typeof t.aiAnalysis=="object"&&t.aiAnalysis.fullAnalysis?t.aiAnalysis.fullAnalysis:t.aiAnalysis})})]})}),e.jsxs(L,{className:"mt-4",children:[e.jsx(g,{md:"4",children:e.jsxs(p,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(N,{className:"bg-info text-white",children:[e.jsx(r,{icon:G,className:"me-2"}),"Category"]}),e.jsx(f,{children:t.aiStructuredAnalysis?t.aiStructuredAnalysis.category:A(t.aiAnalysis).category})]})}),e.jsx(g,{md:"4",children:e.jsxs(p,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(N,{className:"bg-primary text-white",children:[e.jsx(r,{icon:fe,className:"me-2"}),"Patterns"]}),e.jsx(f,{children:t.aiStructuredAnalysis?t.aiStructuredAnalysis.patterns:A(t.aiAnalysis).patterns})]})}),e.jsx(g,{md:"4",children:e.jsx(p,{className:a?"bg-dark text-white border-secondary":"",children:(()=>{const s=t.aiStructuredAnalysis?t.aiStructuredAnalysis.riskLevel:A(t.aiAnalysis).risk;return e.jsxs(e.Fragment,{children:[e.jsxs(N,{className:`bg-${$(s)} text-white`,children:[e.jsx(r,{icon:ye,className:"me-2"}),"Risk Level"]}),e.jsx(f,{className:"d-flex justify-content-center align-items-center",children:e.jsx(b,{color:$(s),size:"lg",shape:"rounded-pill",className:"px-4 py-2",children:s==="UNKNOWN"?"MEDIUM":s})})]})})()})})]})]}):e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-muted",children:"AI analysis not available for this activity."})})]})]})}),e.jsx(Fe,{className:a?"bg-dark text-white":"",children:e.jsx(y,{color:"secondary",onClick:()=>M(!1),children:"Close"})})]})]})};export{_e as default};
