import{j as e}from"./index-Bf0IcOp-.js";import{r as a}from"./vendor-react-B6URQkMn.js";import{a as X}from"./axiosInstance-Dv2jt_v_.js";import{c as Ne,ab as fe,k as f,X as ve,o as c,j as h,l as v,C as L,N as ye,O as M,_ as be,$ as Ce,a0 as Y,a1 as l,a2 as we,a3 as o,ag as De,ah as H,s as G,t as J,ac as K,v as Q,ai as Se,w as q,a8 as Le,a9 as Me,aa as He,y as d,S as ee}from"./vendor-coreui-BN8uYOBb.js";import{c as Ae,a as Te,b as Ee}from"./cil-people-DOcwnkEl.js";import{c as se}from"./cil-user-Ddrdy7PS.js";import{c as Ve}from"./cil-money-Dk3vHnQB.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";var p=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z' class='ci-primary'/>"],ke=["512 512","<rect width='34.924' height='34.924' x='256' y='95.998' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M16,496H496V16H16ZM48,48H464V464H48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M285.313,359.032a18.123,18.123,0,0,1-15.6,8.966,18.061,18.061,0,0,1-17.327-23.157l35.67-121.277A49.577,49.577,0,0,0,194.7,190.572l-11.718,28.234,29.557,12.266,11.718-28.235a17.577,17.577,0,0,1,33.1,11.7l-35.67,121.277A50.061,50.061,0,0,0,269.709,400a50.227,50.227,0,0,0,43.25-24.853l15.1-25.913-27.646-16.115Z' class='ci-primary'/>"],Re=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M344,16H168V168H16V344H168V496H344V344H496V168H344ZM464,200V312H312V464H200V312H48V200H200V48H312V200Z' class='ci-primary'/>"],Pe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M29.663,482.25l.087.087a24.847,24.847,0,0,0,17.612,7.342,25.178,25.178,0,0,0,8.1-1.345l142.006-48.172,272.5-272.5A88.832,88.832,0,0,0,344.334,42.039l-272.5,272.5L23.666,456.541A24.844,24.844,0,0,0,29.663,482.25Zm337.3-417.584a56.832,56.832,0,0,1,80.371,80.373L411.5,180.873,331.127,100.5ZM99.744,331.884,308.5,123.127,388.873,203.5,180.116,412.256,58.482,453.518Z' class='ci-primary'/>"],Fe=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='427.314 107.313 404.686 84.687 256 233.373 107.314 84.687 84.686 107.313 233.373 256 84.686 404.687 107.314 427.313 256 278.627 404.686 427.313 427.314 404.687 278.627 256 427.314 107.313' class='ci-primary'/>"];const Xe=()=>{const[x,A]=a.useState([]),[T,E]=a.useState(!0),[j,re]=a.useState(1),[g,V]=a.useState(!1),[i,k]=a.useState(null),[m,R]=a.useState(""),[ae,P]=a.useState(!1),[F,y]=a.useState(""),[ce,ne]=a.useState(null),[te,z]=a.useState(!1),[n,U]=a.useState(null),[le,Z]=a.useState(!1),[B,b]=a.useState(null),C=5,oe=a.useRef();a.useEffect(()=>{I()},[]);const u=(s,r,t)=>{ne(e.jsxs(Le,{autohide:!0,delay:5e3,children:[e.jsx(Me,{closeButton:!0,color:s,children:e.jsx("strong",{className:"me-auto",children:r})}),e.jsx(He,{children:t})]}))},I=async()=>{var s,r;try{E(!0);const O=(await X.get("/hr/leaveRequest")).data.data||[];A(O),u("success","Data Fetched Successfully",`Retrieved ${O.length} leave request(s)`)}catch(t){console.error("Error fetching leave requests:",t),u("danger","Fetch Error",`Failed to load leave requests: ${((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.error)||t.message}`)}finally{E(!1)}},_=j*C,ie=_-C,de=x.slice(ie,_),w=Math.ceil(x.length/C),me=s=>{if(!s)return e.jsx(d,{color:"secondary",children:"Unknown"});switch(s.toLowerCase()){case"approved":return e.jsx(d,{color:"success",children:s});case"pending":return e.jsx(d,{color:"warning",children:s});case"rejected":return e.jsx(d,{color:"danger",children:s});default:return e.jsx(d,{color:"info",children:s})}},he=s=>s?s.toLowerCase()==="paid"?e.jsx(d,{color:"success",children:s}):e.jsx(d,{color:"secondary",children:s}):e.jsx(d,{color:"secondary",children:"Unknown"}),$=s=>{if(!s)return"N/A";try{const r=new Date(s);return isNaN(r.getTime())?"Invalid Date":r.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(r){return console.error("Date formatting error:",r),"Error"}},W=(s,r)=>{k(s),R(r),y(""),P(!0)},N=()=>{P(!1),k(null),R(""),y("")},D=()=>{z(!1),U(null),b(null)},xe=async()=>{if(!(!i||!m))try{V(!0);const s=m==="approve"?"Approved":"Rejected";await X.put(`/hr/leaveRequest/${i.id}`,{status:s,comments:F}),A(r=>r.map(t=>t.id===i.id?{...t,status:s}:t)),N(),u("success","Success",`Leave request has been ${s.toLowerCase()} successfully`)}catch(s){console.error(`Error ${m}ing leave request:`,s),u("danger","Error",`Failed to ${m} leave request. Please try again.`)}finally{V(!1)}},je=s=>{if(s==null)return"N/A";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}catch(r){return console.error("Currency formatting error:",r),"Error"}},S=s=>{re(s)},ue=async(s,r)=>{if(!s){u("warning","Info","No document available");return}try{Z(!0),b(null),U({path:s,name:`Document-${r.id||"Unknown"}`,type:pe(s),employeeName:r.name||"Unknown Employee"}),z(!0)}catch(t){console.error("Error fetching document:",t),b("Failed to load document. Please try again later.")}finally{Z(!1)}},pe=s=>{if(!s)return"unknown";switch(s.split(".").pop().toLowerCase()){case"pdf":return"pdf";case"doc":case"docx":return"word";case"xls":case"xlsx":return"excel";case"jpg":case"jpeg":case"png":case"gif":return"image";default:return"unknown"}},ge=()=>{if(le)return e.jsxs("div",{className:"text-center p-5",children:[e.jsx(L,{color:"primary"}),e.jsx("p",{className:"mt-3",children:"Loading document..."})]});if(B)return e.jsxs(ee,{color:"danger",className:"mb-0",children:[e.jsx("h4",{children:"Error Loading Document"}),e.jsx("p",{children:B}),e.jsx("p",{children:"Please try again or contact support if the issue persists."})]});if(!n)return e.jsxs(ee,{color:"warning",className:"mb-0",children:[e.jsx("h4",{children:"No Document Selected"}),e.jsx("p",{children:"There was an error selecting the document. Please try again."})]});const s=n.path;switch(n.type){case"pdf":return e.jsx("div",{className:"document-viewer-container",style:{height:"600px",width:"100%"},children:e.jsx("iframe",{src:s,title:n.name,width:"100%",height:"100%",style:{border:"none"},children:"Your browser does not support iframes."})});case"image":return e.jsx("div",{className:"text-center p-3",children:e.jsx("img",{src:s,alt:n.name,className:"img-fluid",style:{maxHeight:"600px",maxWidth:"100%"}})});case"word":return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(c,{icon:p,size:"3xl",className:"text-primary mb-3"}),e.jsx("h5",{children:"Microsoft Word Document"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for Word documents"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",n.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",n.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," Microsoft Word Document"]})]})]})});case"excel":return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(c,{icon:p,size:"3xl",className:"text-success mb-3"}),e.jsx("h5",{children:"Microsoft Excel Document"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for Excel documents"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",n.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",n.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," Microsoft Excel Document"]})]})]})});default:return e.jsx("div",{className:"text-center p-4",children:e.jsxs("div",{className:"document-preview-card p-4 border rounded bg-light",children:[e.jsx(c,{icon:p,size:"3xl",className:"text-secondary mb-3"}),e.jsx("h5",{children:"Document Preview"}),e.jsx("p",{className:"text-muted mb-3",children:"Preview not available for this file type"}),e.jsxs("div",{className:"document-info p-3 bg-white rounded border mb-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"File Name:"})," ",n.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Employee:"})," ",n.employeeName]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Type:"})," ",n.type.toUpperCase()]})]})]})})}};return e.jsxs(Ne,{fluid:!0,className:"mt-4",children:[e.jsx(fe,{ref:oe,push:ce,placement:"top-end"}),e.jsxs(f,{className:"shadow",children:[e.jsxs(ve,{className:"bg-primary text-white d-flex justify-content-between align-items-center",children:[e.jsxs("h4",{className:"mb-0",children:[e.jsx(c,{icon:Ae,className:"me-2"}),"Leave Requests"]}),e.jsxs(h,{color:"light",size:"sm",onClick:I,disabled:T,children:[e.jsx(c,{icon:Pe,className:"me-1"}),"Refresh"]})]}),e.jsx(v,{children:T?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(L,{color:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading leave requests..."})]}):x.length===0?e.jsxs("div",{className:"text-center p-4",children:[e.jsx(c,{icon:ke,size:"xl",className:"mb-3 text-muted"}),e.jsx("p",{children:"No leave requests found"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ye,{className:"mb-3",children:[e.jsx(M,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(f,{className:"text-white bg-info",children:e.jsxs(v,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Total Requests"}),e.jsx("h3",{className:"mb-0",children:x.length})]}),e.jsx(c,{icon:Te,size:"3xl"})]})})}),e.jsx(M,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(f,{className:"text-white bg-warning",children:e.jsxs(v,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Pending"}),e.jsx("h3",{className:"mb-0",children:x.filter(s=>s.status&&s.status.toLowerCase()==="pending").length})]}),e.jsx(c,{icon:Re,size:"3xl"})]})})}),e.jsx(M,{xs:12,sm:6,md:4,lg:3,className:"mb-2",children:e.jsx(f,{className:"text-white bg-success",children:e.jsxs(v,{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:"Approved"}),e.jsx("h3",{className:"mb-0",children:x.filter(s=>s.status&&s.status.toLowerCase()==="approved").length})]}),e.jsx(c,{icon:Ee,size:"3xl"})]})})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs(be,{striped:!0,hover:!0,responsive:!0,className:"border",children:[e.jsx(Ce,{className:"bg-light",children:e.jsxs(Y,{children:[e.jsx(l,{children:"ID"}),e.jsxs(l,{children:[e.jsx(c,{icon:se,className:"me-1"}),"Employee"]}),e.jsx(l,{children:"Department"}),e.jsx(l,{children:"Leave Type"}),e.jsx(l,{children:"Start Date"}),e.jsx(l,{children:"Days"}),e.jsxs(l,{children:[e.jsx(c,{icon:Ve,className:"me-1"}),"Amount"]}),e.jsx(l,{children:"Paid Status"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Document"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(we,{children:de.map(s=>e.jsxs(Y,{children:[e.jsx(o,{children:s.id}),e.jsx(o,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-light rounded-circle p-2 me-2 text-primary",children:e.jsx(c,{icon:se})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:s.name||"Unknown"}),e.jsx("small",{className:"text-muted",children:s.reason||"No reason"})]})]})}),e.jsx(o,{children:s.department||"N/A"}),e.jsx(o,{children:s.leave_type||"N/A"}),e.jsx(o,{children:$(s.start_date)}),e.jsx(o,{children:s.days||"N/A"}),e.jsx(o,{children:je(s.amount)}),e.jsx(o,{children:he(s.isPaid)}),e.jsx(o,{children:me(s.status)}),e.jsx(o,{children:s.document_path?e.jsx(h,{color:"info",size:"sm",onClick:()=>ue(s.document_path,s),children:e.jsx(c,{icon:p})}):e.jsx("span",{className:"text-muted",children:"No doc"})}),e.jsxs(o,{children:[s.status&&s.status.toLowerCase()==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"success",size:"sm",onClick:()=>W(s,"approve"),disabled:g,children:"Approve"}),e.jsx(h,{color:"danger",size:"sm",className:"ms-2",onClick:()=>W(s,"reject"),disabled:g,children:"Reject"})]}),(!s.status||s.status.toLowerCase()!=="pending")&&e.jsx("span",{className:"text-muted",children:"No actions available"})]})]},s.id))})]})}),w>1&&e.jsxs(De,{className:"mt-3 justify-content-center","aria-label":"Page navigation",children:[e.jsx(H,{disabled:j===1,onClick:()=>S(j-1),children:"Previous"}),[...Array(w)].map((s,r)=>e.jsx(H,{active:j===r+1,onClick:()=>S(r+1),children:r+1},r+1)),e.jsx(H,{disabled:j===w,onClick:()=>S(j+1),children:"Next"})]})]})})]}),e.jsxs(G,{visible:ae,onClose:N,children:[e.jsx(J,{onClose:N,children:e.jsxs(K,{children:[m==="approve"?"Approve":"Reject"," Leave Request"]})}),e.jsx(Q,{children:i&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",i.name||"Unknown",e.jsx("br",{}),e.jsx("strong",{children:"Leave Type:"})," ",i.leave_type||"N/A",e.jsx("br",{}),e.jsx("strong",{children:"Start Date:"})," ",$(i.start_date),e.jsx("br",{}),e.jsx("strong",{children:"Duration:"})," ",i.days||"N/A"," days"]}),e.jsx("label",{htmlFor:"comments",className:"form-label",children:"Comments:"}),e.jsx(Se,{id:"comments",rows:3,value:F,onChange:s=>y(s.target.value),placeholder:"Add any comments here (optional)"})]})}),e.jsxs(q,{children:[e.jsx(h,{color:"secondary",onClick:N,children:"Cancel"}),e.jsx(h,{color:m==="approve"?"success":"danger",onClick:xe,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",className:"me-2"}),"Processing..."]}):m==="approve"?"Approve":"Reject"})]})]}),e.jsxs(G,{visible:te,onClose:D,size:"lg",backdrop:"static",children:[e.jsx(J,{onClose:D,children:e.jsx(K,{children:n&&e.jsxs(e.Fragment,{children:[e.jsx(c,{icon:p,className:"me-2"}),"Document Preview: ",n.employeeName]})})}),e.jsx(Q,{className:"p-0",children:e.jsx("div",{className:"document-viewer",children:ge()})}),e.jsx(q,{children:e.jsxs(h,{color:"secondary",onClick:D,children:[e.jsx(c,{icon:Fe,className:"me-1"}),"Close"]})})]})]})};export{Xe as default};
