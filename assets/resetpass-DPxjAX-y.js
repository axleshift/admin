import{b as U,j as e}from"./index-B59r5dXu.js";import{r as c,i as M,k as T}from"./vendor-react-B6URQkMn.js";import{a as Z}from"./axiosInstance-Df5JLouX.js";import{F as p,w as _,y as I,z as q,A as W}from"./index-sLpWG6sR.js";import{g as D,S as G,T as B,o as K,$ as O,p as J,V,W as y,Z as k,d as b,a0 as Y,n as H}from"./vendor-coreui-C9cgcUrA.js";import"./vendor-redux-DipIbRRz.js";const Q="AIzaSyBlGfiToGE4_D_86kpLw_7QSzvaAySDASA",X="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent",ee=async s=>{try{const t={length:s.length,hasLowercase:/[a-z]/.test(s),hasUppercase:/[A-Z]/.test(s),hasNumbers:/\d/.test(s),hasSymbols:/[^A-Za-z0-9]/.test(s),patterns:{hasRepeatedChars:/(.)\1{2,}/.test(s),hasSequentialNumbers:/(?:012|123|234|345|456|567|678|789)/.test(s),hasKeyboardPatterns:/(?:qwer|asdf|zxcv|wasd)/i.test(s)}},r=`
      As a password security AI, analyze this password's strength based on these features:
      - Length: ${t.length} characters
      - Contains lowercase letters: ${t.hasLowercase}
      - Contains uppercase letters: ${t.hasUppercase}
      - Contains numbers: ${t.hasNumbers}
      - Contains symbols: ${t.hasSymbols}
      - Contains repeated characters: ${t.patterns.hasRepeatedChars}
      - Contains sequential numbers: ${t.patterns.hasSequentialNumbers}
      - Contains keyboard patterns: ${t.patterns.hasKeyboardPatterns}
      
      Provide a JSON response with:
      1. A numerical score from 0-100
      2. A strength classification (Weak, Moderate, Strong, Very Strong)
      3. An array of specific improvement suggestions
      4. A brief explanation of the scoring
      
      Return ONLY valid JSON without any other text.
    `,u=(await U.post(X,{contents:[{parts:[{text:r}]}]},{headers:{"Content-Type":"application/json","x-goog-api-key":Q}})).data.candidates[0].content.parts[0].text,n=u.match(/```json\s*([\s\S]*?)\s*```/)||u.match(/\{[\s\S]*\}/),h=n?JSON.parse(n[0].startsWith("{")?n[0]:n[1]):null;if(!h)throw new Error("Failed to parse AI response");return h}catch(t){return console.error("AI Password Analysis Error:",t),se(s)}},se=s=>{let t=0;const r=[];s.length>=8&&(t+=20),s.length>=12&&(t+=10),/[a-z]/.test(s)&&(t+=10),/[A-Z]/.test(s)&&(t+=15),/\d/.test(s)&&(t+=15),/[^A-Za-z0-9]/.test(s)&&(t+=20),/(.)\1{2,}/.test(s)&&(t-=10),s.length<8&&r.push("Use at least 8 characters"),/[a-z]/.test(s)||r.push("Add lowercase letters"),/[A-Z]/.test(s)||r.push("Add uppercase letters"),/\d/.test(s)||r.push("Add numbers"),/[^A-Za-z0-9]/.test(s)||r.push("Add special characters"),/(.)\1{2,}/.test(s)&&r.push("Avoid repeated characters");let d="Weak";return t>=30&&(d="Moderate"),t>=60&&(d="Strong"),t>=80&&(d="Very Strong"),{score:t,strength:d,feedback:r.length>0?r:["Good password!"],explanation:"Basic password analysis (AI fallback)"}};function le(){const[s,t]=c.useState(""),[r,d]=c.useState(""),[u,n]=c.useState(""),[h,w]=c.useState(""),[o,g]=c.useState(null),[f,j]=c.useState(!1),[A,N]=c.useState(null),[C,S]=c.useState(!1),E=M(),{id:$,token:F}=T(),R=(a,i)=>{let l;return(...x)=>{clearTimeout(l),l=setTimeout(()=>{a(...x)},i)}};c.useEffect(()=>{const a=R(async i=>{if(i.length>=4){j(!0),N(null);try{const l=await ee(i);g(l)}catch(l){console.error("Password analysis error:",l),N("Could not analyze password strength"),g({score:0,strength:"Unknown",feedback:["Password analysis service is currently unavailable."],explanation:"Using basic validation only."})}finally{j(!1)}}else g(null)},500);s?a(s):g(null)},[s]);const L=async a=>{var l,x,v,z;if(a.preventDefault(),n(""),w(""),s!==r){n("Passwords do not match");return}if(s.length<8){n("Password must be at least 8 characters long");return}const i=o||{score:40,strength:"Moderate"};S(!0);try{const m=await Z.post(`/general/reset-password/${$}/${F}`,{password:s,passwordAnalysis:{score:i.score,strength:i.strength}});m.data.Status==="Success"?(w("Password reset successful! Redirecting to login..."),setTimeout(()=>E("/login"),2e3)):n(m.data.Message||"Password reset failed")}catch(m){console.error("Error:",m),((l=m.response)==null?void 0:l.status)===400?n(((v=(x=m.response)==null?void 0:x.data)==null?void 0:v.Message)||"Invalid password or expired token"):((z=m.response)==null?void 0:z.status)===404?n("User not found"):n("An error occurred during password reset. Please try again.")}finally{S(!1)}},P=a=>a<40?"danger":a<60?"warning":a<80?"info":"success";return e.jsx(D,{className:"min-vh-100 d-flex align-items-center justify-content-center bg-light",children:e.jsx(G,{className:"w-100 justify-content-center",children:e.jsx(B,{md:6,lg:4,children:e.jsxs(K,{className:"shadow-lg border-0",children:[e.jsxs(O,{className:"bg-primary text-white text-center py-3",children:[e.jsx(p,{icon:_,size:"2x",className:"me-2"}),e.jsx("h4",{className:"d-inline align-middle",children:"Reset Password"})]}),e.jsx(J,{className:"p-4",children:e.jsxs(V,{onSubmit:L,children:[u&&e.jsx(y,{color:"danger",className:"mb-3",children:u}),h&&e.jsx(y,{color:"success",className:"mb-3",children:h}),e.jsxs("div",{className:"mb-3",children:[e.jsx(k,{type:"password",placeholder:"New Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:I,className:"me-2"}),"New Password"]}),value:s,onChange:a=>t(a.target.value),required:!0,className:"mb-2",autoComplete:"new-password"}),s.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[e.jsx(p,{icon:q,className:"me-2 text-primary"}),"Password Analysis:"]}),f?e.jsx(b,{size:"sm",color:"primary"}):o&&e.jsx("span",{className:`text-${P(o.score)}`,children:o.strength})]}),o&&!f&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{value:o.score,color:P(o.score),className:"mb-2"}),e.jsxs("div",{className:"password-feedback mt-2",children:[o.feedback&&o.feedback.map((a,i)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(p,{icon:W,className:"me-1"}),a]},i)),o.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:o.explanation})]})]}),A&&e.jsx(y,{color:"warning",className:"py-1 mt-2 mb-0 small",children:A})]}),e.jsx(k,{type:"password",placeholder:"Confirm Password",floatingLabel:e.jsxs(e.Fragment,{children:[e.jsx(p,{icon:I,className:"me-2"}),"Confirm Password"]}),value:r,onChange:a=>d(a.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(H,{type:"submit",color:"primary",className:"w-100",disabled:C||f||s.length<8||s!==r,children:C?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"sm",component:"span",className:"me-2"}),"Updating..."]}):f?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:"sm",component:"span",className:"me-2"}),"Analyzing..."]}):"Update Password"})]})})]})})})})}export{le as default};
