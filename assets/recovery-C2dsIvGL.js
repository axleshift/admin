import{j as e}from"./index-Cx8KJ1ZF.js";import{r as a,i as z}from"./vendor-react-B6URQkMn.js";import{a as m}from"./axiosInstance-Bq-uIJjs.js";import{l as u}from"./activityLogger-D6Lc4RsL.js";import{c as F,S as M,N as g,O as h,k as x,X as p,j as o,l as j,C as f,a7 as R,a8 as I}from"./vendor-coreui-DDUzhqJ9.js";import"./vendor-redux-C7peqcPR.js";import"./index-xsH4HHeE.js";const Q=()=>{const[N,y]=a.useState([]),[t,S]=a.useState(null),[b,C]=a.useState([]),[c,k]=a.useState(null),[i,r]=a.useState(!1),[v,B]=a.useState(!1),[w,n]=a.useState(""),A=z(),L=localStorage.getItem("name"),d=()=>({name:L||"Unknown User"});a.useEffect(()=>{E()},[]),a.useEffect(()=>{if(t){P(t);const s=d();u({...s,route:"/recovery",action:"SELECT_BACKUP",description:`Selected backup: ${t.name}`})}else C([])},[t]);const E=async()=>{r(!0),n("");try{const s=await m.get("/admin/list-backups");y(s.data.backups||[])}catch{n("Error fetching backups"),y([])}finally{r(!1)}},P=async s=>{if(s){r(!0),n("");try{const l=await m.get(`/admin/list-collections/${s.name}`);C(l.data.collections||[])}catch{n("Error fetching collections"),C([])}finally{r(!1)}}},T=async()=>{B(!0),n("");try{await m.post("/admin/backup"),E();const s=d();u({...s,route:"/recovery",action:"CREATE_BACKUP",description:"Created new backup"})}catch{n("Error during backup")}finally{B(!1)}},O=async()=>{var s;if(!t||!c){n("Please select a backup and collection.");return}if(window.confirm(`Are you sure you want to restore collection "${c}"? This will replace the current data.`)){r(!0),n("");try{await m.post("/admin/restore",{timestamp:t.name,filename:`${c}.bson`,databaseName:"adminis"});const _=d();u({..._,route:"/recovery",action:"RESTORE_COLLECTION",description:`Restored collection: ${c} from backup: ${t.name}`}),alert("Restore successful!")}catch(l){console.error("Restore error:",((s=l.response)==null?void 0:s.data)||l.message),n("Restore failed. Please check the console for details.")}finally{r(!1)}}},U=async()=>{const s=d();u({...s,route:"/recovery",action:"NAVIGATE_TO_SCHEDULER",description:"Navigated to backup scheduler page"}),A("/cron")},$=()=>{S(null),k(null)},D=()=>{k(null)};return e.jsxs(F,{children:[w&&e.jsx(M,{color:"danger",className:"mt-3",children:w}),e.jsx(g,{className:"mb-4 mt-3",children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsxs(p,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:"Backup Configuration"}),e.jsx(o,{className:"ms-auto",color:"primary",onClick:U,children:"Schedule Backup"})]}),e.jsx(j,{children:e.jsx(o,{color:"primary",className:"mt-3",onClick:T,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm"})," Creating Backup..."]}):"Create New Backup"})})]})})}),e.jsxs(g,{children:[e.jsx(h,{md:"6",children:e.jsxs(x,{children:[e.jsxs(p,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:"Available Backups"}),t&&e.jsx(o,{color:"link",className:"p-0",onClick:$,children:"Select Different"})]}),e.jsx(j,{children:i&&!t?e.jsx(f,{}):e.jsx(e.Fragment,{children:t?e.jsxs("div",{className:"p-3",children:[e.jsx("h5",{children:t.name}),e.jsxs("small",{className:"d-block text-muted",children:[new Date(t.created).toLocaleString()," - ",Math.round(t.size/1024/1024),"MB"]})]}):N.length===0?e.jsx("div",{className:"text-center p-3",children:"No backups available"}):e.jsx(R,{children:N.map(s=>e.jsxs(I,{onClick:()=>S(s),style:{cursor:"pointer"},children:[s.name,e.jsxs("small",{className:"d-block text-muted",children:[new Date(s.created).toLocaleString()," - ",Math.round(s.size/1024/1024),"MB"]})]},s.name))})})})]})}),e.jsx(h,{md:"6",children:e.jsxs(x,{children:[e.jsxs(p,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:"Select Collection"}),c&&e.jsx(o,{color:"link",className:"p-0",onClick:D,children:"Select Different"})]}),e.jsx(j,{children:i&&t&&!c?e.jsx(f,{}):e.jsx(e.Fragment,{children:t?c?e.jsx("div",{className:"p-3",children:e.jsx("h5",{children:c})}):b.length===0?e.jsx("div",{className:"text-center p-3",children:"No collections found in this backup"}):e.jsx(R,{children:b.map(s=>e.jsx(I,{onClick:()=>k(s),style:{cursor:"pointer"},children:s},s))}):e.jsx("div",{className:"text-center p-3",children:"Select a backup first"})})})]})})]}),e.jsx(g,{className:"mt-4",children:e.jsx(h,{children:e.jsxs(x,{children:[e.jsx(p,{children:"Restore Options"}),e.jsxs(j,{children:[e.jsxs("div",{className:"mb-3",children:[t&&e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Backup:"})," ",t.name]}),c&&e.jsxs("div",{children:[e.jsx("strong",{children:"Selected Collection:"})," ",c]})]}),t&&c?e.jsx(o,{color:"warning",onClick:O,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm"})," Restoring..."]}):"Restore Collection"}):e.jsx("div",{className:"text-muted",children:"Please select a backup and collection to restore"})]})]})})})]})};export{Q as default};
