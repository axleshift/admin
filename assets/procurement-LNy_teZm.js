import{j as e}from"./index-DV-wgTl8.js";import{r as l,R as k}from"./vendor-react-B6URQkMn.js";import{a as F}from"./axiosInstance-Bq-uIJjs.js";import{F as c,ax as L,R as z,D as H,a7 as C,_ as q,a4 as Q,N as p,ay as V,az as $,Q as d,T as M,aA as N}from"./index-DgWFfLP0.js";import{N as O,O as X,k as y,X as D,j as S,l as b,S as P,C as G,_ as w,$ as v,a0 as t,a1 as n,a2 as I,a3 as a,as as J,y as K}from"./vendor-coreui-DDUzhqJ9.js";import"./vendor-redux-C7peqcPR.js";import"./index-xsH4HHeE.js";const ne=()=>{const[x,T]=l.useState([]),[i,m]=l.useState(!0),[j,h]=l.useState(null),[g,E]=l.useState({}),R=localStorage.getItem("role"),A=localStorage.getItem("department");localStorage.getItem("userId");const B=localStorage.getItem("name"),_=s=>{E(r=>({...r,[s]:!r[s]}))},u=async()=>{m(!0);try{const s=await F.get("/logistics/procurement");T(s.data.data),h(null)}catch(s){h("Error fetching procurement data"),console.error("Procurement data fetch error:",s)}finally{m(!1)}};l.useEffect(()=>{u()},[]);const U=s=>{const r={Pending:{color:"warning",icon:d},Approved:{color:"success",icon:N},"In Progress":{color:"info",icon:d},Completed:{color:"success",icon:N},Cancelled:{color:"danger",icon:M},default:{color:"secondary",icon:d}},f=r[s]||r.default;return logActivity({name:B,role:R,department:A,route:"/procurement",action:"Add Vehicle Initiated",description:"User initiated adding a new vehicle"}).catch(console.warn),e.jsxs(K,{color:f.color,className:"px-2 py-1",children:[e.jsx(c,{icon:f.icon,className:"me-1"})," ",s]})},o=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return e.jsx(O,{children:e.jsx(X,{xs:12,children:e.jsxs(y,{className:"mb-4",children:[e.jsxs(D,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(c,{icon:L,className:"me-2"}),e.jsx("strong",{children:"Procurement Management"})]}),e.jsxs(S,{color:"outline-primary",size:"sm",onClick:u,disabled:i,children:[e.jsx(c,{icon:z,className:i?"fa-spin me-1":"me-1"}),"Refresh"]})]}),e.jsxs(b,{children:[j&&e.jsxs(P,{color:"danger",children:[e.jsx(c,{icon:H,className:"me-2"}),j]}),i?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(G,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading procurement data..."})]}):e.jsx(e.Fragment,{children:x.length===0?e.jsx(P,{color:"info",children:"No procurement records found"}):e.jsxs(w,{hover:!0,responsive:!0,striped:!0,className:"border",children:[e.jsx(v,{color:"light",children:e.jsxs(t,{children:[e.jsx(n,{scope:"col",children:"Title"}),e.jsx(n,{scope:"col",children:"Description"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:C,className:"me-1"})," Procurement Date"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:q,className:"me-1"})," Department"]}),e.jsx(n,{scope:"col",children:"Status"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:Q,className:"me-1"})," Est. Cost"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:C,className:"me-1"})," Delivery Date"]}),e.jsx(n,{scope:"col",children:"Products"})]})}),e.jsx(I,{children:x.map(s=>e.jsxs(k.Fragment,{children:[e.jsxs(t,{children:[e.jsx(a,{children:s.title}),e.jsx(a,{children:s.description.length>50?`${s.description.substring(0,50)}...`:s.description}),e.jsx(a,{children:new Date(s.procurementDate).toLocaleDateString()}),e.jsx(a,{children:s.department}),e.jsx(a,{children:U(s.status)}),e.jsx(a,{children:o(s.estimatedCost)}),e.jsx(a,{children:new Date(s.deliveryDate).toLocaleDateString()}),e.jsx(a,{children:e.jsxs(S,{color:"link",size:"sm",onClick:()=>_(s._id),children:[e.jsx(c,{icon:p,className:"me-1"}),s.products.length," Items",e.jsx(c,{icon:g[s._id]?V:$,className:"ms-1"})]})})]}),e.jsx(t,{children:e.jsx(a,{colSpan:"8",className:"p-0",children:e.jsx(J,{visible:g[s._id],children:e.jsxs(y,{className:"m-3 border-0",children:[e.jsxs(D,{children:[e.jsx(c,{icon:p,className:"me-2"}),"Product Details"]}),e.jsx(b,{children:e.jsxs(w,{small:!0,borderless:!0,children:[e.jsx(v,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Unit"}),e.jsx(n,{children:"Unit Price"}),e.jsx(n,{children:"Total"})]})}),e.jsx(I,{children:s.products.map(r=>e.jsxs(t,{children:[e.jsx(a,{children:r.name}),e.jsx(a,{children:r.quantity}),e.jsx(a,{children:r.unit}),e.jsx(a,{children:o(r.unitPrice)}),e.jsx(a,{children:o(r.quantity*r.unitPrice)})]},r._id))})]})})]})})})})]},s._id))})]})})]})]})})})};export{ne as default};
