import{j as e}from"./index-bhWy8BVO.js";import{r}from"./vendor-react-B6URQkMn.js";import{a as w}from"./axiosInstance-Dv2jt_v_.js";import{l as F}from"./activityLogger-CswLieGG.js";import"./vendor-redux-DipIbRRz.js";import"./vendor-coreui-vXCAeGSv.js";import"./index-t--hEgTQ.js";const V=()=>{const[c,N]=r.useState([]),[i,p]=r.useState(1),[j,P]=r.useState(0),[o,l]=r.useState(!1),[g,d]=r.useState(null),u=sessionStorage.getItem("role"),m=sessionStorage.getItem("department"),x=sessionStorage.getItem("name");r.useEffect(()=>{F({name:x,role:u,department:m,route:"/freights",action:"Page Visit",description:"User viewed the freights list page"})},[x,u,m]);const f=async()=>{var t,a;l(!0),d(null);try{const n=await w.post("/core/syncFreightData");console.log("Sync response:",n.data),await y()}catch(n){d(((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"An error occurred while syncing freights"),console.error("Error syncing freights:",n)}finally{l(!1)}},y=async()=>{var t,a,n,S;l(!0),d(null);try{const s=await w.get("/core/freight",{params:{page:i}});if(!s.data||!Array.isArray(s.data.freights))throw new Error("Invalid response format");N(s.data.freights),P(s.data.totalPages||1)}catch(s){const v=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||s.message||"An unexpected error occurred";d(v),console.error("Detailed Fetch Error:",{status:(n=s.response)==null?void 0:n.status,data:(S=s.response)==null?void 0:S.data,message:v})}finally{l(!1)}};r.useEffect(()=>{f()},[]),r.useEffect(()=>{y()},[i]);const b=t=>{F({name:x,role:u,department:m,route:`/freights/${t}`,action:"View Freight",description:`User viewed details for freight ID: ${t}`})},E=()=>p(t=>Math.max(t-1,1)),k=()=>p(t=>t+1),h=o&&c.length===0;return e.jsxs("div",{className:"freight-list-container",children:[e.jsx("h2",{children:"Freight List"}),h&&e.jsx("p",{children:"Fetching freights..."}),!h&&g&&e.jsxs("p",{children:["Error: ",g]}),!h&&!g&&c.length===0&&e.jsx("p",{children:"No freights available."}),e.jsx("div",{className:"sync-section",children:e.jsx("button",{onClick:f,disabled:o,children:o?"Syncing...":"Sync Freight Data"})}),e.jsxs("table",{className:"freight-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tracking Number"}),e.jsx("th",{children:"Country"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total Weight"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:c.length>0?c.map(t=>e.jsxs("tr",{onClick:()=>b(t._id),className:"freight-row",children:[e.jsx("td",{children:t.tracking_number}),e.jsx("td",{children:t.country}),e.jsx("td",{children:t.status}),e.jsxs("td",{children:[t.total_weight," kg"]}),e.jsxs("td",{children:[t.amount.currency," ",t.amount.value]}),e.jsx("td",{children:e.jsx("button",{onClick:a=>{a.stopPropagation(),b(t._id)},children:"View Details"})})]},t._id)):!h&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"No freights available"})})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:E,disabled:i===1||o,children:"Previous"}),e.jsxs("span",{children:["Page ",i," of ",j]}),e.jsx("button",{onClick:k,disabled:i===j||o,children:"Next"})]})]})};export{V as default};
