import{l as V,j as e}from"./index-Ngt4IgIB.js";import{r as d}from"./vendor-react-B6URQkMn.js";import{a as z}from"./axiosInstance-CKhgb2PG.js";import{F as g,S as W,O as $,T as G,U as J}from"./index-BPaG30GW.js";import{S as K,T as Q,o as X,$ as Y,p as Z,n as b,a1 as I,a2 as ee,a3 as A,a4 as p,a5 as se,a6 as u,_ as T,d as F,W as D}from"./vendor-coreui-C9cgcUrA.js";import"./vendor-redux-DipIbRRz.js";const ie=()=>{const[H,{isLoading:C}]=V(),[m,N]=d.useState([]),[S,y]=d.useState(!1),[L,U]=d.useState(!1),[h,v]=d.useState({}),[E,f]=d.useState({}),[w,x]=d.useState({}),M=["Administrative","Finance","HR","Core","Logistics"],_={Finance:["User","Admin","Staff","Superadmin","Technician"],Administrative:["Admin","Manager","Superadmin"],HR:["Admin","Manager","Employee","Contractor"],Core:["Admin","Manager","Employee","Contractor"],Logistics:["Admin","Manager","Employee","Contractor"]},R=async()=>{y(!0),U(!1);try{const s=await z.get("/hr/newUsers");N(s.data)}catch(s){console.error("Error fetching users:",s),U(!0)}finally{y(!1)}};d.useEffect(()=>{R()},[]);const k=s=>{const a=h[s]||{},r={};return a.department||(r.department="Department is required"),a.role||(r.role="Role is required"),f(t=>({...t,[s]:r})),Object.keys(r).length===0},B=(s,a)=>{v(r=>({...r,[s]:{...r[s],department:a,role:""}})),f(r=>({...r,[s]:{}}))},P=(s,a)=>{v(r=>({...r,[s]:{...r[s],role:a}})),f(r=>({...r,[s]:{}}))},q=s=>{N(n=>n.filter(c=>(c._id||c.id)!==s));const a={...h},r={...E},t={...w};delete a[s],delete r[s],delete t[s],v(a),f(r),x(t)},O=async s=>{var n,c;const a=s._id||s.id;if(!k(a))return;const t={id:a,firstName:s.firstName||((n=s.name)==null?void 0:n.split(" ")[0])||"",lastName:s.lastName||((c=s.name)==null?void 0:c.split(" ").slice(1).join(" "))||"",email:s.email,department:h[a].department,role:h[a].role};try{x(l=>({...l,[a]:{loading:!0,error:null}}));const j=await H(t).unwrap();x(l=>({...l,[a]:{loading:!1,error:null,success:!0}})),q(a),setTimeout(()=>{x(l=>{const i={...l};return delete i[a],i})},3e3)}catch(j){x(l=>{var i;return{...l,[a]:{loading:!1,error:((i=j.data)==null?void 0:i.message)||"An unexpected error occurred",success:!1}}}),console.error("Save user error:",j)}};return e.jsx(K,{children:e.jsx(Q,{md:12,children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs("h4",{children:[e.jsx(g,{icon:W,className:"me-2"}),"New Users Registration"]})}),e.jsxs(Z,{children:[e.jsx("div",{className:"d-flex justify-content-end mb-3",children:e.jsxs(b,{color:"info",onClick:R,disabled:S,children:[e.jsx(g,{icon:$,className:"me-2"}),"Refresh"]})}),e.jsxs(I,{hover:!0,responsive:!0,children:[e.jsx(ee,{children:e.jsxs(A,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Email"}),e.jsx(p,{children:"Department"}),e.jsx(p,{children:"Role"}),e.jsx(p,{children:"Actions"})]})}),e.jsx(se,{children:m==null?void 0:m.map(s=>{var l,i;const a=s._id||s.id,r=h[a]||{},t=E[a]||{},n=w[a]||{},c=s.firstName||((l=s.name)==null?void 0:l.split(" ")[0])||"",j=s.lastName||((i=s.name)==null?void 0:i.split(" ").slice(1).join(" "))||"";return e.jsxs(A,{children:[e.jsxs(u,{children:[c," ",j]}),e.jsx(u,{children:s.email}),e.jsxs(u,{children:[e.jsxs(T,{value:r.department||"",onChange:o=>B(a,o.target.value),invalid:!!t.department,children:[e.jsx("option",{value:"",children:"Select Department"}),M.map(o=>e.jsx("option",{value:o,children:o},o))]}),t.department&&e.jsx("div",{className:"text-danger small",children:t.department})]}),e.jsxs(u,{children:[e.jsxs(T,{value:r.role||"",onChange:o=>P(a,o.target.value),disabled:!r.department,invalid:!!t.role,children:[e.jsx("option",{value:"",children:"Select Role"}),(_[r.department]||[]).map(o=>e.jsx("option",{value:o,children:o},o))]}),t.role&&e.jsx("div",{className:"text-danger small",children:t.role})]}),e.jsxs(u,{children:[e.jsx(b,{color:n.success?"success":n.error?"danger":"primary",onClick:()=>O(s),disabled:n.loading||C,children:n.loading||C?e.jsx(F,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{icon:G,className:"me-2"}),n.success?"Saved":n.error?"Retry":"Save"]})}),n.error&&e.jsxs("div",{className:"text-danger small mt-1",children:[e.jsx(g,{icon:J,className:"me-1"}),n.error]})]})]},a)})})]}),S&&e.jsx("div",{className:"text-center my-3",children:e.jsx(F,{color:"primary"})}),L&&e.jsx(D,{color:"danger",children:"Failed to load users. Please try again."}),(!m||m.length===0)&&!S&&e.jsx(D,{color:"info",children:"No new users available for registration."})]})]})})})};export{ie as default};
