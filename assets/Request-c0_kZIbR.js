import{k as P,j as e}from"./index-DV-wgTl8.js";import{r as o}from"./vendor-react-B6URQkMn.js";import{F as u,U as w,f as E,E as $,V as M}from"./index-DgWFfLP0.js";import{l as m}from"./activityLogger-D6Lc4RsL.js";import{c as F,N as f,O as x,k as D,X as B,l as L,V as T,a5 as V,j as H}from"./vendor-coreui-DDUzhqJ9.js";import"./vendor-redux-C7peqcPR.js";import"./axiosInstance-Bq-uIJjs.js";import"./index-xsH4HHeE.js";const O=s=>s?s.length<=2?"*".repeat(s.length):`${s[0]}${"*".repeat(s.length-2)}${s[s.length-1]}`:"",J=[{category:"HR",icon:E,permissions:[{key:"/worker",label:"Employees"},{key:"/jobposting",label:"Job Postings"},{key:"/payroll",label:"Payroll Management"},{key:"/leave",label:"Leave Management"}]}],Z=()=>{const[s,g]=o.useState([]),[d,y]=o.useState(""),[l,h]=o.useState(""),[c,b]=o.useState(""),[S,j]=o.useState(""),[n,i]=o.useState(null),[k,{isLoading:p}]=P();o.useEffect(()=>{const t=localStorage.getItem("userId"),a=localStorage.getItem("name"),r=localStorage.getItem("department"),A=localStorage.getItem("role");t&&(y(t),j(O(t))),a&&h(a),r&&b(r),m({name:a,role:A,department:r,route:"/access-request",action:"Page Visit",description:"User visited the access request page"})},[]);const C=t=>{const a=s.includes(t)?s.filter(r=>r!==t):[...s,t];g(a),m({name:l,role:localStorage.getItem("role"),department:c,route:"/access-request",action:"Toggle Permission",description:`User ${s.includes(t)?"removed":"added"} permission: ${t}`})},N=async()=>{var t,a;if(i(null),!d||!l||!c||s.length===0){i({success:!1,message:"Ensure all fields are filled and at least one permission is selected."});return}try{const r=await k({requestType:"AccessRequest",pageName:s[0]||"",name:l,department:c,username:d,requestDetails:{permissions:s}}).unwrap();m({name:l,role:localStorage.getItem("role"),department:c,route:"/access-request",action:"Submit Request",description:`User submitted access request for permissions: ${s.join(", ")}`}),i({success:!0,message:"Access request sent successfully!"}),g([])}catch(r){m({name:l,role:localStorage.getItem("role"),department:c,route:"/access-request",action:"Submit Request Failed",description:`User failed to submit access request: ${((t=r.data)==null?void 0:t.error)||"Unknown error"}`}),i({success:!1,message:((a=r.data)==null?void 0:a.error)||"Failed to send request"})}},q={backgroundColor:"#f8f9fa",color:"#000"},U={backgroundColor:"#321fdb",color:"#fff"},I={backgroundColor:"#f8f9fa",color:"#000",padding:"12px",borderRadius:"6px",marginBottom:"16px"},R={backgroundColor:"#f8f9fa",color:"#000"},v={position:"sticky",top:"20px",maxHeight:"90vh",overflowY:"auto"};return e.jsx(F,{fluid:!0,className:"py-4 bg-light",children:e.jsx(f,{className:"justify-content-center",children:e.jsx(x,{md:8,lg:6,children:e.jsx("div",{style:v,children:e.jsxs(D,{className:"shadow-lg mb-4",style:q,children:[e.jsxs(B,{className:"d-flex align-items-center",style:U,children:[e.jsx(u,{icon:w,className:"me-2"}),e.jsx("strong",{children:"Access Request"})]}),e.jsxs(L,{children:[e.jsx(T,{type:"text",label:"User ID",value:S,readOnly:!0,style:R,className:"mb-4"}),e.jsx("label",{className:"form-label",children:"Available Permissions"}),J.map(t=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",style:I,children:[e.jsx(u,{icon:t.icon,className:"me-2 text-primary"}),e.jsx("strong",{children:t.category})]}),e.jsx(f,{children:t.permissions.map(a=>e.jsx(x,{xs:12,md:6,className:"mb-3",children:e.jsx(V,{id:a.key,label:a.label,checked:s.includes(a.key),onChange:()=>C(a.key)})},a.key))})]},t.category)),n&&e.jsxs("div",{className:`alert ${n.success?"alert-success":"alert-danger"} d-flex align-items-center mt-3`,children:[e.jsx(u,{icon:n.success?$:M,className:"me-2"}),n.message]}),e.jsx(H,{color:"primary",className:"w-100 mt-3",onClick:N,disabled:p||!d,children:p?"Sending Request...":"Submit Access Request"})]})]})})})})})};export{Z as default};
