import{j as e}from"./index-Creopves.js";import{r as n,R as re}from"./vendor-react-B6URQkMn.js";import{a as X}from"./axiosInstance-z6yTqPqm.js";import{F as c,O as te,D as ne,E as le,X as Y,Y as q,a5 as oe,a7 as ce,a8 as ie,a9 as de,aa as ue}from"./index-BSUr8F9F.js";import{S as V,T as D,o as me,$ as xe,n as p,p as pe,X as he,Y as je,Z as ye,d as ge,W,a1 as Ce,a2 as fe,a3 as I,a4 as d,a5 as Ne,a6 as i,D as Se,ac as be,ad as M,x as ke,y as ve,a8 as Pe,z as Fe,a7 as we,A as Ae}from"./vendor-coreui-C9cgcUrA.js";import"./vendor-redux-DipIbRRz.js";const Le=()=>{const[y,g]=n.useState([]),[f,_]=n.useState(!0),[C,R]=n.useState(null),[T,Z]=n.useState(""),[l,K]=n.useState({key:"id",direction:"ascending"}),[h,N]=n.useState(1),S=10,[Q,j]=n.useState(!1),[x,E]=n.useState(null),[o,L]=n.useState(""),[$,b]=n.useState(""),[B,O]=n.useState(!1),[U,k]=n.useState(null);n.useEffect(()=>{v()},[]);const v=async()=>{try{_(!0);const s=await X.get("/hr/payroll");s.data&&Array.isArray(s.data)?g(s.data):(console.warn("Unexpected API response format:",s.data),g([])),R(null)}catch(s){R("Failed to fetch payroll data. Please try again later."),console.error("Error fetching payroll data:",s),g([])}finally{_(!1)}},u=s=>{let a="ascending";l.key===s&&l.direction==="ascending"&&(a="descending"),K({key:s,direction:a})},m=s=>l.key!==s?e.jsx(c,{icon:ie,className:"ms-1 text-gray-400"}):l.direction==="ascending"?e.jsx(c,{icon:de,className:"ms-1"}):e.jsx(c,{icon:ue,className:"ms-1"}),P=re.useMemo(()=>l.key?[...y].sort((s,a)=>{const r=s[l.key],t=a[l.key];return!isNaN(parseFloat(r))&&!isNaN(parseFloat(t))?l.direction==="ascending"?parseFloat(r)-parseFloat(t):parseFloat(t)-parseFloat(r):typeof r=="string"&&typeof t=="string"?l.direction==="ascending"?r.localeCompare(t):t.localeCompare(r):r<t?l.direction==="ascending"?-1:1:r>t?l.direction==="ascending"?1:-1:0}):y,[y,l]).filter(s=>Object.values(s).some(a=>a&&a.toString().toLowerCase().includes(T.toLowerCase()))),z=h*S,ee=z-S,G=P.slice(ee,z),F=Math.ceil(P.length/S),w=s=>s==null?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),H=s=>["January","February","March","April","May","June","July","August","September","October","November","December"][s-1]||`Month ${s}`,se=s=>{switch(s==null?void 0:s.toLowerCase()){case"approved":return"success";case"paid":return"success";case"pending":return"warning";case"rejected":return"danger";case"failed":return"danger";default:return"secondary"}},J=(s,a)=>{E(s),L(a),b(""),k(null),j(!0)},ae=async()=>{var s,a;if(!(!x||!o)){O(!0),k(null);try{const r=await X.put(`/hr/payroll/${x.id}/status`,{status:o,remarks:$});g(t=>t.map(A=>A.id===x.id?{...A,status:o.charAt(0).toUpperCase()+o.slice(1),payroll_status:o}:A)),j(!1),E(null),L(""),b("")}catch(r){console.error(`Failed to ${o} payroll:`,r),k(`Failed to ${o} payroll. ${((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.error)||"Please try again later."}`)}finally{O(!1)}}};return e.jsxs("div",{className:"mb-4",children:[e.jsx(V,{children:e.jsx(D,{children:e.jsxs(me,{className:"mb-4",children:[e.jsxs(xe,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:"Payroll Management"}),e.jsxs("div",{children:[e.jsxs(p,{color:"light",className:"me-2",onClick:v,children:[e.jsx(c,{icon:te,className:"me-1"})," Refresh"]}),e.jsxs(p,{color:"primary",children:[e.jsx(c,{icon:ne,className:"me-1"}),"Generate Report"]})]})]}),e.jsxs(pe,{children:[e.jsxs(V,{className:"mb-3",children:[e.jsx(D,{md:6,children:e.jsxs(he,{children:[e.jsx(je,{children:e.jsx(c,{icon:le})}),e.jsx(ye,{placeholder:"Search payroll...",value:T,onChange:s=>Z(s.target.value)})]})}),e.jsx(D,{md:6,className:"d-flex justify-content-end align-items-center",children:!f&&!C&&e.jsxs("small",{className:"text-medium-emphasis",children:["Showing ",P.length," of ",y.length," records"]})})]}),f&&e.jsxs("div",{className:"text-center p-5",children:[e.jsx(ge,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading payroll data..."})]}),C&&e.jsxs(W,{color:"danger",children:[C,e.jsx(p,{color:"link",className:"p-0 ms-2",onClick:v,children:"Try again"})]}),!f&&!C&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(Ce,{hover:!0,bordered:!0,children:[e.jsx(fe,{color:"light",children:e.jsxs(I,{children:[e.jsxs(d,{onClick:()=>u("id"),style:{cursor:"pointer"},children:["ID ",m("id")]}),e.jsxs(d,{onClick:()=>u("employee_id"),style:{cursor:"pointer"},children:["Employee ID ",m("employee_id")]}),e.jsxs(d,{onClick:()=>u("name"),style:{cursor:"pointer"},children:["Employee ",m("name")]}),e.jsxs(d,{onClick:()=>u("department"),style:{cursor:"pointer"},children:["Department ",m("department")]}),e.jsxs(d,{onClick:()=>u("job_position"),style:{cursor:"pointer"},children:["Position ",m("job_position")]}),e.jsxs(d,{onClick:()=>u("gross_salary"),style:{cursor:"pointer"},className:"text-end",children:["Gross Pay ",m("gross_salary")]}),e.jsxs(d,{onClick:()=>u("net_salary"),style:{cursor:"pointer"},className:"text-end",children:["Net Pay ",m("net_salary")]}),e.jsxs(d,{onClick:()=>u("year"),style:{cursor:"pointer"},className:"text-center",children:["Period ",m("year")]}),e.jsxs(d,{onClick:()=>u("status"),style:{cursor:"pointer"},className:"text-center",children:["Status ",m("status")]}),e.jsx(d,{className:"text-center",children:"Actions"})]})}),e.jsx(Ne,{children:G.length>0?G.map((s,a)=>{var r,t;return e.jsxs(I,{children:[e.jsx(i,{children:s.id||"—"}),e.jsx(i,{children:s.employee_id||"—"}),e.jsx(i,{children:s.name||"—"}),e.jsx(i,{children:s.department||"—"}),e.jsx(i,{children:s.job_position||"—"}),e.jsx(i,{className:"text-end",children:w(s.gross_salary)}),e.jsx(i,{className:"text-end",children:w(s.net_salary)}),e.jsx(i,{className:"text-center",children:`${H(s.month)}, ${s.year}`}),e.jsx(i,{className:"text-center",children:e.jsx(Se,{color:se(s.status),children:s.status||"Pending"})}),e.jsxs(i,{className:"text-center",children:[((r=s.status)==null?void 0:r.toLowerCase())==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{color:"success",size:"sm",className:"me-1",onClick:()=>J(s,"approved"),children:[e.jsx(c,{icon:Y,className:"me-1"}),"Approve"]}),e.jsxs(p,{color:"danger",size:"sm",onClick:()=>J(s,"rejected"),children:[e.jsx(c,{icon:q,className:"me-1"}),"Reject"]})]}),((t=s.status)==null?void 0:t.toLowerCase())!=="pending"&&e.jsxs(p,{color:"secondary",size:"sm",disabled:!0,children:[e.jsx(c,{icon:oe,className:"me-1"}),"View Details"]})]})]},s.id||a)}):e.jsx(I,{children:e.jsx(i,{colSpan:"10",className:"text-center p-4 text-medium-emphasis",children:"No payroll records found."})})})]})}),F>1&&e.jsxs(be,{className:"mt-3 justify-content-center","aria-label":"Page navigation",children:[e.jsx(M,{disabled:h===1,onClick:()=>N(h-1),children:"Previous"}),Array.from({length:F},(s,a)=>a+1).map(s=>e.jsx(M,{active:s===h,onClick:()=>N(s),children:s},s)),e.jsx(M,{disabled:h===F,onClick:()=>N(h+1),children:"Next"})]})]})]})]})})}),e.jsxs(ke,{visible:Q,onClose:()=>j(!1),children:[e.jsx(ve,{onClose:()=>j(!1),children:e.jsx(Pe,{children:o==="approved"?"Approve Payroll":"Reject Payroll"})}),e.jsx(Fe,{children:x&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",x.name,e.jsx("br",{}),e.jsx("strong",{children:"Amount:"})," ",w(x.net_salary),e.jsx("br",{}),e.jsx("strong",{children:"Period:"})," ",H(x.month),", ",x.year]}),e.jsxs("p",{children:["Are you sure you want to ",o==="approved"?"approve":"reject"," this payroll?"]}),e.jsx(we,{id:"statusRemarks",label:"Remarks (Optional)",placeholder:"Enter any remarks about this decision...",rows:3,value:$,onChange:s=>b(s.target.value)}),U&&e.jsx(W,{color:"danger",className:"mt-3",children:U})]})}),e.jsxs(Ae,{children:[e.jsx(p,{color:"secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx(p,{color:o==="approved"?"success":"danger",onClick:ae,disabled:B,children:B?e.jsxs(e.Fragment,{children:[e.jsx(c,{icon:ce,spin:!0,className:"me-1"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{icon:o==="approved"?Y:q,className:"me-1"}),o==="approved"?"Approve":"Reject"]})})]})]})]})};export{Le as default};
