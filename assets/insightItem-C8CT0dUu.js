import{j as e}from"./index-C1kKK9j-.js";import{r as h}from"./vendor-react-BHxUanFt.js";import{a as R}from"./axiosInstance-Bq-uIJjs.js";import{F as r,z as _,T as H,a7 as ee,h as Q,Q as se,A as ae,a8 as te,a1 as le,g as re,C as O,a2 as ne,a3 as C,a4 as P,a5 as V}from"./index-ByAwoHiW.js";import{a as f,b as x,d as D,n as I,L as ce,N as ie,O as M,l as N,e as $,m as de,g as q,a1 as F,q as W,p as v,w as me,x as oe,y as T,z as w,A as he,B as m,a2 as xe}from"./vendor-coreui-CLDxaGvm.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const Ce=()=>{const[n,E]=h.useState(null),[j,g]=h.useState(!0),[b,S]=h.useState(null),[A,p]=h.useState("6months"),[c,U]=h.useState(!1);h.useEffect(()=>{const a=()=>{const Z=window.matchMedia("(prefers-color-scheme: dark)").matches||document.body.classList.contains("dark-mode")||document.body.classList.contains("dark-theme")||document.documentElement.getAttribute("data-coreui-theme")==="dark";U(Z)};a();const t=window.matchMedia("(prefers-color-scheme: dark)");t.addEventListener("change",a);const l=new MutationObserver(a);return l.observe(document.documentElement,{attributes:!0}),l.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>{t.removeEventListener("change",a),l.disconnect()}},[]),h.useEffect(()=>{(async()=>{var t,l;try{g(!0);const d=await R.get(`/core/insight/item?timeframe=${A}`);console.log("API Response:",d.data),E(d.data)}catch(d){console.error("Error fetching data:",d),S(((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.error)||"Failed to fetch data")}finally{g(!1)}})()},[A]);const s=(()=>{if(!n)return null;if(n.labels&&n.data)return{labels:n.labels,data:n.data};let a=[],t=[];return Array.isArray(n.months)&&Array.isArray(n.items)?(a=n.months,t=n.items):Array.isArray(n)?n.forEach(l=>{l.month&&a.push(l.month),l.count!==void 0&&t.push(l.count)}):n.data&&(Array.isArray(n.data.months)&&Array.isArray(n.data.items)?(a=n.data.months,t=n.data.items):Array.isArray(n.data)&&n.data.forEach(l=>{l.month&&a.push(l.month),l.count!==void 0&&t.push(l.count)})),{labels:a,data:t}})(),o=s&&s.data.length>0?s.data.reduce((a,t)=>a+Number(t),0):0,Y=s&&s.data.length>0?Math.max(...s.data.map(a=>Number(a)),1):1,i=a=>{if(!s||a===0||!s.data[a]||!s.data[a-1])return null;const t=Number(s.data[a]),l=Number(s.data[a-1]);return l===0?null:(t-l)/l*100},u=a=>a===null?"secondary":a>0?"success":a<0?"danger":"info",k=a=>a===null?C:a>0?P:a<0?V:C,G=()=>!s||s.data.length===0?0:o/s.data.length,z=()=>{(async()=>{var t,l;try{g(!0);const d=await R.get(`/core/insight/item?timeframe=${A}`);E(d.data)}catch(d){S(((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.error)||"Failed to fetch data")}finally{g(!1)}})()},J=c?"mb-4 shadow-sm border-0 text-light":"mb-4 shadow-sm border-0",K=c?"d-flex justify-content-between align-items-center py-3 border-bottom text-light":"bg-white d-flex justify-content-between align-items-center py-3 border-bottom",X=c?"min-vh-100 d-flex flex-column":"bg-light min-vh-100 d-flex flex-column",B=c?"border-bottom":"bg-light",L=c?"":"bg-white",y=c?"text-dark":"";return e.jsx("div",{className:X,children:e.jsx("div",{className:"py-4",children:e.jsx(f,{children:e.jsx(x,{md:12,children:e.jsxs(D,{className:J,children:[e.jsxs(I,{className:K,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-0",children:[e.jsx(r,{icon:_,className:"me-2 text-success"}),"Items Insights"]}),e.jsx("small",{className:c?"text-light-emphasis":"text-body-secondary",children:"Track and analyze your monthly item distribution"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(ce,{children:e.jsxs(ie,{children:[e.jsx(M,{onClick:()=>p("6months"),children:"Last 6 Months"}),e.jsx(M,{onClick:()=>p("12months"),children:"Last 12 Months"}),e.jsx(M,{onClick:()=>p("ytd"),children:"Year to Date"})]})}),e.jsxs(N,{color:c?"dark":"light",onClick:z,disabled:j,children:[e.jsx(r,{icon:H,className:j?"fa-spin me-2":"me-2"}),"Refresh"]}),e.jsxs(N,{color:c?"dark":"light",children:[e.jsx(r,{icon:ee,className:"me-2"}),"Export"]})]})]}),e.jsxs($,{className:"p-4",children:[j&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"300px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{color:"primary",style:{width:"3rem",height:"3rem"}}),e.jsx("p",{className:`mt-3 ${c?"text-light-emphasis":"text-medium-emphasis"}`,children:"Loading item data..."})]})}),b&&e.jsxs(q,{color:"danger",className:"d-flex align-items-center",children:[e.jsx(r,{icon:Q,className:"me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-heading",children:"Data Fetch Error"}),e.jsx("p",{className:"mb-0",children:b}),e.jsxs(N,{color:"danger",variant:"ghost",size:"sm",className:"mt-2",onClick:z,children:[e.jsx(r,{icon:H,className:"me-1"})," Try Again"]})]})]}),!j&&!b&&(!s||s.data.length===0)&&e.jsxs(q,{color:"warning",className:"d-flex align-items-center",children:[e.jsx(r,{icon:Q,className:"me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"alert-heading",children:"No Data Available"}),e.jsx("p",{className:"mb-0",children:"No item data available for the selected time period."}),e.jsxs(N,{color:"warning",variant:"ghost",size:"sm",className:"mt-2",onClick:()=>p("12months"),children:[e.jsx(r,{icon:se,className:"me-1"})," Try Different Time Period"]})]})]}),s&&s.data.length>0&&!j&&!b&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{className:"mb-4",children:[e.jsx(x,{lg:4,md:6,className:"mb-4",children:e.jsx(F,{color:"primary",className:"h-100",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"p-3 bg-primary bg-opacity-25 rounded-circle me-3",children:e.jsx(r,{icon:ae,size:"2x",className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:c?"text-light-emphasis small":"text-medium-emphasis small",children:"Total Items"}),e.jsx("div",{className:"fs-3 fw-bold",children:o.toFixed(0)})]})]})})}),e.jsx(x,{lg:4,md:6,className:"mb-4",children:e.jsx(F,{color:"info",className:"h-100",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"p-3 bg-info bg-opacity-25 rounded-circle me-3",children:e.jsx(r,{icon:te,size:"2x",className:"text-info"})}),e.jsxs("div",{children:[e.jsx("div",{className:c?"text-light-emphasis small":"text-medium-emphasis small",children:"Average Monthly Items"}),e.jsx("div",{className:"fs-3 fw-bold",children:G().toFixed(0)})]})]})})}),e.jsx(x,{lg:4,md:12,className:"mb-4",children:s.data.length>=2&&e.jsx(F,{color:u(i(s.data.length-1)),className:"h-100",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`p-3 bg-${u(i(s.data.length-1))} bg-opacity-25 rounded-circle me-3`,children:e.jsx(r,{icon:k(i(s.data.length-1)),size:"2x",className:`text-${u(i(s.data.length-1))}`})}),e.jsxs("div",{children:[e.jsx("div",{className:c?"text-light-emphasis small":"text-medium-emphasis small",children:"Month-over-Month Change"}),e.jsx("div",{className:"fs-3 fw-bold",children:i(s.data.length-1)!==null?`${i(s.data.length-1)>0?"+":""}${i(s.data.length-1).toFixed(1)}%`:""})]})]})})})]}),e.jsx(f,{className:"mb-4",children:e.jsx(x,{md:12,children:e.jsxs(D,{className:"border-0 shadow-sm",children:[e.jsxs(I,{className:`${L} border-bottom d-flex justify-content-between align-items-center py-3 ${c?"text-light":""}`,children:[e.jsxs("h4",{className:"mb-0",children:[e.jsx(r,{icon:le,className:"me-2 text-primary"}),"Monthly Items Distribution"]}),e.jsxs(N,{color:c?"dark":"light",size:"sm",children:[e.jsx(r,{icon:re,className:"me-1"})," Item Analysis"]})]}),e.jsx($,{className:"p-4",children:e.jsx("div",{className:"px-3",children:e.jsx(f,{className:"align-items-end g-0",style:{height:"250px"},children:s.data.map((a,t)=>e.jsx(x,{className:"px-1 text-center",children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("small",{className:"mb-2 fw-bold",children:Number(a).toFixed(0)}),e.jsx("div",{style:{width:"100%",height:`${Number(a)/Y*80}%`,minHeight:Number(a)>0?"20px":"4px"},children:e.jsx(W,{value:100,color:t===s.data.length-1?"primary":"info",className:"h-100 shadow-sm",style:{minWidth:"30px",borderRadius:"4px"}})}),e.jsxs("small",{className:`mt-2 ${c?"text-light-emphasis":"text-medium-emphasis"}`,children:[e.jsx(r,{icon:O,className:"me-1"}),s.labels[t]||`Month ${t+1}`]}),t>0&&e.jsxs(v,{color:u(i(t)),shape:"rounded-pill",className:`mt-1 ${y}`,children:[e.jsx(r,{icon:k(i(t)),className:"me-1",size:"xs"}),i(t)!==null?`${i(t).toFixed(1)}%`:""]})]})},t))})})})]})})}),e.jsx(f,{children:e.jsx(x,{md:12,children:e.jsxs(D,{className:"border-0 shadow-sm",children:[e.jsx(I,{className:`${L} border-bottom d-flex justify-content-between align-items-center py-3 ${c?"text-light":""}`,children:e.jsxs("h4",{className:"mb-0",children:[e.jsx(r,{icon:ne,className:"me-2 text-primary"}),"Item Details"]})}),e.jsx($,{className:"p-0",children:e.jsxs(me,{hover:!0,responsive:!0,className:"mb-0 border-0",children:[e.jsx(oe,{className:B,children:e.jsxs(T,{children:[e.jsx(w,{children:"Month"}),e.jsx(w,{className:"text-end",children:"Items Count"}),e.jsx(w,{className:"text-end",children:"% of Total"}),e.jsx(w,{className:"text-end",children:"Change"})]})}),e.jsx(he,{children:s.data.map((a,t)=>e.jsxs(T,{children:[e.jsx(m,{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:`p-2 me-2 ${c?"bg-dark":"bg-light"} rounded`,children:e.jsx(r,{icon:O,className:"text-primary"})}),e.jsx("span",{className:"fw-medium",children:s.labels[t]||`Month ${t+1}`})]})}),e.jsx(m,{className:"text-end fw-bold",children:Number(a).toFixed(0)}),e.jsx(m,{className:"text-end",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-end",children:[e.jsx("span",{className:"me-2",children:o>0?`${(Number(a)/o*100).toFixed(1)}%`:"0%"}),e.jsx(W,{value:o>0?Number(a)/o*100:0,color:"info",className:"flex-grow-1",style:{maxWidth:"100px",height:"8px"}})]})}),e.jsx(m,{className:"text-end",children:t>0?e.jsxs(v,{color:u(i(t)),shape:"rounded-pill",className:y,children:[e.jsx(r,{icon:k(i(t)),className:"me-1"}),i(t)!==null?`${i(t).toFixed(1)}%`:""]}):e.jsxs(v,{color:"secondary",shape:"rounded-pill",className:y,children:[e.jsx(r,{icon:C,className:"me-1"})," Base"]})})]},t))}),e.jsx(xe,{className:B,children:e.jsxs(T,{children:[e.jsx(m,{className:"fw-bold",children:"Total"}),e.jsx(m,{className:"fw-bold text-end",children:o.toFixed(0)}),e.jsx(m,{className:"fw-bold text-end",children:"100%"}),e.jsx(m,{className:"text-end",children:s.data.length>=2&&e.jsxs(v,{color:Number(s.data[s.data.length-1])>Number(s.data[0])?"success":Number(s.data[s.data.length-1])<Number(s.data[0])?"danger":"info",shape:"rounded-pill",className:y,children:[e.jsx(r,{icon:Number(s.data[s.data.length-1])>Number(s.data[0])?P:Number(s.data[s.data.length-1])<Number(s.data[0])?V:C,className:"me-1"}),Number(s.data[0])!==0?`${((Number(s.data[s.data.length-1])-Number(s.data[0]))/Number(s.data[0])*100).toFixed(1)}%`:""]})})]})})]})})]})})})]})]})]})})})})})};export{Ce as default};
