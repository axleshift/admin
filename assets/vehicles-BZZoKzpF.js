import{j as e}from"./index-BnfaAiZg.js";import{r as i}from"./vendor-react-B6URQkMn.js";import{a as P}from"./axiosInstance-Dv2jt_v_.js";import{l as d}from"./activityLogger-dj-FpP-1.js";import{F as t,K as p,ai as ae,u as A,aj as te,N as le,ak as ie,al as ne,f as re,a2 as E,am as I,an as oe,x as F,ao as ce,ap as de,ag as me,aq as he,ar as xe,as as ue,y as pe,z as je,O as fe}from"./index-1Ig5rmq6.js";import{j as c,C as z,S as v,k as T,X as R,e as ge,f as we,g as be,h as j,N as Ne,O as ye,l as Ce,as as ve,aj as ke,s as Ve,t as De,ad as Se,v as _e,w as Me,y as Pe}from"./vendor-coreui-DGBpOIqK.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const Ue=()=>{const[r,$]=i.useState([]),[N,k]=i.useState(!0),[f,V]=i.useState(null),[g,D]=i.useState(null),[S,_]=i.useState(!1),[U,B]=i.useState(""),[L,H]=i.useState(""),[O,y]=i.useState(!1),[w,b]=i.useState(null),[Z,m]=i.useState(!1),n=localStorage.getItem("role"),o=localStorage.getItem("department"),l=localStorage.getItem("name"),M=localStorage.getItem("username");localStorage.getItem("userId"),i.useEffect(()=>{(async()=>{try{k(!0);const a=await P.get("/logistics/vehicle");a.data.success&&a.data.data.success?($(a.data.data.data),b({color:"success",title:"Success",content:"Vehicle data has been successfully loaded!"}),m(!0),d({name:l,role:n,department:o,route:"/vehicles",action:"View Vehicles",description:`${l} viewed vehicle fleet data`}).catch(console.warn)):V("Failed to fetch vehicle data")}catch(a){V(a.message||"An error occurred while fetching vehicle data"),console.error("Error fetching vehicles:",a),b({color:"danger",title:"Error",content:"Failed to load vehicle data"}),m(!0)}finally{k(!1)}})()},[l,n,o]);const h=async s=>{try{_(!0);let a="";switch(s){case"all":a="All_Vehicles";break;case"available":a="Available_Vehicles";break;case"in_use":a="InUse_Vehicles";break;case"maintenance":a="Maintenance_Vehicles";break;case"forRegistration":a="ForRegistration_Vehicles";break;default:a="Vehicles"}const x=await P.post("/management/downloadVehicleZip",{name:l,role:n,username:M,downloadType:s},{responseType:"blob"}),ee=l.substring(0,2)+n.charAt(0)+M.slice(-6);B(ee),H(`${a}_Protected.zip`),y(!0);const se=window.URL.createObjectURL(new Blob([x.data])),u=document.createElement("a");u.href=se,u.setAttribute("download",`${a}_Protected.zip`),document.body.appendChild(u),u.click(),document.body.removeChild(u),d({name:l,role:n,department:o,route:"/vehicles",action:"Download Protected Data",description:`Downloaded ${a} as password-protected zip`}).catch(console.warn),b({color:"success",title:"Success",content:`File ${a}_Protected.zip downloaded successfully!`}),m(!0)}catch(a){console.error("Error creating protected zip:",a),b({color:"danger",title:"Error",content:"Failed to create protected download. Please try again."}),m(!0)}finally{_(!1)}},q=()=>{window.print(),d({name:l,role:n,department:o,route:"/vehicles",action:"Print Vehicle List",description:`Printed vehicle fleet list (${r.filter(s=>!s.deleted).length} vehicles)`}).catch(console.warn)},Y=()=>{d({name:l,role:n,department:o,route:"/vehicles",action:"Add Vehicle Initiated",description:"User initiated adding a new vehicle"}).catch(console.warn)},C=(s,a)=>{const x={view:`Viewed details for vehicle ${a.regisNumber||a._id}`,edit:`Initiated editing vehicle ${a.regisNumber||a._id}`,delete:`Initiated deletion of vehicle ${a.regisNumber||a._id}`};d({name:l,role:n,department:o,route:"/vehicles",action:`Vehicle ${s.charAt(0).toUpperCase()+s.slice(1)}`,description:x[s]}).catch(console.warn)},G=s=>{if(g===s)D(null);else{D(s);const a=r.find(x=>x._id===s);a&&d({name:l,role:n,department:o,route:"/vehicles",action:"View Vehicle Details",description:`${l} Expanded details for vehicle ${a.regisNumber||s}`}).catch(console.warn)}},K=s=>s?new Date(s).toLocaleDateString():"N/A",W=s=>({available:"success",in_use:"primary",forRegistration:"warning",maintenance:"danger"})[s]||"secondary",X=s=>({available:je,in_use:F,forRegistration:pe,maintenance:ue})[s]||fe,J=s=>e.jsxs(Pe,{color:W(s),children:[e.jsx(t,{icon:X(s),className:"me-1"}),s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())]}),Q=[{key:"idNum",label:"ID",icon:oe},{key:"brand",label:"Brand",icon:I},{key:"model",label:"Model",icon:p},{key:"year",label:"Year",icon:E},{key:"type",label:"Type",icon:p},{key:"capacity",label:"Capacity (kg)",icon:F},{key:"fuelType",label:"Fuel Type",icon:ce},{key:"currentMileage",label:"Mileage (km)",icon:de}];return e.jsxs("div",{className:"container-fluid p-4",children:[Z&&w&&e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:1050},children:e.jsx("div",{className:`toast show align-items-center text-white bg-${w.color} border-0`,role:"alert","aria-live":"assertive","aria-atomic":"true",children:e.jsxs("div",{className:"d-flex",children:[e.jsxs("div",{className:"toast-body",children:[e.jsx("strong",{children:w.title}),": ",w.content]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>m(!1)})]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h1",{children:[e.jsx(t,{icon:p,className:"me-3 text-primary"}),"Vehicle Fleet Management"]}),e.jsxs(c,{color:"primary",onClick:Y,children:[e.jsx(t,{icon:ae,className:"me-2"}),"Add Vehicle"]})]}),N&&e.jsx("div",{className:"d-flex justify-content-center py-5",children:e.jsx(z,{color:"primary"})}),f&&e.jsxs(v,{color:"danger",className:"mb-4",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:f})]}),!N&&!f&&r&&r.length===0&&e.jsx(v,{color:"warning",className:"mb-4",children:e.jsx("p",{children:"No vehicle data available."})}),!N&&!f&&r&&r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"shadow mb-4",children:e.jsx(R,{className:"bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"fw-bold",children:[e.jsx(t,{icon:p,className:"me-2 text-primary"}),"Total Vehicles: ",r.filter(s=>!s.deleted).length]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(ge,{children:[e.jsxs(we,{disabled:S,children:[e.jsx(t,{icon:A,className:"me-2",color:"success"}),"Secure Download",S&&e.jsx(z,{size:"sm",className:"ms-2"})]}),e.jsxs(be,{children:[e.jsx(j,{onClick:()=>h("all"),children:"All Vehicles"}),e.jsx(j,{onClick:()=>h("available"),children:"Available Vehicles"}),e.jsx(j,{onClick:()=>h("in_use"),children:"In-Use Vehicles"}),e.jsx(j,{onClick:()=>h("maintenance"),children:"Maintenance Vehicles"}),e.jsx(j,{onClick:()=>h("forRegistration"),children:"For Registration Vehicles"})]})]}),e.jsxs(c,{color:"light",size:"sm",onClick:q,children:[e.jsx(t,{icon:te,className:"me-2 text-primary"}),"Print List"]})]})]})})}),e.jsx(Ne,{children:r.filter(s=>!s.deleted).map(s=>e.jsx(ye,{sm:12,className:"mb-4",children:e.jsx(T,{className:"shadow-sm border-top-0 border-left-0 border-right-0 border-bottom border-primary",style:{cursor:"pointer",borderWidth:"3px"},children:e.jsxs("div",{className:"d-flex flex-row",children:[e.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"120px",minHeight:"100%"},children:e.jsx(t,{icon:p,size:"3x",className:"text-primary"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs(R,{className:"d-flex justify-content-between align-items-center bg-white border-0",children:[e.jsx("div",{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:le,className:"me-2 text-primary"}),s.regisNumber||"No Registration"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[J(s.status||"unknown"),e.jsx(c,{color:"link",className:"p-0 ms-3",onClick:()=>G(s._id),children:e.jsx(t,{icon:g===s._id?ie:ne,size:"lg"})})]})]}),e.jsxs(Ce,{className:"py-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Driver"}),e.jsxs("div",{children:[e.jsx(t,{icon:re,className:"me-2 text-info"}),e.jsx("strong",{children:s.driver||"Not Assigned"})]})]}),e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Registration Expiry"}),e.jsxs("div",{children:[e.jsx(t,{icon:E,className:"me-2 text-warning"}),e.jsx("strong",{children:K(s.regisExprationDate)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small mb-1",children:"Brand & Model"}),e.jsxs("div",{children:[e.jsx(t,{icon:I,className:"me-2 text-secondary"}),e.jsx("strong",{children:(s.brand||"")+" "+(s.model||"")})]})]})]}),e.jsxs(ve,{visible:g===s._id,children:[e.jsx("hr",{className:"my-3"}),e.jsx("div",{className:"row",children:Q.filter(a=>!["regisNumber","driver","regisExprationDate","status","brand","model"].includes(a.key)).map(a=>e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:a.label}),e.jsxs("div",{children:[a.icon&&e.jsx(t,{icon:a.icon,className:"me-2 text-primary"}),e.jsx("strong",{children:s[a.key]||"N/A"})]})]},a.key))})]})]}),g===s._id&&e.jsxs(ke,{className:"bg-white d-flex justify-content-end gap-2 py-2",children:[e.jsxs(c,{color:"info",size:"sm",onClick:()=>C("view",s),children:[e.jsx(t,{icon:me,className:"me-1"})," View"]}),e.jsxs(c,{color:"success",size:"sm",onClick:()=>C("edit",s),children:[e.jsx(t,{icon:he,className:"me-1"})," Edit"]}),e.jsxs(c,{color:"danger",size:"sm",onClick:()=>C("delete",s),children:[e.jsx(t,{icon:xe,className:"me-1"})," Delete"]})]})]})]})})},s._id))})]}),e.jsxs(Ve,{visible:O,onClose:()=>y(!1),children:[e.jsx(De,{closeButton:!0,children:e.jsx(Se,{children:"Password Protected File"})}),e.jsxs(_e,{children:[e.jsxs("p",{children:["Your file ",e.jsx("strong",{children:L})," has been downloaded successfully."]}),e.jsx("p",{children:"Use the following password to unlock the ZIP file:"}),e.jsxs(v,{color:"info",className:"d-flex align-items-center",children:[e.jsx(t,{icon:A,className:"me-3 fs-4"}),e.jsx("div",{className:"font-monospace fw-bold",children:U})]}),e.jsx("p",{className:"text-muted small",children:"This password is unique to your account. Please keep it secure."})]}),e.jsx(Me,{children:e.jsx(c,{color:"secondary",onClick:()=>y(!1),children:"Close"})})]})]})};export{Ue as default};
