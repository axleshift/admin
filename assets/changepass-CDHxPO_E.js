import{j as e}from"./index-BgwvEAMv.js";import{r as n,i as J}from"./vendor-react-B6URQkMn.js";import{c as K,N as Q,O as X,k as ee,l as se,S,R as ae,T as A,U as v,o as I,V as k,Y as B,C as L,y as re,Z as te,j as ne}from"./vendor-coreui-BN8uYOBb.js";import{a as oe}from"./axiosInstance-Dv2jt_v_.js";import{a as le}from"./geminiPasswordAnalyzer-D2a4flXO.js";import{F as u,t as D,v as ce,w as ie,x as Y,y as Z,z as de}from"./index-BabiU5Zk.js";import{c as z}from"./cil-lock-locked-DmxpJbVL.js";import"./vendor-redux-C7peqcPR.js";import"./index-t--hEgTQ.js";const _=l=>{let a=0,t="Very Weak";const c=[];l.length<8?c.push("Password should be at least 8 characters long"):a+=20,/[A-Z]/.test(l)?a+=15:c.push("Add uppercase letters for stronger security"),/[a-z]/.test(l)?a+=15:c.push("Add lowercase letters for better security"),/[0-9]/.test(l)?a+=15:c.push("Include numbers to strengthen your password"),/[^A-Za-z0-9]/.test(l)?a+=15:c.push("Add special characters (like !@#$%) for maximum security");const m=new Set(l).size;return m>8?a+=10:m>5?a+=5:c.push("Use a greater variety of characters"),["12345","123456","qwerty","password","admin","welcome","abcdef","abc123","111111","000000"].some(p=>l.toLowerCase().includes(p))&&(a=Math.max(a-20,0),c.push("Avoid common password patterns and sequences")),a<30?t="Very Weak":a<50?t="Weak":a<70?t="Moderate":a<85?t="Strong":t="Very Strong",{score:a,strength:t,feedback:c,explanation:"Analysis performed using basic password rules."}},je=()=>{const[l,a]=n.useState(""),[t,c]=n.useState(""),[m,x]=n.useState(""),[p,d]=n.useState(null),[E,T]=n.useState(null),[r,y]=n.useState(null),[j,C]=n.useState(!1),[f,w]=n.useState(null),[R,q]=n.useState(!1),[g,F]=n.useState(!0),[M,b]=n.useState(0),[h,N]=n.useState(!1),G=J(),O=(s,i)=>{let o;return(...P)=>{clearTimeout(o),o=setTimeout(()=>{s(...P)},i)}},U=n.useCallback(async s=>{if(!s||s.length<4)return null;if(C(!0),w(null),g)try{const i=await Promise.race([le(s),new Promise((o,P)=>setTimeout(()=>P(new Error("Analysis timeout")),3e3))]);return b(0),i}catch(i){console.error("Password analysis error:",i);const o=M+1;return b(o),o>=3?(F(!1),w("AI analysis temporarily disabled due to repeated failures"),setTimeout(()=>{F(!0),b(0),w(null)},3e4)):w(`Could not analyze password strength (Attempt ${o}/3)`),_(s)}else return _(s)},[g,M]),V=n.useCallback(O(async s=>{try{const i=await U(s);y(i)}finally{C(!1)}},500),[U]);n.useEffect(()=>{N(!1),d(null),t?V(t):(y(null),C(!1))},[t,V]);const $=async s=>{s.preventDefault();const i=localStorage.getItem("email");if(d(null),T(null),N(!1),t!==m){d("New passwords do not match.");return}if(!r||r.score<30){d("Please choose a stronger password.");return}q(!0);try{(await oe.put("/client/change-password",{email:i,currentPassword:l,newPassword:t,passwordAnalysis:{score:r.score,strength:r.strength,aiPowered:g&&!f}})).data.success&&(T("Password changed successfully!"),a(""),c(""),x(""),y(null),setTimeout(()=>{G("/settings")},2e3))}catch(o){console.error("Error changing password:",o),o.response?o.response.data.code==="PASSWORD_RECENTLY_USED"?(N(!0),d("You cannot reuse a password that was used within the last 6 months.")):d(o.response.data.message||"An error occurred. Please try again."):d("An error occurred. Please try again later.")}finally{q(!1)}},W=s=>!s||s<30?"danger":s<50?"warning":s<70?"info":s<85?"primary":"success",H=s=>!s||s<50?Z:s<70?Y:de;return e.jsx(K,{children:e.jsx(Q,{className:"justify-content-center",children:e.jsx(X,{md:8,lg:6,children:e.jsx(ee,{className:"shadow-sm",children:e.jsxs(se,{className:"p-4",children:[e.jsx("h1",{className:"mb-4 text-center",children:"Change Password"}),p&&e.jsxs(S,{color:h?"warning":"danger",className:"mb-3",children:[h&&e.jsx(u,{icon:D,className:"me-2"}),p]}),E&&e.jsx(S,{color:"success",className:"mb-3",children:E}),e.jsxs(ae,{onSubmit:$,children:[e.jsxs(A,{className:"mb-3",children:[e.jsx(v,{children:e.jsx(I,{icon:z})}),e.jsx(k,{type:"password",placeholder:"Current Password",value:l,onChange:s=>a(s.target.value),required:!0,autoComplete:"current-password"})]}),e.jsxs(A,{className:"mb-2",children:[e.jsx(v,{children:e.jsx(I,{icon:z})}),e.jsx(k,{type:"password",placeholder:"New Password",value:t,onChange:s=>c(s.target.value),required:!0,className:h?"border-warning":"",autoComplete:"new-password"})]}),t.length>0&&e.jsxs("div",{className:"mb-3 password-analyzer",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[g&&!f?e.jsx(B,{content:"AI-powered password analysis",children:e.jsx(u,{icon:ce,className:"me-2 text-primary"})}):e.jsx(B,{content:"Basic password analysis",children:e.jsx(u,{icon:ie,className:"me-2 text-secondary"})}),"Password Strength:"]}),j?e.jsx(L,{size:"sm",color:"primary"}):r&&e.jsxs(re,{color:W(r.score),shape:"rounded-pill",children:[e.jsx(u,{icon:H(r.score),className:"me-1"}),r.strength]})]}),r&&!j&&e.jsxs(e.Fragment,{children:[e.jsx(te,{value:r.score,color:W(r.score),className:"mb-2",animated:!0}),e.jsxs("div",{className:"password-feedback mt-2",children:[h&&e.jsxs("div",{className:"small text-warning mb-1 fw-bold",children:[e.jsx(u,{icon:D,className:"me-1"}),"This password was used within the last 6 months"]}),r.feedback&&r.feedback.map((s,i)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(u,{icon:Y,className:"me-1"}),s]},i)),r.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:r.explanation})]})]}),f&&e.jsxs(S,{color:"warning",className:"py-1 mt-2 mb-0 small",children:[e.jsx(u,{icon:Z,className:"me-1"}),f]})]}),e.jsxs(A,{className:"mb-4",children:[e.jsx(v,{children:e.jsx(I,{icon:z})}),e.jsx(k,{type:"password",placeholder:"Confirm New Password",value:m,onChange:s=>x(s.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(ne,{type:"submit",color:"primary",className:"px-4 w-100",disabled:R||j||!l||t.length<8||t!==m||r&&r.score<30||h,children:R?e.jsxs(e.Fragment,{children:[e.jsx(L,{size:"sm",component:"span",className:"me-2"}),"Updating..."]}):"Change Password"})]})]})})})})})};export{je as default};
