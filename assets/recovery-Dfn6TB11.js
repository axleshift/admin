import{r as a,a as l,j as e,e as C,f as j,J as O,b as Q,c as E,i as m}from"./index-CKcFKU7h.js";import{C as T}from"./index.esm-DAwbp2WG.js";import{C as U}from"./CAlert-D4xm2muB.js";import{C as P}from"./CRow-6GBEGtvd.js";import{C as g}from"./CCol-Bfnlt4mm.js";import{C as S}from"./CCardHeader-BJVPw31J.js";import{C as V}from"./CForm-2IzFcotE.js";import{C as D,a as B}from"./CListGroupItem-CUarwIc_.js";const ae=()=>{const[u,v]=a.useState(""),[F,N]=a.useState([]),[c,L]=a.useState(null),[$,f]=a.useState([]),[n,z]=a.useState(null),[A,p]=a.useState([]),[x,G]=a.useState(null),[i,r]=a.useState(!1),[w,R]=a.useState(!1),[I,s]=a.useState(""),[b,k]=a.useState(!1);a.useEffect(()=>{const t=localStorage.getItem("backupDirectory");t&&(v(t),r(!0),l.post("http://localhost:5053/admin/set-directory",{directory:t}).then(()=>{k(!0),y()}).catch(()=>s("Could not restore saved directory. Please set it manually.")).finally(()=>r(!1)))},[]),a.useEffect(()=>{b&&y()},[b]),a.useEffect(()=>{c?H(c):f([])},[c]),a.useEffect(()=>{n?J(c,n):p([])},[n]);const y=async()=>{r(!0),s("");try{const t=await l.get("http://localhost:5053/admin/list-backups");N(t.data.backups||[])}catch{s("Error fetching backups"),N([])}finally{r(!1)}},H=async t=>{var d,h;if(t){r(!0),s("");try{const o=await l.get(`http://localhost:5053/admin/list-collections/${t.name}`);o.data.databases?f(o.data.databases):(f([]),s("No databases found in this backup."))}catch(o){console.error("Error fetching databases:",o),s(((h=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:h.message)||"Error fetching databases"),f([])}finally{r(!1)}}},J=async(t,d)=>{if(!t||!d){p([]);return}r(!0),s("");try{const h=await l.get(`http://localhost:5053/admin/list-collections/${t.name}?databaseName=${d}`);p(h.data.collections||[])}catch{s("Error fetching collections"),p([])}finally{r(!1)}},q=async()=>{if(!u){s("Please enter a directory.");return}r(!0),s("");try{await l.post("http://localhost:5053/admin/set-directory",{directory:u}),localStorage.setItem("backupDirectory",u),k(!0),y()}catch{s("Error setting directory"),k(!1)}finally{r(!1)}},K=async()=>{R(!0),s("");try{await l.post("http://localhost:5053/admin/backup"),y()}catch{s("Error during backup")}finally{R(!1)}},M=async()=>{if(!c||!n||!x){s("Please select a backup, database, and collection.");return}r(!0),s("");try{await l.post("http://localhost:5053/admin/restore",{timestamp:c.name,filename:x,databaseName:n}),alert("Restore successful!")}catch{s("Restore failed.")}finally{r(!1)}};return e.jsxs(T,{children:[I&&e.jsx(U,{color:"danger",className:"mt-3",children:I}),e.jsx(P,{className:"mb-4 mt-3",children:e.jsx(g,{children:e.jsxs(C,{children:[e.jsx(S,{children:"Backup Configuration"}),e.jsxs(j,{children:[e.jsxs(V,{children:[e.jsx(O,{children:"Set Backup Directory"}),e.jsxs("div",{className:"d-flex",children:[e.jsx(Q,{type:"text",placeholder:"Enter directory path",value:u,onChange:t=>v(t.target.value)}),e.jsx(E,{className:"ms-2",onClick:q,disabled:i,children:i?e.jsx(m,{size:"sm"}):"Set Directory"})]})]}),e.jsx(E,{color:"primary",className:"mt-3",onClick:K,disabled:!b||w,children:w?e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm"})," Creating Backup..."]}):"Create New Backup"})]})]})})}),e.jsxs(P,{children:[e.jsx(g,{md:"4",children:e.jsxs(C,{children:[e.jsx(S,{children:"Available Backups"}),e.jsx(j,{children:i?e.jsx(m,{}):e.jsx(D,{children:F.map(t=>e.jsx(B,{active:(c==null?void 0:c.name)===t.name,onClick:()=>L(t),style:{cursor:"pointer"},children:t.name},t.name))})})]})}),e.jsx(g,{md:"4",children:e.jsxs(C,{children:[e.jsx(S,{children:"Select Database"}),e.jsx(j,{children:i?e.jsx(m,{}):e.jsx(D,{children:$.map(t=>e.jsx(B,{active:n===t,onClick:()=>z(t),style:{cursor:"pointer"},children:t},t))})})]})}),e.jsxs(g,{md:"4",children:[e.jsxs(C,{children:[e.jsx(S,{children:"Select Collection"}),e.jsx(j,{children:i?e.jsx(m,{}):e.jsx(D,{children:A.map(t=>e.jsx(B,{active:x===t,onClick:()=>G(t),style:{cursor:"pointer"},children:t},t))})})]}),e.jsx(E,{color:"warning",className:"mt-3",onClick:M,disabled:!x,children:"Restore"})]})]})]})};export{ae as default};
