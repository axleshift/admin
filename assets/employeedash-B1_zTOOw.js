import{j as e,w as re,x as le}from"./index-CzlX11AB.js";import{u as ce,r as s}from"./vendor-react-P0hRR2W0.js";import{C as ie}from"./customhead-HZLGt52a.js";import{F as h,x as T,y as de,C as me}from"./index-D0KVb9r2.js";import{S as g}from"./statbox-ZiMRliOC.js";import"./overviewChart-DpU4Y1kf.js";import he from"./monthchart-DMth4K8w.js";import"./papaparse.min-CHum4QXG.js";import{a as u}from"./axiosInstance-Bq-uIJjs.js";import{l as ge}from"./activityLogger-D6Lc4RsL.js";import{C as ue,a as d,b as o,d as U}from"./vendor-coreui-pds89uUO.js";import"./vendor-redux-BKcj_6VU.js";import"./generateCategoricalChart-Cfl7J4DB.js";import"./LineChart-CPohoAyb.js";import"./index-xsH4HHeE.js";const fe=()=>e.jsxs("div",{className:"loader",children:[e.jsx("div",{className:"outer"}),e.jsx("div",{className:"middle"}),e.jsx("div",{className:"inner"})]}),Re=()=>{var b;const j=ce(),[xe,k]=s.useState(window.innerWidth>768),[pe,R]=s.useState(""),[z,f]=s.useState(!0),[B,W]=s.useState([]),[w,N]=s.useState(null),[a,L]=s.useState(null),[c,G]=s.useState(null),[Q,x]=s.useState(!0),{data:ye,isLoading:H}=re(),{data:Se,isLoading:P}=le(),v=localStorage.getItem("name"),q=localStorage.getItem("role"),J=localStorage.getItem("department");localStorage.getItem("username");const[K,M]=s.useState([]),[O,p]=s.useState(!1),[C,V]=s.useState(null),[D,X]=s.useState(null),[Z,y]=s.useState(!0);ge({name:v,role:q,department:J,route:"Admin Dashboard",action:"Navigate",description:`${v} Navigate to Admin Dashboard`}).catch(console.warn),s.useEffect(()=>{const r=()=>k(window.innerWidth>768);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),s.useEffect(()=>{const r=localStorage.getItem("accessToken");r?R(r):j("/login")},[j]),s.useEffect(()=>{const r=async()=>{try{x(!0);const t=await u.get("/finance/monthlysalesrevenue");if(t.data&&Array.isArray(t.data)&&t.data.length>0){const n=new Date,S=n.toLocaleString("en-US",{month:"long"}),se=n.getFullYear(),F=t.data.find(l=>l.month===S&&l.year===se),m=new Date(n);m.setMonth(m.getMonth()-1);const ae=m.toLocaleString("en-US",{month:"long"}),ne=m.getFullYear(),Y=t.data.find(l=>l.month===ae&&l.year===ne);if(F)L(F);else{const l=[...t.data].sort((I,$)=>{const oe=new Date(`${I.month} 1, ${I.year}`);return new Date(`${$.month} 1, ${$.year}`)-oe});L(l[0]),console.log("Current month data not found, using most recent:",l[0])}Y&&G(Y)}x(!1)}catch(t){console.error("Failed to fetch monthly sales data:",t),N(n=>n||"An error occurred while fetching sales data"),x(!1)}},i=async()=>{try{y(!0);const t=await u.get("/finance/yearlysalesrevenue");t.data&&X(t.data),y(!1)}catch(t){console.error("Failed to fetch yearly data:",t),y(!1)}},A=async()=>{var t;try{f(!0);const S=((t=(await u.get("/core/fetch-core")).data)==null?void 0:t.data)||[];W(S),f(!1)}catch(n){N(n.message||"Failed to fetch shipment data"),f(!1)}};(async()=>{try{p(!0);const n=(await u.get("/hr/worker")).data||[];M(n),p(!1)}catch(t){V(t.message||"Failed to fetch user data"),p(!1),console.error("Error fetching users:",t)}})(),A(),i(),r()},[]);const _=B.length,ee=new Date().getFullYear(),te=K.length,E=(r,i)=>!i||i===0?"0":((r-i)/i*100).toFixed(1);return H||P?e.jsx(fe,{}):e.jsxs(ue,{fluid:!0,className:"p-3",children:[e.jsxs(d,{className:"mb-4",children:[e.jsx(o,{xs:12,md:8,children:e.jsx(ie,{title:"Dashboard",subtitle:"Welcome to Dashboard"})}),e.jsx(o,{xs:12,md:4,className:"d-flex justify-content-md-end align-items-center mb-3 mb-md-0"})]}),e.jsxs(d,{className:"my-3 g-3",children:[e.jsx(o,{xs:12,md:6,lg:3,children:e.jsx(g,{title:"Total Employees",value:te,icon:e.jsx(h,{icon:T}),color:"primary",loading:O,description:"Total registered employees"})}),e.jsx(o,{xs:12,md:6,lg:3,children:e.jsx(g,{title:"Total Shipments",value:_,icon:e.jsx(h,{icon:T}),color:"primary",loading:z,description:"Total shipments tracked"})}),e.jsx(o,{xs:12,md:6,lg:3,children:e.jsx(g,{title:`Current Sales (${(a==null?void 0:a.month)||"Loading..."})`,value:((b=a==null?void 0:a.totalSales)==null?void 0:b.toLocaleString())||0,increase:c?`${E((a==null?void 0:a.totalSales)||0,(c==null?void 0:c.totalSales)||0)>0?"+":""}${E((a==null?void 0:a.totalSales)||0,(c==null?void 0:c.totalSales)||0)}%`:"0",icon:e.jsx(h,{icon:de,style:{fontSize:"20px",color:"#0d6efd"}}),loading:Q})}),e.jsxs(o,{xs:12,md:6,lg:3,children:[" ",e.jsx(g,{title:`Yearly Sales (${ee})`,value:D?D.totalSales.toLocaleString():"Loading...",description:"Annual performance",icon:e.jsx(h,{icon:me,style:{fontSize:"20px",color:"#dc3545"}}),loading:Z})]})]}),e.jsx(d,{className:"my-3",children:e.jsx(o,{xs:12,children:e.jsx(U,{className:"mb-4",children:e.jsx("div",{className:"p-3",children:e.jsx(he,{})})})})}),e.jsx(d,{className:"my-3",children:e.jsx(o,{xs:12,children:e.jsx(U,{className:"mb-4"})})}),w&&e.jsx(d,{className:"my-3",children:e.jsx(o,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:w})})}),C&&e.jsx(d,{className:"my-3",children:e.jsx(o,{xs:12,children:e.jsx("div",{className:"alert alert-danger",children:C})})})]})};export{Re as default};
