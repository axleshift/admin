import{r as s,ad as Q,j as e,e as E,f as M,i as O,c as z,F as B,ae as J,af as K,b as k,ag as V}from"./index-CKcFKU7h.js";import{C as G}from"./CCardHeader-BJVPw31J.js";import{C as X}from"./CForm-2IzFcotE.js";import{C as Y}from"./CRow-6GBEGtvd.js";import{C as g}from"./CCol-Bfnlt4mm.js";import{C as L}from"./CFormSelect-BKkxLTOG.js";import{C as W}from"./DefaultLayout-Xwng9yPx.js";import{C as Z,a as $,b as H,c as b,d as ee,e as v}from"./CTable-KMmU-9g7.js";import{C as re,a as N}from"./CPaginationItem-22HnPUyI.js";import"./index.esm-DAwbp2WG.js";import"./ex-CELXs5B0.js";function ne(o,n,a){var R=this,d=s.useRef(null),i=s.useRef(0),c=s.useRef(null),f=s.useRef([]),C=s.useRef(),j=s.useRef(),A=s.useRef(o),p=s.useRef(!0);A.current=o;var h=typeof window<"u",S=!n&&n!==0&&h;if(typeof o!="function")throw new TypeError("Expected a function");n=+n||0;var w=!!(a=a||{}).leading,r=!("trailing"in a)||!!a.trailing,t="maxWait"in a,y="debounceOnServer"in a&&!!a.debounceOnServer,x=t?Math.max(+a.maxWait||0,n):null;s.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var F=s.useMemo(function(){var l=function(u){var m=f.current,T=C.current;return f.current=C.current=null,i.current=u,j.current=A.current.apply(T,m)},D=function(u,m){S&&cancelAnimationFrame(c.current),c.current=S?requestAnimationFrame(u):setTimeout(u,m)},U=function(u){if(!p.current)return!1;var m=u-d.current;return!d.current||m>=n||m<0||t&&u-i.current>=x},_=function(u){return c.current=null,r&&f.current?l(u):(f.current=C.current=null,j.current)},I=function u(){var m=Date.now();if(U(m))return _(m);if(p.current){var T=n-(m-d.current),q=t?Math.min(T,x-(m-i.current)):T;D(u,q)}},P=function(){if(h||y){var u=Date.now(),m=U(u);if(f.current=[].slice.call(arguments),C.current=R,d.current=u,m){if(!c.current&&p.current)return i.current=d.current,D(I,n),w?l(d.current):j.current;if(t)return D(I,n),l(d.current)}return c.current||D(I,n),j.current}};return P.cancel=function(){c.current&&(S?cancelAnimationFrame(c.current):clearTimeout(c.current)),i.current=0,f.current=d.current=C.current=c.current=null},P.isPending=function(){return!!c.current},P.flush=function(){return c.current?_(Date.now()):j.current},P},[w,t,n,x,r,S,h,y]);return F}function te(o,n){return o===n}function ae(o,n,a){var R=te,d=s.useRef(o),i=s.useState({})[1],c=ne(s.useCallback(function(C){d.current=C,i({})},[i]),n,a),f=s.useRef(o);return R(f.current,o)||(c(o),f.current=o),[d.current,c]}const se=50,pe=()=>{const[o,n]=s.useState(1),[a,R]=s.useState({username:"",name:"",department:"",role:"",action:"",route:"",startDate:"",endDate:new Date().toISOString().split("T")[0]}),[d]=ae(a,500),{data:i={logs:[],total:0,pages:0},isLoading:c,isError:f,error:C,isFetching:j,refetch:A}=Q({page:o,limit:se,filters:d}),p=s.useMemo(()=>{const r={username:new Set,department:new Set,role:new Set,action:new Set};return i.logs.forEach(t=>{t.username&&r.username.add(t.username),t.department&&r.department.add(t.department),t.role&&r.role.add(t.role),t.action&&r.action.add(t.action)}),{username:Array.from(r.username).sort(),department:Array.from(r.department).sort(),role:Array.from(r.role).sort(),action:Array.from(r.action).sort()}},[i.logs]),h=s.useCallback(r=>{const{name:t,value:y}=r.target;R(x=>({...x,[t]:y})),n(1)},[]),S=s.useCallback(()=>{R({username:"",name:"",department:"",role:"",action:"",route:"",startDate:"",endDate:new Date().toISOString().split("T")[0]}),n(1)},[]),w=()=>{const r=i.pages,t=o,y=[];let x=Math.max(1,t-2),F=Math.min(r,x+4);F-x<4&&(x=Math.max(1,F-4));for(let l=x;l<=F;l++)y.push(l);return e.jsxs(re,{className:"justify-content-end",children:[e.jsx(N,{disabled:t===1,onClick:()=>n(l=>Math.max(1,l-1)),children:"Previous"}),x>1&&e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:()=>n(1),children:"1"}),x>2&&e.jsx(N,{children:"..."})]}),y.map(l=>e.jsx(N,{active:t===l,onClick:()=>n(l),children:l},l)),F<r&&e.jsxs(e.Fragment,{children:[F<r-1&&e.jsx(N,{children:"..."}),e.jsx(N,{onClick:()=>n(r),children:r})]}),e.jsx(N,{disabled:t===r,onClick:()=>n(l=>Math.min(r,l+1)),children:"Next"})]})};return c?e.jsx(E,{children:e.jsxs(M,{className:"text-center",children:[e.jsx(O,{color:"primary"}),e.jsx("p",{children:"Loading logs..."})]})}):f?e.jsx(E,{children:e.jsxs(M,{className:"text-center text-danger",children:["Error loading logs: ",C.message]})}):e.jsxs(E,{children:[e.jsxs(G,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h3",{children:"Activity Logs"}),e.jsxs("div",{className:"d-flex align-items-center",children:[j&&e.jsx(O,{size:"sm",className:"me-2"}),e.jsxs(z,{color:"primary",onClick:A,disabled:j,children:[e.jsx(B,{icon:J,className:"me-2"}),"Refresh"]})]})]}),e.jsxs(M,{children:[e.jsxs(E,{className:"mb-4",children:[e.jsxs(G,{children:[e.jsx(B,{icon:K,className:"me-2"}),"Filters"]}),e.jsx(M,{children:e.jsx(X,{children:e.jsxs(Y,{className:"g-3",children:[e.jsx(g,{md:4,children:e.jsxs(L,{label:"Username",name:"username",value:a.username,onChange:h,children:[e.jsx("option",{value:"",children:"All Users"}),p.username.map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx(g,{md:4,children:e.jsx(k,{type:"text",label:"Name",name:"name",value:a.name,onChange:h,placeholder:"Filter by name"})}),e.jsx(g,{md:4,children:e.jsxs(L,{label:"Department",name:"department",value:a.department,onChange:h,children:[e.jsx("option",{value:"",children:"All Departments"}),["HR","Logistics","Core","Finance","Administrative",...p.department].map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx(g,{md:4,children:e.jsxs(L,{label:"Role",name:"role",value:a.role,onChange:h,children:[e.jsx("option",{value:"",children:"All Roles"}),["Superadmin","Admin","Manager",...p.role].map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx(g,{md:4,children:e.jsxs(L,{label:"Action",name:"action",value:a.action,onChange:h,children:[e.jsx("option",{value:"",children:"All Actions"}),p.action.map(r=>e.jsx("option",{value:r,children:r},r))]})}),e.jsx(g,{md:4,children:e.jsx(k,{type:"text",label:"Route",name:"route",value:a.route,onChange:h,placeholder:"Filter by route"})}),e.jsx(g,{md:4,children:e.jsx(k,{type:"date",label:"Start Date",name:"startDate",value:a.startDate,onChange:h})}),e.jsx(g,{md:4,children:e.jsx(k,{type:"date",label:"End Date",name:"endDate",value:a.endDate,onChange:h})}),e.jsx(g,{xs:12,className:"d-flex justify-content-end",children:e.jsxs(z,{color:"secondary",onClick:S,disabled:j,children:[e.jsx(B,{icon:V,className:"me-2"}),"Reset Filters"]})})]})})})]}),e.jsxs("div",{className:"mb-3 d-flex justify-content-between align-items-center",children:[e.jsxs(W,{color:"info",className:"py-2",children:["Showing ",i.logs.length," of ",i.total," logs",j&&e.jsx(O,{size:"sm",className:"ms-2"})]}),w()]}),e.jsxs(Z,{striped:!0,hover:!0,responsive:!0,className:"mb-3",children:[e.jsx($,{children:e.jsxs(H,{children:[e.jsx(b,{children:"Timestamp"}),e.jsx(b,{children:"Username"}),e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Department"}),e.jsx(b,{children:"Role"}),e.jsx(b,{children:"Action"}),e.jsx(b,{children:"Route"}),e.jsx(b,{children:"Description"})]})}),e.jsx(ee,{children:i.logs.length===0?e.jsx(H,{children:e.jsx(v,{colSpan:"8",className:"text-center",children:"No logs found matching the current filters."})}):i.logs.map(r=>e.jsxs(H,{children:[e.jsx(v,{children:new Date(r.timestamp).toLocaleString()}),e.jsx(v,{children:r.username}),e.jsx(v,{children:r.name}),e.jsx(v,{children:r.department}),e.jsx(v,{children:r.role}),e.jsx(v,{children:e.jsx(W,{color:"primary",children:r.action})}),e.jsx(v,{children:r.route}),e.jsx(v,{children:r.description})]},r._id))})]}),i.pages>1&&w()]})]})};export{pe as default};
