import{j as s}from"./index-BM2XebS9.js";import{i as b,r}from"./vendor-react-B6URQkMn.js";import{A as z,S as p}from"./AnnouncementList-CyRQAwGJ.js";import{C as B}from"./customhead-BXh5Q7IZ.js";import I from"./monthly-C-GgjGfK.js";import{F as y,C as W,J as Y}from"./index-D-k-o6LC.js";import{a as U}from"./axiosInstance-DJJrlVKC.js";import{g as H,S as m,T as l,o as J}from"./vendor-coreui-BDhfDOiu.js";import"./vendor-redux-DipIbRRz.js";import"./cil-chevron-right-DSvcss7_.js";import"./activityLogger-BIBCW0K8.js";const ee=()=>{var g,u;b();const[P,v]=r.useState(window.innerWidth>768),[e,x]=r.useState(null),[t,L]=r.useState(null),[T,f]=r.useState(!0),[h,$]=r.useState(null);r.useEffect(()=>{const o=()=>v(window.innerWidth>768);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),r.useEffect(()=>{(async()=>{try{f(!0);const n=await U.get("/finance/monthlysalesrevenue");if(n.data&&Array.isArray(n.data)&&n.data.length>0){const c=new Date,R=c.toLocaleString("en-US",{month:"long"}),A=c.getFullYear(),S=n.data.find(a=>a.month===R&&a.year===A),d=new Date(c);d.setMonth(d.getMonth()-1);const F=d.toLocaleString("en-US",{month:"long"}),N=d.getFullYear(),j=n.data.find(a=>a.month===F&&a.year===N);if(S)x(S);else{const a=[...n.data].sort((w,C)=>{const E=new Date(`${w.month} 1, ${w.year}`);return new Date(`${C.month} 1, ${C.year}`)-E});x(a[0]),console.log("Current month data not found, using most recent:",a[0])}j&&L(j)}f(!1)}catch(n){console.error("Failed to fetch dashboard data:",n),$(n.message||"An error occurred while fetching data"),f(!1)}})()},[]);const i=(o,n)=>!n||n===0?"0":((o-n)/n*100).toFixed(1);return s.jsxs(H,{fluid:!0,className:"p-3",children:[s.jsx(m,{children:s.jsxs(l,{children:[s.jsx(B,{title:"Finance Dashboard",subtitle:"Welcome to the Finance Dashboard"}),s.jsx(z,{})]})}),s.jsxs(m,{children:[s.jsx(l,{xs:12,md:6,lg:3,children:s.jsx(p,{title:`Current Sales (${(e==null?void 0:e.month)||"Loading..."})`,value:((g=e==null?void 0:e.totalSales)==null?void 0:g.toLocaleString())||0,increase:t?`${i((e==null?void 0:e.totalSales)||0,(t==null?void 0:t.totalSales)||0)>0?"+":""}${i((e==null?void 0:e.totalSales)||0,(t==null?void 0:t.totalSales)||0)}%`:"0",description:"vs. last month",icon:s.jsx(y,{icon:W,style:{fontSize:"20px",color:"#0d6efd"}})})}),s.jsx(l,{xs:12,md:6,lg:3,children:s.jsx(p,{title:`Current Revenue (${(e==null?void 0:e.month)||"Loading..."})`,value:`$${((u=e==null?void 0:e.totalRevenue)==null?void 0:u.toLocaleString())||0}`,increase:t?`${i((e==null?void 0:e.totalRevenue)||0,(t==null?void 0:t.totalRevenue)||0)>0?"+":""}${i((e==null?void 0:e.totalRevenue)||0,(t==null?void 0:t.totalRevenue)||0)}%`:"0",description:"vs. last month",icon:s.jsx(y,{icon:Y,style:{fontSize:"20px",color:"#198754"}})})})]}),s.jsx(m,{className:"my-3",children:s.jsx(l,{xs:12,children:s.jsx(J,{className:"mb-4",children:s.jsx("div",{className:"p-3",children:s.jsx(I,{view:"sales",onDataLoaded:o=>{o&&Array.isArray(o)&&o.length>0}})})})})}),h&&s.jsx(m,{className:"my-3",children:s.jsx(l,{xs:12,children:s.jsx("div",{className:"alert alert-danger",children:h})})})]})};export{ee as default};
