import{j as e}from"./index-CJJ1ocKz.js";import{r as o}from"./vendor-react-BHxUanFt.js";import{a as G}from"./axiosInstance-Bq-uIJjs.js";import{u as de}from"./vendor-redux-CSji-Y9p.js";import{F as i,y as me,w as V,b as he,a5 as xe,j as ge,a6 as je,M as ue,a7 as pe,a8 as Ne,g as Q,B as fe,d as _,a9 as ye,o as we,h as be,e as ke}from"./index-Df-BKtnA.js";import{a3 as Ce,C as q,d as N,n as f,e as y,l as w,Q as Ae,p as b,m as Me,r as Se,s as Te,t as L,u as x,v as ve,w as h,o as X,U as Ee,V as j,W as De,a as I,b as u,L as Le,M as Ie,N as Ue,O as Re,a4 as $e,a5 as Pe,a6 as Fe,a7 as Oe,T as Be}from"./vendor-coreui-DaIzHuu_.js";import"./index-xsH4HHeE.js";const Qe=()=>{const[k,U]=o.useState([]),[R,A]=o.useState(null),[Y,M]=o.useState(!0),[S,T]=o.useState(!1),[c,Z]=o.useState(null),[ee,v]=o.useState(!1),[d,se]=o.useState(1),[C]=o.useState(20),[g,$]=o.useState(1),ae=de(s=>s.changeState.theme),{colorMode:te}=Ce("coreui-free-react-admin-template-theme"),a=ae==="dark"||te==="dark",P=()=>{M(!0),A(null),G.get("/general/log").then(s=>{U(s.data),$(Math.ceil(s.data.length/C)),M(!1)}).catch(s=>{A(s.message),M(!1)})},re=()=>{T(!0),G.get("/general/log").then(s=>{U(s.data),$(Math.ceil(s.data.length/C)),T(!1)}).catch(s=>{A(s.message),T(!1)})};o.useEffect(()=>{P()},[]);const ne=s=>{Z(s),v(!0)},E=d*C,F=E-C,O=k.slice(F,E),p=s=>se(s),ie=()=>{const s=[];s.push(e.jsx(j,{active:d===1,onClick:()=>p(1),children:"1"},"first"));let r=Math.max(2,d-Math.floor(5/2)),n=Math.min(g-1,r+5-2);n-r<3&&(r=Math.max(2,n-3)),r>2&&s.push(e.jsx(j,{disabled:!0,children:"..."},"ellipsis1"));for(let m=r;m<=n;m++)s.push(e.jsx(j,{active:d===m,onClick:()=>p(m),children:m},m));return n<g-1&&s.push(e.jsx(j,{disabled:!0,children:"..."},"ellipsis2")),g>1&&s.push(e.jsx(j,{active:d===g,onClick:()=>p(g),children:g},"last")),s},le=s=>{const t={category:"General activity",patterns:"No unusual patterns detected",risk:"MEDIUM"};if(!s)return t;if(typeof s=="object"&&s!==null){if(s.category&&s.patterns&&s.riskLevel)return{category:s.category,patterns:s.patterns,risk:s.riskLevel==="UNKNOWN"?"MEDIUM":s.riskLevel};if(s.aiStructuredAnalysis){const l=s.aiStructuredAnalysis;return{category:l.category||t.category,patterns:l.patterns||t.patterns,risk:l.riskLevel==="UNKNOWN"?"MEDIUM":l.riskLevel||t.risk}}}const r=typeof s=="string"?s:JSON.stringify(s);if(!r)return t;try{const l=JSON.parse(r);if(l.category&&l.patterns&&l.riskLevel)return{category:l.category,patterns:l.patterns,risk:l.riskLevel==="UNKNOWN"?"MEDIUM":l.riskLevel}}catch{}let n="MEDIUM";const m=r.match(/risk(?:\s*level|\s*assessment)?:?\s*(low|medium|high|unknown)/i);m&&(n=m[1].toUpperCase(),n==="UNKNOWN"&&(n="MEDIUM"));let K=t.category;const W=r.match(/categor(?:y|ization):?\s*([^.]+)/i);W&&(K=W[1].trim());let z=t.patterns;const J=r.match(/patterns:?\s*([^.]+)/i)||r.match(/unusual patterns:?\s*([^.]+)/i);return J&&(z=J[1].trim()),{category:K,patterns:z,risk:n}},D=s=>!s||s.toLowerCase()==="unknown"?"warning":s.toLowerCase()==="high"?"danger":s.toLowerCase()==="medium"?"warning":s.toLowerCase()==="low"?"success":a?"light":"secondary",ce=a?{color:"#FFFFFF"}:{},B=s=>{const t={CREATE:"success",UPDATE:"primary",DELETE:"danger",RESTORE:"warning",SELECT:"info",FETCH:a?"light":"secondary",NAVIGATE:a?"light":"secondary",AUTO:a?"light":"dark",SET:"info"};for(const[r,n]of Object.entries(t))if(s&&s.includes(r))return n;return a?"light":"secondary"},oe=s=>{const t=new Date,r=new Date(s),n=Math.floor((t-r)/1e3);return n<60?`${n} seconds ago`:n<3600?`${Math.floor(n/60)} minutes ago`:n<86400?`${Math.floor(n/3600)} hours ago`:`${Math.floor(n/86400)} days ago`},H=s=>{var r;if(s.aiStructuredAnalysis)return{category:s.aiStructuredAnalysis.category||"General activity",patterns:s.aiStructuredAnalysis.patterns||"No unusual patterns detected",risk:s.aiStructuredAnalysis.riskLevel==="UNKNOWN"?"MEDIUM":s.aiStructuredAnalysis.riskLevel||"MEDIUM",fullAnalysis:typeof s.aiAnalysis=="string"?s.aiAnalysis:((r=s.aiAnalysis)==null?void 0:r.fullAnalysis)||JSON.stringify(s.aiAnalysis)};const t=le(s.aiAnalysis);return{category:t.category,patterns:t.patterns,risk:t.risk,fullAnalysis:typeof s.aiAnalysis=="string"?s.aiAnalysis:JSON.stringify(s.aiAnalysis)}};return R?e.jsx(q,{className:"mt-4",children:e.jsxs(N,{className:`text-center border-danger ${a?"bg-dark text-white":""}`,children:[e.jsxs(f,{className:"bg-danger text-white",children:[e.jsx(i,{icon:me,className:"me-2"})," Error"]}),e.jsxs(y,{children:[e.jsx("p",{className:"mb-0",children:R}),e.jsxs(w,{color:"primary",className:"mt-3",onClick:P,children:[e.jsx(i,{icon:V,className:"me-2"})," Try Again"]})]})]})}):e.jsxs(q,{fluid:!0,className:"p-4",children:[e.jsxs(N,{className:`shadow-sm ${a?"bg-dark text-white":""}`,children:[e.jsxs(f,{className:`d-flex justify-content-between align-items-center ${a?"bg-dark text-white border-secondary":"bg-light"}`,children:[e.jsxs("div",{children:[e.jsx(i,{icon:he,className:"me-2 text-primary"}),e.jsxs(Ae,{className:"d-inline mb-0",style:ce,children:["Activity Tracker ",e.jsx(b,{color:"info",shape:"rounded-pill",className:"ms-2",children:"AI Enhanced"})]})]}),e.jsxs("div",{children:[e.jsxs(w,{color:"light",size:"sm",className:`me-2 ${a?"text-dark":""}`,onClick:re,disabled:S,children:[e.jsx(i,{icon:V,spin:S,className:"me-1"}),S?"Refreshing...":"Refresh"]}),e.jsxs(w,{color:a?"light":"secondary",size:"sm",className:a?"text-dark":"",children:[e.jsx(i,{icon:xe,className:"me-1"}),"Export"]})]})]}),e.jsx(y,{children:Y?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(Me,{color:"primary"}),e.jsx("p",{className:`mt-2 ${a?"text-light":"text-muted"}`,children:"Loading activity data..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(Se,{hover:!0,striped:!0,responsive:!0,className:`border ${a?"table-dark":""}`,children:[e.jsx(Te,{className:a?"bg-dark text-white border-secondary":"bg-light",children:e.jsxs(L,{children:[e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:ge,className:`me-2 ${a?"text-white":"text-muted"}`}),"User"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:je,className:`me-2 ${a?"text-white":"text-muted"}`}),"Role"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:ue,className:`me-2 ${a?"text-white":"text-muted"}`}),"Department"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:pe,className:`me-2 ${a?"text-white":"text-muted"}`}),"Route"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:Ne,className:`me-2 ${a?"text-white":"text-muted"}`}),"Action"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:Q,className:`me-2 ${a?"text-white":"text-muted"}`}),"Description"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:fe,className:`me-2 ${a?"text-white":"text-muted"}`}),"Time"]}),e.jsxs(x,{className:"text-nowrap",children:[e.jsx(i,{icon:_,className:`me-2 ${a?"text-white":"text-muted"}`}),"AI Analysis"]})]})}),e.jsx(ve,{children:O.length===0?e.jsx(L,{children:e.jsx(h,{colSpan:8,className:`text-center p-5 ${a?"text-white":"text-muted"}`,children:"No activity records found"})}):O.map(s=>{const t=H(s);return e.jsxs(L,{className:"align-middle",children:[e.jsx(h,{className:"font-weight-bold",children:s.name||"Unknown"}),e.jsx(h,{children:e.jsx(b,{color:a?"light":"dark",shape:"rounded-pill",className:`px-2 py-1 ${a?"text-dark":""}`,children:s.role||"Unknown"})}),e.jsx(h,{children:s.department||"Unknown"}),e.jsx(h,{className:a?"text-info":"text-primary",children:s.route}),e.jsx(h,{children:e.jsx(b,{color:B(s.action),shape:"rounded-pill",className:B(s.action)==="light"?"text-dark":"",children:s.action})}),e.jsx(h,{children:e.jsx(X,{content:s.description,placement:"bottom",children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},children:s.description})})}),e.jsx(h,{className:"text-nowrap",children:e.jsx(X,{content:new Date(s.timestamp).toLocaleString(),children:e.jsx("span",{children:oe(s.timestamp)})})}),e.jsx(h,{children:s.aiAnalysis?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(b,{color:D(t.risk),shape:"rounded-pill",className:"me-2",children:t.risk}),e.jsxs(w,{color:"light",size:"sm",onClick:()=>ne(s),children:[e.jsx(i,{icon:ye,className:"me-1"}),"View"]})]}):e.jsx("span",{className:"text-muted",children:"Not available"})})]},s._id)})})]})}),k.length>0&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(Ee,{"aria-label":"Activity pagination",className:a?"pagination-dark":"",children:[e.jsx(j,{"aria-label":"Previous",disabled:d===1,onClick:()=>p(d-1),children:e.jsx("span",{"aria-hidden":"true",children:"«"})}),ie(),e.jsx(j,{"aria-label":"Next",disabled:d===g,onClick:()=>p(d+1),children:e.jsx("span",{"aria-hidden":"true",children:"»"})})]})})]})}),e.jsx(De,{className:`${a?"bg-dark text-white border-secondary":"bg-light text-muted"}`,children:e.jsxs(I,{children:[e.jsx(u,{children:e.jsxs("small",{children:["Showing ",F+1,"-",Math.min(E,k.length)," of ",k.length," activities"]})}),e.jsx(u,{className:"text-end",children:e.jsxs("small",{children:["Last updated: ",new Date().toLocaleString()]})})]})})]}),e.jsxs(Le,{visible:ee,onClose:()=>v(!1),size:"lg",backdrop:"static",className:a?"modal-dark":"",children:[e.jsx(Ie,{className:a?"bg-dark text-white":"",children:e.jsxs(Ue,{children:[e.jsx(i,{icon:_,className:"me-2 text-primary"}),"AI Activity Analysis"]})}),e.jsx(Re,{className:a?"bg-dark text-white":"",children:c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Activity Details"}),e.jsxs(I,{className:"mb-3",children:[e.jsxs(u,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"User:"})," ",c.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Role:"})," ",c.role]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Department:"})," ",c.department]})]}),e.jsxs(u,{md:"6",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Route:"})," ",c.route]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Action:"})," ",c.action]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Time:"})," ",new Date(c.timestamp).toLocaleString()]})]})]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Description:"})," ",c.description]})]}),e.jsxs("div",{className:"mb-3 mt-4",children:[e.jsxs("h5",{children:[e.jsx(i,{icon:we,className:"me-2 text-info"}),"AI Analysis Results"]}),c.aiAnalysis?e.jsx(e.Fragment,{children:(()=>{const s=H(c);return e.jsxs(e.Fragment,{children:[e.jsx($e,{activeItemKey:1,className:"mt-3",children:e.jsxs(Pe,{itemKey:1,children:[e.jsx(Fe,{children:"Full Analysis"}),e.jsx(Oe,{children:e.jsx("div",{className:`p-3 ${a?"bg-secondary bg-opacity-10":"bg-light"}`,style:{whiteSpace:"pre-line",borderRadius:"0.25rem"},children:s.fullAnalysis})})]})}),e.jsxs(I,{className:"mt-4",children:[e.jsx(u,{md:"4",children:e.jsxs(N,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(f,{className:"bg-info text-white",children:[e.jsx(i,{icon:Q,className:"me-2"}),"Category"]}),e.jsx(y,{children:s.category})]})}),e.jsx(u,{md:"4",children:e.jsxs(N,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(f,{className:"bg-primary text-white",children:[e.jsx(i,{icon:be,className:"me-2"}),"Patterns"]}),e.jsx(y,{children:s.patterns})]})}),e.jsx(u,{md:"4",children:e.jsxs(N,{className:a?"bg-dark text-white border-secondary":"",children:[e.jsxs(f,{className:`bg-${D(s.risk)} text-white`,children:[e.jsx(i,{icon:ke,className:"me-2"}),"Risk Level"]}),e.jsx(y,{className:"d-flex justify-content-center align-items-center",children:e.jsx(b,{color:D(s.risk),size:"lg",shape:"rounded-pill",className:"px-4 py-2",children:s.risk})})]})})]})]})})()}):e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{className:"text-muted",children:"AI analysis not available for this activity."})})]})]})}),e.jsx(Be,{className:a?"bg-dark text-white":"",children:e.jsx(w,{color:"secondary",onClick:()=>v(!1),children:"Close"})})]})]})};export{Qe as default};
