import{l as L,m as M,j as e}from"./index-DnQYre1Z.js";import{r as h}from"./vendor-react-B6URQkMn.js";import{F as j,J as k,K as B,L as P}from"./index--2R5L5uR.js";import{N as q,O,k as V,X as z,l as G,Y as J,Z as K,_ as v,$ as o,a0 as Q,a1 as c,W as S,j as W,C as f,S as N}from"./vendor-coreui-jwXAEa-8.js";import"./vendor-redux-DipIbRRz.js";const I=()=>{const{data:i,isLoading:u,isError:y,refetch:R}=L(),[U,{isLoading:p}]=M(),[d,g]=h.useState({}),[A,m]=h.useState({}),[E,x]=h.useState({}),b=["Administrative","Finance","HR","Core","Logistics"],w={Finance:["User","Admin","Staff","Superadmin","Technician"],Administrative:["Admin","Manager","Superadmin"],HR:["Admin","Manager","Employee","Contractor"],Core:["Admin","Manager","Employee","Contractor"],Logistics:["Admin","Manager","Employee","Contractor"]},F=s=>{const r=d[s]||{},a={};return r.department||(a.department="Department is required"),r.role||(a.role="Role is required"),m(l=>({...l,[s]:a})),Object.keys(a).length===0},T=(s,r)=>{g(a=>({...a,[s]:{...a[s],department:r,role:""}})),m(a=>({...a,[s]:{}}))},D=(s,r)=>{g(a=>({...a,[s]:{...a[s],role:r}})),m(a=>({...a,[s]:{}}))},H=async s=>{const r=s.id;if(!F(r))return;const l={id:r,firstName:s.firstName,lastName:s.lastName,email:s.email,department:d[r].department,role:d[r].role};try{x(n=>({...n,[r]:{loading:!0,error:null}}));const t=await U(l).unwrap();x(n=>({...n,[r]:{loading:!1,error:null,success:!0}})),R()}catch(t){x(n=>{var C;return{...n,[r]:{loading:!1,error:((C=t.data)==null?void 0:C.message)||"An unexpected error occurred",success:!1}}}),console.error("Save user error:",t)}};return e.jsx(q,{children:e.jsx(O,{md:12,children:e.jsxs(V,{children:[e.jsx(z,{children:e.jsxs("h4",{children:[e.jsx(j,{icon:k,className:"me-2"}),"New Users Registration"]})}),e.jsxs(G,{children:[e.jsxs(J,{hover:!0,responsive:!0,children:[e.jsx(K,{children:e.jsxs(v,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Email"}),e.jsx(o,{children:"Department"}),e.jsx(o,{children:"Role"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Q,{children:i==null?void 0:i.map(s=>{const r=s.id,a=d[r]||{},l=A[r]||{},t=E[r]||{};return e.jsxs(v,{children:[e.jsxs(c,{children:[s.firstName," ",s.lastName]}),e.jsx(c,{children:s.email}),e.jsxs(c,{children:[e.jsxs(S,{value:a.department||"",onChange:n=>T(r,n.target.value),invalid:!!l.department,children:[e.jsx("option",{value:"",children:"Select Department"}),b.map(n=>e.jsx("option",{value:n,children:n},n))]}),l.department&&e.jsx("div",{className:"text-danger small",children:l.department})]}),e.jsxs(c,{children:[e.jsxs(S,{value:a.role||"",onChange:n=>D(r,n.target.value),disabled:!a.department,invalid:!!l.role,children:[e.jsx("option",{value:"",children:"Select Role"}),(w[a.department]||[]).map(n=>e.jsx("option",{value:n,children:n},n))]}),l.role&&e.jsx("div",{className:"text-danger small",children:l.role})]}),e.jsxs(c,{children:[e.jsx(W,{color:t.success?"success":t.error?"danger":"primary",onClick:()=>H(s),disabled:t.loading||p,children:t.loading||p?e.jsx(f,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{icon:B,className:"me-2"}),t.success?"Saved":t.error?"Retry":"Save"]})}),t.error&&e.jsxs("div",{className:"text-danger small mt-1",children:[e.jsx(j,{icon:P,className:"me-1"}),t.error]})]})]},r)})})]}),u&&e.jsx("div",{className:"text-center my-3",children:e.jsx(f,{color:"primary"})}),y&&e.jsx(N,{color:"danger",children:"Failed to load users. Please try again."}),(!i||i.length===0)&&!u&&e.jsx(N,{color:"info",children:"No new users available for registration."})]})]})})})};export{I as default};
