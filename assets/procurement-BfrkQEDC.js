import{j as e}from"./index-BA9i51uk.js";import{r as l,R as _}from"./vendor-react-BHxUanFt.js";import{a as k}from"./axiosInstance-Bq-uIJjs.js";import{F as c,ac as L,v as q,h as H,s as p,Y as z,I as V,q as C,ad as M,ae as Q,u as d,x as Y,af as N}from"./index-BbcC8ntF.js";import{a as $,b as G,d as D,n as y,l as S,e as b,g as v,m as J,r as w,s as P,t,u as n,v as I,w as a,a7 as K,p as O}from"./vendor-coreui-blXmWd_E.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const ne=()=>{const[x,T]=l.useState([]),[i,m]=l.useState(!0),[h,j]=l.useState(null),[g,E]=l.useState({}),B=localStorage.getItem("role"),R=localStorage.getItem("department");localStorage.getItem("userId");const A=localStorage.getItem("name"),U=s=>{E(r=>({...r,[s]:!r[s]}))},u=async()=>{m(!0);try{const s=await k.get("/logistics/procurement");T(s.data.data),j(null)}catch(s){j("Error fetching procurement data"),console.error("Procurement data fetch error:",s)}finally{m(!1)}};l.useEffect(()=>{u()},[]);const F=s=>{const r={Pending:{color:"warning",icon:d},Approved:{color:"success",icon:N},"In Progress":{color:"info",icon:d},Completed:{color:"success",icon:N},Cancelled:{color:"danger",icon:Y},default:{color:"secondary",icon:d}},f=r[s]||r.default;return logActivity({name:A,role:B,department:R,route:"/procurement",action:"Add Vehicle Initiated",description:"User initiated adding a new vehicle"}).catch(console.warn),e.jsxs(O,{color:f.color,className:"px-2 py-1",children:[e.jsx(c,{icon:f.icon,className:"me-1"})," ",s]})},o=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s);return e.jsx($,{children:e.jsx(G,{xs:12,children:e.jsxs(D,{className:"mb-4",children:[e.jsxs(y,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx(c,{icon:L,className:"me-2"}),e.jsx("strong",{children:"Procurement Management"})]}),e.jsxs(S,{color:"outline-primary",size:"sm",onClick:u,disabled:i,children:[e.jsx(c,{icon:q,className:i?"fa-spin me-1":"me-1"}),"Refresh"]})]}),e.jsxs(b,{children:[h&&e.jsxs(v,{color:"danger",children:[e.jsx(c,{icon:H,className:"me-2"}),h]}),i?e.jsxs("div",{className:"text-center p-5",children:[e.jsx(J,{color:"primary"}),e.jsx("div",{className:"mt-3",children:"Loading procurement data..."})]}):e.jsx(e.Fragment,{children:x.length===0?e.jsx(v,{color:"info",children:"No procurement records found"}):e.jsxs(w,{hover:!0,responsive:!0,striped:!0,className:"border",children:[e.jsx(P,{color:"light",children:e.jsxs(t,{children:[e.jsx(n,{scope:"col",children:"Title"}),e.jsx(n,{scope:"col",children:"Description"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:p,className:"me-1"})," Procurement Date"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:z,className:"me-1"})," Department"]}),e.jsx(n,{scope:"col",children:"Status"}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:V,className:"me-1"})," Est. Cost"]}),e.jsxs(n,{scope:"col",children:[e.jsx(c,{icon:p,className:"me-1"})," Delivery Date"]}),e.jsx(n,{scope:"col",children:"Products"})]})}),e.jsx(I,{children:x.map(s=>e.jsxs(_.Fragment,{children:[e.jsxs(t,{children:[e.jsx(a,{children:s.title}),e.jsx(a,{children:s.description.length>50?`${s.description.substring(0,50)}...`:s.description}),e.jsx(a,{children:new Date(s.procurementDate).toLocaleDateString()}),e.jsx(a,{children:s.department}),e.jsx(a,{children:F(s.status)}),e.jsx(a,{children:o(s.estimatedCost)}),e.jsx(a,{children:new Date(s.deliveryDate).toLocaleDateString()}),e.jsx(a,{children:e.jsxs(S,{color:"link",size:"sm",onClick:()=>U(s._id),children:[e.jsx(c,{icon:C,className:"me-1"}),s.products.length," Items",e.jsx(c,{icon:g[s._id]?M:Q,className:"ms-1"})]})})]}),e.jsx(t,{children:e.jsx(a,{colSpan:"8",className:"p-0",children:e.jsx(K,{visible:g[s._id],children:e.jsxs(D,{className:"m-3 border-0",children:[e.jsxs(y,{children:[e.jsx(c,{icon:C,className:"me-2"}),"Product Details"]}),e.jsx(b,{children:e.jsxs(w,{small:!0,borderless:!0,children:[e.jsx(P,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Quantity"}),e.jsx(n,{children:"Unit"}),e.jsx(n,{children:"Unit Price"}),e.jsx(n,{children:"Total"})]})}),e.jsx(I,{children:s.products.map(r=>e.jsxs(t,{children:[e.jsx(a,{children:r.name}),e.jsx(a,{children:r.quantity}),e.jsx(a,{children:r.unit}),e.jsx(a,{children:o(r.unitPrice)}),e.jsx(a,{children:o(r.quantity*r.unitPrice)})]},r._id))})]})})]})})})})]},s._id))})]})})]})]})})})};export{ne as default};
