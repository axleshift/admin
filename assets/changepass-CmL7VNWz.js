import{j as e}from"./index-CqTYrJit.js";import{r as o,u as J}from"./vendor-react-BHxUanFt.js";import{C as K,a as Q,b as X,d as ee,e as se,g as N,f as ae,h as P,i as A,j as S,k as I,o as L,m as V,p as te,q as re,l as ne}from"./vendor-coreui-CLDxaGvm.js";import{a as oe}from"./axiosInstance-Bq-uIJjs.js";import{a as le,c as ce}from"./geminiPasswordAnalyzer-CjYXo4ux.js";import{F as d,b as D,d as ie,e as de,g as _,h as G,i as ue}from"./index-BNowUf5p.js";import{c as k}from"./cil-lock-locked-DmxpJbVL.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const Y=c=>{let a=0,t="Very Weak";const i=[];c.length<8?i.push("Password should be at least 8 characters long"):a+=20,/[A-Z]/.test(c)?a+=15:i.push("Add uppercase letters for stronger security"),/[a-z]/.test(c)?a+=15:i.push("Add lowercase letters for better security"),/[0-9]/.test(c)?a+=15:i.push("Include numbers to strengthen your password"),/[^A-Za-z0-9]/.test(c)?a+=15:i.push("Add special characters (like !@#$%) for maximum security");const u=new Set(c).size;return u>8?a+=10:u>5?a+=5:i.push("Use a greater variety of characters"),["12345","123456","qwerty","password","admin","welcome","abcdef","abc123","111111","000000"].some(p=>c.toLowerCase().includes(p))&&(a=Math.max(a-20,0),i.push("Avoid common password patterns and sequences")),a<30?t="Very Weak":a<50?t="Weak":a<70?t="Moderate":a<85?t="Strong":t="Very Strong",{score:a,strength:t,feedback:i,explanation:"Analysis performed using basic password rules."}},Ce=()=>{const[c,a]=o.useState(""),[t,i]=o.useState(""),[u,x]=o.useState(""),[p,m]=o.useState(null),[v,E]=o.useState(null),[r,y]=o.useState(null),[j,z]=o.useState(!1),[f,w]=o.useState(null),[T,R]=o.useState(!1),[g,q]=o.useState(!0),[F,C]=o.useState(0),[h,M]=o.useState(!1),Z=J(),$=(s,n)=>{let l;return(...b)=>{clearTimeout(l),l=setTimeout(()=>{s(...b)},n)}},U=o.useCallback(async s=>{if(!s||s.length<4)return null;if(z(!0),w(null),g)try{const n=await Promise.race([le(s),new Promise((l,b)=>setTimeout(()=>b(new Error("Analysis timeout")),3e3))]);return C(0),n}catch(n){console.error("Password analysis error:",n);const l=F+1;return C(l),l>=3?(q(!1),w("AI analysis temporarily disabled due to repeated failures"),setTimeout(()=>{q(!0),C(0),w(null)},3e4)):w(`Could not analyze password strength (Attempt ${l}/3)`),Y(s)}else return Y(s)},[g,F]),W=o.useCallback($(async s=>{try{const n=await U(s);y(n)}finally{z(!1)}},500),[U]);o.useEffect(()=>{t&&(W(t),ce(t)<28&&y(n=>({...n,feedback:[...(n==null?void 0:n.feedback)||[],"Increase password complexity for better security."]})))},[t,W]);const H=async s=>{s.preventDefault();const n=localStorage.getItem("email");if(m(null),E(null),M(!1),t!==u){m("New passwords do not match.");return}if(!r||r.score<30){m("Please choose a stronger password.");return}R(!0);try{(await oe.put("/client/change-password",{email:n,currentPassword:c,newPassword:t,passwordAnalysis:{score:r.score,strength:r.strength,aiPowered:g&&!f}})).data.success&&(E("Password changed successfully!"),a(""),i(""),x(""),y(null),setTimeout(()=>{Z("/settings")},2e3))}catch(l){console.error("Error changing password:",l),l.response?l.response.data.code==="PASSWORD_RECENTLY_USED"?(M(!0),m("You cannot reuse a password that was used within the last 6 months.")):m(l.response.data.message||"An error occurred. Please try again."):m("An error occurred. Please try again later.")}finally{R(!1)}},B=s=>!s||s<30?"danger":s<50?"warning":s<70?"info":s<85?"primary":"success",O=s=>!s||s<50?G:s<70?_:ue;return e.jsx(K,{children:e.jsx(Q,{className:"justify-content-center",children:e.jsx(X,{md:8,lg:6,children:e.jsx(ee,{className:"shadow-sm",children:e.jsxs(se,{className:"p-4",children:[e.jsx("h1",{className:"mb-4 text-center",children:"Change Password"}),p&&e.jsxs(N,{color:h?"warning":"danger",className:"mb-3",children:[h&&e.jsx(d,{icon:D,className:"me-2"}),p]}),v&&e.jsx(N,{color:"success",className:"mb-3",children:v}),e.jsxs(ae,{onSubmit:H,children:[e.jsxs(P,{className:"mb-3",children:[e.jsx(A,{children:e.jsx(S,{icon:k})}),e.jsx(I,{type:"password",placeholder:"Current Password",value:c,onChange:s=>a(s.target.value),required:!0,autoComplete:"current-password"})]}),e.jsxs(P,{className:"mb-2",children:[e.jsx(A,{children:e.jsx(S,{icon:k})}),e.jsx(I,{type:"password",placeholder:"New Password",value:t,onChange:s=>i(s.target.value),required:!0,className:h?"border-warning":"",autoComplete:"new-password"})]}),t.length>0&&e.jsxs("div",{className:"mb-3 password-analyzer",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-1",children:[e.jsxs("span",{className:"d-flex align-items-center",children:[g&&!f?e.jsx(L,{content:"AI-powered password analysis",children:e.jsx(d,{icon:ie,className:"me-2 text-primary"})}):e.jsx(L,{content:"Basic password analysis",children:e.jsx(d,{icon:de,className:"me-2 text-secondary"})}),"Password Strength:"]}),j?e.jsx(V,{size:"sm",color:"primary"}):r&&e.jsxs(te,{color:B(r.score),shape:"rounded-pill",children:[e.jsx(d,{icon:O(r.score),className:"me-1"}),r.strength]})]}),r&&!j&&e.jsxs(e.Fragment,{children:[e.jsx(re,{value:r.score,color:B(r.score),className:"mb-2",animated:!0}),e.jsxs("div",{className:"password-feedback mt-2",children:[h&&e.jsxs("div",{className:"small text-warning mb-1 fw-bold",children:[e.jsx(d,{icon:D,className:"me-1"}),"This password was used within the last 6 months"]}),r.feedback&&r.feedback.map((s,n)=>e.jsxs("div",{className:"small text-muted mb-1",children:[e.jsx(d,{icon:_,className:"me-1"}),s]},n)),r.explanation&&e.jsx("div",{className:"small text-muted mt-1 pt-1 border-top",children:r.explanation})]})]}),f&&e.jsxs(N,{color:"warning",className:"py-1 mt-2 mb-0 small",children:[e.jsx(d,{icon:G,className:"me-1"}),f]})]}),e.jsxs(P,{className:"mb-4",children:[e.jsx(A,{children:e.jsx(S,{icon:k})}),e.jsx(I,{type:"password",placeholder:"Confirm New Password",value:u,onChange:s=>x(s.target.value),required:!0,autoComplete:"new-password"})]}),e.jsx(ne,{type:"submit",color:"primary",className:"px-4 w-100",disabled:T||j||!c||t.length<8||t!==u||r&&r.score<30||h,children:T?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:"sm",component:"span",className:"me-2"}),"Updating..."]}):"Change Password"})]})]})})})})})};export{Ce as default};
