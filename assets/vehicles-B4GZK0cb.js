import{j as e}from"./index-BA9i51uk.js";import{r as i}from"./vendor-react-BHxUanFt.js";import{a as M}from"./axiosInstance-Bq-uIJjs.js";import{l as d}from"./activityLogger-D6Lc4RsL.js";import{F as t,t as p,a1 as ae,c as P,a2 as te,w as le,a3 as ie,a4 as ne,j as re,s as A,a5 as E,a6 as oe,g as F,a7 as ce,a8 as de,$ as me,a9 as he,aa as xe,ab as ue,h as pe,i as je,x as ge}from"./index-BbcC8ntF.js";import{l as c,m as T,g as v,d as R,n as $,Q as fe,R as be,S as we,T as j,a as Ne,b as ye,e as Ce,a7 as ve,x as ke,H as Ve,I as De,J as Se,K as _e,O as Ie,p as Me}from"./vendor-coreui-blXmWd_E.js";import"./vendor-redux-CSji-Y9p.js";import"./index-xsH4HHeE.js";const Ue=()=>{const[r,z]=i.useState([]),[N,k]=i.useState(!0),[g,V]=i.useState(null),[f,D]=i.useState(null),[S,_]=i.useState(!1),[U,B]=i.useState(""),[L,H]=i.useState(""),[Z,y]=i.useState(!1),[b,w]=i.useState(null),[O,m]=i.useState(!1),n=localStorage.getItem("role"),o=localStorage.getItem("department"),l=localStorage.getItem("name"),I=localStorage.getItem("username");localStorage.getItem("userId"),i.useEffect(()=>{(async()=>{try{k(!0);const a=await M.get("/logistics/vehicle");a.data.success&&a.data.data.success?(z(a.data.data.data),w({color:"success",title:"Success",content:"Vehicle data has been successfully loaded!"}),m(!0),d({name:l,role:n,department:o,route:"/vehicles",action:"View Vehicles",description:`${l} viewed vehicle fleet data`}).catch(console.warn)):V("Failed to fetch vehicle data")}catch(a){V(a.message||"An error occurred while fetching vehicle data"),console.error("Error fetching vehicles:",a),w({color:"danger",title:"Error",content:"Failed to load vehicle data"}),m(!0)}finally{k(!1)}})()},[l,n,o]);const h=async s=>{try{_(!0);let a="";switch(s){case"all":a="All_Vehicles";break;case"available":a="Available_Vehicles";break;case"in_use":a="InUse_Vehicles";break;case"maintenance":a="Maintenance_Vehicles";break;case"forRegistration":a="ForRegistration_Vehicles";break;default:a="Vehicles"}const x=await M.post("/management/downloadVehicleZip",{name:l,role:n,username:I,downloadType:s},{responseType:"blob"}),ee=l.substring(0,2)+n.charAt(0)+I.slice(-6);B(ee),H(`${a}_Protected.zip`),y(!0);const se=window.URL.createObjectURL(new Blob([x.data])),u=document.createElement("a");u.href=se,u.setAttribute("download",`${a}_Protected.zip`),document.body.appendChild(u),u.click(),document.body.removeChild(u),d({name:l,role:n,department:o,route:"/vehicles",action:"Download Protected Data",description:`Downloaded ${a} as password-protected zip`}).catch(console.warn),w({color:"success",title:"Success",content:`File ${a}_Protected.zip downloaded successfully!`}),m(!0)}catch(a){console.error("Error creating protected zip:",a),w({color:"danger",title:"Error",content:"Failed to create protected download. Please try again."}),m(!0)}finally{_(!1)}},Y=()=>{window.print(),d({name:l,role:n,department:o,route:"/vehicles",action:"Print Vehicle List",description:`Printed vehicle fleet list (${r.filter(s=>!s.deleted).length} vehicles)`}).catch(console.warn)},q=()=>{d({name:l,role:n,department:o,route:"/vehicles",action:"Add Vehicle Initiated",description:"User initiated adding a new vehicle"}).catch(console.warn)},C=(s,a)=>{const x={view:`Viewed details for vehicle ${a.regisNumber||a._id}`,edit:`Initiated editing vehicle ${a.regisNumber||a._id}`,delete:`Initiated deletion of vehicle ${a.regisNumber||a._id}`};d({name:l,role:n,department:o,route:"/vehicles",action:`Vehicle ${s.charAt(0).toUpperCase()+s.slice(1)}`,description:x[s]}).catch(console.warn)},G=s=>{if(f===s)D(null);else{D(s);const a=r.find(x=>x._id===s);a&&d({name:l,role:n,department:o,route:"/vehicles",action:"View Vehicle Details",description:`${l} Expanded details for vehicle ${a.regisNumber||s}`}).catch(console.warn)}},J=s=>s?new Date(s).toLocaleDateString():"N/A",K=s=>({available:"success",in_use:"primary",forRegistration:"warning",maintenance:"danger"})[s]||"secondary",Q=s=>({available:je,in_use:F,forRegistration:pe,maintenance:ue})[s]||ge,W=s=>e.jsxs(Me,{color:K(s),children:[e.jsx(t,{icon:Q(s),className:"me-1"}),s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())]}),X=[{key:"idNum",label:"ID",icon:oe},{key:"brand",label:"Brand",icon:E},{key:"model",label:"Model",icon:p},{key:"year",label:"Year",icon:A},{key:"type",label:"Type",icon:p},{key:"capacity",label:"Capacity (kg)",icon:F},{key:"fuelType",label:"Fuel Type",icon:ce},{key:"currentMileage",label:"Mileage (km)",icon:de}];return e.jsxs("div",{className:"container-fluid p-4",children:[O&&b&&e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:1050},children:e.jsx("div",{className:`toast show align-items-center text-white bg-${b.color} border-0`,role:"alert","aria-live":"assertive","aria-atomic":"true",children:e.jsxs("div",{className:"d-flex",children:[e.jsxs("div",{className:"toast-body",children:[e.jsx("strong",{children:b.title}),": ",b.content]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>m(!1)})]})})}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("h1",{children:[e.jsx(t,{icon:p,className:"me-3 text-primary"}),"Vehicle Fleet Management"]}),e.jsxs(c,{color:"primary",onClick:q,children:[e.jsx(t,{icon:ae,className:"me-2"}),"Add Vehicle"]})]}),N&&e.jsx("div",{className:"d-flex justify-content-center py-5",children:e.jsx(T,{color:"primary"})}),g&&e.jsxs(v,{color:"danger",className:"mb-4",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:g})]}),!N&&!g&&r&&r.length===0&&e.jsx(v,{color:"warning",className:"mb-4",children:e.jsx("p",{children:"No vehicle data available."})}),!N&&!g&&r&&r.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"shadow mb-4",children:e.jsx($,{className:"bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("span",{className:"fw-bold",children:[e.jsx(t,{icon:p,className:"me-2 text-primary"}),"Total Vehicles: ",r.filter(s=>!s.deleted).length]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(fe,{children:[e.jsxs(be,{disabled:S,children:[e.jsx(t,{icon:P,className:"me-2",color:"success"}),"Secure Download",S&&e.jsx(T,{size:"sm",className:"ms-2"})]}),e.jsxs(we,{children:[e.jsx(j,{onClick:()=>h("all"),children:"All Vehicles"}),e.jsx(j,{onClick:()=>h("available"),children:"Available Vehicles"}),e.jsx(j,{onClick:()=>h("in_use"),children:"In-Use Vehicles"}),e.jsx(j,{onClick:()=>h("maintenance"),children:"Maintenance Vehicles"}),e.jsx(j,{onClick:()=>h("forRegistration"),children:"For Registration Vehicles"})]})]}),e.jsxs(c,{color:"light",size:"sm",onClick:Y,children:[e.jsx(t,{icon:te,className:"me-2 text-primary"}),"Print List"]})]})]})})}),e.jsx(Ne,{children:r.filter(s=>!s.deleted).map(s=>e.jsx(ye,{sm:12,className:"mb-4",children:e.jsx(R,{className:"shadow-sm border-top-0 border-left-0 border-right-0 border-bottom border-primary",style:{cursor:"pointer",borderWidth:"3px"},children:e.jsxs("div",{className:"d-flex flex-row",children:[e.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:"120px",minHeight:"100%"},children:e.jsx(t,{icon:p,size:"3x",className:"text-primary"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs($,{className:"d-flex justify-content-between align-items-center bg-white border-0",children:[e.jsx("div",{children:e.jsxs("h5",{className:"mb-0",children:[e.jsx(t,{icon:le,className:"me-2 text-primary"}),s.regisNumber||"No Registration"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[W(s.status||"unknown"),e.jsx(c,{color:"link",className:"p-0 ms-3",onClick:()=>G(s._id),children:e.jsx(t,{icon:f===s._id?ie:ne,size:"lg"})})]})]}),e.jsxs(Ce,{className:"py-2",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Driver"}),e.jsxs("div",{children:[e.jsx(t,{icon:re,className:"me-2 text-info"}),e.jsx("strong",{children:s.driver||"Not Assigned"})]})]}),e.jsxs("div",{className:"me-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:"Registration Expiry"}),e.jsxs("div",{children:[e.jsx(t,{icon:A,className:"me-2 text-warning"}),e.jsx("strong",{children:J(s.regisExprationDate)})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small mb-1",children:"Brand & Model"}),e.jsxs("div",{children:[e.jsx(t,{icon:E,className:"me-2 text-secondary"}),e.jsx("strong",{children:(s.brand||"")+" "+(s.model||"")})]})]})]}),e.jsxs(ve,{visible:f===s._id,children:[e.jsx("hr",{className:"my-3"}),e.jsx("div",{className:"row",children:X.filter(a=>!["regisNumber","driver","regisExprationDate","status","brand","model"].includes(a.key)).map(a=>e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("div",{className:"text-muted small mb-1",children:a.label}),e.jsxs("div",{children:[a.icon&&e.jsx(t,{icon:a.icon,className:"me-2 text-primary"}),e.jsx("strong",{children:s[a.key]||"N/A"})]})]},a.key))})]})]}),f===s._id&&e.jsxs(ke,{className:"bg-white d-flex justify-content-end gap-2 py-2",children:[e.jsxs(c,{color:"info",size:"sm",onClick:()=>C("view",s),children:[e.jsx(t,{icon:me,className:"me-1"})," View"]}),e.jsxs(c,{color:"success",size:"sm",onClick:()=>C("edit",s),children:[e.jsx(t,{icon:he,className:"me-1"})," Edit"]}),e.jsxs(c,{color:"danger",size:"sm",onClick:()=>C("delete",s),children:[e.jsx(t,{icon:xe,className:"me-1"})," Delete"]})]})]})]})})},s._id))})]}),e.jsxs(Ve,{visible:Z,onClose:()=>y(!1),children:[e.jsx(De,{closeButton:!0,children:e.jsx(Se,{children:"Password Protected File"})}),e.jsxs(_e,{children:[e.jsxs("p",{children:["Your file ",e.jsx("strong",{children:L})," has been downloaded successfully."]}),e.jsx("p",{children:"Use the following password to unlock the ZIP file:"}),e.jsxs(v,{color:"info",className:"d-flex align-items-center",children:[e.jsx(t,{icon:P,className:"me-3 fs-4"}),e.jsx("div",{className:"font-monospace fw-bold",children:U})]}),e.jsx("p",{className:"text-muted small",children:"This password is unique to your account. Please keep it secure."})]}),e.jsx(Ie,{children:e.jsx(c,{color:"secondary",onClick:()=>y(!1),children:"Close"})})]})]})};export{Ue as default};
